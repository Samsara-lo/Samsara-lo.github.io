<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ollvm_BCFæºç é˜…è¯»</title>
      <link href="/2025/06/15/ollvm-BCF%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
      <url>/2025/06/15/ollvm-BCF%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="è™šå‡æ§åˆ¶æµ-BCF-Bogus-Control-Flow"><a href="#è™šå‡æ§åˆ¶æµ-BCF-Bogus-Control-Flow" class="headerlink" title="è™šå‡æ§åˆ¶æµ BCF (Bogus Control Flow)"></a>è™šå‡æ§åˆ¶æµ BCF (Bogus Control Flow)</h1><h2 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h2><ul><li>è™šå‡æ§åˆ¶æµæ··æ·†é€šè¿‡åŠ å…¥åŒ…å«ä¸é€æ˜è°“è¯çš„æ¡ä»¶è·³è½¬ï¼ˆæ°¸çœŸoræ°¸å‡ï¼‰å’Œä¸å¯è¾¾çš„åŸºæœ¬å—ï¼Œæ¥å¹²æ‰° IDA çš„æ§åˆ¶æµåˆ†æå’Œ F5 åæ±‡ç¼–ã€‚</li></ul><h2 id="åæ··æ·†ï¼š"><a href="#åæ··æ·†ï¼š" class="headerlink" title="åæ··æ·†ï¼š"></a>åæ··æ·†ï¼š</h2><p>1ã€å°†å…¨å±€å˜é‡èµ‹å€¼å¹¶å°† segment è®¾ä¸ºåªè¯»ã€‚</p><ul><li>å¯¹äºå¸¸è§„çš„ ollvm çš„ bcf æ··æ·†æ¥è¯´ï¼Œbcf çš„ä¸é€æ˜è°“è¯éƒ½æ˜¯å¤„äº .bssæ®µ ä¸­ã€‚</li><li>Edit-&gt;Segments-&gt;Edit segment å°† Write å¤é€‰æ¡†å–æ¶ˆå‹¾é€‰ï¼Œ .bssæ®µ å°±è®¾ä¸ºåªè¯»</li></ul><p>2ã€d810 </p><p>3ã€idapython patch ä¸é€æ˜è°“è¯</p><h2 id="æºç ä½ç½®ï¼š"><a href="#æºç ä½ç½®ï¼š" class="headerlink" title="æºç ä½ç½®ï¼š"></a>æºç ä½ç½®ï¼š</h2><p>obfuscator\lib\Transforms\Obfuscation\BogusControlFlow.cpp</p><h2 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h2><h3 id="Passç»“æ„ä¸å‚æ•°"><a href="#Passç»“æ„ä¸å‚æ•°" class="headerlink" title="Passç»“æ„ä¸å‚æ•°"></a>Passç»“æ„ä¸å‚æ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">BogusControlFlow</span> : <span class="keyword">public</span> FunctionPass &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> ID; <span class="comment">// Pass identification</span></span><br><span class="line">    <span class="type">bool</span> flag;</span><br><span class="line">    <span class="built_in">BogusControlFlow</span>() : <span class="built_in">FunctionPass</span>(ID) &#123;&#125;</span><br><span class="line">    <span class="built_in">BogusControlFlow</span>(<span class="type">bool</span> flag) : <span class="built_in">FunctionPass</span>(ID) &#123;<span class="keyword">this</span>-&gt;flag = flag; <span class="built_in">BogusControlFlow</span>();&#125;</span><br></pre></td></tr></table></figure><p>ç»§æ‰¿è‡ª LLVM çš„ FunctionPassã€‚<br>åœ¨ LLVM Pass è®¾è®¡ä¸­ï¼ŒID ç”¨äºæ ‡è¯†æ’ä»¶è‡ªèº«ï¼Œflag å¯ç”¨æ¥æ§åˆ¶æ˜¯å¦å¯¹ç›®æ ‡å‡½æ•°å®é™…ä½œç”¨ï¼ˆå¦‚æŒ‰ç”¨æˆ·å‚æ•°é€‰æ‹©ï¼‰ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨äºæ¥æ”¶å¯é€‰å‚æ•°ã€‚</p><h2 id="passæµç¨‹ä¸»å…¥å£"><a href="#passæµç¨‹ä¸»å…¥å£" class="headerlink" title="passæµç¨‹ä¸»å…¥å£"></a>passæµç¨‹ä¸»å…¥å£</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">runOnFunction</span><span class="params">(Function &amp;F)</span></span>&#123;            <span class="comment">//Passçš„æ ¸å¿ƒå…¥å£</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ObfTimes &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">errs</span>()&lt;&lt;<span class="string">&quot;BogusControlFlow application number -bcf_loop=x must be x &gt; 0&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( !((ObfProbRate &gt; <span class="number">0</span>) &amp;&amp; (ObfProbRate &lt;= <span class="number">100</span>)) ) &#123;</span><br><span class="line">      <span class="built_in">errs</span>()&lt;&lt;<span class="string">&quot;BogusControlFlow application basic blocks percentage -bcf_prob=x must be 0 &lt; x &lt;= 100&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ··æ·†è½®æ•°ï¼ˆObfTimesï¼‰å’Œæ¦‚ç‡å‚æ•°ï¼ˆObfProbRateï¼‰æ˜¯å¦åˆæ³•ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">toObfuscate</span>(flag,&amp;F,<span class="string">&quot;bcf&quot;</span>)) &#123; <span class="comment">//åˆ¤æ–­æ­¤å‡½æ•°æ˜¯å¦è¦æ··æ·†</span></span><br><span class="line">      <span class="built_in">bogus</span>(F);</span><br><span class="line">      <span class="built_in">doF</span>(*F.<span class="built_in">getParent</span>());    <span class="comment">//åœ¨å…¨æ¨¡å—å±‚é¢åšä¸€æ¬¡doFï¼ˆå…¨å±€ä¿®é¥°ï¼Œä¾‹å¦‚æ··æ·†æ‰€æœ‰æ’çœŸçš„æ¡ä»¶ï¼‰</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="comment">// end of runOnFunction()</span></span><br></pre></td></tr></table></figure><h3 id="éšæœºé€‰æ‹©ã€éå†æ¯ä¸ªåŸºæœ¬å—"><a href="#éšæœºé€‰æ‹©ã€éå†æ¯ä¸ªåŸºæœ¬å—" class="headerlink" title="éšæœºé€‰æ‹©ã€éå†æ¯ä¸ªåŸºæœ¬å—"></a>éšæœºé€‰æ‹©ã€éå†æ¯ä¸ªåŸºæœ¬å—</h3><p><code>bogus(F)</code>çš„ä¸»è¦é€»è¾‘æ˜¯ï¼šå¾ªç¯è¦æ··æ·†å¤šå°‘è½®ï¼Œæ¯è½®éå†å‡½æ•°å½“å‰å…¨éƒ¨åŸºæœ¬å—ã€‚å¯¹æ¯ä¸ªBasicBlockæŒ‰æ¦‚ç‡ ObfProbRate éšæœºå†³å®šæ˜¯å¦æ’å…¥è™šå‡æ§åˆ¶æµâ€”â€”é€‰ä¸­åè°ƒç”¨addBogusFlow(basicBlock, F)ã€‚å…¶ä¸­æ’å…¥è™šå‡æµç¨‹ä¼šå¯¼è‡´æ–°ç”Ÿæˆ3ä¸ªåŸºæœ¬å—ï¼Œå› æ­¤ç»Ÿè®¡é‡éœ€ç›¸åº”è‡ªå¢ã€‚æ¯ä¸€è½®å¾ªç¯å¤„ç†åï¼ŒfirstTimeä½è®¾ä¸ºfalseï¼Œé¿å…é‡å¤åˆå§‹åŒ–ç»Ÿè®¡å˜é‡ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">bogus</span><span class="params">(Function &amp;F)</span> </span>&#123;</span><br><span class="line">    ++NumFunction;              </span><br><span class="line">    <span class="type">int</span> NumBasicBlocks = <span class="number">0</span>;     </span><br><span class="line">    <span class="type">bool</span> firstTime = <span class="literal">true</span>;      </span><br><span class="line">    <span class="type">bool</span> hasBeenModified = <span class="literal">false</span>; </span><br><span class="line">    <span class="type">int</span> NumObfTimes = ObfTimes;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        std::list&lt;BasicBlock *&gt; basicBlocks;</span><br><span class="line">        <span class="comment">// --- 1. æŠŠå½“å‰Fçš„æ‰€æœ‰åŸºæœ¬å—æ”¶é›†åˆ°listé‡Œ ---</span></span><br><span class="line">        <span class="keyword">for</span>(Function::iterator i = F.<span class="built_in">begin</span>(); i != F.<span class="built_in">end</span>(); ++i)&#123;</span><br><span class="line">            basicBlocks.<span class="built_in">push_back</span>(&amp;*i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// --- 2. éå†æ‰€æœ‰åŸºæœ¬å—ï¼ŒæŒ‰æ¦‚ç‡æŒ‘é€‰ ---</span></span><br><span class="line">        <span class="keyword">while</span>(!basicBlocks.<span class="built_in">empty</span>())&#123;</span><br><span class="line">            NumBasicBlocks ++;</span><br><span class="line">            BasicBlock *basicBlock = basicBlocks.<span class="built_in">front</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// -- 3. æŒ‰æ¦‚ç‡å†³å®šæ˜¯å¦å¯¹è¯¥å—æ··æ·† --</span></span><br><span class="line">            <span class="keyword">if</span>((<span class="type">int</span>)cryptoutils-&gt;<span class="built_in">get_range</span>(<span class="number">100</span>) &lt; ObfProbRate)&#123;</span><br><span class="line">                hasBeenModified = <span class="literal">true</span>;</span><br><span class="line">                ++NumModifiedBasicBlocks;        <span class="comment">// æ··æ·†çš„å—è®¡æ•°</span></span><br><span class="line">                NumAddedBasicBlocks += <span class="number">3</span>;        <span class="comment">// æ¯æ¬¡æ–°å¢3ä¸ªBB</span></span><br><span class="line">                FinalNumBasicBlocks += <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// --- æ ¸å¿ƒï¼šå¯¹è¯¥å—åšbogusæ··æ·† ----</span></span><br><span class="line">                <span class="built_in">addBogusFlow</span>(basicBlock, F);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// -- 4. popæ‰å·²ç»å¤„ç†è¿‡çš„å— --</span></span><br><span class="line">            basicBlocks.<span class="built_in">pop_front</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// -- 5. ç¬¬ä¸€æ¬¡éå†æ—¶ï¼Œç”¨äºè®°å½•ç»Ÿè®¡ --</span></span><br><span class="line">            <span class="keyword">if</span>(firstTime)&#123;</span><br><span class="line">                ++InitNumBasicBlocks;</span><br><span class="line">                ++FinalNumBasicBlocks;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        firstTime = <span class="literal">false</span>;         <span class="comment">// åªåœ¨ç¬¬ä¸€è½®åˆå§‹åŒ–æ—¶ç»Ÿè®¡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(--NumObfTimes &gt; <span class="number">0</span>);       <span class="comment">// è§†æ··æ·†è½®æ•°å¤šæ¬¡å åŠ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ‹†åˆ†åŸºæœ¬å—ï¼Œåˆ¶é€ åˆ†æ”¯ç‚¹"><a href="#æ‹†åˆ†åŸºæœ¬å—ï¼Œåˆ¶é€ åˆ†æ”¯ç‚¹" class="headerlink" title="æ‹†åˆ†åŸºæœ¬å—ï¼Œåˆ¶é€ åˆ†æ”¯ç‚¹"></a>æ‹†åˆ†åŸºæœ¬å—ï¼Œåˆ¶é€ åˆ†æ”¯ç‚¹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BasicBlock::iterator i1 = basicBlock-&gt;<span class="built_in">begin</span>();</span><br><span class="line"><span class="keyword">if</span>(basicBlock-&gt;<span class="built_in">getFirstNonPHIOrDbgOrLifetime</span>())</span><br><span class="line">    i1 = (BasicBlock::iterator)basicBlock-&gt;<span class="built_in">getFirstNonPHIOrDbgOrLifetime</span>();</span><br><span class="line">Twine *var = <span class="keyword">new</span> <span class="built_in">Twine</span>(<span class="string">&quot;originalBB&quot;</span>);</span><br><span class="line">BasicBlock *originalBB = basicBlock-&gt;<span class="built_in">splitBasicBlock</span>(i1, *var);</span><br></pre></td></tr></table></figure><p>å°†å½“å‰basicBlockæŒ‰ç…§é¦–ä¸ªéphiä¸éè°ƒè¯•/å£°æ˜ä½œç”¨åŸŸæŒ‡ä»¤æ‹†åˆ†ï¼šç¬¬ä¸€å—åªä¿ç•™phiä¸å¿…è¦çš„å¤´éƒ¨ä¿¡æ¯ï¼Œå‰©ä½™çš„å†…å®¹æ–°ç”Ÿæˆ originalBBã€‚è¿™æ ·åç»­æ’å…¥åˆ†æ”¯æ—¶å¯ä¿è¯iråˆæ³•æ€§ï¼Œä¸ä¼šç ´åphiå˜é‡ã€‚æ–°originalBBæˆäº†æ’å…¥è·³è½¬çš„ç›®æ ‡ã€‚</p><h3 id="åˆ›å»ºåŸå§‹å—çš„å˜å½¢å‰¯æœ¬"><a href="#åˆ›å»ºåŸå§‹å—çš„å˜å½¢å‰¯æœ¬" class="headerlink" title="åˆ›å»ºåŸå§‹å—çš„å˜å½¢å‰¯æœ¬"></a>åˆ›å»ºåŸå§‹å—çš„å˜å½¢å‰¯æœ¬</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Twine * var3 = <span class="keyword">new</span> <span class="built_in">Twine</span>(<span class="string">&quot;alteredBB&quot;</span>);</span><br><span class="line">BasicBlock *alteredBB = <span class="built_in">createAlteredBasicBlock</span>(originalBB, *var3, &amp;F);</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆäº†ä¸€ä»½originalBBçš„æ·±æ‹·è´ï¼Œå¹¶æŒ‰åç»­ä»£ç åœ¨å…¶ä¸­é—´éšæœºæ’å…¥äº†åƒåœ¾æŒ‡ä»¤</p><h3 id="æ§åˆ¶æµæ‰‡å‡ºä¸æ’å…¥æ’çœŸåˆ¤å®š"><a href="#æ§åˆ¶æµæ‰‡å‡ºä¸æ’å…¥æ’çœŸåˆ¤å®š" class="headerlink" title="æ§åˆ¶æµæ‰‡å‡ºä¸æ’å…¥æ’çœŸåˆ¤å®š"></a>æ§åˆ¶æµæ‰‡å‡ºä¸æ’å…¥æ’çœŸåˆ¤å®š</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡†å¤‡æ¡ä»¶æ’ä¸ºçœŸçš„IR</span></span><br><span class="line">Value * LHS = ConstantFP::<span class="built_in">get</span>(Type::<span class="built_in">getFloatTy</span>(F.<span class="built_in">getContext</span>()), <span class="number">1.0</span>);</span><br><span class="line">Value * RHS = ConstantFP::<span class="built_in">get</span>(Type::<span class="built_in">getFloatTy</span>(F.<span class="built_in">getContext</span>()), <span class="number">1.0</span>);</span><br><span class="line">Twine * var4 = <span class="keyword">new</span> <span class="built_in">Twine</span>(<span class="string">&quot;condition&quot;</span>);</span><br><span class="line">FCmpInst * condition = <span class="keyword">new</span> <span class="built_in">FCmpInst</span>(*basicBlock, FCmpInst::FCMP_TRUE , LHS, RHS, *var4);</span><br><span class="line">BranchInst::<span class="built_in">Create</span>(originalBB, alteredBB, (Value *)condition, basicBlock);</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šå°±æ˜¯1.0å’Œ1.0åšæµ®ç‚¹æ¯”è¾ƒï¼Œè°“è¯FCMP_TRUEä»£è¡¨â€œæ°¸è¿œä¸ºçœŸâ€ã€‚<br>å†ç”¨å®ƒæ„é€ æ¡ä»¶åˆ†æ”¯ï¼Œå¦‚æœ condition ä¸ºçœŸè·³ originalBBï¼Œå¦åˆ™è·³ alteredBBã€‚<br>ä½†å®é™…ä¸Šä¸€ç›´èµ° originalBBã€‚æœ€åä¼šç”±doFå°†è¯¥æ’çœŸåˆ¤æ–­æ›¿æ¢æˆæ›´å¤æ‚çš„è¡¨è¾¾å¼ã€‚</p><h3 id="è®©alteredBBå¾ªç¯å›originalBB"><a href="#è®©alteredBBå¾ªç¯å›originalBB" class="headerlink" title="è®©alteredBBå¾ªç¯å›originalBB"></a>è®©alteredBBå¾ªç¯å›originalBB</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BranchInst::<span class="built_in">Create</span>(originalBB, alteredBB);</span><br></pre></td></tr></table></figure><p>alteredBB çš„ç»ˆæ­¢æŒ‡ä»¤ç›´æ¥è·³å› originalBB</p><h3 id="å†æ¬¡æ‹†åˆ†-originalBB-çš„ç»“å°¾ï¼Œä¼ªé€ -return-alteredBF-è·³è½¬"><a href="#å†æ¬¡æ‹†åˆ†-originalBB-çš„ç»“å°¾ï¼Œä¼ªé€ -return-alteredBF-è·³è½¬" class="headerlink" title="å†æ¬¡æ‹†åˆ† originalBB çš„ç»“å°¾ï¼Œä¼ªé€  return / alteredBF è·³è½¬"></a>å†æ¬¡æ‹†åˆ† originalBB çš„ç»“å°¾ï¼Œä¼ªé€  return / alteredBF è·³è½¬</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">BasicBlock::iterator i = originalBB-&gt;<span class="built_in">end</span>();</span><br><span class="line">Twine * var5 = <span class="keyword">new</span> <span class="built_in">Twine</span>(<span class="string">&quot;originalBBpart2&quot;</span>);</span><br><span class="line">BasicBlock * originalBBpart2 = originalBB-&gt;<span class="built_in">splitBasicBlock</span>(--i , *var5);</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// åœ¨ originalBB æœ«å°¾å†æ’å…¥ä¸€æ¡æ’ä¸ºçœŸçš„åˆ¤æ–­</span></span><br><span class="line">Twine * var6 = <span class="keyword">new</span> <span class="built_in">Twine</span>(<span class="string">&quot;condition2&quot;</span>);</span><br><span class="line">FCmpInst * condition2 = <span class="keyword">new</span> <span class="built_in">FCmpInst</span>(*originalBB, CmpInst::FCMP_TRUE , LHS, RHS, *var6);</span><br><span class="line">BranchInst::<span class="built_in">Create</span>(originalBBpart2, alteredBB, (Value *)condition2, originalBB);</span><br></pre></td></tr></table></figure><h3 id="å…‹éš†åŸå§‹åŸºæœ¬å—å¹¶æ’å…¥åƒåœ¾æŒ‡ä»¤"><a href="#å…‹éš†åŸå§‹åŸºæœ¬å—å¹¶æ’å…¥åƒåœ¾æŒ‡ä»¤" class="headerlink" title="å…‹éš†åŸå§‹åŸºæœ¬å—å¹¶æ’å…¥åƒåœ¾æŒ‡ä»¤"></a>å…‹éš†åŸå§‹åŸºæœ¬å—å¹¶æ’å…¥åƒåœ¾æŒ‡ä»¤</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BasicBlock * alteredBB = llvm::<span class="built_in">CloneBasicBlock</span> (basicBlock, VMap, Name, F);</span><br><span class="line"><span class="comment">// ä¸ºæ¯æ¡æŒ‡ä»¤åšoperand/Phi remapç­‰</span></span><br><span class="line"><span class="comment">// ...éå† alteredBB-&gt;begin(), e= alteredBB-&gt;end()</span></span><br><span class="line"><span class="comment">// æ ¹æ®opcodeéšæœºæ’å…¥è¯¸å¦‚å–å&amp;åŠ æ³•/ç§»ä½/ä¹˜æ³•ç­‰å†—ä½™åƒåœ¾ç®—æœ¯æ“ä½œ</span></span><br></pre></td></tr></table></figure><p>ç”¨ LLVM æä¾›çš„ CloneBasicBlock API æ·±æ‹·è´ä¸€ä¸ªIRåŸºæœ¬å—ï¼Œç„¶åå¯¹å…¶ä¸­æ¯æ¡æŒ‡ä»¤åšå‚æ•°å’Œ phi èŠ‚ç‚¹ç­‰çš„ remappingï¼Œä¿è¯å„æŒ‡å‘æ­£ç¡®ï¼Œç„¶åæŒ‰ç…§ç±»å‹ç»§ç»­åœ¨åˆé€‚ä½ç½®æ’å…¥åƒåœ¾æŒ‡ä»¤ã€‚</p><h3 id="å…¨å±€æ›¿æ¢æ’çœŸåˆ¤å®šæ¡ä»¶"><a href="#å…¨å±€æ›¿æ¢æ’çœŸåˆ¤å®šæ¡ä»¶" class="headerlink" title="å…¨å±€æ›¿æ¢æ’çœŸåˆ¤å®šæ¡ä»¶"></a>å…¨å±€æ›¿æ¢æ’çœŸåˆ¤å®šæ¡ä»¶</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ï¼ˆ1ï¼‰éå†æ‰¾æ‰€æœ‰ FCMP_TRUE çš„åˆ†æ”¯</span></span><br><span class="line"><span class="comment">//ï¼ˆ2ï¼‰ç»Ÿä¸€æ›¿æ¢æˆå¤æ‚ä¸é€æ˜è°“è¯ï¼š(y &lt; 10) || ((x*(x+1)) % 2 == 0)</span></span><br><span class="line">opX = <span class="keyword">new</span> <span class="built_in">LoadInst</span> ((Value *)x, <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">opY = <span class="keyword">new</span> <span class="built_in">LoadInst</span> ((Value *)y, <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">op = BinaryOperator::<span class="built_in">Create</span>(Instruction::Sub, (Value *)opX,</span><br><span class="line">    ConstantInt::<span class="built_in">get</span>(Type::<span class="built_in">getInt32Ty</span>(M.<span class="built_in">getContext</span>()), <span class="number">1</span>, <span class="literal">false</span>), <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">op1 = BinaryOperator::<span class="built_in">Create</span>(Instruction::Mul, (Value *)opX, op, <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">op = BinaryOperator::<span class="built_in">Create</span>(Instruction::URem, op1,</span><br><span class="line">    ConstantInt::<span class="built_in">get</span>(Type::<span class="built_in">getInt32Ty</span>(M.<span class="built_in">getContext</span>()), <span class="number">2</span>, <span class="literal">false</span>), <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">condition = <span class="keyword">new</span> <span class="built_in">ICmpInst</span>((*i), ICmpInst::ICMP_EQ, op,</span><br><span class="line">    ConstantInt::<span class="built_in">get</span>(Type::<span class="built_in">getInt32Ty</span>(M.<span class="built_in">getContext</span>()), <span class="number">0</span>, <span class="literal">false</span>));</span><br><span class="line">condition2 = <span class="keyword">new</span> <span class="built_in">ICmpInst</span>((*i), ICmpInst::ICMP_SLT, opY,</span><br><span class="line">    ConstantInt::<span class="built_in">get</span>(Type::<span class="built_in">getInt32Ty</span>(M.<span class="built_in">getContext</span>()), <span class="number">10</span>, <span class="literal">false</span>));</span><br><span class="line">op1 = BinaryOperator::<span class="built_in">Create</span>(Instruction::Or, (Value *)condition,</span><br><span class="line">    (Value *)condition2, <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">BranchInst::<span class="built_in">Create</span>(((BranchInst*)*i)-&gt;<span class="built_in">getSuccessor</span>(<span class="number">0</span>),</span><br><span class="line">    ((BranchInst*)*i)-&gt;<span class="built_in">getSuccessor</span>(<span class="number">1</span>),(Value *) op1,</span><br><span class="line">    ((BranchInst*)*i)-&gt;<span class="built_in">getParent</span>());</span><br><span class="line">(*i)-&gt;<span class="built_in">eraseFromParent</span>();</span><br></pre></td></tr></table></figure><p>æ€»è€Œè¨€ä¹‹æ˜¯å°†æ‰€æœ‰çš„å‡è·³è½¬å¤æ‚åŒ–</p><h3 id="pass-æ··æ·†æ€è·¯æ ¸å¿ƒ"><a href="#pass-æ··æ·†æ€è·¯æ ¸å¿ƒ" class="headerlink" title="pass æ··æ·†æ€è·¯æ ¸å¿ƒ"></a>pass æ··æ·†æ€è·¯æ ¸å¿ƒ</h3><p>1ã€éšæœºé€‰å–åŸºæœ¬å—<br>2ã€å°†å…¶ä¸€æ‹†ä¸‰ï¼Œå¹¶æ„é€ å†—ä½™always-trueæ¡ä»¶å’Œè™šå‡åˆ†æ”¯<br>3ã€æ’å…¥å¸¦æœ‰åƒåœ¾æŒ‡ä»¤çš„alteredå‰¯æœ¬å—<br>4ã€ç®—æ³•å®Œæˆåï¼Œå†æŠŠè¿™äº›æ’çœŸçš„ predicate å…¨å˜æˆå¤æ‚çš„â€œä¸é€æ˜è°“è¯â€<br>5ã€è¾¾åˆ°æ§åˆ¶æµä¸ç¬¦å·æµåˆ†æéš¾åº¦å¤§å¹…æå‡çš„æ•ˆæœ</p>]]></content>
      
      
      <categories>
          
          <category> æºç é˜…è¯» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> obfuscation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é…ç½®AndroidçœŸæœºåŸºæœ¬ç¯å¢ƒ</title>
      <link href="/2025/04/30/%E9%85%8D%E7%BD%AEAndroid%E7%9C%9F%E6%9C%BA%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83/"/>
      <url>/2025/04/30/%E9%85%8D%E7%BD%AEAndroid%E7%9C%9F%E6%9C%BA%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<h1 id="é…ç½®AndroidçœŸæœºåŸºæœ¬ç¯å¢ƒ"><a href="#é…ç½®AndroidçœŸæœºåŸºæœ¬ç¯å¢ƒ" class="headerlink" title="é…ç½®AndroidçœŸæœºåŸºæœ¬ç¯å¢ƒ"></a>é…ç½®AndroidçœŸæœºåŸºæœ¬ç¯å¢ƒ</h1><h2 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h2><ul><li>éœ€è¦å¼€äº†oemé”</li><li>å°½é‡<strong>ä¸è¦ç”¨åä¸º</strong>çš„çº¿ğŸ”—ï¼Œè¡€çš„æ•™è®­TTåä¸ºçš„ä¸€äº›åè®®ä¸ä¸€æ ·çš„ï¼Œç”¨pixelçš„å®˜æ–¹çº¿æˆ–çº¢ç±³ä¹‹ç±»çš„ï¼Œæ³¨æ„æœ‰äº›çº¿åªæ”¯æŒå……ç”µ</li><li></li></ul><h2 id="äºŒã€é…ç½®AndroidåŸºæœ¬ç¯å¢ƒ"><a href="#äºŒã€é…ç½®AndroidåŸºæœ¬ç¯å¢ƒ" class="headerlink" title="äºŒã€é…ç½®AndroidåŸºæœ¬ç¯å¢ƒ"></a>äºŒã€é…ç½®AndroidåŸºæœ¬ç¯å¢ƒ</h2><h3 id="2-1-é…ç½®Android-SDK"><a href="#2-1-é…ç½®Android-SDK" class="headerlink" title="2.1 é…ç½®Android SDK"></a>2.1 é…ç½®Android SDK</h3><p>å®˜ç½‘ï¼š<a href="https://developer.android.com/studio/releases/platform-tools">https://developer.android.com/studio/releases/platform-tools</a><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304842.png" alt=""><br>æŠŠD:...\platform-toolsæ”¾åˆ°ä½ çš„ç¯å¢ƒå˜é‡é‡Œ<br>ç„¶åæ‰“å¼€cmd/powershellï¼Œè¾“å…¥<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb --version</span><br></pre></td></tr></table></figure><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304843.png" alt=""><br>è¿™å°±æ˜¯é…å¥½äº†</p><h3 id="2-2-é…ç½®USBè°ƒè¯•"><a href="#2-2-é…ç½®USBè°ƒè¯•" class="headerlink" title="2.2 é…ç½®USBè°ƒè¯•"></a>2.2 é…ç½®USBè°ƒè¯•</h3><p>æ‰“å¼€è®¾ç½®-å…³äºæœ¬æœº-bulidå·è¿ç»­ç‚¹å‡»<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304844.png" alt=""><br>ç„¶åé€€å›ä¸Šä¸€é¡µï¼Œåœ¨è®¾ç½®é‡Œæ‰¾åˆ°å¼€å‘è€…é€‰é¡¹<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304845.png" alt=""><br>ç¡®ä¿</p><ul><li>oemé”å¼€</li><li>USBè°ƒè¯•å¼€<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304846.png" alt=""></li></ul><p>å¾€ä¸‹æ‹‰ä¼šæœ‰ä¸ªé»˜è®¤USBé…ç½®ï¼Œè®°å¾—ç‚¹åˆ°æ–‡ä»¶ä¼ è¾“</p><blockquote><p>å¦‚æœé»‘è‰²ä¸å¯é€‰æ¢ä¸€æ ¹çº¢ç±³ä¹‹ç±»åæ­£ä¸æ˜¯åä¸ºçš„çº¿</p></blockquote><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304847.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304848.png" alt=""></p><h2 id="ä¸‰ã€é…ç½®rootç¯å¢ƒ"><a href="#ä¸‰ã€é…ç½®rootç¯å¢ƒ" class="headerlink" title="ä¸‰ã€é…ç½®rootç¯å¢ƒ"></a>ä¸‰ã€é…ç½®rootç¯å¢ƒ</h2><p>å¸‚é¢ä¸Šmagiskçš„æ•™ç¨‹æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æœ¬æ–‡ä»¥kernelsuä¸ºä¾‹å­ï¼Œkernelsuçš„åŠŸèƒ½äº²æµ‹æ›´å¼ºå¤§ã€‚<br>å°tipsï¼škerneléœ€è¦å®‰å“13åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå¦åˆ™æ— æ³•rootã€‚å®‰å“12ä»¥ä¸‹è€è€å®å®å»magiskå§ã€‚</p><h3 id="3-1-æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬"><a href="#3-1-æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬" class="headerlink" title="3.1 æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬"></a>3.1 æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬</h3><p>ç”¨USBçº¿è¿æ¥ç”µè„‘å’Œæ‰‹æœºï¼Œåœ¨powershellé‡Œè¾“å…¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell <span class="built_in">uname</span> -r </span><br></pre></td></tr></table></figure></p><h3 id="3-2-ä¸‹è½½kernelsu-apk"><a href="#3-2-ä¸‹è½½kernelsu-apk" class="headerlink" title="3.2 ä¸‹è½½kernelsu.apk"></a>3.2 ä¸‹è½½kernelsu.apk</h3><p> å®˜ç½‘é“¾æ¥ï¼š<a href="https://kernelsu.com/kernelsu-download.html">https://kernelsu.com/kernelsu-download.html</a><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304799.png" alt=""><br> æ‰“å¼€powershell<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb install KernelSU_v1.0.5_12081-release.apk</span><br></pre></td></tr></table></figure><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304801.png" alt=""></p><h3 id="3-3-ä¸‹è½½-KernelSU"><a href="#3-3-ä¸‹è½½-KernelSU" class="headerlink" title="3.3 ä¸‹è½½ KernelSU"></a>3.3 ä¸‹è½½ KernelSU</h3><p> å‚è€ƒï¼š<a href="https://kernelsu.com/">https://kernelsu.com/</a></p><h4 id="3-3-1-ä¸‹è½½-KernelSU-img"><a href="#3-3-1-ä¸‹è½½-KernelSU-img" class="headerlink" title="3.3.1 ä¸‹è½½ KernelSU.img"></a>3.3.1 ä¸‹è½½ KernelSU.img</h4><p> githubï¼š<a href="https://github.com/tiann/KernelSU/releases/tag/v1.0.5">https://github.com/tiann/KernelSU/releases/tag/v1.0.5</a><br> è“å¥ç›˜ï¼š<a href="https://mrzzoxo.lanzoue.com/b02qi7toh">https://mrzzoxo.lanzoue.com/b02qi7toh</a><br>é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ï¼Œéªé¾™ä¸€èˆ¬æ˜¯ boot.imgï¼Œè”å‘ç§‘ä¸€èˆ¬æ˜¯ boot-gz.imgï¼Œå¦‚æœä½¿ç”¨æŸä¸ªå‹ç¼©æ ¼å¼æˆåŠŸå¼€æœºï¼Œåç»­å¯ç»§ç»­ç”¨è¿™ä¸ªæ ¼å¼ã€‚<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304803.png" alt=""><br>ä¸‹è½½å®Œè§£å‹å¥½å…ˆæ”¾è¿™è¿›è¡Œä¸‹ä¸€æ­¥</p><h4 id="3-3-2-ä¸‹è½½-ç³»ç»ŸåŒ…å’Œpayload-dumper-go"><a href="#3-3-2-ä¸‹è½½-ç³»ç»ŸåŒ…å’Œpayload-dumper-go" class="headerlink" title="3.3.2 ä¸‹è½½ ç³»ç»ŸåŒ…å’Œpayload-dumper-go"></a>3.3.2 ä¸‹è½½ ç³»ç»ŸåŒ…å’Œpayload-dumper-go</h4><p>ç³»ç»ŸåŒ…ï¼š<a href="https://magiskcn.com/roms.html">https://magiskcn.com/roms.html</a></p><p>è“å¥ç›˜ï¼š<a href="https://mrzzoxo.lanzoue.com/b02plgdpi">https://mrzzoxo.lanzoue.com/b02plgdpi</a><br>@payload-dumper-go.zip</p><hr><p>ROMåŒ…ï¼š<a href="https://magiskcn.com/roms.html">https://magiskcn.com/roms.html</a></p><hr><p><strong>1ã€é€‰æ‹©åˆé€‚çš„romåŒ…ï¼Œæˆ‘æ˜¯pixel6å®‰å“14ï¼Œä¸‹é¢14çš„éƒ½å¯ä»¥ä¸‹å°½é‡ä¸‹æ–°ä¸€ç‚¹çš„</strong><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304806.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304807.png" alt=""></p><p><strong>2ã€æŠŠpayload.binæ”¾åˆ°payload-dumper-goæ–‡ä»¶å¤¹ä¸‹</strong></p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304808.png" alt=""></p><p><strong>3ã€æ‰“å¼€æ‰“å¼€CMDå‘½ä»¤è¡Œ.batï¼Œè¾“å…¥bï¼Œæ‰“å¼€imgæ–‡ä»¶å¤¹å°±å¯ä»¥çœ‹åˆ°boot.imgäº†</strong></p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304809.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304810.png" alt=""></p><p><strong>4ã€ä¼ è¾“boot.imgåˆ°æ‰‹æœº</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push boot.img /storage/emulated/0/Download/</span><br></pre></td></tr></table></figure></p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304811.png" alt=""></p><p><strong>5ã€æ‰“å¼€kernelsu.apk-ä¸»é¡µ-å®‰è£…-é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶-boot.img-å®‰è£…</strong><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304813.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304814.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304815.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304816.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304817.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304818.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304819.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304820.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304822.png" alt=""></p><p>è¿™é‡Œä½ çš„Downloadæ–‡ä»¶å¤¹é‡Œä¼šå¤šä¸€ä¸ªkernelsu_patched_xxxx_xxxx.imgæ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯ä½ åˆ·å…¥çš„ç³»ç»Ÿäº†ã€‚ï¼ˆæˆ‘è¿™åŸæ¥åˆ·è¿‡ä¸€éäº†æ‰€ä»¥æœ‰ä¸¤ä¸ªï¼‰<br>â­<strong>æ¯ä¸ªäººçš„æ–‡ä»¶åˆ·å‡ºæ¥ä¸ä¸€æ ·</strong>ï¼Œæ‰€ä»¥ä¸è¦ç›´æ¥ç”¨ï¼Œè¦è‡ªå·±æ‰¾ã€‚</p><h3 id="3-3-3-adb-fastboot-åˆ·å…¥ç³»ç»Ÿ"><a href="#3-3-3-adb-fastboot-åˆ·å…¥ç³»ç»Ÿ" class="headerlink" title="3.3.3 adb-fastboot+åˆ·å…¥ç³»ç»Ÿ"></a>3.3.3 adb-fastboot+åˆ·å…¥ç³»ç»Ÿ</h3><p>adb-fastbootï¼š<a href="https://mrzzoxo.lanzoue.com/b02plghuh">https://mrzzoxo.lanzoue.com/b02plghuh</a><br>@adb-fastbootã€‚zip</p><p><strong>1ã€æŠŠ<code>kernelsu_patched_xxxx_xxxx.img</code>ä¼ å›ç”µè„‘ï¼Œæ”¾åˆ°<code>adb-fastboot</code> ç›®å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb pull /storage/emulated/0/Download/kernelsu_patched_xxxx_xxx.img ä½ çš„windowsè·¯å¾„</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304823.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304824.png" alt=""></p><p><strong>2ã€è¿›å…¥bootloader</strong></p><p>æ‰“å¼€powershellè¾“å…¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb reboot bootloader</span><br></pre></td></tr></table></figure></p><p><strong>3ã€åˆ·å…¥<code>kernelsu_patched_xxxx_xxxx.img</code></strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fastboot flash boot kernelsu_patched_xxxx_xxxx.img</span><br><span class="line">fastboot reboot</span><br></pre></td></tr></table></figure><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304825.png" alt=""></p><p>è¿™å°±æ˜¯åˆ·å¥½äº†<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304826.png" alt=""></p><h3 id="3-4-å¼€å¯rootæƒé™"><a href="#3-4-å¼€å¯rootæƒé™" class="headerlink" title="3.4 å¼€å¯rootæƒé™"></a>3.4 å¼€å¯rootæƒé™</h3><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301335444.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301335445.png" alt=""></p><h2 id="å››ã€å¸¸ç”¨çš„è½¯ä»¶"><a href="#å››ã€å¸¸ç”¨çš„è½¯ä»¶" class="headerlink" title="å››ã€å¸¸ç”¨çš„è½¯ä»¶"></a>å››ã€å¸¸ç”¨çš„è½¯ä»¶</h2><h3 id="4-1-frida"><a href="#4-1-frida" class="headerlink" title="4.1 frida"></a>4.1 frida</h3><h4 id="4-1-1-å®‰è£…frida"><a href="#4-1-1-å®‰è£…frida" class="headerlink" title="4.1.1 å®‰è£…frida"></a>4.1.1 å®‰è£…frida</h4><p>åœ¨powershellé‡Œè¾“å…¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install frida</span><br><span class="line">pip install frida-tools</span><br></pre></td></tr></table></figure></p><h4 id="4-1-2-frida-server"><a href="#4-1-2-frida-server" class="headerlink" title="4.1.2 frida-server"></a>4.1.2 frida-server</h4><p>fridaé“¾æ¥ï¼š<a href="https://github.com/frida/frida/releases">https://github.com/frida/frida/releases</a></p><p>æ³¨æ„å…ˆæŸ¥çœ‹ä½ çš„frida versionï¼Œéœ€è¦é€‰æ‹©ç›¸åº”ç‰ˆæœ¬çš„firdaserver<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida --version</span><br></pre></td></tr></table></figure><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304828.png" alt=""><br>æ‰¾åˆ°releaseé‡Œç›¸åº”çš„ç‰ˆæœ¬<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304829.png" alt=""><br>æˆ‘æ‰‹æœºæ˜¯amd64çš„<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304830.png" alt=""><br>è§£å‹å‡ºæ¥é•¿è¿™æ ·ï¼Œä½ å¯ä»¥æŒ‰F2ç»™æ–‡ä»¶æ”¹ä¸ªåå­—é˜²æ­¢æ£€æµ‹<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304831.png" alt=""><br>æŠŠå®ƒæ¨é€åˆ°æ‰‹æœº<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb push fs /data/local/tmp/</span><br><span class="line">fsæ˜¯æˆ‘æ”¹äº†åå­—çš„fridaserver</span><br></pre></td></tr></table></figure></p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304832.png" alt=""></p><h3 id="4-2-MTç®¡ç†å™¨-NPç®¡ç†å™¨"><a href="#4-2-MTç®¡ç†å™¨-NPç®¡ç†å™¨" class="headerlink" title="4.2 MTç®¡ç†å™¨/NPç®¡ç†å™¨"></a>4.2 MTç®¡ç†å™¨/NPç®¡ç†å™¨</h3><p>@ MTç®¡ç†å™¨.zip<br>@ NPç®¡ç†å™¨.zip</p><p>MTç®¡ç†å™¨æ˜¯æ”¶è´¹è½¯ä»¶ï¼ŒNPå¹³æ›¿</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb install MTç®¡ç†å™¨_2.11.8.apk</span><br></pre></td></tr></table></figure><h3 id="4-3-Zygisk-Next"><a href="#4-3-Zygisk-Next" class="headerlink" title="4.3 Zygisk-Next"></a>4.3 Zygisk-Next</h3><p>githubï¼š<a href="https://github.com/Dr-TSNG/ZygiskNext/releases/tag/v1.2.8">https://github.com/Dr-TSNG/ZygiskNext/releases/tag/v1.2.8</a><br>@Zygisk-Next-1.2.8-512-4b5d6ad-release.zip<br>Zygisk-Nextå’Œlposedåˆ·å…¥æ•™ç¨‹ä¸€æ ·çš„ï¼Œä¸€èµ·å†™åœ¨ä¸‹é¢äº†</p><h3 id="4-4-Lsposedæ¨¡å—"><a href="#4-4-Lsposedæ¨¡å—" class="headerlink" title="4.4 Lsposedæ¨¡å—"></a>4.4 Lsposedæ¨¡å—</h3><p>Githubï¼š<br>@LSPosed-v1.9.2-7024-zygisk-release.zip<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push LSPosed-v1.9.2-7024-zygisk-release.zip /storage/emulated/0/Download/</span><br></pre></td></tr></table></figure><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304835.png" alt=""></p><p>æ‰“å¼€kernelsuï¼Œæ¨¡å—-å®‰è£…<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304836.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304837.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304838.png" alt=""><br>é‡å¯ï¼Œé€šè¿‡æ‹¨å·é”®è¾“å…¥ <em>#</em>#5776733#<em>#</em> è¿›å…¥ LSPosed<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304839.png" alt=""><br>ç‚¹è¿›å»å»ºç«‹å¿«æ·æ–¹å¼<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304840.png" alt=""><br>â­å¦‚æœç‚¹ä¸å¼€å»çœ‹ä½ å¯èƒ½é‡åˆ°çš„é—®é¢˜</p><h3 id="4-5-ç®—æ³•åŠ©æ‰‹"><a href="#4-5-ç®—æ³•åŠ©æ‰‹" class="headerlink" title="4.5 ç®—æ³•åŠ©æ‰‹"></a>4.5 ç®—æ³•åŠ©æ‰‹</h3><p>githubï¼š<a href="https://github.com/Xposed-Modules-Repo/com.junge.algorithmaide/releases/tag/212-2.1.2">https://github.com/Xposed-Modules-Repo/com.junge.algorithmaide/releases/tag/212-2.1.2</a><br>@ ç®—æ³•åŠ©æ‰‹.zip</p><p>è¿™ä¸ªéœ€è¦è£…å¥½zygiskå’ŒLSPosedæ‰èƒ½ç”¨ï¼ˆæœ‰å…ˆåé¡ºåºï¼‰</p><h2 id="äº”ã€ä½ å¯èƒ½é‡åˆ°çš„é—®é¢˜"><a href="#äº”ã€ä½ å¯èƒ½é‡åˆ°çš„é—®é¢˜" class="headerlink" title="äº”ã€ä½ å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>äº”ã€ä½ å¯èƒ½é‡åˆ°çš„é—®é¢˜</h2><h3 id="5-1-ä¸€ç›´waiting-for-device"><a href="#5-1-ä¸€ç›´waiting-for-device" class="headerlink" title="5.1 ä¸€ç›´waiting for device"></a>5.1 ä¸€ç›´waiting for device</h3><p>1ã€æ²¡è£…é©±åŠ¨ï¼Œå»çœ‹è®¾å¤‡ç®¡ç†å™¨é‡Œä½ çš„è®¾å¤‡æœ‰æ²¡æœ‰é»„è‰²æ„Ÿå¹å·ï¼Œè¿™ä¸ªç½‘ä¸Šå¾ˆå¤šè§£å†³æ–¹å¼<br>2ã€çº¿çš„é—®é¢˜ï¼Œåä¸ºçš„çº¿åè®®ä¸å¤ªä¸€æ ·ï¼Œæ¢ä¸ªçº¿<br>3ã€å¼€å‘è€…æ¨¡å¼-USBåå¥½è®¾ç½®é‡ŒUSBç”¨é€”æ²¡é€‰åˆ°æ–‡ä»¶ä¼ è¾“/Andorid Auto</p><h3 id="5-2-lsposedæ¨¡å—æ‰“ä¸å¼€ï¼Œé”™è¯¯æŠ¥å‘ŠåŒ…å«çš„æ•°æ®æ¥è‡ªäºç³»ç»Ÿå„è‡ªæ—¥å¿—â€¦"><a href="#5-2-lsposedæ¨¡å—æ‰“ä¸å¼€ï¼Œé”™è¯¯æŠ¥å‘ŠåŒ…å«çš„æ•°æ®æ¥è‡ªäºç³»ç»Ÿå„è‡ªæ—¥å¿—â€¦" class="headerlink" title="5.2 lsposedæ¨¡å—æ‰“ä¸å¼€ï¼Œé”™è¯¯æŠ¥å‘ŠåŒ…å«çš„æ•°æ®æ¥è‡ªäºç³»ç»Ÿå„è‡ªæ—¥å¿—â€¦."></a>5.2 lsposedæ¨¡å—æ‰“ä¸å¼€ï¼Œé”™è¯¯æŠ¥å‘ŠåŒ…å«çš„æ•°æ®æ¥è‡ªäºç³»ç»Ÿå„è‡ªæ—¥å¿—â€¦.</h3><p>é”™è¯¯æ—¥å¿—ï¼š<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202506301304841.png" alt=""><br>è§£å†³æ–¹æ³•ï¼š<br>1ã€<code>adb uninstall com.google.android.art</code><br>2ã€æ›´æ¢lsposedï¼Œç”¨lsposed modæˆ–è€…æ›´æ–°çš„lsposedï¼Œäº²æµ‹è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒæœ‰ç”¨<br>lsposed1.10.1ï¼š<a href="https://github.com/topics/xposed">https://github.com/topics/xposed</a></p><h3 id="5-3-Wi-Fi-â€œç½‘ç»œè¿æ¥å—é™â€"><a href="#5-3-Wi-Fi-â€œç½‘ç»œè¿æ¥å—é™â€" class="headerlink" title="5.3 Wi-Fi â€œç½‘ç»œè¿æ¥å—é™â€"></a>5.3 Wi-Fi â€œç½‘ç»œè¿æ¥å—é™â€</h3><p>æ¢ä¸ªæœåŠ¡å™¨å°±å†™ï¼Œå‚è€ƒè¿™ç¯‡æ–‡ç« <br><a href="https://www.cnblogs.com/leotiger/p/18308609">è§£å†³Pixelã€Lineageç­‰åŸå§‹ç³»ç»Ÿä¸­çš„WIFIç½‘ç»œè¿æ¥å—é™é—®é¢˜</a></p><hr><p>Androidé€†å‘ä¹‹æ—…åˆšåˆšå¯ç¨‹ï¼Œç¥ä½ é¡ºåˆ©</p>]]></content>
      
      
      <categories>
          
          <category> å®æˆ˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> ç¯å¢ƒæ­å»º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDAä½¿ç”¨æŠ€å·§</title>
      <link href="/2025/03/26/IDA%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
      <url>/2025/03/26/IDA%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸¤å¤©åšé¢˜çš„æ—¶å€™åŒå±Šçš„pwnå¸ˆå‚…sakuraæ¥é—®æœ‰æ²¡æœ‰å¯ä»¥ä¿®æ”¹IDAå±€éƒ¨å˜é‡çš„æ–¹æ³•ã€‚ç ”ç©¶äº†ä¸€ä¸‹æ„Ÿè§‰å¾ˆæœ‰æ„æ€ï¼Œäºæ˜¯å•ç‹¬å¼€ä¸€ç¯‡æ–‡ç« è®°å½•æˆ‘ç»å¸¸ç”¨åˆ°çš„IDAå°æŠ€å·§ã€‚</p><h1 id="ä¿®æ”¹å±€éƒ¨å˜é‡"><a href="#ä¿®æ”¹å±€éƒ¨å˜é‡" class="headerlink" title="ä¿®æ”¹å±€éƒ¨å˜é‡"></a>ä¿®æ”¹å±€éƒ¨å˜é‡</h1><h2 id="IDA"><a href="#IDA" class="headerlink" title="IDA"></a>IDA</h2><p>IDAæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œæˆ‘åœ¨ç½‘ä¸ŠæŸ¥åˆ°å¯ä»¥force new variableï¼Œä½†æ˜¯æˆ‘ä¸€ç›´æ²¡æˆåŠŸã€‚</p><h3 id="å®ç°æ•ˆæœï¼š"><a href="#å®ç°æ•ˆæœï¼š" class="headerlink" title="å®ç°æ•ˆæœï¼š"></a>å®ç°æ•ˆæœï¼š</h3><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260152493.png" alt=""></p><h3 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h3><p>å› ä¸ºå¯ä»¥è§‚å¯Ÿåˆ°éƒ½æ˜¯åˆ†å¼€èµ‹å€¼çš„</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260206208.png" alt=""></p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260207597.png" alt=""></p><p>æˆ‘ä»¬åœ¨var_5é‚£è¾¹æŒ‰U</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260211783.png" alt=""></p><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ†å‡ºä¸€ä¸ªchar+intï¼Œå› ä¸ºæˆ‘å¾—éœ€æ±‚æ˜¯è®©v2[0]å•ç‹¬åˆ†å‡ºæ¥å˜æˆcharï¼Œv2[1]-v2[4]å˜æˆå››å­—èŠ‚çš„intï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©1+4</p><p>åœ¨01çš„åœ°æ–¹æŒ‰Né‡å‘½åæˆiï¼Œåœ¨05çš„åœ°æ–¹é€‰æ‹©å»ºç«‹æ•°ç»„ï¼ˆå¯ä»¥æŒ‰Aï¼‰åœ¨Næˆopcode</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260220412.png" alt=""></p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260222223.png" alt=""></p><p>å›åˆ°executeBrainfuckæŒ‰F5</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260223664.png" alt=""></p><p>æ¥ç€æ¥æ”¹æ±‡ç¼–</p><p>å› ä¸ºIDAåœ¨åç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šæ ¹æ®å˜é‡çš„è®¿é—®æ–¹å¼å’ŒæŒ‡ä»¤æ¥æ¨æ–­å˜é‡ç±»å‹</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260230570.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov     dword ptr [rbp+opcode+1], 0  ; èµ‹å€¼äº† 4 ä¸ªå­—èŠ‚</span><br></pre></td></tr></table></figure><p>opcode[1]ä¹‹åæ˜¯ 4 ä¸ªè¿ç»­çš„å­—èŠ‚ï¼ŒIDAä¼šæ¨æµ‹opcode[5]è¿™æ ·çš„å­˜å‚¨</p><p>æˆ‘ä»¬æŠŠå®ƒnopæ‰</p><p>1ã€<code>opcode+1</code>å­—èŠ‚æ•°æ˜¾ç€åœ°<code>4</code>åˆå§‹åŒ–ï¼ŒIDA æ— æ³•ç¡®è®¤å®ƒæ˜¯å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¯èƒ½ä¼šè¢«æ‹†é™¤<code>int</code>ã€‚</p><p>2.IDAåå‘äºæœ€ç®€å•çš„æ•°æ®ç»“æ„ï¼Œå› æ­¤<code>[rbp-5h]</code>ç›´æ¥èµ‹å€¼<code>signed __int8 opcode</code>ï¼Œè€Œ<code>[rbp-4h]</code>ä½œä¸º<code>int opcode_1</code>å¤„ç†ã€‚</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260234728.png" alt=""></p><p>åœ¨opcodeé‚£é‡ŒæŒ‰Yè½¬æ¢å‡½æ•°ç±»å‹+æŒ‰Né‡å‘½åiå°±å¥½äº†</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260236267.jpg" alt=""></p><h2 id="Ghidraä¸€æŠŠæ¢­"><a href="#Ghidraä¸€æŠŠæ¢­" class="headerlink" title="Ghidraä¸€æŠŠæ¢­"></a>Ghidraä¸€æŠŠæ¢­</h2><p>è€ƒè™‘åˆ°æ˜¯pwnçš„å¸ˆå‚…ï¼Œæ‰€ä»¥ä¸æ¨èï¼ˆï¼‰ghidraæŒºéº»çƒ¦çš„ä½†æ˜¯è¶³å¤Ÿåº•å±‚ï¼Œç¡®å®å¥½ç”¨</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260158257.jpg" alt=""></p><h1 id="ä¼ªä»£ç å¯¹åº”æ±‡ç¼–"><a href="#ä¼ªä»£ç å¯¹åº”æ±‡ç¼–" class="headerlink" title="ä¼ªä»£ç å¯¹åº”æ±‡ç¼–"></a>ä¼ªä»£ç å¯¹åº”æ±‡ç¼–</h1><p>å¯ä»¥å®ç°ç‚¹ä¼ªä»£ç å“ªé‡Œæ±‡ç¼–ä¼šç›¸åº”è·³è½¬ï¼Œæ±‡ç¼–åŒç†ï¼Œpatchçš„æ—¶å€™å¥½ç”¨</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260202020.png" alt=""></p><h1 id="ä¿®å¤æšä¸¾å€¼"><a href="#ä¿®å¤æšä¸¾å€¼" class="headerlink" title="ä¿®å¤æšä¸¾å€¼"></a>ä¿®å¤æšä¸¾å€¼</h1><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503261654447.png" alt=""></p><p>ä»¥ptraceå‡½æ•°ä¸ºä¾‹ï¼Œè¿™é‡Œçš„12LLè¡¨ç¤ºä¸€ä¸ªåŠŸèƒ½å·ã€‚åœ¨12ä¸Šé¢æŒ‰Mï¼Œç‚¹å‡»yesï¼Œctrl+Fæœç´¢ptraceï¼Œè¿™é‡Œæ˜¯PTRACE_GETREGS</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503261657409.png" alt=""></p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AI_agent_zer0_to_oneï¼ˆäºŒï¼‰</title>
      <link href="/2025/03/16/AI-agent-zer0-to-one%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2025/03/16/AI-agent-zer0-to-one%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="AI-Agent-æ¶æ„è®¾è®¡"><a href="#AI-Agent-æ¶æ„è®¾è®¡" class="headerlink" title="AI Agent æ¶æ„è®¾è®¡"></a><strong>AI Agent æ¶æ„è®¾è®¡</strong></h2><h3 id="Agent-æ¶æ„çš„åŸºæœ¬ç»„ä»¶"><a href="#Agent-æ¶æ„çš„åŸºæœ¬ç»„ä»¶" class="headerlink" title="Agent æ¶æ„çš„åŸºæœ¬ç»„ä»¶"></a><strong>Agent æ¶æ„çš„åŸºæœ¬ç»„ä»¶</strong></h3><p>AI Agentçš„æ¶æ„é€šå¸¸åŒ…å«ä»¥ä¸‹åŸºæœ¬ç»„ä»¶ï¼šæ„ŸçŸ¥æ¨¡å—ã€æ¨ç†å¼•æ“å’Œè¡ŒåŠ¨æ‰§è¡Œæ¨¡å—ã€‚è¿™äº›ç»„ä»¶å…±åŒå·¥ä½œï¼Œä½¿Agentèƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒã€åšå‡ºå†³ç­–å¹¶é‡‡å–è¡ŒåŠ¨ã€‚</p><p><strong>æ„ŸçŸ¥æ¨¡å—</strong>ï¼šè´Ÿè´£ä»ç¯å¢ƒä¸­æ”¶é›†ä¿¡æ¯ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºAgentå¯ä»¥å¤„ç†çš„æ ¼å¼ã€‚</p><p>å…³é”®ç‰¹ç‚¹ï¼š</p><ol><li>å¤šæ¨¡æ€æ„ŸçŸ¥ï¼šå¤„ç†è§†è§‰ã€å¬è§‰ã€è§¦è§‰ç­‰å¤šç§è¾“å…¥ã€‚</li><li>æ•°æ®é¢„å¤„ç†ï¼šæ»¤æ³¢ã€å½’ä¸€åŒ–ã€ç‰¹å¾æå–ç­‰ã€‚</li><li>ä¼ æ„Ÿå™¨èåˆï¼šæ•´åˆå¤šä¸ªä¼ æ„Ÿå™¨çš„æ•°æ®ã€‚</li></ol><p><strong>æ¨ç†å¼•æ“ï¼š</strong>Agentçš„â€å¤§è„‘â€ï¼Œè´Ÿè´£å¤„ç†æ„ŸçŸ¥åˆ°çš„ä¿¡æ¯ï¼Œåšå‡ºå†³ç­–ï¼Œå¹¶ç”Ÿæˆè¡ŒåŠ¨è®¡åˆ’ã€‚</p><p>å…³é”®ç‰¹ç‚¹ï¼š</p><ol><li>çŸ¥è¯†è¡¨ç¤ºï¼šå­˜å‚¨å’Œç»„ç»‡Agentçš„çŸ¥è¯†å’Œä¿¡å¿µã€‚</li><li>æ¨ç†æœºåˆ¶ï¼šåŸºäºè§„åˆ™ã€æ¦‚ç‡æˆ–ç¥ç»ç½‘ç»œçš„æ¨ç†ã€‚</li><li>å­¦ä¹ èƒ½åŠ›ï¼šä»ç»éªŒä¸­æ›´æ–°çŸ¥è¯†å’Œç­–ç•¥ã€‚</li></ol><p><strong>è¡ŒåŠ¨æ‰§è¡Œæ¨¡å—ï¼š</strong>å°†æ¨ç†å¼•æ“çš„å†³ç­–è½¬åŒ–ä¸ºå…·ä½“çš„è¡ŒåŠ¨ï¼Œå¹¶ä¸ç¯å¢ƒè¿›è¡Œäº¤äº’ã€‚</p><p>å…³é”®ç‰¹ç‚¹ï¼š</p><ol><li>åŠ¨ä½œæ˜ å°„ï¼šå°†é«˜çº§å†³ç­–è½¬æ¢ä¸ºä½çº§æ§åˆ¶å‘½ä»¤ã€‚</li><li>åé¦ˆæ§åˆ¶ï¼šæ ¹æ®æ‰§è¡Œç»“æœè°ƒæ•´è¡ŒåŠ¨ã€‚</li><li>å®‰å…¨æœºåˆ¶ï¼šç¡®ä¿è¡ŒåŠ¨ä¸ä¼šå±åŠAgentæˆ–ç¯å¢ƒã€‚</li></ol><h3 id="å¸¸è§çš„-Agent-æ¶æ„"><a href="#å¸¸è§çš„-Agent-æ¶æ„" class="headerlink" title="å¸¸è§çš„ Agent æ¶æ„"></a><strong>å¸¸è§çš„ Agent æ¶æ„</strong></h3><p><strong>ååº”å¼æ¶æ„ï¼š</strong>ç›´æ¥å°†æ„ŸçŸ¥æ˜ å°„åˆ°è¡ŒåŠ¨ï¼Œä¸éœ€è¦å†…éƒ¨çŠ¶æ€æˆ–å¤æ‚çš„æ¨ç†è¿‡ç¨‹ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ol><li>å¿«é€Ÿå“åº”</li><li>ä½è®¡ç®—å¤æ‚åº¦</li><li>é€‚åˆç®€å•ã€æ˜ç¡®çš„ä»»åŠ¡ç¯å¢ƒ</li></ol><p><strong>åˆ†å±‚æ¶æ„ï¼š</strong>å°†Agentçš„åŠŸèƒ½åˆ’åˆ†ä¸ºå¤šä¸ªå±‚æ¬¡ï¼Œæ¯ä¸ªå±‚æ¬¡è´Ÿè´£ä¸åŒæŠ½è±¡çº§åˆ«çš„ä»»åŠ¡ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ol><li>æ¨¡å—åŒ–è®¾è®¡</li><li>æ”¯æŒä¸åŒæ—¶é—´å°ºåº¦çš„å†³ç­–</li><li><p>é€‚åˆå¤æ‚ä»»åŠ¡å’Œé•¿æœŸè§„åˆ’</p><p><strong>BDI æ¶æ„ï¼š</strong>Belief-Desire-Intentionï¼Œä¸€ç§åŸºäºäººç±»æ¨ç†çš„Agentæ¨¡å‹ï¼ŒåŒ…å«ä¿¡å¿µï¼ˆå¯¹ä¸–ç•Œçš„è®¤çŸ¥ï¼‰ã€æ¬²æœ›ï¼ˆç›®æ ‡ï¼‰å’Œæ„å›¾ï¼ˆè®¡åˆ’ï¼‰ä¸‰ä¸ªå…³é”®ç»„ä»¶ã€‚</p></li></ol><p>ç‰¹ç‚¹ï¼š</p><ol><li>æ¨¡æ‹Ÿäººç±»æ¨ç†è¿‡ç¨‹</li><li>æ”¯æŒå¤æ‚çš„ç›®æ ‡å¯¼å‘è¡Œä¸º</li><li>é€‚åˆåŠ¨æ€ã€ä¸ç¡®å®šçš„ç¯å¢ƒ</li></ol><h3 id="å¤š-Agent-ç³»ç»ŸMASè®¾è®¡"><a href="#å¤š-Agent-ç³»ç»ŸMASè®¾è®¡" class="headerlink" title="å¤š Agent ç³»ç»ŸMASè®¾è®¡"></a><strong>å¤š Agent ç³»ç»ŸMASè®¾è®¡</strong></h3><p>æ¶‰åŠå¤šä¸ªäº¤äº’çš„æ™ºèƒ½Agentï¼Œè¿™äº›Agentå¯ä»¥åä½œæˆ–ç«äº‰æ¥è§£å†³å¤æ‚é—®é¢˜ã€‚è®¾è®¡å¤šAgentç³»ç»Ÿéœ€è¦è€ƒè™‘Agenté—´çš„é€šä¿¡ã€åä½œæœºåˆ¶ä»¥åŠæ•´ä½“ç³»ç»Ÿçš„ç»„ç»‡ç»“æ„ã€‚</p><p><strong>å¤šAgentç³»ç»Ÿï¼ˆMASï¼‰æ¶æ„è®¾è®¡æ¨¡å¼</strong></p><p><strong>æ¦‚è¿°ï¼š</strong>ä¸€ç§ç”¨äºè®¾è®¡å’Œå®ç°å¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¶æ„æ–¹æ³•ã€‚</p><ul><li>æ ¸å¿ƒæ¦‚å¿µï¼š<ul><li><strong>æ™ºèƒ½ä»£ç†</strong>ï¼šæ™ºèƒ½ä»£ç†æ˜¯MASçš„åŸºæœ¬æ„å»ºå•å…ƒã€‚æ¯ä¸ªä»£ç†å…·æœ‰æ„ŸçŸ¥ã€å†³ç­–å’Œè¡ŒåŠ¨çš„èƒ½åŠ›ã€‚ä»£ç†å¯ä»¥æ˜¯è½¯ä»¶å®ä½“æˆ–ç‰©ç†å®ä½“ï¼Œå¦‚æœºå™¨äººã€‚</li><li><strong>ç¯å¢ƒ</strong>ï¼šç¯å¢ƒæ˜¯ä»£ç†æ„ŸçŸ¥å’Œè¡ŒåŠ¨çš„åœºæ‰€ã€‚ç¯å¢ƒå¯ä»¥æ˜¯ç‰©ç†ä¸–ç•Œã€è™šæ‹Ÿä¸–ç•Œæˆ–æ··åˆä¸–ç•Œã€‚</li><li><strong>é€šä¿¡</strong>ï¼šä»£ç†ä¹‹é—´é€šè¿‡é€šä¿¡è¿›è¡Œä¿¡æ¯äº¤æ¢å’Œåä½œã€‚é€šä¿¡å¯ä»¥æ˜¯ç›´æ¥çš„ï¼ˆå¦‚æ¶ˆæ¯ä¼ é€’ï¼‰æˆ–é—´æ¥çš„ï¼ˆå¦‚é€šè¿‡ç¯å¢ƒï¼‰ã€‚</li><li><strong>åä½œ</strong>ï¼šä»£ç†é€šè¿‡åä½œæ¥å®ç°å…±åŒçš„ç›®æ ‡ã€‚åä½œå¯ä»¥æ˜¯æ˜¾å¼çš„ï¼ˆå¦‚ä»»åŠ¡åˆ†é…ï¼‰æˆ–éšå¼çš„ï¼ˆå¦‚è¡Œä¸ºåè°ƒï¼‰ã€‚</li><li><strong>è‡ªæ²»</strong>ï¼šä»£ç†å…·æœ‰è‡ªä¸»å†³ç­–çš„èƒ½åŠ›ï¼Œå¯ä»¥æ ¹æ®ç¯å¢ƒå˜åŒ–å’Œè‡ªèº«ç›®æ ‡è¿›è¡Œè°ƒæ•´ã€‚</li></ul></li><li><p>MASçš„ç³»ç»Ÿæ¶æ„ï¼š</p><ul><li><strong>æ„ŸçŸ¥å±‚</strong>ï¼šè´Ÿè´£ä»ç¯å¢ƒä¸­è·å–ä¿¡æ¯ã€‚</li><li><strong>å†³ç­–å±‚</strong>ï¼šè´Ÿè´£æ ¹æ®æ„ŸçŸ¥ä¿¡æ¯è¿›è¡Œå†³ç­–ã€‚</li><li><strong>è¡ŒåŠ¨å±‚</strong>ï¼šè´Ÿè´£æ‰§è¡Œå†³ç­–å¹¶å½±å“ç¯å¢ƒã€‚</li><li><p><strong>é€šä¿¡å±‚</strong>ï¼šè´Ÿè´£ä»£ç†ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[æ„ŸçŸ¥å±‚] --&gt; B[å†³ç­–å±‚]</span><br><span class="line">    B --&gt; C[è¡ŒåŠ¨å±‚]</span><br><span class="line">    B --&gt; D[é€šä¿¡å±‚]</span><br><span class="line">    D --&gt; B</span><br><span class="line"></span><br><span class="line">%% è‡ªå®šä¹‰æ ·å¼</span><br><span class="line">classDef default fill:#ffffff,stroke:#000000,color:#000000;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ä»£ç†æ¶æ„æ¨¡å¼ï¼š</p><ul><li><strong>ååº”å¼ä»£ç†</strong>ï¼šåŸºäºæ„ŸçŸ¥-è¡ŒåŠ¨è§„åˆ™ï¼Œå¿«é€Ÿå“åº”ç¯å¢ƒå˜åŒ–ã€‚</li><li><strong>è®¤çŸ¥ä»£ç†</strong>ï¼šå…·æœ‰å†…éƒ¨çŠ¶æ€å’Œæ¨ç†èƒ½åŠ›ï¼Œèƒ½å¤Ÿè¿›è¡Œå¤æ‚å†³ç­–ã€‚</li><li><strong>æ··åˆä»£ç†</strong>ï¼šç»“åˆååº”å¼å’Œè®¤çŸ¥ç‰¹æ€§ï¼Œå…¼å…·å¿«é€Ÿå“åº”å’Œå¤æ‚å†³ç­–èƒ½åŠ›ã€‚</li></ul></li><li>åä½œæ¨¡å¼ï¼šå†³å®šäº†ä»£ç†å¦‚ä½•ååŒå·¥ä½œä»¥å®ç°å…±åŒç›®æ ‡ã€‚<ul><li><strong>åˆåŒç½‘åè®®</strong>ï¼šé€šè¿‡ç«æ ‡å’ŒåˆåŒæœºåˆ¶è¿›è¡Œä»»åŠ¡åˆ†é…ã€‚</li><li><strong>é»‘æ¿ç³»ç»Ÿ</strong>ï¼šä»£ç†é€šè¿‡å…±äº«çš„é»‘æ¿è¿›è¡Œä¿¡æ¯äº¤æ¢å’Œåä½œã€‚</li><li><strong>æ‹å–æœºåˆ¶</strong>ï¼šé€šè¿‡æ‹å–æ–¹å¼è¿›è¡Œèµ„æºåˆ†é…å’Œä»»åŠ¡åˆ†é…ã€‚</li></ul></li><li>é€šä¿¡æ¨¡å¼ï¼šå†³å®šäº†ä»£ç†ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢æ–¹å¼ï¼š<ul><li><strong>ç‚¹å¯¹ç‚¹é€šä¿¡</strong>ï¼šä»£ç†ä¹‹é—´ç›´æ¥è¿›è¡Œä¿¡æ¯äº¤æ¢ã€‚</li><li><strong>å¹¿æ’­é€šä¿¡</strong>ï¼šä»£ç†å‘æ‰€æœ‰å…¶ä»–ä»£ç†å‘é€ä¿¡æ¯ã€‚</li><li><strong>å¤šæ’­é€šä¿¡</strong>ï¼šä»£ç†å‘ç‰¹å®šç»„çš„ä»£ç†å‘é€ä¿¡æ¯ã€‚</li></ul></li><li>ç»„ç»‡æ¨¡å¼ï¼šå†³å®šäº†ä»£ç†çš„ç»„ç»‡ç»“æ„å’Œè§’è‰²åˆ†é…ã€‚<ul><li><strong>å±‚æ¬¡ç»“æ„</strong>ï¼šä»£ç†æŒ‰ç…§å±‚æ¬¡è¿›è¡Œç»„ç»‡ï¼Œä¸Šå±‚ä»£ç†è´Ÿè´£åè°ƒå’Œç®¡ç†ä¸‹å±‚ä»£ç†ã€‚</li><li><strong>å¹³é¢ç»“æ„</strong>ï¼šæ‰€æœ‰ä»£ç†å¤„äºåŒä¸€å±‚æ¬¡ï¼Œå…·æœ‰ç›¸åŒçš„æƒåˆ©å’Œè´£ä»»ã€‚</li><li><strong>å›¢é˜Ÿç»“æ„</strong>ï¼šä»£ç†è¢«ç»„ç»‡æˆå¤šä¸ªå›¢é˜Ÿï¼Œæ¯ä¸ªå›¢é˜Ÿè´Ÿè´£ç‰¹å®šçš„ä»»åŠ¡æˆ–åŠŸèƒ½ã€‚</li></ul></li><li>é€‚åº”æ€§æ¨¡å¼ï¼šå†³å®šäº†ä»£ç†å¦‚ä½•åº”å¯¹ç¯å¢ƒå˜åŒ–å’Œä»»åŠ¡å˜åŒ–ã€‚<ul><li><strong>å­¦ä¹ æœºåˆ¶</strong>ï¼šä»£ç†é€šè¿‡å­¦ä¹ ç®—æ³•ï¼ˆå¦‚å¼ºåŒ–å­¦ä¹ ï¼‰æ¥æé«˜æ€§èƒ½ã€‚</li><li><strong>è¿›åŒ–æœºåˆ¶</strong>ï¼šä»£ç†é€šè¿‡è¿›åŒ–ç®—æ³•ï¼ˆå¦‚é—ä¼ ç®—æ³•ï¼‰æ¥ä¼˜åŒ–è¡Œä¸ºã€‚</li><li><strong>è‡ªç»„ç»‡æœºåˆ¶</strong>ï¼šä»£ç†é€šè¿‡è‡ªç»„ç»‡æœºåˆ¶ï¼ˆå¦‚èšç¾¤ä¼˜åŒ–ï¼‰æ¥å®ç°å…¨å±€åè°ƒã€‚</li></ul></li><li>å®‰å…¨ä¸ä¿¡ä»»æ¨¡å¼ï¼šç¡®ä¿ä»£ç†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚<ul><li><strong>èº«ä»½è®¤è¯</strong>ï¼šç¡®ä¿ä»£ç†çš„èº«ä»½çœŸå®æ€§ã€‚</li><li><strong>è®¿é—®æ§åˆ¶</strong>ï¼šé™åˆ¶ä»£ç†å¯¹èµ„æºçš„è®¿é—®æƒé™ã€‚</li><li><strong>ä¿¡ä»»ç®¡ç†</strong>ï¼šé€šè¿‡ä¿¡ä»»æ¨¡å‹è¯„ä¼°ä»£ç†çš„å¯ä¿¡åº¦ã€‚</li></ul></li><li><p>ååº”å¼ä»£ç†ï¼šé€šè¿‡ç®€å•çš„æ„ŸçŸ¥-è¡ŒåŠ¨è§„åˆ™è¿›è¡Œå†³ç­–ã€‚</p><ul><li>å“åº”é€Ÿåº¦å¿«ï¼Œé€‚ç”¨äºåŠ¨æ€å˜åŒ–çš„ç¯å¢ƒã€‚</li><li><p>ç¼ºä¹é•¿æœŸè§„åˆ’èƒ½åŠ›ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Algorithm ReactiveAgent</span><br><span class="line">  Input: Perception p</span><br><span class="line">  Output: Action a</span><br><span class="line"></span><br><span class="line">  RuleSet R = &#123;r1, r2, ..., rn&#125; // Set of perception-action rules</span><br><span class="line">  for each rule r in R do</span><br><span class="line">    if r.condition(p) is true then</span><br><span class="line">      return r.action</span><br><span class="line">  end for</span><br><span class="line">  return null // No applicable action</span><br></pre></td></tr></table></figure></li></ul></li><li><p>è®¤çŸ¥ä»£ç†ï¼šå…·æœ‰å†…éƒ¨çŠ¶æ€å’Œæ¨ç†èƒ½åŠ›ï¼Œèƒ½å¤Ÿè¿›è¡Œå¤æ‚å†³ç­–</p><ul><li>å…·æœ‰å¤æ‚å†³ç­–èƒ½åŠ›ï¼Œé€‚ç”¨äºå¤æ‚ä»»åŠ¡ã€‚</li><li><p>è®¡ç®—å¤æ‚åº¦é«˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Algorithm CognitiveAgent</span><br><span class="line">  Input: Perception p, InternalState s</span><br><span class="line">  Output: Action a</span><br><span class="line"></span><br><span class="line">  BeliefSet B = UpdateBeliefs(p, s)</span><br><span class="line">  DesireSet D = GenerateDesires(B)</span><br><span class="line">  IntentionSet I = SelectIntentions(D)</span><br><span class="line">  Plan P = GeneratePlan(I)</span><br><span class="line">  ExecutePlan(P)</span><br><span class="line">  UpdateState(s, P)</span><br><span class="line"> </span><br></pre></td></tr></table></figure></li></ul></li><li><p>åä½œç®—æ³•ï¼šå®ç°ä»£ç†ä¹‹é—´çš„åä½œã€‚</p><ul><li>çµæ´»æ€§é«˜ï¼Œé€‚ç”¨äºåŠ¨æ€ä»»åŠ¡åˆ†é…ã€‚</li><li><p>é€šä¿¡å¼€é”€å¤§ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Algorithm ContractNet</span><br><span class="line">  Input: Task t</span><br><span class="line">  Output: AssignedAgent a</span><br><span class="line"></span><br><span class="line">  AnnounceTask(t)</span><br><span class="line">  Bids = CollectBids()</span><br><span class="line">  BestBid = SelectBestBid(Bids)</span><br><span class="line">  AssignTask(BestBid.agent, t)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>é€šä¿¡åè®®ï¼šå®šä¹‰ä»£ç†ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢æ ¼å¼</p><p>  KQMLä¼˜ç‚¹ï¼š</p><ul><li>æ ‡å‡†åŒ–ç¨‹åº¦é«˜ï¼Œé€‚ç”¨äºå¼‚æ„ç³»ç»Ÿã€‚</li><li><p>ç¼ºç‚¹æ˜¯å­¦ä¹ æ›²çº¿é™¡å³­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Message KQMLMessage</span><br><span class="line">  Performative: String // e.g., &quot;ask&quot;, &quot;tell&quot;, &quot;achieve&quot;</span><br><span class="line">  Sender: AgentID</span><br><span class="line">  Receiver: AgentID</span><br><span class="line">  Content: String</span><br><span class="line">  Language: String // e.g., &quot;Prolog&quot;, &quot;LISP&quot;</span><br><span class="line">  Ontology: String</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><strong>ä»£ç†å†³ç­–æ¨¡å‹</strong></p><p>é€šå¸¸åŸºäºé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼ˆMDPï¼‰ã€‚</p><ul><li>çŠ¶æ€ç©ºé—´ $S$ï¼šä»£ç†å¯èƒ½å¤„äºçš„æ‰€æœ‰çŠ¶æ€çš„é›†åˆã€‚</li><li>åŠ¨ä½œç©ºé—´ $A$ï¼šä»£ç†å¯èƒ½é‡‡å–çš„æ‰€æœ‰åŠ¨ä½œçš„é›†åˆã€‚</li><li>çŠ¶æ€è½¬ç§»å‡½æ•° $P(sâ€™|s,a)$ï¼šåœ¨çŠ¶æ€ $s$ æ‰§è¡ŒåŠ¨ä½œ $a$ åè½¬ç§»åˆ°çŠ¶æ€ $sâ€™$ çš„æ¦‚ç‡ã€‚</li><li>å¥–åŠ±å‡½æ•° $R(s,a)$ï¼šåœ¨çŠ¶æ€ $s$ æ‰§è¡ŒåŠ¨ä½œ $a$ æ‰€è·å¾—çš„å³æ—¶å¥–åŠ±ã€‚</li></ul><p>å¸¸è§çš„åšå¼ˆæ¨¡å‹ï¼š</p><ul><li><strong>é›¶å’Œåšå¼ˆ</strong>ï¼šä¸€ä¸ªä»£ç†çš„æ”¶ç›Šç­‰äºå¦ä¸€ä¸ªä»£ç†çš„æŸå¤±ã€‚</li><li><strong>åˆä½œåšå¼ˆ</strong>ï¼šä»£ç†é€šè¿‡åˆä½œå®ç°å…±åŒåˆ©ç›Šã€‚</li><li><strong>éåˆä½œåšå¼ˆ</strong>ï¼šä»£ç†ç‹¬ç«‹å†³ç­–ä»¥æœ€å¤§åŒ–è‡ªèº«åˆ©ç›Šã€‚<ul><li>çº³ä»€å‡è¡¡ï¼Œè¡¨ç¤ºåœ¨ç»™å®šç­–ç•¥ç»„åˆä¸‹ï¼Œä»»ä½•ä»£ç†éƒ½æ— æ³•é€šè¿‡å•æ–¹é¢æ”¹å˜ç­–ç•¥è€Œè·å¾—æ›´é«˜æ”¶ç›Šã€‚</li></ul></li></ul><p><strong>Agenté—´é€šä¿¡åè®®</strong></p><p>å®šä¹‰äº†Agentä¹‹é—´äº¤æ¢ä¿¡æ¯çš„æ–¹å¼å’Œæ ¼å¼ã€‚</p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AIå®‰å…¨ </tag>
            
            <tag> AI agent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AI_agent_zer0_to_oneï¼ˆä¸€ï¼‰</title>
      <link href="/2025/03/14/AI-agent-zer0-to-one%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2025/03/14/AI-agent-zer0-to-one%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="AI-Agent-æ¦‚è¿°ä¸ç†è®ºåŸºç¡€"><a href="#AI-Agent-æ¦‚è¿°ä¸ç†è®ºåŸºç¡€" class="headerlink" title="AI Agent æ¦‚è¿°ä¸ç†è®ºåŸºç¡€"></a><strong>AI Agent æ¦‚è¿°ä¸ç†è®ºåŸºç¡€</strong></h2><h3 id="AI-Agent-çš„å®šä¹‰-amp-ç‰¹ç‚¹"><a href="#AI-Agent-çš„å®šä¹‰-amp-ç‰¹ç‚¹" class="headerlink" title="AI Agent çš„å®šä¹‰&amp;ç‰¹ç‚¹"></a><strong>AI Agent çš„å®šä¹‰&amp;ç‰¹ç‚¹</strong></h3><p>AI Agentï¼šæ™ºèƒ½ä»£ç†ï¼Œä¸€ç§èƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒå¹¶åœ¨å…¶ä¸­é‡‡å–è¡ŒåŠ¨ä»¥å®ç°ç‰¹å®šç›®æ ‡çš„è®¡ç®—ç³»ç»Ÿ</p><ol><li>äº¤äº’æ–¹å¼ï¼š<ul><li>ä¼ ç»ŸAIç³»ç»Ÿï¼šé€šå¸¸æ˜¯è¢«åŠ¨çš„ï¼Œåªåœ¨æ¥æ”¶åˆ°è¾“å…¥æ—¶æ‰è¿›è¡Œå¤„ç†ã€‚</li><li>AI Agentï¼šä¸»åŠ¨ä¸ç¯å¢ƒäº¤äº’ï¼ŒæŒç»­æ„ŸçŸ¥å’Œè¡ŒåŠ¨ã€‚</li></ul></li><li>å†³ç­–èƒ½åŠ›ï¼š<ul><li>ä¼ ç»ŸAIç³»ç»Ÿï¼šå¾€å¾€åŸºäºé¢„å®šä¹‰çš„è§„åˆ™æˆ–æ¨¡å‹è¿›è¡Œå†³ç­–ã€‚</li><li>AI Agentï¼šèƒ½å¤Ÿæ ¹æ®ç¯å¢ƒå˜åŒ–åŠ¨æ€è°ƒæ•´å†³ç­–ç­–ç•¥ã€‚</li></ul></li><li>å­¦ä¹ èƒ½åŠ›ï¼š<ul><li>ä¼ ç»ŸAIç³»ç»Ÿï¼šå­¦ä¹ èƒ½åŠ›æœ‰é™ï¼Œé€šå¸¸éœ€è¦äººå·¥è°ƒæ•´ã€‚</li><li>AI Agentï¼šå…·æœ‰æŒç»­å­¦ä¹ å’Œè‡ªæˆ‘æ”¹è¿›çš„èƒ½åŠ›ã€‚</li></ul></li><li>ç›®æ ‡å¯¼å‘ï¼š<ul><li>ä¼ ç»ŸAIç³»ç»Ÿï¼šé€šå¸¸ä¸“æ³¨äºè§£å†³ç‰¹å®šé—®é¢˜ã€‚</li><li>AI Agentï¼šèƒ½å¤Ÿå¤„ç†å¤šä¸ªç›®æ ‡ï¼Œå¹¶åœ¨ç›®æ ‡ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚</li></ul></li><li>é€‚åº”æ€§ï¼š<ul><li>ä¼ ç»ŸAIç³»ç»Ÿï¼šå¯¹ç¯å¢ƒå˜åŒ–çš„é€‚åº”èƒ½åŠ›è¾ƒå¼±ã€‚</li><li>AI Agentï¼šèƒ½å¤Ÿå¿«é€Ÿé€‚åº”æ–°ç¯å¢ƒå’Œæ–°ä»»åŠ¡ã€‚</li></ul></li></ol><h3 id="AI-Agent-çš„ç±»å‹ä¸åº”ç”¨é¢†åŸŸ"><a href="#AI-Agent-çš„ç±»å‹ä¸åº”ç”¨é¢†åŸŸ" class="headerlink" title="AI Agent çš„ç±»å‹ä¸åº”ç”¨é¢†åŸŸ"></a><strong>AI Agent çš„ç±»å‹ä¸åº”ç”¨é¢†åŸŸ</strong></h3><h3 id="åŸºäºè§„åˆ™çš„-Agent"><a href="#åŸºäºè§„åˆ™çš„-Agent" class="headerlink" title="åŸºäºè§„åˆ™çš„ Agent"></a><strong>åŸºäºè§„åˆ™çš„ Agent</strong></h3><p>é€šè¿‡é¢„å®šä¹‰çš„è§„åˆ™æ¥åšå‡ºå†³ç­–å’Œæ‰§è¡Œæ“ä½œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RuleBasedAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.rules = &#123;</span><br><span class="line">            <span class="string">&quot;sunny&quot;</span>: <span class="string">&quot;å»å…¬å›­&quot;</span>,</span><br><span class="line">            <span class="string">&quot;rainy&quot;</span>: <span class="string">&quot;å¾…åœ¨å®¶&quot;</span>,</span><br><span class="line">            <span class="string">&quot;cloudy&quot;</span>: <span class="string">&quot;å»è´­ç‰©ä¸­å¿ƒ&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decide</span>(<span class="params">self, weather</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.rules.get(weather, <span class="string">&quot;æ— æ³•å†³å®š&quot;</span>)</span><br><span class="line"></span><br><span class="line">agent = RuleBasedAgent()</span><br><span class="line"><span class="built_in">print</span>(agent.decide(<span class="string">&quot;sunny&quot;</span>))  <span class="comment"># è¾“å‡ºï¼šå»å…¬å›­</span></span><br></pre></td></tr></table></figure><h3 id="å­¦ä¹ å‹-Agent"><a href="#å­¦ä¹ å‹-Agent" class="headerlink" title="å­¦ä¹ å‹ Agent"></a><strong>å­¦ä¹ å‹ Agent</strong></h3><p>ä»ç»éªŒä¸­å­¦ä¹ ï¼Œä¸æ–­æ”¹è¿›å…¶æ€§èƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QLearningAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, states, actions, learning_rate=<span class="number">0.1</span>, discount_factor=<span class="number">0.9</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.q_table = np.zeros((states, actions))</span><br><span class="line">        <span class="variable language_">self</span>.lr = learning_rate</span><br><span class="line">        <span class="variable language_">self</span>.gamma = discount_factor</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, state, action, reward, next_state</span>):</span><br><span class="line">        current_q = <span class="variable language_">self</span>.q_table[state, action]</span><br><span class="line">        next_max_q = np.<span class="built_in">max</span>(<span class="variable language_">self</span>.q_table[next_state])</span><br><span class="line">        new_q = current_q + <span class="variable language_">self</span>.lr * (reward + <span class="variable language_">self</span>.gamma * next_max_q - current_q)</span><br><span class="line">        <span class="variable language_">self</span>.q_table[state, action] = new_q</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_action</span>(<span class="params">self, state</span>):</span><br><span class="line">        <span class="keyword">return</span> np.argmax(<span class="variable language_">self</span>.q_table[state])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line">agent = QLearningAgent(states=<span class="number">10</span>, actions=<span class="number">4</span>)</span><br><span class="line">agent.update(state=<span class="number">0</span>, action=<span class="number">1</span>, reward=<span class="number">5</span>, next_state=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="è‡ªä¸»-Agent"><a href="#è‡ªä¸»-Agent" class="headerlink" title="è‡ªä¸» Agent"></a><strong>è‡ªä¸» Agent</strong></h3><p>å…·æœ‰é«˜åº¦çš„ç‹¬ç«‹æ€§ï¼Œèƒ½å¤Ÿåœ¨æ²¡æœ‰ç›´æ¥äººç±»å¹²é¢„çš„æƒ…å†µä¸‹åšå‡ºå†³ç­–å’Œæ‰§è¡Œä»»åŠ¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AutonomousAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.position = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="variable language_">self</span>.goal = (<span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line">        <span class="variable language_">self</span>.obstacles = <span class="built_in">set</span>([(<span class="number">2</span>, <span class="number">2</span>), (<span class="number">3</span>, <span class="number">3</span>), (<span class="number">4</span>, <span class="number">4</span>)])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sense_environment</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># æ¨¡æ‹Ÿç¯å¢ƒæ„ŸçŸ¥</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;current_position&quot;</span>: <span class="variable language_">self</span>.position,</span><br><span class="line">            <span class="string">&quot;nearby_obstacles&quot;</span>: [obs <span class="keyword">for</span> obs <span class="keyword">in</span> <span class="variable language_">self</span>.obstacles <span class="keyword">if</span> <span class="variable language_">self</span>.distance(obs, <span class="variable language_">self</span>.position) &lt; <span class="number">2</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">plan_path</span>(<span class="params">self, env_data</span>):</span><br><span class="line">        <span class="comment"># ç®€åŒ–çš„è·¯å¾„è§„åˆ’</span></span><br><span class="line">        current_pos = env_data[<span class="string">&quot;current_position&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> current_pos == <span class="variable language_">self</span>.goal:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Goal reached&quot;</span></span><br><span class="line">        </span><br><span class="line">        possible_moves = [(<span class="number">1</span>, <span class="number">0</span>), (-<span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, -<span class="number">1</span>)]</span><br><span class="line">        best_move = <span class="built_in">min</span>(possible_moves, key=<span class="keyword">lambda</span> move: <span class="variable language_">self</span>.distance(</span><br><span class="line">            (current_pos[<span class="number">0</span>] + move[<span class="number">0</span>], current_pos[<span class="number">1</span>] + move[<span class="number">1</span>]),</span><br><span class="line">            <span class="variable language_">self</span>.goal</span><br><span class="line">        ))</span><br><span class="line">        <span class="keyword">return</span> best_move</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_action</span>(<span class="params">self, action</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(action, <span class="built_in">tuple</span>):</span><br><span class="line">            <span class="variable language_">self</span>.position = (<span class="variable language_">self</span>.position[<span class="number">0</span>] + action[<span class="number">0</span>], <span class="variable language_">self</span>.position[<span class="number">1</span>] + action[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.position</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">distance</span>(<span class="params">self, pos1, pos2</span>):</span><br><span class="line">        <span class="keyword">return</span> ((pos1[<span class="number">0</span>] - pos2[<span class="number">0</span>])**<span class="number">2</span> + (pos1[<span class="number">1</span>] - pos2[<span class="number">1</span>])**<span class="number">2</span>)**<span class="number">0.5</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            env_data = <span class="variable language_">self</span>.sense_environment()</span><br><span class="line">            action = <span class="variable language_">self</span>.plan_path(env_data)</span><br><span class="line">            <span class="keyword">if</span> action == <span class="string">&quot;Goal reached&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            new_position = <span class="variable language_">self</span>.execute_action(action)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Moved to <span class="subst">&#123;new_position&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">agent = AutonomousAgent()</span><br><span class="line">agent.run()</span><br></pre></td></tr></table></figure><h2 id="AI-Agent-çš„æ ¸å¿ƒæŠ€æœ¯"><a href="#AI-Agent-çš„æ ¸å¿ƒæŠ€æœ¯" class="headerlink" title=" AI Agent çš„æ ¸å¿ƒæŠ€æœ¯"></a><strong> AI Agent çš„æ ¸å¿ƒæŠ€æœ¯</strong></h2><h3 id="æœºå™¨å­¦ä¹ åŸºç¡€"><a href="#æœºå™¨å­¦ä¹ åŸºç¡€" class="headerlink" title="æœºå™¨å­¦ä¹ åŸºç¡€"></a><strong>æœºå™¨å­¦ä¹ åŸºç¡€</strong></h3><p><strong>ç›‘ç£å­¦ä¹ ï¼š</strong>é€šè¿‡æ ‡è®°æ•°æ®æ¥è®­ç»ƒæ¨¡å‹ï¼Œç›®æ ‡æ˜¯å­¦ä¹ è¾“å…¥åˆ°è¾“å‡ºçš„æ˜ å°„ï¼Œå¸¸ç”¨äºåˆ†ç±»å’Œå›å½’é—®é¢˜ã€‚</p><p><strong>æ— ç›‘ç£å­¦ä¹  ï¼š</strong>å¤„ç†æœªæ ‡è®°çš„æ•°æ®ï¼Œç›®æ ‡æ˜¯å‘ç°æ•°æ®ä¸­çš„éšè—ç»“æ„ã€‚ç›®æ ‡æ˜¯å‘ç°æ•°æ®çš„å†…åœ¨ç»“æ„ï¼Œå¸¸ç”¨äºèšç±»ã€é™ç»´å’Œå¼‚å¸¸æ£€æµ‹ã€‚</p><p><strong>å¼ºåŒ–å­¦ä¹ ï¼š</strong>é€šè¿‡ä¸ç¯å¢ƒäº¤äº’æ¥å­¦ä¹ æœ€ä¼˜ç­–ç•¥çš„æ–¹æ³•ã€‚ç›®æ ‡æ˜¯æœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±ï¼Œé€‚ç”¨äºåºåˆ—å†³ç­–é—®é¢˜ã€‚</p><ul><li>å…³é”®æ¦‚å¿µï¼š<ul><li>çŠ¶æ€ï¼ˆStateï¼‰</li><li>åŠ¨ä½œï¼ˆActionï¼‰</li><li>å¥–åŠ±ï¼ˆRewardï¼‰</li><li>ç­–ç•¥ï¼ˆPolicyï¼‰</li><li>ä»·å€¼å‡½æ•°ï¼ˆValue Functionï¼‰</li></ul></li></ul><h3 id="æ·±åº¦å­¦ä¹ æŠ€æœ¯"><a href="#æ·±åº¦å­¦ä¹ æŠ€æœ¯" class="headerlink" title="æ·±åº¦å­¦ä¹ æŠ€æœ¯"></a><strong>æ·±åº¦å­¦ä¹ æŠ€æœ¯</strong></h3><p>æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªå­é¢†åŸŸï¼Œå®ƒä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¥å­¦ä¹ æ•°æ®çš„å±‚æ¬¡è¡¨ç¤ºã€‚åœ¨AI Agentå¼€å‘ä¸­ï¼Œæ·±åº¦å­¦ä¹ æŠ€æœ¯èƒ½å¤Ÿå¤„ç†é«˜ç»´åº¦ã€éç»“æ„åŒ–çš„æ•°æ®ï¼Œå¦‚å›¾åƒã€éŸ³é¢‘å’Œæ–‡æœ¬ã€‚</p><p><strong>ç¥ç»ç½‘ç»œåŸºç¡€ï¼š</strong>æ·±åº¦å­¦ä¹ çš„åŸºç¡€ï¼Œå®ƒæ¨¡ä»¿äº†äººè„‘çš„ç»“æ„å’ŒåŠŸèƒ½ã€‚</p><ul><li>å…³é”®æ¦‚å¿µï¼š<ul><li>ç¥ç»å…ƒï¼ˆNeuronï¼‰</li><li>æ¿€æ´»å‡½æ•°ï¼ˆActivation Functionï¼‰</li><li>æƒé‡å’Œåç½®ï¼ˆWeights and Biasesï¼‰</li><li>å‰å‘ä¼ æ’­ï¼ˆForward Propagationï¼‰</li><li>åå‘ä¼ æ’­ï¼ˆBackpropagationï¼‰</li></ul></li></ul><p><strong>å·ç§¯ç¥ç»ç½‘ç»œ (CNN)</strong>ï¼šå¤„ç†ç½‘æ ¼ç»“æ„æ•°æ®ï¼ˆå¦‚å›¾åƒï¼‰æ—¶è¡¨ç°å‡ºè‰²<strong>ï¼Œ</strong>å±€éƒ¨è¿æ¥ã€æƒé‡å…±äº«ã€ç©ºé—´æˆ–æ—¶é—´ä¸‹é‡‡æ ·</p><ul><li>å…³é”®ç»„ä»¶ï¼š<ul><li>å·ç§¯å±‚</li><li>æ± åŒ–å±‚</li><li>å…¨è¿æ¥å±‚</li></ul></li></ul><p><strong>å¾ªç¯ç¥ç»ç½‘ç»œ (RNN)ï¼š</strong>é€‚ç”¨äºå¤„ç†åºåˆ—æ•°æ®ï¼Œå¦‚æ—¶é—´åºåˆ—æˆ–è‡ªç„¶è¯­è¨€ã€‚èƒ½å¤„ç†å˜é•¿åºåˆ—ã€å…·æœ‰å†…éƒ¨çŠ¶æ€ï¼ˆè®°å¿†ï¼‰ã€å¯ä»¥æ•æ‰é•¿æœŸä¾èµ–å…³ç³»ã€‚</p><ul><li>å˜ä½“ï¼š<ul><li>é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰</li><li>é—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰</li></ul></li></ul><p><strong>æ³¨æ„åŠ›æœºåˆ¶ä¸ Transformerï¼š</strong>èƒ½å¶å¹¶è¡Œå¤„ç†åºåˆ—ã€æ•æ‰é•¿è·ç¦»ä¾èµ–ã€è®¡ç®—æ•ˆç‡é«˜ã€‚</p><p>æ³¨æ„åŠ›æœºåˆ¶å…è®¸æ¨¡å‹åœ¨å¤„ç†è¾“å…¥æ—¶å…³æ³¨æœ€ç›¸å…³çš„éƒ¨åˆ†ã€‚</p><p>Transformeræ¶æ„åŸºäºè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œåœ¨å„ç§NLPä»»åŠ¡ä¸­å–å¾—äº†çªç ´æ€§è¿›å±•ã€‚</p><h3 id="è‡ªç„¶è¯­è¨€å¤„ç†-NLP"><a href="#è‡ªç„¶è¯­è¨€å¤„ç†-NLP" class="headerlink" title="è‡ªç„¶è¯­è¨€å¤„ç† (NLP)"></a><strong>è‡ªç„¶è¯­è¨€å¤„ç† (NLP)</strong></h3><p>è‡ªç„¶è¯­è¨€å¤„ç†æ˜¯AI Agentä¸äººç±»è¿›è¡Œè¯­è¨€äº¤äº’çš„å…³é”®æŠ€æœ¯ã€‚å®ƒä½¿Agentèƒ½å¤Ÿç†è§£ã€ç”Ÿæˆå’Œå¤„ç†äººç±»è¯­è¨€ã€‚</p><p><strong>æ–‡æœ¬åˆ†ç±»ï¼š</strong>æ–‡æœ¬åˆ†ç±»æ˜¯NLPçš„åŸºç¡€ä»»åŠ¡ä¹‹ä¸€ï¼Œå®ƒå°†æ–‡æœ¬åˆ†é…åˆ°é¢„å®šä¹‰çš„ç±»åˆ«ä¸­ã€‚</p><ul><li>æƒ…æ„Ÿåˆ†æ</li><li>åƒåœ¾é‚®ä»¶æ£€æµ‹</li><li>æ–°é—»åˆ†ç±»</li></ul><p><strong>å‘½åå®ä½“è¯†åˆ«NERï¼š</strong>è¯†åˆ«æ–‡æœ¬ä¸­çš„å‘½åå®ä½“ï¼ˆå¦‚äººåã€åœ°åã€ç»„ç»‡åç­‰ï¼‰å¹¶å°†å…¶åˆ†ç±»çš„ä»»åŠ¡ã€‚</p><ul><li>æƒ…æ„Ÿåˆ†æ</li><li>åƒåœ¾é‚®ä»¶æ£€æµ‹</li><li>æ–°é—»åˆ†ç±»</li></ul><p><strong>æƒ…æ„Ÿåˆ†æï¼š</strong>æ—¨åœ¨ç¡®å®šæ–‡æœ¬ä¸­è¡¨è¾¾çš„æƒ…æ„Ÿæ€åº¦ï¼ˆå¦‚ç§¯æã€æ¶ˆææˆ–ä¸­æ€§ï¼‰ã€‚</p><ul><li>ç¤¾äº¤åª’ä½“ç›‘æ§</li><li>å®¢æˆ·åé¦ˆåˆ†æ</li><li><p>å¸‚åœºç ”ç©¶</p><p><strong>æœºå™¨ç¿»è¯‘ï¼š</strong>å°†æ–‡æœ¬ä»ä¸€ç§è¯­è¨€è‡ªåŠ¨ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€çš„ä»»åŠ¡ã€‚</p></li><li><p>è·¨è¯­è¨€é€šä¿¡</p></li><li>å¤šè¯­è¨€å†…å®¹åˆ›å»º</li><li>å›½é™…å•†åŠ¡</li></ul><h3 id="è®¡ç®—æœºè§†è§‰"><a href="#è®¡ç®—æœºè§†è§‰" class="headerlink" title="è®¡ç®—æœºè§†è§‰"></a><strong>è®¡ç®—æœºè§†è§‰</strong></h3><p>è®¡ç®—æœºè§†è§‰ä½¿AI Agentèƒ½å¤Ÿç†è§£å’Œå¤„ç†è§†è§‰ä¿¡æ¯ã€‚</p><p><strong>å›¾åƒåˆ†ç±»ï¼š</strong>è¯†åˆ«å›¾åƒä¸­ä¸»è¦å¯¹è±¡æˆ–åœºæ™¯çš„ä»»åŠ¡ã€‚</p><ul><li>åŒ»å­¦è¯Šæ–­</li><li>è‡ªåŠ¨æ ‡è®°</li><li>å†…å®¹è¿‡æ»¤</li></ul><p><strong>ç›®æ ‡æ£€æµ‹ï¼š</strong>è¯†åˆ«å›¾åƒä¸­çš„å¯¹è±¡&amp;å®šä½å®ƒä»¬çš„ä½ç½®ã€‚</p><ul><li>è‡ªåŠ¨é©¾é©¶</li><li>å®‰å…¨ç›‘æ§</li><li>é›¶å”®åˆ†æ</li></ul><p><strong>å›¾åƒåˆ†å‰²ï¼š</strong>å°†å›¾åƒåˆ’åˆ†ä¸ºå¤šä¸ªè¯­ä¹‰åŒºåŸŸï¼Œä¸ºæ¯ä¸ªåƒç´ åˆ†é…ä¸€ä¸ªç±»åˆ«æ ‡ç­¾ã€‚</p><ul><li>åŒ»å­¦å›¾åƒåˆ†æ</li><li>è‡ªåŠ¨é©¾é©¶åœºæ™¯ç†è§£</li><li>å¢å¼ºç°å®</li></ul><p><strong>äººè„¸è¯†åˆ«ï¼š</strong>æ¶‰åŠæ£€æµ‹ã€å¯¹é½å’Œè¯†åˆ«äººè„¸ã€‚</p><ul><li>å®‰å…¨ç³»ç»Ÿ</li><li>ç”¨æˆ·è®¤è¯</li><li>ç¤¾äº¤åª’ä½“æ ‡è®°</li></ul><h3 id="å†³ç­–ä¸è§„åˆ’"><a href="#å†³ç­–ä¸è§„åˆ’" class="headerlink" title="å†³ç­–ä¸è§„åˆ’"></a><strong>å†³ç­–ä¸è§„åˆ’</strong></h3><p>AI Agentè‡ªä¸»è¡ŒåŠ¨çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨å¤æ‚ç¯å¢ƒä¸­åšå‡ºæ˜æ™ºçš„é€‰æ‹©å¹¶åˆ¶å®šé•¿æœŸç­–ç•¥ã€‚</p><p><strong>å†³ç­–æ ‘ï¼š</strong>ä¸€ç§ç›´è§‚çš„å†³ç­–æ¨¡å‹ï¼Œé€‚ç”¨äºåˆ†ç±»å’Œå›å½’ä»»åŠ¡ã€‚</p><ul><li>é£é™©è¯„ä¼°</li><li>å®¢æˆ·åˆ†ç±»</li><li>åŒ»ç–—è¯Šæ–­</li></ul><p><strong>è’™ç‰¹å¡æ´›æ ‘æœç´¢ï¼ˆMCTSï¼‰</strong>ï¼šä¸€ç§ç”¨äºå†³ç­–è¿‡ç¨‹çš„å¯å‘å¼æœç´¢ç®—æ³•ï¼Œç‰¹åˆ«é€‚ç”¨äºå…·æœ‰å¤§çŠ¶æ€ç©ºé—´çš„é—®é¢˜ã€‚</p><ul><li>æ¸¸æˆAIï¼ˆå¦‚å›´æ£‹ï¼‰</li><li>è·¯å¾„è§„åˆ’</li><li>èµ„æºåˆ†é…</li></ul><p><strong>A*ç®—æ³•</strong>ï¼šä¸€ç§ç”¨äºå›¾å½¢æœç´¢å’Œè·¯å¾„è§„åˆ’çš„å¯å‘å¼ç®—æ³•ã€‚</p><ul><li>å¯¼èˆªç³»ç»Ÿ</li><li>æœºå™¨äººè·¯å¾„è§„åˆ’</li><li>æ¸¸æˆAIå¯»è·¯</li></ul><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AIå®‰å…¨ </tag>
            
            <tag> AI agent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»é›¶å¼€å§‹çš„å¤§æ¨¡å‹æ­å»ºä¹‹æ—…</title>
      <link href="/2025/01/31/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%90%AD%E5%BB%BA%E4%B9%8B%E6%97%85/"/>
      <url>/2025/01/31/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%90%AD%E5%BB%BA%E4%B9%8B%E6%97%85/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€æ­å»ºå¼€å‘ç¯å¢ƒ"><a href="#ä¸€ã€æ­å»ºå¼€å‘ç¯å¢ƒ" class="headerlink" title="ä¸€ã€æ­å»ºå¼€å‘ç¯å¢ƒ"></a>ä¸€ã€æ­å»ºå¼€å‘ç¯å¢ƒ</h1><ul><li><h2 id="python3"><a href="#python3" class="headerlink" title="python3"></a><strong>python3</strong></h2></li><li><h2 id="pytorch"><a href="#pytorch" class="headerlink" title="pytorch"></a><strong>pytorch</strong></h2></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install numpy tqdm matplotlib</span><br></pre></td></tr></table></figure><ul><li><h2 id="ä¾èµ–åº“"><a href="#ä¾èµ–åº“" class="headerlink" title="ä¾èµ–åº“"></a><strong>ä¾èµ–åº“</strong></h2></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install numpy tqdm matplotlib</span><br></pre></td></tr></table></figure><ul><li><h2 id="vscode-Jupyter"><a href="#vscode-Jupyter" class="headerlink" title="vscode / Jupyter"></a><strong>vscode / Jupyter</strong></h2></li></ul><h1 id="äºŒã€å‡†å¤‡ä¸€ä¸ªæ•°æ®é›†"><a href="#äºŒã€å‡†å¤‡ä¸€ä¸ªæ•°æ®é›†" class="headerlink" title="äºŒã€å‡†å¤‡ä¸€ä¸ªæ•°æ®é›†"></a>äºŒã€å‡†å¤‡ä¸€ä¸ªæ•°æ®é›†</h1><ul><li><a href="https://blog.salesforceairesearch.com/the-wikitext-long-term-dependency-language-modeling-dataset/">WikiText</a></li><li><a href="https://github.com/jcpeterson/openwebtext">OpenWebText</a></li><li>anythingelse</li></ul><h2 id="1-å‡†å¤‡ç¯å¢ƒï¼ˆä»¥openwebtextä¸ºä¾‹ï¼‰"><a href="#1-å‡†å¤‡ç¯å¢ƒï¼ˆä»¥openwebtextä¸ºä¾‹ï¼‰" class="headerlink" title="1.å‡†å¤‡ç¯å¢ƒï¼ˆä»¥openwebtextä¸ºä¾‹ï¼‰"></a>1.å‡†å¤‡ç¯å¢ƒï¼ˆä»¥openwebtextä¸ºä¾‹ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/JCPETERSON/OpenwebText.git</span><br><span class="line"><span class="built_in">cd</span> OpenwebText</span><br></pre></td></tr></table></figure><p>pythonç‰ˆæœ¬å¾—é«˜ä¸€ç‚¹ï¼Œæˆ‘ç”¨çš„3.12ï¼Œ3.8ä¸è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><p>å¦‚æœè€æŠ¥é”™ç‰ˆæœ¬é—®é¢˜å°±ç›´æ¥ä¸‹ï¼ˆæ²¡æŠ¥é”™å°±ä¸æ”¹ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install beautifulsoup4 certifi chardet cssselect feedfinder2 feedparser htmlmin idna jieba3k lxml newspaper3k nltk numpy pandas pillow python-dateutil pytorch-pretrained-bert pytz pyyaml recordtype requests-file requests singledispatch six soupsieve spacy tinysegmenter tldextract tqdm urllib3 urlparse2 pycurl pebble chardet transformers</span><br></pre></td></tr></table></figure><h2 id="2-åŠ è½½-amp-é¢„å¤„ç†æ•°æ®"><a href="#2-åŠ è½½-amp-é¢„å¤„ç†æ•°æ®" class="headerlink" title="2.åŠ è½½&amp;é¢„å¤„ç†æ•°æ®"></a>2.åŠ è½½&amp;é¢„å¤„ç†æ•°æ®</h2><h3 id="1-ã€ç›´æ¥ä¸‹è½½Pushshift-æ•°æ®"><a href="#1-ã€ç›´æ¥ä¸‹è½½Pushshift-æ•°æ®" class="headerlink" title="(1)ã€ç›´æ¥ä¸‹è½½Pushshift æ•°æ®"></a>(1)ã€ç›´æ¥ä¸‹è½½<a href="https://mega.nz/folder/EZZD0YwJ#9_PlEQzdMVLaNdKv_ICNVQ">Pushshift æ•°æ®</a></h3><p>è¿™é‡Œé¢çš„urlæ˜¯å·²ç»å»é‡äº†çš„ï¼Œæ­£å¸¸æµç¨‹å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æå– URL</span><br><span class="line">python extract_urls.py --single_file pushshift_dumps/RS_v2_2005-06.xz</span><br><span class="line"></span><br><span class="line">æƒ³æå–ä¸€ä¸ªæ—¶é—´èŒƒå›´å†…çš„ URL</span><br><span class="line">python extract_urls.py --year_start 2016 --year_end 2018</span><br><span class="line"></span><br><span class="line">å»é‡ URL</span><br><span class="line">python deduplicate_urls.py --input_dir url_dumps</span><br></pre></td></tr></table></figure><h3 id="2-ã€ä¸‹è½½HTMLæ•°æ®"><a href="#2-ã€ä¸‹è½½HTMLæ•°æ®" class="headerlink" title="(2)ã€ä¸‹è½½HTMLæ•°æ®"></a>(2)ã€ä¸‹è½½HTMLæ•°æ®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python312 download.py D:\Tools\openwebtext\URLs\RS_2011-01.bz2.deduped.txt --n_procs 100 --scraper raw --chunk_size 100000 --compress --<span class="built_in">timeout</span> 30</span><br></pre></td></tr></table></figure><p>å°†æŠ“å–çš„ HTML é¡µé¢å­˜å‚¨åœ¨ <code>scraped</code> æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶å‹ç¼©å­˜æ¡£ã€‚</p><p>ç­‰æŒºä¹…çš„ï¼ŒæŒ‚ç€ç¡è§‰äº†ã€‚é»˜è®¤å®ƒdoneäº†å°±æ˜¯å¥½äº†ï¼ˆï¼‰</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501281514200.png" alt="1738029502506.png"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501281515362.png" alt="1738029524605.png"></p><h3 id="3-ã€ä»HTMLä¸­æå–æ–‡æœ¬"><a href="#3-ã€ä»HTMLä¸­æå–æ–‡æœ¬" class="headerlink" title="(3)ã€ä»HTMLä¸­æå–æ–‡æœ¬"></a>(3)ã€ä»HTMLä¸­æå–æ–‡æœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade newspaper3k</span><br></pre></td></tr></table></figure><p>æŠŠextract_text.pyé‡Œçš„save_parsed_fileæ”¹æˆå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">save_parsed_file</span>(<span class="params">filename, text, out_dir</span>):</span><br><span class="line">    <span class="comment"># è·å–æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">    file_path = os.path.join(out_dir, filename)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç¡®ä¿ç›®å½•å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">    os.makedirs(os.path.dirname(file_path), exist_ok=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å†™å…¥æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> handle:</span><br><span class="line">        handle.write(text)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501281514962.png" alt="1738048415160.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python312 extract_text.py --html_archive scraped/RS_2011-01-1_data.xz --n_procs 100</span><br></pre></td></tr></table></figure><p>ä» HTML ä¸­æå–å‡ºæ–‡æœ¬å†…å®¹å¹¶ä¿å­˜ä¸º <code>.txt</code> æ–‡ä»¶.</p><p>â€”å¦‚æœä¸­é—´æœ‰æŠ¥é”™é‡æ–°æ¥çš„è¯ï¼Œè®°å¾—æŠŠåŸæ¥æå–çš„æ–‡ä»¶åˆ æ‰ï¼Œæ–‡ä»¶å¤¹åœ¨scrapedé‡Œ</p><h3 id="4-ã€åˆ†è¯å¤„ç†"><a href="#4-ã€åˆ†è¯å¤„ç†" class="headerlink" title="(4)ã€åˆ†è¯å¤„ç†"></a>(4)ã€åˆ†è¯å¤„ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m spacy download en_core_web_sm</span><br></pre></td></tr></table></figure><p>æ›´æ”¹tokenize_text.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spacy</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="keyword">import</span> chardet</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detect_encoding</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ£€æµ‹æ–‡ä»¶çš„å®é™…ç¼–ç &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        raw_data = f.read(<span class="number">1024</span>)  <span class="comment"># è¯»å–æ–‡ä»¶çš„å‰ 1KB æ•°æ®</span></span><br><span class="line">    result = chardet.detect(raw_data)</span><br><span class="line">    <span class="keyword">return</span> result[<span class="string">&#x27;encoding&#x27;</span>] <span class="keyword">or</span> <span class="string">&#x27;utf-8&#x27;</span>  <span class="comment"># å¦‚æœæ£€æµ‹å¤±è´¥ï¼Œé»˜è®¤è¿”å› &#x27;utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_tokenized_text</span>(<span class="params">output_dir, filename, text</span>):</span><br><span class="line">    <span class="comment"># æ„å»ºå®Œæ•´è¾“å‡ºè·¯å¾„</span></span><br><span class="line">    text_file = os.path.join(output_dir, filename)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨</span></span><br><span class="line">    os.makedirs(os.path.dirname(text_file), exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¿å­˜æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">with</span> io.<span class="built_in">open</span>(text_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fo:</span><br><span class="line">        fo.write(text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tokenizeSpacy</span>(<span class="params">args</span>):</span><br><span class="line">    nlp = spacy.load(<span class="string">&quot;en_core_web_sm&quot;</span>)  <span class="comment"># åŠ è½½ spaCy æ¨¡å‹</span></span><br><span class="line">    extraction_file_paths = glob.glob(args.input_glob)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> extraction_file_path <span class="keyword">in</span> extraction_file_paths:</span><br><span class="line">        path, filename = os.path.split(extraction_file_path)</span><br><span class="line">        text_file = os.path.join(</span><br><span class="line">            args.output_dir, filename.replace(<span class="string">&#x27;.txt&#x27;</span>, <span class="string">&#x27;.tokenized.txt&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨</span></span><br><span class="line">        os.makedirs(os.path.dirname(text_file), exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æµ‹æ–‡ä»¶ç¼–ç </span></span><br><span class="line">        file_encoding = detect_encoding(extraction_file_path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># æ‰“å¼€è¾“å…¥æ–‡ä»¶å’Œè¾“å‡ºæ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">with</span> io.<span class="built_in">open</span>(extraction_file_path, <span class="string">&#x27;r&#x27;</span>, encoding=file_encoding) <span class="keyword">as</span> fi, \</span><br><span class="line">                    io.<span class="built_in">open</span>(text_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fo:</span><br><span class="line"></span><br><span class="line">                omitted_line_count = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> fi:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">len</span>(line.strip()) &gt; <span class="number">0</span>:  <span class="comment"># å¿½ç•¥ç©ºè¡Œ</span></span><br><span class="line">                        doc = nlp(line)</span><br><span class="line">                        fo.write(<span class="string">&#x27; &#x27;</span>.join([x.text <span class="keyword">for</span> x <span class="keyword">in</span> doc]) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        omitted_line_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;Omitted <span class="subst">&#123;omitted_line_count&#125;</span> empty lines from <span class="subst">&#123;filename&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Failed to decode <span class="subst">&#123;extraction_file_path&#125;</span> with encoding <span class="subst">&#123;file_encoding&#125;</span>. Skipping this file.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--input_glob&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;*.txt&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--output_dir&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;tokenized&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--tokenizer&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;spacy&#x27;</span>, choices=[<span class="string">&#x27;spacy&#x27;</span>, <span class="string">&#x27;gpt2&#x27;</span>])</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--combine&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">1e8</span>, <span class="built_in">help</span>=<span class="string">&quot;min tokens per file in gpt2 mode&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--file_bs&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">10000</span>, <span class="built_in">help</span>=<span class="string">&quot;files per batch in gpt2 mode&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è§£æå‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨</span></span><br><span class="line">    os.makedirs(args.output_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ ¹æ® tokenizer é€‰æ‹©æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> args.tokenizer == <span class="string">&#x27;spacy&#x27;</span>:</span><br><span class="line">        tokenizeSpacy(args)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;GPT-2 tokenizer is not implemented in this version.&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python312 tokenize_text.py --input_glob <span class="string">&quot;parsed/RS_2011-01/*.txt&quot;</span> --output_dir tokenized</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501282028656.png" alt="1738067274379.png"></p><h1 id="ä¸‰ã€æ„å»ºå’Œè®­ç»ƒ-GPT-ç±»ä¼¼æ¨¡å‹"><a href="#ä¸‰ã€æ„å»ºå’Œè®­ç»ƒ-GPT-ç±»ä¼¼æ¨¡å‹" class="headerlink" title="ä¸‰ã€æ„å»ºå’Œè®­ç»ƒ GPT ç±»ä¼¼æ¨¡å‹"></a>ä¸‰ã€æ„å»ºå’Œè®­ç»ƒ GPT ç±»ä¼¼æ¨¡å‹</h1><p>ä¸‹é¢çš„æ–‡ä»¶å±‚çº§å…³ç³»å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gpt_project/</span><br><span class="line">â”œâ”€â”€ model/</span><br><span class="line">â”‚   â”œâ”€â”€ gpt.py</span><br><span class="line">â”‚   â”œâ”€â”€ transformer_block.py</span><br><span class="line">â”œâ”€â”€ data/</span><br><span class="line">â”‚   â”œâ”€â”€ dataset.py</span><br><span class="line">â”‚   â”œâ”€â”€ tokenizer.py  # å¯é€‰</span><br><span class="line">â”‚   â”œâ”€â”€ tokenized/  # å­˜æ”¾æ‰€æœ‰åˆ†è¯å¥½çš„ .txt æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ train/</span><br><span class="line">â”‚   â”œâ”€â”€ train.py  # è®­ç»ƒä»£ç </span><br><span class="line">|â€”â€”train_model/</span><br><span class="line">|</span><br><span class="line">â”œâ”€â”€ inference.py  # ç”Ÿæˆæ–‡æœ¬</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501292326878.png" alt="1738164364319.png"></p><h2 id="1-dataset-py"><a href="#1-dataset-py" class="headerlink" title="1. dataset.py"></a>1. <strong>dataset.py</strong></h2><p>ç”¨äºå¤„ç†æ•°æ®é›†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#dataset.py</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextDataset</span>(torch.utils.data.Dataset):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, directory_path, seq_length, tokenizer</span>):</span><br><span class="line">        <span class="variable language_">self</span>.seq_length = seq_length</span><br><span class="line">        <span class="variable language_">self</span>.tokenizer = tokenizer</span><br><span class="line">        <span class="variable language_">self</span>.data = []</span><br><span class="line">        <span class="variable language_">self</span>.vocab = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.inverse_vocab = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¬¬ä¸€æ­¥ï¼šç»Ÿè®¡æ‰€æœ‰å•è¯çš„é¢‘ç‡</span></span><br><span class="line">        word_counter = Counter()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># éå† directory_path ç›®å½•ä¸­çš„æ‰€æœ‰ .tokenized.txt æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(directory_path):</span><br><span class="line">            <span class="keyword">if</span> filename.endswith(<span class="string">&quot;.tokenized.txt&quot;</span>):</span><br><span class="line">                file_path = os.path.join(directory_path, filename)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    words = f.read().split()</span><br><span class="line">                    word_counter.update(words)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¬¬äºŒæ­¥ï¼šåˆ›å»ºè¯æ±‡è¡¨ï¼Œç»™æ¯ä¸ªå•è¯åˆ†é…ä¸€ä¸ª ID</span></span><br><span class="line">        <span class="variable language_">self</span>.vocab = &#123;word: idx + <span class="number">1</span> <span class="keyword">for</span> idx, (word, _) <span class="keyword">in</span> <span class="built_in">enumerate</span>(word_counter.items())&#125;</span><br><span class="line">        <span class="variable language_">self</span>.vocab[<span class="string">&#x27;&lt;pad&gt;&#x27;</span>] = <span class="number">0</span>  <span class="comment"># ä¸º padding æ·»åŠ ä¸€ä¸ª ID</span></span><br><span class="line">        <span class="variable language_">self</span>.vocab[<span class="string">&#x27;&lt;unk&gt;&#x27;</span>] = <span class="built_in">len</span>(<span class="variable language_">self</span>.vocab)  <span class="comment"># ä¸ºæœªçŸ¥å•è¯æ·»åŠ ä¸€ä¸ª ID</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åˆ›å»ºé€†è¯æ±‡è¡¨</span></span><br><span class="line">        <span class="variable language_">self</span>.inverse_vocab = &#123;idx: word <span class="keyword">for</span> word, idx <span class="keyword">in</span> <span class="variable language_">self</span>.vocab.items()&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¬¬ä¸‰æ­¥ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸º token ID</span></span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(directory_path):</span><br><span class="line">            <span class="keyword">if</span> filename.endswith(<span class="string">&quot;.tokenized.txt&quot;</span>):</span><br><span class="line">                file_path = os.path.join(directory_path, filename)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    words = f.read().split()</span><br><span class="line">                    <span class="comment"># å°†æ¯ä¸ªå•è¯è½¬æ¢ä¸º token IDï¼Œå¦‚æœä¸åœ¨è¯æ±‡è¡¨ä¸­åˆ™ä½¿ç”¨ &lt;unk&gt;</span></span><br><span class="line">                    token_ids = [<span class="variable language_">self</span>.vocab.get(word, <span class="variable language_">self</span>.vocab[<span class="string">&#x27;&lt;unk&gt;&#x27;</span>]) <span class="keyword">for</span> word <span class="keyword">in</span> words]</span><br><span class="line">                    <span class="variable language_">self</span>.data.append(token_ids)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å°†æ•°æ®è½¬åŒ–ä¸ºè®­ç»ƒæ‰€éœ€çš„åºåˆ—å½¢å¼</span></span><br><span class="line">        <span class="variable language_">self</span>.data = [<span class="variable language_">self</span>.pad_sequence(seq) <span class="keyword">for</span> seq <span class="keyword">in</span> <span class="variable language_">self</span>.data]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, idx</span>):</span><br><span class="line">        input_text = <span class="variable language_">self</span>.data[idx]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¼–ç è¾“å…¥æ–‡æœ¬</span></span><br><span class="line">        input_ids = torch.tensor(input_text)  <span class="comment"># è½¬æ¢ä¸º tensor</span></span><br><span class="line">        target_ids = input_ids.clone()  <span class="comment"># ä½¿ç”¨è¾“å…¥ä½œä¸ºç›®æ ‡</span></span><br><span class="line">        <span class="keyword">return</span> input_ids, target_ids</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pad_sequence</span>(<span class="params">self, seq</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¡«å……åºåˆ—åˆ° seq_length&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(seq) &lt; <span class="variable language_">self</span>.seq_length:</span><br><span class="line">            <span class="comment"># ä½¿ç”¨ pad token å¡«å……</span></span><br><span class="line">            seq += [<span class="variable language_">self</span>.vocab[<span class="string">&#x27;&lt;pad&gt;&#x27;</span>]] * (<span class="variable language_">self</span>.seq_length - <span class="built_in">len</span>(seq))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœè¶…å‡º seq_lengthï¼Œåˆ™æˆªæ–­</span></span><br><span class="line">            seq = seq[:<span class="variable language_">self</span>.seq_length]</span><br><span class="line">        <span class="keyword">return</span> seq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    def __getitem__(self, idx):</span></span><br><span class="line"><span class="string">        input_ids = torch.tensor(self.data[idx], dtype=torch.long)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        # å¦‚æœè¾“å…¥åºåˆ—é•¿åº¦å°äº seq_lengthï¼Œè¿›è¡Œå¡«å……</span></span><br><span class="line"><span class="string">        padding_length = self.seq_length - input_ids.size(0)</span></span><br><span class="line"><span class="string">        if padding_length &gt; 0:</span></span><br><span class="line"><span class="string">            padding = torch.tensor([self.vocab[&#x27;&lt;pad&gt;&#x27;]] * padding_length, dtype=torch.long)</span></span><br><span class="line"><span class="string">            input_ids = torch.cat([input_ids, padding], dim=0)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        # è®¾ç½® target_ids ä¸º input_ids çš„ä¸‹ä¸€ä¸ª tokenï¼ˆå³è¯­è¨€æ¨¡å‹çš„è®­ç»ƒç›®æ ‡ï¼‰</span></span><br><span class="line"><span class="string">        target_ids = input_ids[1:].clone()</span></span><br><span class="line"><span class="string">        target_ids = torch.cat([target_ids, torch.tensor([self.vocab[&#x27;&lt;pad&gt;&#x27;]], dtype=torch.long)])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        return input_ids, target_ids</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="2-gpt-py"><a href="#2-gpt-py" class="headerlink" title="2.gpt.py"></a>2.gpt.py</h2><p>å®ç° GPT æ¨¡å‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gpt.py</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">project_root = os.path.abspath(os.path.join(os.path.dirname(__file__), <span class="string">&#x27;..&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Adding to sys.path:&quot;</span>, project_root)</span><br><span class="line">sys.path.append(project_root)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> model.transformer_block <span class="keyword">import</span> TransformerBlock</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GPT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vocab_size, embed_size, num_layers, num_heads, hidden_dim, max_length</span>):</span><br><span class="line">        <span class="built_in">super</span>(GPT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.hidden_dim = hidden_dim  <span class="comment"># æ·»åŠ  hidden_dim å˜é‡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GPT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vocab_size, embed_size, num_heads, num_layers, max_length</span>):</span><br><span class="line">        <span class="built_in">super</span>(GPT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.embedding = nn.Embedding(vocab_size, embed_size)</span><br><span class="line">        <span class="variable language_">self</span>.position_embedding = nn.Embedding(max_length, embed_size)</span><br><span class="line">        <span class="variable language_">self</span>.blocks = nn.ModuleList([</span><br><span class="line">            TransformerBlock(embed_size, num_heads, embed_size * <span class="number">4</span>)</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_layers)</span><br><span class="line">        ])</span><br><span class="line">        <span class="variable language_">self</span>.fc_out = nn.Linear(embed_size, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        batch_size, seq_length = x.shape</span><br><span class="line">        positions = torch.arange(<span class="number">0</span>, seq_length).expand(batch_size, seq_length)</span><br><span class="line">        x = <span class="variable language_">self</span>.embedding(x) + <span class="variable language_">self</span>.position_embedding(positions)</span><br><span class="line">        <span class="keyword">for</span> block <span class="keyword">in</span> <span class="variable language_">self</span>.blocks:</span><br><span class="line">            x = block(x)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.fc_out(x)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate</span>(<span class="params">self, input_ids, max_length=<span class="number">100</span>, temperature=<span class="number">1.0</span>, top_k=<span class="number">50</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.<span class="built_in">eval</span>()  <span class="comment"># è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è·å–åˆå§‹è¾“å‡º</span></span><br><span class="line">        generated_ids = input_ids</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(max_length):</span><br><span class="line">            outputs = <span class="variable language_">self</span>(generated_ids)</span><br><span class="line">            logits = outputs  <span class="comment"># å‡è®¾æ¨¡å‹çš„è¾“å‡ºæ˜¯ logits</span></span><br><span class="line">            logits = logits[:, -<span class="number">1</span>, :]  <span class="comment"># åªå…³æ³¨æœ€æ–°ç”Ÿæˆçš„ token</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># åº”ç”¨æ¸©åº¦é‡‡æ ·</span></span><br><span class="line">            logits = logits / temperature</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Top-K é‡‡æ ·</span></span><br><span class="line">            <span class="keyword">if</span> top_k &gt; <span class="number">0</span>:</span><br><span class="line">                top_k_values, top_k_indices = torch.topk(logits, top_k)</span><br><span class="line">                top_k_probs = F.softmax(top_k_values, dim=-<span class="number">1</span>)</span><br><span class="line">                next_token = torch.multinomial(top_k_probs, <span class="number">1</span>)</span><br><span class="line">                next_token = top_k_indices.gather(-<span class="number">1</span>, next_token)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># é»˜è®¤é‡‡æ ·</span></span><br><span class="line">                probs = F.softmax(logits, dim=-<span class="number">1</span>)</span><br><span class="line">                next_token = torch.multinomial(probs, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ·»åŠ ç”Ÿæˆçš„ token åˆ°è¾“å…¥åºåˆ—</span></span><br><span class="line">            generated_ids = torch.cat([generated_ids, next_token], dim=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> generated_ids</span><br><span class="line">    </span><br></pre></td></tr></table></figure><h2 id="3-transformer-block-py"><a href="#3-transformer-block-py" class="headerlink" title="3.transformer_block.py"></a>3.transformer_block.py</h2><p>ç”¨äºå®ç° GPT æ¨¡å‹çš„ä¸€ä¸ªåŸºæœ¬ç»„ä»¶â€”â€”Transformer å—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># transformer_block.py</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AttentionHead</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, embed_size, head_size</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.q = nn.Linear(embed_size, head_size, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.k = nn.Linear(embed_size, head_size, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.v = nn.Linear(embed_size, head_size, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.scale = head_size ** -<span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        q = <span class="variable language_">self</span>.q(x)</span><br><span class="line">        k = <span class="variable language_">self</span>.k(x)</span><br><span class="line">        v = <span class="variable language_">self</span>.v(x)</span><br><span class="line">        scores = torch.matmul(q, k.transpose(-<span class="number">2</span>, -<span class="number">1</span>)) * <span class="variable language_">self</span>.scale</span><br><span class="line">        attention = torch.softmax(scores, dim=-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> torch.matmul(attention, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TransformerBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, embed_size, num_heads, feed_forward_size</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.attention = nn.MultiheadAttention(embed_dim=embed_size, num_heads=num_heads)</span><br><span class="line">        <span class="variable language_">self</span>.ff = nn.Sequential(</span><br><span class="line">            nn.Linear(embed_size, feed_forward_size),</span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.Linear(feed_forward_size, embed_size),</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.norm1 = nn.LayerNorm(embed_size)</span><br><span class="line">        <span class="variable language_">self</span>.norm2 = nn.LayerNorm(embed_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        attention_out, _ = <span class="variable language_">self</span>.attention(x, x, x)</span><br><span class="line">        x = <span class="variable language_">self</span>.norm1(x + attention_out)</span><br><span class="line">        ff_out = <span class="variable language_">self</span>.ff(x)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.norm2(x + ff_out)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-generate-py"><a href="#4-generate-py" class="headerlink" title="4. generate.py"></a>4. <strong>generate.py</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> model.gpt <span class="keyword">import</span> GPT</span><br><span class="line"><span class="keyword">from</span> data.tokenizer <span class="keyword">import</span> SimpleTokenizer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_text</span>(<span class="params">prompt, model, tokenizer, max_length=<span class="number">50</span></span>):</span><br><span class="line">    tokens = tokenizer.encode(prompt)</span><br><span class="line">    input_data = torch.tensor([tokens])</span><br><span class="line"></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(max_length):</span><br><span class="line">            output = model(input_data)</span><br><span class="line">            next_token = torch.argmax(output[:, -<span class="number">1</span>, :], dim=-<span class="number">1</span>)</span><br><span class="line">            input_data = torch.cat([input_data, next_token.unsqueeze(<span class="number">0</span>)], dim=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> next_token.item() == tokenizer.word_to_idx[<span class="string">&quot;&lt;END&gt;&quot;</span>]:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tokenizer.decode(input_data[<span class="number">0</span>].tolist())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    vocab_size = <span class="number">10000</span></span><br><span class="line">    embed_size = <span class="number">128</span></span><br><span class="line">    num_heads = <span class="number">8</span></span><br><span class="line">    num_layers = <span class="number">4</span></span><br><span class="line">    max_length = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load pretrained model</span></span><br><span class="line">    model = GPT(vocab_size, embed_size, num_heads, num_layers, max_length)</span><br><span class="line">    tokenizer = SimpleTokenizer(vocab_size)</span><br><span class="line">    tokenizer.build_vocab(<span class="string">&quot;This is a small test corpus &lt;END&gt;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    prompt = <span class="string">&quot;This is a&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(generate_text(prompt, model, tokenizer))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-train-py"><a href="#5-train-py" class="headerlink" title="5.train.py"></a>5.<strong>train.py</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># train/train.py</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">project_root = os.path.abspath(os.path.join(os.path.dirname(__file__), <span class="string">&#x27;..&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Adding to sys.path:&quot;</span>, project_root)</span><br><span class="line">sys.path.append(project_root)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> data.dataset <span class="keyword">import</span> TextDataset</span><br><span class="line"><span class="keyword">from</span> model.gpt <span class="keyword">import</span> GPT</span><br><span class="line"><span class="keyword">from</span> torch.optim <span class="keyword">import</span> AdamW</span><br><span class="line"><span class="keyword">from</span> torch.optim.lr_scheduler <span class="keyword">import</span> StepLR</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> GPT2LMHeadModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å¤–éƒ¨åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨</span></span><br><span class="line">model = GPT2LMHeadModel.from_pretrained(<span class="string">&#x27;gpt2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>():</span><br><span class="line">    <span class="comment"># åŠ è½½åˆ†è¯å™¨</span></span><br><span class="line">    tokenizer = AutoTokenizer.from_pretrained(<span class="string">&#x27;gpt2&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®¾ç½®è®¾å¤‡</span></span><br><span class="line">    device = torch.device(<span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">    model.to(device)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é…ç½®æ•°æ®é›†</span></span><br><span class="line">    dataset = TextDataset(directory_path=<span class="string">&quot;data/tokenized&quot;</span>, seq_length=<span class="number">128</span>, tokenizer=tokenizer)</span><br><span class="line">    data_loader = DataLoader(dataset, batch_size=<span class="number">4</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é…ç½®ä¼˜åŒ–å™¨</span></span><br><span class="line">    optimizer = AdamW(model.parameters(), lr=<span class="number">1e-5</span>)</span><br><span class="line">    scheduler = StepLR(optimizer, step_size=<span class="number">5</span>, gamma=<span class="number">0.5</span>)  <span class="comment"># æ¯5ä¸ªepochå‡å°‘å­¦ä¹ ç‡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">    model.train()</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):  <span class="comment"># å‡è®¾è®­ç»ƒ3ä¸ªepoch</span></span><br><span class="line">        total_loss = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> batch_idx, (input_ids, target_ids) <span class="keyword">in</span> <span class="built_in">enumerate</span>(data_loader):</span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line"></span><br><span class="line">            input_ids = input_ids.to(device)</span><br><span class="line">            target_ids = target_ids.to(device)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å‰å‘ä¼ æ’­</span></span><br><span class="line">            outputs = model(input_ids, labels=target_ids)</span><br><span class="line">            loss = outputs.loss</span><br><span class="line">            total_loss += loss.item()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># åå‘ä¼ æ’­</span></span><br><span class="line">            loss.backward()</span><br><span class="line">            <span class="comment"># è®­ç»ƒè¿‡ç¨‹ä¸­æ·»åŠ æ¢¯åº¦è£å‰ª</span></span><br><span class="line">            torch.nn.utils.clip_grad_norm_(model.parameters(), max_norm=<span class="number">1.0</span>)</span><br><span class="line">            optimizer.step()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¾“å‡ºæ¯ä¸ª epoch çš„æŸå¤±</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Epoch <span class="subst">&#123;epoch+<span class="number">1</span>&#125;</span>, Loss: <span class="subst">&#123;total_loss / <span class="built_in">len</span>(data_loader)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å­¦ä¹ ç‡è°ƒåº¦</span></span><br><span class="line">        scheduler.step()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹</span></span><br><span class="line">    torch.save(model.state_dict(), <span class="string">&quot;trained_model/model.pth&quot;</span>)</span><br><span class="line"></span><br><span class="line">    tokenizer.save_pretrained(<span class="string">&quot;trained_model&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    train()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-inference-py"><a href="#6-inference-py" class="headerlink" title="6. inference.py"></a>6. <strong>inference.py</strong></h2><p>è¿™æ˜¯æ¨ç†è„šæœ¬ï¼Œç”¨äºåŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹å¹¶è¿›è¡Œæ¨ç†ï¼ˆç”Ÿæˆé¢„æµ‹ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inference.py</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">project_root = os.path.abspath(os.path.join(os.path.dirname(__file__), <span class="string">&#x27;..&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Adding to sys.path:&quot;</span>, project_root)</span><br><span class="line">sys.path.append(project_root)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> model.gpt <span class="keyword">import</span> GPT</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_model</span>():</span><br><span class="line">    <span class="comment"># åŠ è½½æ¨¡å‹</span></span><br><span class="line">    model = GPT(vocab_size=<span class="number">50000</span>, embed_size=<span class="number">256</span>, num_layers=<span class="number">6</span>, num_heads=<span class="number">8</span>, max_length=<span class="number">512</span>)</span><br><span class="line">    model.load_state_dict(torch.load(<span class="string">&quot;trained_model/model.pth&quot;</span>), strict=<span class="literal">False</span>)</span><br><span class="line">    model.<span class="built_in">eval</span>()  <span class="comment"># è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ è½½åˆ†è¯å™¨</span></span><br><span class="line">    tokenizer = AutoTokenizer.from_pretrained(<span class="string">&#x27;gpt2&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> model, tokenizer  <span class="comment"># è¿”å›æ¨¡å‹å’Œåˆ†è¯å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chat</span>():</span><br><span class="line">    model, tokenizer = load_model()  <span class="comment"># åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        text = <span class="built_in">input</span>(<span class="string">&quot;Input: &quot;</span>)  <span class="comment"># è·å–ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">        <span class="keyword">if</span> text.lower() == <span class="string">&quot;quit&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œç¼–ç </span></span><br><span class="line">        input_ids = tokenizer.encode(text, return_tensors=<span class="string">&#x27;pt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç”Ÿæˆæ–‡æœ¬</span></span><br><span class="line">        generated_ids = model.generate(input_ids, max_length=<span class="number">100</span>, temperature=<span class="number">1.0</span>, top_k=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è§£ç å¹¶æ‰“å°ç”Ÿæˆçš„æ–‡æœ¬</span></span><br><span class="line">        output_text = tokenizer.decode(generated_ids[<span class="number">0</span>], skip_special_tokens=<span class="literal">True</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;GPT: <span class="subst">&#123;output_text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    chat()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åè¿è¡Œé¡ºåºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python312 train/train.py</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501292344755.png" alt="1738165457988.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python312 inference.py</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501292343248.png" alt="1738165422521.png"></p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> å®æˆ˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android-è¯¾ç¨‹æ€»ç»“</title>
      <link href="/2025/01/19/Android-%E8%AF%BE%E7%A8%8B%E6%80%BB%E7%BB%93/"/>
      <url>/2025/01/19/Android-%E8%AF%BE%E7%A8%8B%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒ</p><p>æ­£å·±è€å¸ˆçš„ã€Šå®‰å“é€†å‘è¿™æ¡£äº‹ã€‹</p><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="ä¸æ‰‹æœºå»ºç«‹è¿æ¥"><a href="#ä¸æ‰‹æœºå»ºç«‹è¿æ¥" class="headerlink" title="ä¸æ‰‹æœºå»ºç«‹è¿æ¥"></a>ä¸æ‰‹æœºå»ºç«‹è¿æ¥</h3><h4 id="æ¨¡æ‹Ÿå™¨"><a href="#æ¨¡æ‹Ÿå™¨" class="headerlink" title="æ¨¡æ‹Ÿå™¨"></a>æ¨¡æ‹Ÿå™¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb connect 127.0.0.1:ç«¯å£å·</span><br><span class="line">adb devices</span><br><span class="line">adb -s 127.0.0.1:ç«¯å£å· shell</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šæˆ‘çš„æ˜¯mumuæ¨¡æ‹Ÿå™¨ï¼Œæ¯æ¬¡éƒ½è¦åˆ°å¤šå¼€å™¨é‡Œé¢æŸ¥çœ‹adbç«¯å£å»ºç«‹è¿æ¥ï¼Œä½†æ˜¯æ­£å¸¸åº”è¯¥å¯ä»¥ç›´æ¥adb devices&amp;adb shellã€‚æ¨¡æ‹Ÿå™¨æ˜¯è¿™æ ·çš„TT</p><h4 id="çœŸæœº"><a href="#çœŸæœº" class="headerlink" title="çœŸæœº"></a>çœŸæœº</h4><p>æ‰‹æœºå¼€å¼€å‘è€…ç‰ˆæœ¬å’ŒUSBè°ƒè¯•ï¼Œç„¶åé€šè¿‡æ•°æ®çº¿è¿æ¥</p><ul><li>æœ‰ä¸€äº›æ•°æ®çº¿åªèƒ½å……ç”µï¼Œç¬¬ä¸€æ¬¡è¿æ¥ç”µè„‘çš„æ—¶å€™æ‰‹æœºä¸Šä¼šå¼¹å‡ºè¦æ±‚å…è®¸ USB è°ƒè¯•è®¿é—®ã€‚ç¡®ä¿ä½ ç‚¹å‡»äº†â€œå…è®¸â€æŒ‰é’®ã€‚</li><li>å¦‚æœæ²¡å¼¹å‡ºå°±æ¢ä¸€æ ¹æ•°æ®çº¿/é‡å¯ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb devices</span><br><span class="line">adb shell</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶ä¼ è¾“"><a href="#æ–‡ä»¶ä¼ è¾“" class="headerlink" title="æ–‡ä»¶ä¼ è¾“"></a>æ–‡ä»¶ä¼ è¾“</h3><h4 id="ä¼ æ–‡ä»¶è¿›windows"><a href="#ä¼ æ–‡ä»¶è¿›windows" class="headerlink" title="ä¼ æ–‡ä»¶è¿›windows"></a>ä¼ æ–‡ä»¶è¿›windows</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb -s 127.0.0.1:16384 shell pm list packages</span><br><span class="line">adb -s 127.0.0.1:16384 shell pm path com.chaoxing.mobile</span><br><span class="line">adb -s 127.0.0.1:16384 pull /data/app/~~EerlSikM2HRGxvcqMsmfIg==/com.chaoxing.mobile-_E7VgeY662xxYG0tGxtKrQ==/base.apk D:\æ¡Œé¢\xuexitong</span><br></pre></td></tr></table></figure><h4 id="æ¨é€æ–‡ä»¶è‡³æ¨¡æ‹Ÿå™¨"><a href="#æ¨é€æ–‡ä»¶è‡³æ¨¡æ‹Ÿå™¨" class="headerlink" title="æ¨é€æ–‡ä»¶è‡³æ¨¡æ‹Ÿå™¨"></a>æ¨é€æ–‡ä»¶è‡³æ¨¡æ‹Ÿå™¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb push &quot;D:\LeStoreDownload\ç½‘é¡µ\frida-clr-16.5.7-windows-x86_64.dll\frida-clr-16.5.7-windows-x86_64.dll&quot; /data/local/tmp/</span><br><span class="line">adb shell ls /data/local/tmp/</span><br></pre></td></tr></table></figure><h4 id="è½¯ä»¶å®‰è£…"><a href="#è½¯ä»¶å®‰è£…" class="headerlink" title="è½¯ä»¶å®‰è£…"></a>è½¯ä»¶å®‰è£…</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb install  a.apk</span><br></pre></td></tr></table></figure><h3 id="åˆè¯†APK"><a href="#åˆè¯†APK" class="headerlink" title="åˆè¯†APK"></a>åˆè¯†APK</h3><p><strong>APK</strong>ï¼šå…¨ç§°Android Packageï¼Œç›¸å½“äºå‹ç¼©æ–‡ä»¶ï¼ŒæŠŠ.apkåç¼€æ”¹ä¸º.zipå°±å¯ä»¥è§£å‹</p><ul><li><strong>assetsç›®å½• </strong>ï¼šå­˜æ”¾apké™æ€èµ„æºï¼Œè§†é¢‘å›¾ç‰‡ç­‰ã€‚</li><li><strong>libç›®å½•</strong>ï¼šarmeabi-v7aåŸºæœ¬é€šç”¨æ‰€æœ‰androidè®¾å¤‡ï¼Œarm64-v8aåªé€‚ç”¨äº64ä½çš„androidè®¾å¤‡ï¼Œx86å¸¸è§ç”¨äºandroidæ¨¡æ‹Ÿå™¨ï¼Œå…¶ç›®å½•ä¸‹çš„.soæ–‡ä»¶æ˜¯cæˆ–c++ç¼–è¯‘çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚</li><li><strong>META-INFç›®å½•</strong>ï¼šå­˜æ”¾ç­¾åä¿¡æ¯ï¼Œç”¨æ¥éªŒè¯APKçš„å®Œæ•´æ€§ã€‚</li><li><strong>resæ–‡ä»¶</strong>ï¼šèµ„æºæ–‡ä»¶ï¼Œå›¾ç‰‡å­—ç¬¦ä¸²ç­‰ï¼ˆä¼šè½¬ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼‰</li><li><strong>AndroidMainfest.xmlæ–‡ä»¶</strong>ï¼šAPKçš„åº”ç”¨æ¸…å•ï¼Œæè¿°åº”ç”¨åå­—ç‰ˆæœ¬ç­‰</li><li><strong>classes.dexæ–‡ä»¶</strong>ï¼šclasses.dexæ˜¯Javaæºç ç¼–ç åçš„javaå­—èŠ‚ç ï¼Œ<strong>APKè¿è¡Œçš„ä¸»è¦é€»è¾‘</strong></li><li><strong>resources.arsc</strong>ï¼šresources.arscæ˜¯ç¼–è¯‘åçš„äºŒè¿›åˆ¶èµ„æºæ–‡ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œæ˜ å°„ç€èµ„æºå’Œidï¼Œé€šè¿‡Ræ–‡ä»¶ä¸­çš„idå°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„èµ„æº</li></ul><p><strong>assetså’Œresæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</strong></p><p>assetsä¸»è¦å­˜æ”¾çš„æ˜¯åº”ç”¨å†…æ˜¾ç¤ºå‡ºæ¥çš„å›¾ç‰‡ï¼Œä¸ä¼šè½¬ä¸ºäºŒè¿›åˆ¶æ ¼å¼</p><p>resæ˜¯uiè®¾è®¡ç›¸å…³çš„æ–‡ä»¶ï¼Œä¼šè½¬ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œç»è¿‡å‹ç¼©ä¼˜åŒ–</p><h3 id="JVMã€Dalvikã€ART"><a href="#JVMã€Dalvikã€ART" class="headerlink" title="JVMã€Dalvikã€ART"></a>JVMã€Dalvikã€ART</h3><p>JVMæ˜¯JAVAè™šæ‹Ÿæœºï¼Œè¿è¡ŒJAVAå­—èŠ‚ç ç¨‹åº<br>Dalvikæ˜¯Googleä¸“é—¨ä¸ºAndroidè®¾è®¡çš„ä¸€ä¸ªè™šæ‹Ÿæœºï¼ŒDalvikæœ‰ä¸“å±çš„æ–‡ä»¶æ‰§è¡Œæ ¼å¼dex(Dalvik executable)<br>Art(Android Runtime)ç›¸å½“äºDalvikçš„å‡çº§ç‰ˆï¼Œæœ¬è´¨ä¸Dalvikæ— å¼‚</p><h3 id="å®‰å“å››å¤§ç»„ä»¶"><a href="#å®‰å“å››å¤§ç»„ä»¶" class="headerlink" title="å®‰å“å››å¤§ç»„ä»¶"></a>å®‰å“å››å¤§ç»„ä»¶</h3><div class="table-container"><table><thead><tr><th style="text-align:left">ç»„ä»¶</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">Activity(æ´»åŠ¨)</td><td style="text-align:left">åœ¨åº”ç”¨ä¸­çš„ä¸€ä¸ªActivityå¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç•Œé¢ï¼Œæ„æ€å¯ä»¥ç†è§£ä¸ºâ€œæ´»åŠ¨â€ï¼Œå³ä¸€ä¸ªæ´»åŠ¨å¼€å§‹ï¼Œä»£è¡¨ Activityç»„ä»¶å¯åŠ¨ï¼Œæ´»åŠ¨ç»“æŸï¼Œä»£è¡¨ä¸€ä¸ªActivityçš„ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚ä¸€ä¸ªAndroidåº”ç”¨å¿…é¡»é€šè¿‡Activityæ¥è¿è¡Œå’Œå¯åŠ¨ï¼ŒActivityçš„ç”Ÿå‘½å‘¨æœŸäº¤ç»™ç³»ç»Ÿç»Ÿä¸€ç®¡ç†ã€‚</td></tr><tr><td style="text-align:left">Service(æœåŠ¡)</td><td style="text-align:left">Serviceå®ƒå¯ä»¥åœ¨åå°æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œæ“ä½œè€Œæ²¡æœ‰ç”¨æˆ·ç•Œé¢çš„åº”ç”¨ç»„ä»¶ï¼Œä¸ä¾èµ–ä»»ä½•ç”¨æˆ·ç•Œé¢ï¼Œä¾‹å¦‚åå°æ’­æ”¾éŸ³ä¹ï¼Œåå°ä¸‹è½½æ–‡ä»¶ç­‰ã€‚</td></tr><tr><td style="text-align:left">Broadcast Receiver(å¹¿æ’­æ¥æ”¶å™¨)</td><td style="text-align:left">ä¸€ä¸ªç”¨äºæ¥æ”¶å¹¿æ’­ä¿¡æ¯ï¼Œå¹¶åšå‡ºå¯¹åº”å¤„ç†çš„ç»„ä»¶ã€‚æ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„ç³»ç»Ÿå¹¿æ’­ï¼šé€šçŸ¥æ—¶åŒºæ”¹å˜ã€ç”µé‡ä½ã€ç”¨æˆ·æ”¹å˜äº†è¯­è¨€é€‰é¡¹ç­‰ã€‚</td></tr><tr><td style="text-align:left">Content Provider(å†…å®¹æä¾›è€…)</td><td style="text-align:left">ä½œä¸ºåº”ç”¨ç¨‹åºä¹‹é—´å”¯ä¸€çš„å…±äº«æ•°æ®çš„é€”å¾„ï¼ŒContent Providerä¸»è¦çš„åŠŸèƒ½å°±æ˜¯å­˜å‚¨å¹¶æ£€ç´¢æ•°æ®ä»¥åŠå‘å…¶ä»–åº”ç”¨ç¨‹åºæä¾›è®¿é—®æ•°æ®çš„æ¥å£ã€‚Androidå†…ç½®çš„è®¸å¤šæ•°æ®éƒ½æ˜¯ä½¿ç”¨Content Providerå½¢å¼ï¼Œä¾›å¼€å‘è€…è°ƒç”¨çš„ï¼ˆå¦‚è§†é¢‘ï¼ŒéŸ³é¢‘ï¼Œå›¾ç‰‡ï¼Œé€šè®¯å½•ç­‰ï¼‰</td></tr></tbody></table></div><h3 id="Activityç”Ÿå‘½å‘¨æœŸ"><a href="#Activityç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Activityç”Ÿå‘½å‘¨æœŸ"></a>Activityç”Ÿå‘½å‘¨æœŸ</h3><div class="table-container"><table><thead><tr><th style="text-align:left">å‡½æ•°åç§°</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">onCreate()</td><td style="text-align:left">ä¸€ä¸ªActivityå¯åŠ¨åç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå¸¸ç”¨æ¥åœ¨æ­¤æ–¹æ³•ä¸­è¿›è¡ŒActivityçš„ä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚ä¾‹å¦‚åˆ›å»ºViewï¼Œç»‘å®šæ•°æ®ï¼Œæ³¨å†Œç›‘å¬ï¼ŒåŠ è½½å‚æ•°ç­‰ã€‚</td></tr><tr><td style="text-align:left">onStart()</td><td style="text-align:left">å½“Activityæ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶ï¼Œæ­¤æ–¹æ³•è¢«è°ƒç”¨ä½†æ­¤æ—¶è¿˜æ— æ³•è¿›è¡Œä¸ç”¨æˆ·çš„äº¤äº’æ“ä½œã€‚</td></tr><tr><td style="text-align:left">onResume()</td><td style="text-align:left">è¿™ä¸ªæ–¹æ³•åœ¨onStart()ä¹‹åè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨Activityå‡†å¤‡å¥½ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’çš„æ—¶å€™è°ƒç”¨ï¼Œæ­¤æ—¶çš„Activityä¸€å®šä½äºActivityæ ˆé¡¶ï¼Œå¤„äºè¿è¡ŒçŠ¶æ€ã€‚</td></tr><tr><td style="text-align:left">onPause()</td><td style="text-align:left">è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ç³»ç»Ÿå‡†å¤‡å»å¯åŠ¨æˆ–è€…æ¢å¤å¦å¤–ä¸€ä¸ªActivityçš„æ—¶å€™è°ƒç”¨ï¼Œé€šå¸¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œä¸€äº›é‡Šæ”¾èµ„æºçš„æ–¹æ³•ï¼Œä»¥åŠä¿å­˜ä¸€äº›å…³é”®æ•°æ®ã€‚</td></tr><tr><td style="text-align:left">onStop()</td><td style="text-align:left">è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨Activityå®Œå…¨ä¸å¯è§çš„æ—¶å€™è°ƒç”¨çš„ã€‚</td></tr><tr><td style="text-align:left">onDestroy()</td><td style="text-align:left">è¿™ä¸ªæ–¹æ³•åœ¨Activityé”€æ¯ä¹‹å‰è°ƒç”¨ï¼Œä¹‹åActivityçš„çŠ¶æ€ä¸ºé”€æ¯çŠ¶æ€ã€‚</td></tr><tr><td style="text-align:left">onRestart()</td><td style="text-align:left">å½“Activityä»åœæ­¢stopçŠ¶æ€æ¢è¿›å…¥startçŠ¶æ€æ—¶è°ƒç”¨çŠ¶æ€ã€‚</td></tr></tbody></table></div><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501190150532.png" alt="1737222612157.png"></p><h3 id="åŠ¨æ€è°ƒè¯•"><a href="#åŠ¨æ€è°ƒè¯•" class="headerlink" title="åŠ¨æ€è°ƒè¯•"></a>åŠ¨æ€è°ƒè¯•</h3><h4 id="1-ä¿®æ”¹debugæƒé™"><a href="#1-ä¿®æ”¹debugæƒé™" class="headerlink" title="1.ä¿®æ”¹debugæƒé™"></a>1.ä¿®æ”¹debugæƒé™</h4><p><strong>æ–¹æ³•ä¸€</strong>:åœ¨AndroidManifest.xmlé‡Œæ·»åŠ å¯è°ƒè¯•æƒé™ï¼ˆåœ¨applicationé‡Œï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:debuggable=&quot;true&quot;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•äºŒ</strong>ï¼šXappDebugæ¨¡å—hookå¯¹åº”çš„app</p><p><a href="https://github.com/Palatis/XAppDebug">XappDebug</a></p><p><strong>æ–¹æ³•ä¸‰</strong>ï¼šMagiskå‘½ä»¤(é‡å¯å¤±æ•ˆ)</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span>  adb shell #adbè¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span>  su #åˆ‡æ¢è‡³è¶…çº§ç”¨æˆ·</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span>  magisk resetprop ro.debuggable 1</span><br><span class="line"></span><br><span class="line"><span class="bullet">4.</span>  stop;start; #ä¸€å®šè¦é€šè¿‡è¯¥æ–¹å¼é‡å¯</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•å››</strong>:åˆ·å…¥MagiskHide Props Configæ¨¡å—</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨4é€‰é¡¹ä¸­å¦‚æœæœ‰ro.debuggableé‚£å°±ç›´æ¥ä¿®æ”¹<br>æ²¡æœ‰çš„è¯å°±é€‰5<br><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501211617314.png" alt="1737447405593.png"></p><p>ä¿®æ”¹ro.debuggableçš„å€¼ä¸º1</p><h4 id="2-ç«¯å£è½¬å‘ä»¥åŠå¼€å¯adbæƒé™"><a href="#2-ç«¯å£è½¬å‘ä»¥åŠå¼€å¯adbæƒé™" class="headerlink" title="2.ç«¯å£è½¬å‘ä»¥åŠå¼€å¯adbæƒé™"></a>2.ç«¯å£è½¬å‘ä»¥åŠå¼€å¯adbæƒé™</h4><p>ç‰ˆæœ¬å·ç‚¹å‡»ä¸ƒæ¬¡å¼€å¯å¼€å‘è€…æ¨¡å¼å¹¶å¼€å¯adbè°ƒè¯•æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:9999 tcp:9999</span><br></pre></td></tr></table></figure><h4 id="3-ä¸‹æ®µç‚¹"><a href="#3-ä¸‹æ®µç‚¹" class="headerlink" title="3.ä¸‹æ®µç‚¹"></a>3.ä¸‹æ®µç‚¹</h4><p>ctrl+bä¸‹æ–­ç‚¹</p><h4 id="4-debugæ¨¡å¼å¯åŠ¨"><a href="#4-debugæ¨¡å¼å¯åŠ¨" class="headerlink" title="4.debugæ¨¡å¼å¯åŠ¨"></a>4.debugæ¨¡å¼å¯åŠ¨</h4><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -D -n <span class="keyword">com</span>.zj.wuaipojie/.ui.MainActivity</span><br></pre></td></tr></table></figure><p>adb shell am start -D -n<br>adb shell am start -D -n åŒ…å/ç±»å<br>am start -n è¡¨ç¤ºå¯åŠ¨ä¸€ä¸ªactivity<br>am start -D è¡¨ç¤ºå°†åº”ç”¨è®¾ç½®ä¸ºå¯è°ƒè¯•æ¨¡å¼</p><h4 id="5-Jebé™„åŠ è°ƒè¯•è¿›ç¨‹"><a href="#5-Jebé™„åŠ è°ƒè¯•è¿›ç¨‹" class="headerlink" title="5.Jebé™„åŠ è°ƒè¯•è¿›ç¨‹"></a>5.Jebé™„åŠ è°ƒè¯•è¿›ç¨‹</h4><h3 id="Logæ’æ¡©"><a href="#Logæ’æ¡©" class="headerlink" title="Logæ’æ¡©"></a>Logæ’æ¡©</h3><p>å®šä¹‰ï¼šLogæ’æ¡©æŒ‡çš„æ˜¯åç¼–è¯‘APKæ–‡ä»¶æ—¶ï¼Œåœ¨å¯¹åº”çš„smaliæ–‡ä»¶é‡Œï¼Œæ·»åŠ ç›¸åº”çš„smaliä»£ç ï¼Œå°†ç¨‹åºä¸­çš„å…³é”®ä¿¡æ¯ï¼Œä»¥logæ—¥å¿—çš„å½¢å¼è¿›è¡Œè¾“å‡ºã€‚</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invoke-static &#123;å¯¹åº”å¯„å­˜å™¨&#125;, <span class="class">Lcom/mtools/LogUtils;</span>-&gt;v(<span class="class">Ljava/lang/Object;</span>)V</span><br></pre></td></tr></table></figure><h2 id="smaliåŠå…¶è¯­æ³•"><a href="#smaliåŠå…¶è¯­æ³•" class="headerlink" title="smaliåŠå…¶è¯­æ³•"></a>smaliåŠå…¶è¯­æ³•</h2><p>smaliæ˜¯Dalvikçš„å¯„å­˜å™¨è¯­è¨€ï¼Œsmaliä»£ç æ˜¯dexåç¼–è¯‘è€Œæ¥çš„ã€‚</p><h3 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h3><div class="table-container"><table><thead><tr><th style="text-align:left">åç§°</th><th style="text-align:left">æ³¨é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">.class</td><td style="text-align:left">ç±»å</td></tr><tr><td style="text-align:left">.super</td><td style="text-align:left">çˆ¶ç±»åï¼Œç»§æ‰¿çš„ä¸Šçº§ç±»ååç§°</td></tr><tr><td style="text-align:left">.source</td><td style="text-align:left">æºå</td></tr><tr><td style="text-align:left">.field</td><td style="text-align:left">å˜é‡</td></tr><tr><td style="text-align:left">.method</td><td style="text-align:left">æ–¹æ³•å</td></tr><tr><td style="text-align:left">.register</td><td style="text-align:left">å¯„å­˜å™¨</td></tr><tr><td style="text-align:left">.end method</td><td style="text-align:left">æ–¹æ³•åçš„ç»“æŸ</td></tr><tr><td style="text-align:left">public</td><td style="text-align:left">å…¬æœ‰</td></tr><tr><td style="text-align:left">protected</td><td style="text-align:left">åŠå…¬å¼€ï¼Œåªæœ‰åŒä¸€å®¶äººæ‰èƒ½ç”¨</td></tr><tr><td style="text-align:left">private</td><td style="text-align:left">ç§æœ‰ï¼Œåªèƒ½è‡ªå·±ä½¿ç”¨</td></tr><tr><td style="text-align:left">.parameter</td><td style="text-align:left">æ–¹æ³•å‚æ•°</td></tr><tr><td style="text-align:left">.prologue</td><td style="text-align:left">æ–¹æ³•å¼€å§‹</td></tr><tr><td style="text-align:left">.line xxx</td><td style="text-align:left">ä½äºç¬¬xxxè¡Œ</td></tr></tbody></table></div><h3 id="æ•°æ®ç±»å‹å¯¹åº”"><a href="#æ•°æ®ç±»å‹å¯¹åº”" class="headerlink" title="æ•°æ®ç±»å‹å¯¹åº”"></a>æ•°æ®ç±»å‹å¯¹åº”</h3><div class="table-container"><table><thead><tr><th style="text-align:left">smaliç±»å‹</th><th style="text-align:left">javaç±»å‹</th><th style="text-align:left">æ³¨é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">V</td><td style="text-align:left">void</td><td style="text-align:left">æ— è¿”å›å€¼</td></tr><tr><td style="text-align:left">Z</td><td style="text-align:left">boolean</td><td style="text-align:left">å¸ƒå°”å€¼ç±»å‹ï¼Œè¿”å›0æˆ–1</td></tr><tr><td style="text-align:left">B</td><td style="text-align:left">byte</td><td style="text-align:left">å­—èŠ‚ç±»å‹ï¼Œè¿”å›å­—èŠ‚</td></tr><tr><td style="text-align:left">S</td><td style="text-align:left">short</td><td style="text-align:left">çŸ­æ•´æ•°ç±»å‹ï¼Œè¿”å›æ•°å­—</td></tr><tr><td style="text-align:left">C</td><td style="text-align:left">char</td><td style="text-align:left">å­—ç¬¦ç±»å‹ï¼Œè¿”å›å­—ç¬¦</td></tr><tr><td style="text-align:left">I</td><td style="text-align:left">int</td><td style="text-align:left">æ•´æ•°ç±»å‹ï¼Œè¿”å›æ•°å­—</td></tr><tr><td style="text-align:left">J</td><td style="text-align:left">long ï¼ˆ64ä½ éœ€è¦2ä¸ªå¯„å­˜å™¨å­˜å‚¨ï¼‰</td><td style="text-align:left">é•¿æ•´æ•°ç±»å‹ï¼Œè¿”å›æ•°å­—</td></tr><tr><td style="text-align:left">F</td><td style="text-align:left">float</td><td style="text-align:left">å•æµ®ç‚¹ç±»å‹ï¼Œè¿”å›æ•°å­—</td></tr><tr><td style="text-align:left">D</td><td style="text-align:left">double ï¼ˆ64ä½ éœ€è¦2ä¸ªå¯„å­˜å™¨å­˜å‚¨ï¼‰</td><td style="text-align:left">åŒæµ®ç‚¹ç±»å‹ï¼Œè¿”å›æ•°å­—</td></tr><tr><td style="text-align:left">string</td><td style="text-align:left">String</td><td style="text-align:left">æ–‡æœ¬ç±»å‹ï¼Œè¿”å›å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:left">Lxxx/xxx/xxx</td><td style="text-align:left">object</td><td style="text-align:left">å¯¹è±¡ç±»å‹ï¼Œè¿”å›å¯¹è±¡</td></tr></tbody></table></div><h3 id="å¸¸ç”¨æŒ‡ä»¤"><a href="#å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤</h3><div class="table-container"><table><thead><tr><th style="text-align:left">å…³é”®å­—</th><th style="text-align:left">æ³¨é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">const</td><td style="text-align:left">é‡å†™æ•´æ•°å±æ€§ï¼ŒçœŸå‡å±æ€§å†…å®¹ï¼Œåªèƒ½æ˜¯æ•°å­—ç±»å‹</td></tr><tr><td style="text-align:left">const-string</td><td style="text-align:left">é‡å†™å­—ç¬¦ä¸²å†…å®¹</td></tr><tr><td style="text-align:left">const-wide</td><td style="text-align:left">é‡å†™é•¿æ•´æ•°ç±»å‹ï¼Œå¤šç”¨äºä¿®æ”¹åˆ°æœŸæ—¶é—´ã€‚</td></tr><tr><td style="text-align:left">return</td><td style="text-align:left">è¿”å›æŒ‡ä»¤</td></tr><tr><td style="text-align:left">if-eq</td><td style="text-align:left">å…¨ç§°equal(a=b)ï¼Œæ¯”è¾ƒå¯„å­˜å™¨abå†…å®¹ï¼Œç›¸åŒåˆ™è·³</td></tr><tr><td style="text-align:left">if-ne</td><td style="text-align:left">å…¨ç§°not equal(a!=b)ï¼Œabå†…å®¹ä¸ç›¸åŒåˆ™è·³</td></tr><tr><td style="text-align:left">if-eqz</td><td style="text-align:left">å…¨ç§°equal zero(a=0)ï¼Œzå³æ˜¯0çš„æ ‡è®°ï¼Œaç­‰äº0åˆ™è·³</td></tr><tr><td style="text-align:left">if-nez</td><td style="text-align:left">å…¨ç§°not equal zero(a!=0)ï¼Œaä¸ç­‰äº0åˆ™è·³</td></tr><tr><td style="text-align:left">if-ge</td><td style="text-align:left">å…¨ç§°greater equal(a&gt;=b)ï¼Œaå¤§äºæˆ–ç­‰äºåˆ™è·³</td></tr><tr><td style="text-align:left">if-le</td><td style="text-align:left">å…¨ç§°little equal(a&lt;=b)ï¼Œaå°äºæˆ–ç­‰äºåˆ™è·³</td></tr><tr><td style="text-align:left">goto</td><td style="text-align:left">å¼ºåˆ¶è·³åˆ°æŒ‡å®šä½ç½®</td></tr><tr><td style="text-align:left">switch</td><td style="text-align:left">åˆ†æ”¯è·³è½¬ï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ªåˆ†æ”¯çº¿ï¼Œå¹¶æ ¹æ®æŒ‡ä»¤è·³è½¬åˆ°é€‚å½“ä½ç½®</td></tr><tr><td style="text-align:left">iget</td><td style="text-align:left">è·å–å¯„å­˜å™¨æ•°æ®</td></tr></tbody></table></div><h3 id="å¯„å­˜å™¨"><a href="#å¯„å­˜å™¨" class="headerlink" title="å¯„å­˜å™¨"></a>å¯„å­˜å™¨</h3><p>åœ¨smailé‡Œæ‰€æœ‰æ“ä½œé€šè¿‡å¯„å­˜å™¨æ¥è¿›è¡Œ</p><ul><li><strong>æœ¬åœ°å¯„å­˜å™¨</strong>ï¼švå¼€å¤´æ•°å­—ç»“å°¾ v0</li><li><strong>å‚æ•°å¯„å­˜å™¨</strong>ï¼špå¼€å¤´æ•°å­—ç»“å°¾ p0</li></ul><p><strong>Q</strong> ï¼šp0ä¸€å®šæ˜¯ç¬¬ä¸€ä¸ªå‚æ•°å—ï¼Ÿ</p><p><strong>A</strong>ï¼šåœ¨staticå‡½æ•°ä¸­p0å¯¹åº”ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå› ä¸ºjavaè¯­æ³•é‡Œæ²¡æœ‰staticè¯­æ³•ï¼‰</p><p>åœ¨éstaticå‡½æ•°ä¸­ï¼Œp0ä»£æŒ‡ <strong>â€œthisâ€</strong>ï¼Œp1è¡¨ç¤ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°</p><h2 id="å®æˆ˜åŸç†"><a href="#å®æˆ˜åŸç†" class="headerlink" title="å®æˆ˜åŸç†"></a>å®æˆ˜åŸç†</h2><h3 id="åŒå¼€åŸç†"><a href="#åŒå¼€åŸç†" class="headerlink" title="åŒå¼€åŸç†"></a>åŒå¼€åŸç†</h3><ul><li><strong>ä¿®æ”¹åŒ…å</strong>ï¼šè®©æ‰‹æœºç³»ç»Ÿè®¤ä¸ºè¿™æ˜¯2ä¸ªAPPå®ç°ï¼Œæ”¹å˜äº†åº”ç”¨çš„ç­¾åä¿¡æ¯ï¼Œå¦‚æœæœ‰ç­¾åæ ¡éªŒåˆ™å¯èƒ½é—ªé€€å´©æºƒ</li><li><strong>ä¿®æ”¹Framework</strong></li><li><strong>é€šè¿‡è™šæ‹ŸåŒ–æŠ€æœ¯å®ç°</strong></li><li><strong>ä»¥æ’ä»¶æœºåˆ¶è¿è¡Œ</strong>ï¼šåˆ©ç”¨åå°„æ›¿æ¢ï¼ŒåŠ¨æ€ä»£{è¿‡}{æ»¤}ç†ï¼Œhookäº†ç³»ç»Ÿçš„å¤§éƒ¨åˆ†ä¸systemâ€”serverè¿›ç¨‹é€šè®¯çš„å‡½æ•°ï¼Œä»¥æ­¤ä½œä¸ºâ€œæ¬ºä¸Šç’ä¸‹â€çš„ç›®çš„ï¼Œæ¬ºéª—ç³»ç»Ÿâ€œä»¥ä¸ºâ€åªæœ‰ä¸€ä¸ªapkåœ¨è¿è¡Œï¼Œç’è¿‡æ’ä»¶è®©å…¶â€œè®¤ä¸ºâ€è‡ªå·±å·²ç»å®‰è£…ã€‚</li></ul><h3 id="å»å¹¿å‘Š"><a href="#å»å¹¿å‘Š" class="headerlink" title="å»å¹¿å‘Š"></a>å»å¹¿å‘Š</h3><p>å¯åŠ¨å¹¿å‘Šæµç¨‹ï¼š</p><ul><li>å¯åŠ¨Activity-&gt;å¹¿å‘ŠActivity-&gt;ä¸»é¡µActivity</li></ul><p>ä¿®æ”¹æ–¹æ³•ï¼š</p><ul><li>ä¿®æ”¹åŠ è½½æ—¶é—´</li><li>Acitivityåˆ‡æ¢å®šä½ï¼Œä¿®æ”¹Intentçš„Activityç±»å</li></ul><h3 id="å¼¹çª—å®šä½-amp-å †æ ˆåˆ†æ"><a href="#å¼¹çª—å®šä½-amp-å †æ ˆåˆ†æ" class="headerlink" title="å¼¹çª—å®šä½&amp;å †æ ˆåˆ†æ"></a>å¼¹çª—å®šä½&amp;å †æ ˆåˆ†æ</h3><p>ä¿®æ”¹æ–¹æ³•ï¼š<br>1.ä¿®æ”¹xmlä¸­çš„versiocode<br>2.Hookå¼¹çª—(æ¨èç®—æ³•åŠ©æ‰‹å¼€å¯å¼¹çª—å®šä½)<br>3.ä¿®æ”¹dexå¼¹çª—ä»£ç <br>4.æŠ“åŒ…ä¿®æ”¹å“åº”ä½“(ä¹Ÿå¯ä»¥è·¯ç”±å™¨æ‹¦æˆª)</p><h3 id="å¸ƒå±€ä¼˜åŒ–"><a href="#å¸ƒå±€ä¼˜åŒ–" class="headerlink" title="å¸ƒå±€ä¼˜åŒ–"></a>å¸ƒå±€ä¼˜åŒ–</h3><p>1.å¼€å‘è€…åŠ©æ‰‹æŠ“å¸ƒå±€<br>2.MTç®¡ç†å™¨xmlæœç´¢å®šä½<br>3.ä¿®æ”¹xmlä»£ç </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:visibility=&quot;gone&quot;</span><br></pre></td></tr></table></figure><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PEæ–‡ä»¶ç»“æ„å­¦ä¹ </title>
      <link href="/2025/01/05/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/"/>
      <url>/2025/01/05/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>èµ„æ–™æ¥æºï¼šã€Šé€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†ã€‹å’Œ<a href="https://www.youtube.com/watch?v=oSpeXGHaKAk&amp;t=15123s">PEæ–‡ä»¶ç»“æ„æ ¼å¼è¯¦è§£ï¼ˆå®Œæ•´ç‰ˆï¼‰ã€é€†å‘ç¼–ç¨‹ã€‘ (youtube.com)</a></p><h1 id="ä¸€ã€PEæ–‡ä»¶åŸºç¡€"><a href="#ä¸€ã€PEæ–‡ä»¶åŸºç¡€" class="headerlink" title="ä¸€ã€PEæ–‡ä»¶åŸºç¡€"></a>ä¸€ã€PEæ–‡ä»¶åŸºç¡€</h1><h2 id="1-å¯æ‰§è¡Œæ–‡ä»¶"><a href="#1-å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="1.å¯æ‰§è¡Œæ–‡ä»¶"></a>1.å¯æ‰§è¡Œæ–‡ä»¶</h2><p>Windowsï¼šPE</p><p>Linux: elf</p><h2 id="2-PEæ–‡ä»¶ç‰¹å¾"><a href="#2-PEæ–‡ä»¶ç‰¹å¾" class="headerlink" title="2.PEæ–‡ä»¶ç‰¹å¾"></a>2.PEæ–‡ä»¶ç‰¹å¾</h2><p>PEæ–‡ä»¶æŒ‡çº¹</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011858080.png" alt="1735729100495.png"></p><h2 id="3-PEç»“æ„"><a href="#3-PEç»“æ„" class="headerlink" title="3.PEç»“æ„"></a>3.PEç»“æ„</h2><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011859756.png" alt="1735729120355.png"></p><h3 id="DOSå¤´"><a href="#DOSå¤´" class="headerlink" title="DOSå¤´"></a>DOSå¤´</h3><ul><li><strong>DOS MZå¤´</strong>  <strong>IMAGE_DOS_HEADER(64å­—èŠ‚)</strong></li></ul><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011859938.png" alt="1735729155568.png"></p><p><strong>e_magic</strong>ï¼š4D5Aæ˜¯DOSç­¾åï¼Œä¸å¯æ”¹</p><p><strong>e_lfanew</strong>ï¼š78æŒ‡å‘PEå¤´å¼€å§‹ä½ç½®ï¼Œè¦æ”¹è¦ä¸€èµ·æ”¹ã€‚</p><p>ä¸Šé¢ä¸¤ä¸ªæ˜¯<strong>PEæŒ‡çº¹</strong>ï¼Œæ“ä½œç³»ç»Ÿç”¨æ¥<strong>è¯†åˆ«æ˜¯å¦æ˜¯PEæ–‡ä»¶</strong>ï¼Œå…¶ä»–åœ°æ–¹å¯ä»¥éšä¾¿æ”¹ï¼Œå› ä¸º<em>IMAGE_DOS_HEADER</em>æ˜¯ç»™16ä½å¹³å°çœ‹çš„ï¼Œè€Œæˆ‘ä»¬ç°åœ¨çš„ç¯å¢ƒå¤§éƒ¨åˆ†æ˜¯32ä½æˆ–è€…64ä½ã€‚</p><ul><li><strong>MS_DOS Stu</strong>ï¼ŒDOSå­˜æ ¹ï¼Œç”¨æ¥ç»™é“¾æ¥å™¨æ’å…¥æ•°æ®ï¼Œéšä¾¿æ”¹</li></ul><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011900211.png" alt="1735729196266.png"></p><h3 id="NTå¤´-IMAGE-NT-HEADERS"><a href="#NTå¤´-IMAGE-NT-HEADERS" class="headerlink" title="NTå¤´ IMAGE_NT_HEADERS"></a>NTå¤´ IMAGE_NT_HEADERS</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS</span> &#123;</span></span><br><span class="line"> DWORD Signature; ``<span class="comment">// PEæ ‡è¯†</span></span><br><span class="line"> IMAGE_FILE_HEADER FileHeader; ``<span class="comment">// æ ‡å‡†PEå¤´</span></span><br><span class="line"> IMAGE_OPTIONAL_HEADER32 OptionalHeader; ``<span class="comment">// æ‰©å±•PEå¤´</span></span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br></pre></td></tr></table></figure><h4 id="PEæ ‡è¯†-Signature-4å­—èŠ‚"><a href="#PEæ ‡è¯†-Signature-4å­—èŠ‚" class="headerlink" title="PEæ ‡è¯† Signature 4å­—èŠ‚"></a>PEæ ‡è¯† Signature 4å­—èŠ‚</h4><p><strong><u>ä¸å¯æ”¹</u></strong>,æ“ä½œç³»ç»Ÿå¯åŠ¨ç¨‹åºçš„æ—¶å€™è¯†åˆ«è¿™ä¸ªæ ‡è¯†ã€‚</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011901322.png" alt="1735729196266.png"></p><h4 id="æ ‡å‡†PEå¤´-IMAGE-FILE-HEADER-20å­—èŠ‚"><a href="#æ ‡å‡†PEå¤´-IMAGE-FILE-HEADER-20å­—èŠ‚" class="headerlink" title="æ ‡å‡†PEå¤´ IMAGE_FILE_HEADER(20å­—èŠ‚)"></a>æ ‡å‡†PEå¤´ <strong>IMAGE_FILE_HEADER</strong>(20å­—èŠ‚)</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_FILE_HEADER</span> &#123;</span></span><br><span class="line"> WORD Machine; <span class="comment">// å¯ä»¥è¿è¡Œåœ¨ä»€ä¹ˆæ ·çš„CPUä¸Š</span></span><br><span class="line"> WORD NumberOfSections; <span class="comment">// è¡¨ç¤ºèŠ‚çš„æ•°é‡</span></span><br><span class="line"> DWORD TimeDateStamp; <span class="comment">// ç¼–è¯‘å™¨å¡«å†™çš„æ—¶é—´æˆ³</span></span><br><span class="line"> DWORD PointerToSymbolTable; <span class="comment">// è°ƒè¯•ç›¸å…³</span></span><br><span class="line"> DWORD NumberOfSymbols; <span class="comment">// è°ƒè¯•ç›¸å…³</span></span><br><span class="line"> WORD SizeOfOptionalHeader; <span class="comment">// æ‰©å±•PEå¤´çš„å¤§å°</span></span><br><span class="line"> WORD Characteristics; <span class="comment">// æ–‡ä»¶å±æ€§</span></span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011902971.png" alt="1735729302371.png"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011902440.png" alt="1735729314190.png"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011902205.png" alt="1735729331600.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">64 86 -&gt;8664 ä»£è¡¨åœ¨x64ä¸Šè¿è¡Œ</span><br><span class="line">0F 00 æœ‰0x0Fä¸ªèŠ‚åŒº</span><br><span class="line">84 D7 68 65 ç¼–è¯‘å™¨å†™çš„æ—¶é—´æˆ³ï¼Œå’Œæ–‡ä»¶æ— å…³ï¼Œéšä¾¿æ”¹</span><br><span class="line">è°ƒè¯•ä¸ç®¡</span><br><span class="line">F0 00 æ‰©å±•PEå¤´å¤§å°ï¼Œå¯æ”¹</span><br><span class="line">22 00-&gt;0022-&gt; 0000 0000 0010 0010 ç¬¬2ä½ï¼Œç¬¬6ä½æœ‰å€¼ å¯¹åº”æ•°æ®ä½1ï¼Œ5 åˆ†åˆ«ä»£è¡¨æ–‡ä»¶å¯æ‰§è¡Œï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å¤„ç†å¤§äº2GBçš„åœ°å€ï¼ˆä»£è¡¨64ä½ï¼‰</span><br></pre></td></tr></table></figure><h4 id="æ‰©å±•PEå¤´-IMAGE-OPTIONAL-HEADER"><a href="#æ‰©å±•PEå¤´-IMAGE-OPTIONAL-HEADER" class="headerlink" title="æ‰©å±•PEå¤´  IMAGE_OPTIONAL_HEADER"></a>æ‰©å±•PEå¤´  IMAGE_OPTIONAL_HEADER</h4><h5 id="æ‰©å±•PEå¤´ç»“æ„-amp-ä¸åŒç¼–è¯‘å™¨ä¸Šçš„å·®å¼‚"><a href="#æ‰©å±•PEå¤´ç»“æ„-amp-ä¸åŒç¼–è¯‘å™¨ä¸Šçš„å·®å¼‚" class="headerlink" title="æ‰©å±•PEå¤´ç»“æ„&amp;ä¸åŒç¼–è¯‘å™¨ä¸Šçš„å·®å¼‚"></a>æ‰©å±•PEå¤´ç»“æ„&amp;ä¸åŒç¼–è¯‘å™¨ä¸Šçš„å·®å¼‚</h5><p>32ä½ä¸Šæ˜¯224å­—èŠ‚ï¼ˆE0)ï¼ˆå¯æ‰©å±•ï¼‰</p><p>64ä½æ˜¯F0</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//32ä½ä¸ºä¾‹</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_OPTIONAL_HEADER32</span> &#123;</span></span><br><span class="line">    WORD    Magic;                  <span class="comment">// æ ‡å¿—ï¼šPE32 æ˜¯ 0x10B</span></span><br><span class="line">    BYTE    MajorLinkerVersion;     <span class="comment">// é“¾æ¥å™¨çš„ä¸»ç‰ˆæœ¬å·</span></span><br><span class="line">    BYTE    MinorLinkerVersion;     <span class="comment">// é“¾æ¥å™¨çš„æ¬¡ç‰ˆæœ¬å·</span></span><br><span class="line">    DWORD   SizeOfCode;             <span class="comment">// ä»£ç æ®µçš„å¤§å°ï¼ˆæ²¡ç”¨ï¼‰</span></span><br><span class="line">    DWORD   SizeOfInitializedData;  <span class="comment">// åˆå§‹åŒ–æ•°æ®æ®µçš„å¤§å°ï¼ˆæ²¡ç”¨ï¼‰</span></span><br><span class="line">    DWORD   SizeOfUninitializedData;<span class="comment">// æœªåˆå§‹åŒ–æ•°æ®æ®µçš„å¤§å°ï¼ˆæ²¡ç”¨ï¼‰</span></span><br><span class="line">    DWORD   AddressOfEntryPoint;    <span class="comment">// ç¨‹åºå…¥å£ç‚¹çš„ RVA</span></span><br><span class="line">    DWORD   BaseOfCode;             <span class="comment">// ä»£ç æ®µçš„èµ·å§‹ RVAï¼ˆæ²¡ç”¨ï¼‰</span></span><br><span class="line">    DWORD   BaseOfData;             <span class="comment">// æ•°æ®æ®µçš„èµ·å§‹ RVAï¼ˆæ²¡ç”¨ï¼‰</span></span><br><span class="line">    DWORD   ImageBase;              <span class="comment">// å†…å­˜é•œåƒåŸºå€</span></span><br><span class="line">    DWORD   SectionAlignment;       <span class="comment">// å†…å­˜å¯¹é½</span></span><br><span class="line">    DWORD   FileAlignment;          <span class="comment">// æ–‡ä»¶å¯¹é½</span></span><br><span class="line">    WORD    MajorOperatingSystemVersion; <span class="comment">// OS ä¸»ç‰ˆæœ¬å·</span></span><br><span class="line">    WORD    MinorOperatingSystemVersion; <span class="comment">// OS æ¬¡ç‰ˆæœ¬å·</span></span><br><span class="line">    DWORD   SizeOfImage;            <span class="comment">// é•œåƒçš„æ€»å¤§å°</span></span><br><span class="line">    DWORD   SizeOfHeaders;          <span class="comment">// å¤´+èŠ‚è¡¨æŒ‰ç…§æ–‡ä»¶å¯¹é½åçš„æ€»å¤§å°</span></span><br><span class="line">    DWORD   CheckSum;               <span class="comment">// æ ¡éªŒå’Œ</span></span><br><span class="line">    WORD    Subsystem;              <span class="comment">// å­ç³»ç»Ÿï¼ˆå¦‚ GUIã€CUIï¼‰</span></span><br><span class="line">    WORD    DllCharacteristics;    <span class="comment">// DLL å±æ€§</span></span><br><span class="line">    DWORD   SizeOfStackReserve;     <span class="comment">// å †æ ˆä¿ç•™å¤§å°</span></span><br><span class="line">    DWORD   SizeOfStackCommit;      <span class="comment">// å †æ ˆæäº¤å¤§å°</span></span><br><span class="line">    DWORD   SizeOfHeapReserve;      <span class="comment">// å †ä¿ç•™å¤§å°</span></span><br><span class="line">    DWORD   SizeOfHeapCommit;       <span class="comment">// å †æäº¤å¤§å°</span></span><br><span class="line">    DWORD   LoaderFlags;            <span class="comment">// è£…è½½å™¨æ ‡å¿—ï¼ˆé€šå¸¸ä¸º 0ï¼‰</span></span><br><span class="line">    DWORD   NumberOfRvaAndSizes;    <span class="comment">// æ•°æ®ç›®å½•é¡¹æ•°</span></span><br><span class="line">    IMAGE_DATA_DIRECTORY DataDirectory[<span class="number">16</span>]; <span class="comment">// è¡¨ï¼Œç»“æ„ä½“æ•°ç»„</span></span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32;</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th><strong>å­—æ®µåç§°</strong></th><th><strong>32 ä½ PEï¼ˆPE32ï¼‰</strong></th><th><strong>64 ä½ PEï¼ˆPE32+ï¼‰</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td><code>Magic</code></td><td><code>0x10B</code></td><td><code>0x20B</code></td><td>æ ‡è¯† PE æ–‡ä»¶æ˜¯ 32 ä½ï¼ˆPE32ï¼‰è¿˜æ˜¯ 64 ä½ï¼ˆPE32+ï¼‰ã€‚</td></tr><tr><td><code>AddressOfEntryPoint</code></td><td>å­˜åœ¨</td><td>å­˜åœ¨</td><td>ç¨‹åºå…¥å£ç‚¹çš„ RVAï¼ˆç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼‰ã€‚</td></tr><tr><td><code>BaseOfCode</code></td><td>å­˜åœ¨</td><td>å­˜åœ¨</td><td>ä»£ç æ®µçš„èµ·å§‹ RVAã€‚</td></tr><tr><td><code>BaseOfData</code></td><td>å­˜åœ¨</td><td><strong>ä¸å­˜åœ¨</strong></td><td>æ•°æ®æ®µçš„èµ·å§‹ RVAï¼Œ<strong>ä»…åœ¨ PE32 ä¸­å­˜åœ¨</strong>ã€‚</td></tr><tr><td><code>ImageBase</code></td><td>32 ä½åœ°å€ï¼ˆé»˜è®¤ 0x00400000ï¼‰</td><td>64 ä½åœ°å€ï¼ˆé»˜è®¤ 0x0000000140000000ï¼‰</td><td>å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­çš„é¦–åœ°å€ã€‚</td></tr><tr><td><code>SizeOfStackReserve</code></td><td>32 ä½å€¼</td><td>64 ä½å€¼</td><td>ä¸ºçº¿ç¨‹çš„å †æ ˆé¢„ç•™çš„å¤§å°ã€‚</td></tr><tr><td><code>SizeOfHeapReserve</code></td><td>32 ä½å€¼</td><td>64 ä½å€¼</td><td>ä¸ºå †åˆ†é…çš„ä¿ç•™å¤§å°ã€‚</td></tr></tbody></table></div><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011903423.png" alt="1735729389033.png"></p><ul><li><strong>Magic</strong></li></ul><p>2ä¸ªå­—èŠ‚ï¼Œæ–‡ä»¶çš„æ ‡å¿—</p><p>32 ä½ï¼š10B</p><p>64 ä½ï¼š20B </p><ul><li><strong>AddressOfEntryPoint</strong></li></ul><p>4ä¸ªå­—èŠ‚ï¼Œç¨‹åºçš„å…¥å£ç‚¹åœ°å€ï¼Œå³æ‰§è¡Œå¼€å§‹çš„ä½ç½®ã€‚</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011904115.png" alt="1735729398902.png"></p><ul><li><strong>ImageBase</strong></li></ul><p>4ä¸ªå­—èŠ‚ï¼Œç¨‹åºåŠ è½½çš„åŸºåœ°å€ã€‚</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011904366.png" alt="1735729409663.png"></p><p>AddressOfEntryPointï¼š<u>042CE910</u></p><p>imagebase:<u>00000010</u></p><p>ç¨‹åºæ‰§è¡Œå…¥å£ï¼šï¼ˆEIP)042CE910+00000010=042CE920</p><ul><li><strong>SectionAlignment</strong></li></ul><p>èŠ‚åŒºçš„å†…å­˜å¯¹é½å¤§å°ï¼ŒèŠ‚åŒºåœ¨<strong>å†…å­˜</strong>ä¸­çš„æœ€å°å¤§å°ã€‚</p><ul><li><strong>FileAlignment</strong></li></ul><p>èŠ‚åŒºçš„æ–‡ä»¶å¯¹é½å¤§å°ï¼ŒèŠ‚åŒºåœ¨<strong>ç£ç›˜æ–‡ä»¶</strong>ä¸­çš„æœ€å°å•ä½ã€‚</p><ul><li><strong>SizeOfImage</strong></li></ul><p>è¡¨ç¤ºåœ¨å†…å­˜ä¸­<strong>æ•´ä¸ª</strong>PEæ–‡ä»¶æ˜ å°„çš„å¤§å°ï¼ˆåŒ…æ‹¬æ‰€æœ‰èŠ‚åŒºå’Œå¤´ä¿¡æ¯ï¼‰ï¼Œå¯æ¯”å®é™…çš„å€¼å¤§ã€‚å†…å­˜å¯¹é½ä»¥åæ˜¯SectionAlignmentæˆ–è€…FileAlignmentçš„æ•´æ•°å€ã€‚</p><ul><li><strong>SizeOfHeaders</strong></li></ul><p>PE æ–‡ä»¶å¤´çš„å¤§å°ã€‚æ˜¯<strong>FileAlignmentçš„æ•´æ•°å€</strong>ã€‚</p><ul><li><strong>CheckSum</strong></li></ul><p>æ ¡éªŒå’Œï¼Œç³»ç»Ÿç”¨æ¥æ£€æµ‹æ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹</p><ul><li><strong>Subsystem</strong></li></ul><p>ç¨‹åºçš„å­ç³»ç»Ÿç±»å‹ï¼ˆä¾‹å¦‚ï¼ŒWindows GUI æˆ–æ§åˆ¶å°åº”ç”¨ç¨‹åºï¼‰ï¼Œç”¨æ¥è¡¨ç¤ºPEæ–‡ä»¶çš„ç‰¹æ€§ã€‚</p><h3 id="èŠ‚è¡¨"><a href="#èŠ‚è¡¨" class="headerlink" title="èŠ‚è¡¨"></a>èŠ‚è¡¨</h3><p><strong>IMAGE_SECTION_HEADER</strong> (40å­—èŠ‚)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_SECTION_HEADER</span> &#123;</span></span><br><span class="line">    BYTE    Name[<span class="number">8</span>];               <span class="comment">// èŠ‚åç§°ï¼ˆæœ€å¤š 8 å­—èŠ‚ï¼Œå¯èƒ½æ²¡æœ‰ç»“æŸç¬¦ï¼‰</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        DWORD   PhysicalAddress;   <span class="comment">// å®é™…å·²å¼ƒç”¨ï¼Œå¸¸ä¸º 0</span></span><br><span class="line">        DWORD   VirtualSize;       <span class="comment">// èŠ‚çš„å®é™…å¤§å°ï¼ˆå†…å­˜ä¸­çš„å¤§å°ï¼‰</span></span><br><span class="line">    &#125; Misc;</span><br><span class="line">    DWORD   VirtualAddress;        <span class="comment">// èŠ‚åœ¨å†…å­˜ä¸­çš„ RVAï¼ˆç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼‰</span></span><br><span class="line">    DWORD   SizeOfRawData;         <span class="comment">// èŠ‚åœ¨æ–‡ä»¶ä¸­çš„å¤§å°ï¼ˆä»¥ FileAlignment å¯¹é½ï¼‰</span></span><br><span class="line">    DWORD   PointerToRawData;      <span class="comment">// èŠ‚åœ¨æ–‡ä»¶ä¸­çš„åç§»ï¼ˆä»¥ FileAlignment å¯¹é½ï¼‰</span></span><br><span class="line">    DWORD   PointerToRelocations; <span class="comment">// é‡å®šä½è¡¨çš„æ–‡ä»¶åç§»ï¼ˆé€šå¸¸ä¸º 0ï¼Œå·²å¼ƒç”¨ï¼‰</span></span><br><span class="line">    DWORD   PointerToLinenumbers; <span class="comment">// è°ƒè¯•ä¿¡æ¯çš„æ–‡ä»¶åç§»ï¼ˆé€šå¸¸ä¸º 0ï¼‰</span></span><br><span class="line">    WORD    NumberOfRelocations;  <span class="comment">// é‡å®šä½æ¡ç›®æ•°é‡ï¼ˆé€šå¸¸ä¸º 0ï¼‰</span></span><br><span class="line">    WORD    NumberOfLinenumbers;  <span class="comment">// è°ƒè¯•è¡Œå·æ¡ç›®æ•°é‡ï¼ˆé€šå¸¸ä¸º 0ï¼‰</span></span><br><span class="line">    DWORD   Characteristics;      <span class="comment">// èŠ‚çš„å±æ€§æ ‡å¿—ï¼ˆæƒé™ã€ç±»å‹ç­‰ï¼‰</span></span><br><span class="line">&#125; IMAGE_SECTION_HEADER;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çº¢è‰²æ¡†å‡ºæ¥çš„æ˜¯æ‰©å±•PEå¤´ï¼Œä¸‹é¢å°±æ˜¯èŠ‚è¡¨</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011904634.png" alt="1735729466460.png"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011905916.png" alt="1735729479345.png"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011905144.png" alt=""></p><ul><li><h4 id="Name"><a href="#Name" class="headerlink" title="Name"></a>Name</h4></li></ul><p>8å­—èŠ‚ï¼Œå½“å‰èŠ‚çš„åå­—ï¼Œå¯ä»¥éšæ„æ›´æ”¹ã€‚</p><h5 id=""><a href="#" class="headerlink" title=""></a><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052106081.png" alt="image"></h5><p>å½“å‰è¿™ä¸ªèŠ‚æœªå¯¹é½æ—¶çš„å¤§å°ï¼Œå³å®é™…å¤§å°ã€‚</p><p>å®é™…å¤§å°æœ‰å¯èƒ½ä¼šæ¯”Size of Raw Dataå¤§ï¼Œå› ä¸ºæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡åœ¨æ–‡ä»¶ä¸­æ˜¯ä¸å ç©ºé—´çš„ï¼Œä½†æ˜¯åœ¨å†…å­˜é‡Œæ˜¯æœ‰ä½ç½®çš„ã€‚</p><p><strong>Q</strong>ï¼šåœ¨å†…å­˜ä¸­å±•å¼€æ—¶ä»¥ä»€ä¹ˆä¸ºåŸºå‡†å‘¢ï¼Ÿ</p><p><strong>A</strong>ï¼šè°å¤§æŒ‰è°ï¼Œå¦‚æœVitual Size&gt;Size of Raw Data,åˆ™æŒ‰ç…§Vitual Sizeå±•å¼€ï¼Œåä¹‹åˆ™æŒ‰ç…§Size of Raw Dataã€‚</p><ul><li><h4 id="VirtualAddressï¼ˆRVAï¼‰"><a href="#VirtualAddressï¼ˆRVAï¼‰" class="headerlink" title="VirtualAddressï¼ˆRVAï¼‰"></a>VirtualAddressï¼ˆRVAï¼‰</h4></li></ul><p>åœ¨å†…å­˜ä¸­çš„åç§»åœ°å€ï¼ŒåŠ ä¸ŠImageBaseåˆ™æ˜¯å†…å­˜ä¸­çš„çœŸå®åœ°å€ã€‚</p><ul><li><h4 id="Raw-Size-Size-of-Raw-Data"><a href="#Raw-Size-Size-of-Raw-Data" class="headerlink" title="Raw Size(Size of Raw Data)"></a>Raw Size(Size of Raw Data)</h4></li></ul><p>æ–‡ä»¶å¯¹é½åçš„å¤§å°</p><ul><li><h4 id="Raw-Address-File-Pointer-to-Raw-Data"><a href="#Raw-Address-File-Pointer-to-Raw-Data" class="headerlink" title="Raw Address(File Pointer to Raw Data)"></a><strong>Raw Address</strong>(File Pointer to Raw Data)</h4></li></ul><p>å½“å‰èŠ‚åœ¨æ–‡ä»¶ä¸­èµ·å§‹ä½ç½®</p><ul><li><h4 id="Reloc-Address"><a href="#Reloc-Address" class="headerlink" title="Reloc Address"></a><strong>Reloc Address</strong></h4></li></ul><p>èŠ‚çš„é‡å®šä½è¡¨ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰åœ¨æ–‡ä»¶ä¸­çš„åç§»åœ°å€ã€‚</p><ul><li><h4 id="Line-Numbersã€Relocation-Numberã€Line-Number-Numbers"><a href="#Line-Numbersã€Relocation-Numberã€Line-Number-Numbers" class="headerlink" title="Line Numbersã€Relocation Numberã€Line Number Numbers"></a><strong>Line Numbers</strong>ã€<strong>Relocation Number</strong>ã€<strong>Line Number Numbers</strong></h4></li></ul><p>ä¸è°ƒè¯•ä¿¡æ¯å’Œé‡å®šä½è¡¨ç›¸å…³ã€‚</p><ul><li><h4 id="Characteristics"><a href="#Characteristics" class="headerlink" title="Characteristics"></a>Characteristics</h4></li></ul><p>èŠ‚åŒºå±æ€§</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052106048.png" alt="image"></p><h3 id="PEæ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€"><a href="#PEæ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€" class="headerlink" title="PEæ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€"></a>PEæ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€</h3><p>æ–‡ä»¶å¯¹é½å’Œå†…å­˜å¯¹é½çš„å·®å¼‚ï¼š</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052106850.png" alt="image"></p><h2 id="4ã€RVAå’ŒFOAçš„è½¬æ¢"><a href="#4ã€RVAå’ŒFOAçš„è½¬æ¢" class="headerlink" title="4ã€RVAå’ŒFOAçš„è½¬æ¢"></a>4ã€RVAå’ŒFOAçš„è½¬æ¢</h2><p><strong>VA</strong>ï¼šè™šæ‹Ÿå†…å­˜çš„ç»å¯¹åœ°å€ã€‚</p><p><strong>RVA</strong>ï¼šç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼Œä»ImageBaseå¼€å§‹çš„ç›¸å¯¹åœ°å€ã€‚</p><p><strong>FOA</strong>ï¼šæ–‡ä»¶åç§»åœ°å€</p><p><strong>Q</strong>ï¼šæƒ³æ”¹è¾¹ä¸€ä¸ªå…¨å±€å˜é‡çš„åˆå§‹å€¼ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ</p><p><strong>A</strong>ï¼šå…ˆåŒºåˆ†å…¨å±€å˜é‡æœ‰æ— åˆå§‹å€¼ã€‚å¦‚æœæœ‰åˆå§‹å€¼ï¼Œå…¨å±€å˜é‡å‚¨å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ²¡æœ‰åˆå§‹å€¼ï¼Œåœ¨æ–‡ä»¶é‡Œå°±æ²¡æœ‰ä½ç½®ï¼Œåœ¨å†…å­˜å±•å¼€æ—¶æ‰ä¼šåˆ†é…ä½ç½®ã€‚</p><p><1>ã€åˆ¤æ–­RVAæ˜¯å¦åœ¨å¤´éƒ¨ï¼Œåœ¨çš„è¯ç›´æ¥è¿”å›</p><p>FOA=RVA</p><p><2>ã€åˆ¤æ–­RVAåœ¨å“ªä¸€ä¸ªèŠ‚</p><p>RVA&gt;=èŠ‚.VA</p><p>RVA&lt;=èŠ‚.VA+å½“å‰èŠ‚å†…å­˜å¯¹å…¶åå¤§å°</p><p>å·®å€¼=RVA-èŠ‚.VA</p><p><4>ã€FOA=èŠ‚.PointerToRawData+å·®å€¼</p><p>çœ‹ä¸€ä¸‹ä¹¦ä¸Šçš„ä¾‹å­ï¼Œå®ä¾‹ä¸‹é¢å¯¼å…¥è¡¨çš„è®¡ç®—ä¹Ÿæœ‰æåˆ°</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052107891.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052108166.png" alt="image"></p><p><strong>ç®—å®ŒRAWè®°å¾—æŸ¥çœ‹æ˜¯å¦å’Œå†…å­˜ä¸­åœ¨åŒä¸€èŠ‚åŒºï¼ï¼ï¼</strong>å¦‚ä¸Šå›¾Q3</p><h2 id="5ã€æ‰‹æ’•PEæ–‡ä»¶"><a href="#5ã€æ‰‹æ’•PEæ–‡ä»¶" class="headerlink" title="5ã€æ‰‹æ’•PEæ–‡ä»¶"></a>5ã€æ‰‹æ’•PEæ–‡ä»¶</h2><h3 id="ï¼ˆ1ï¼‰åœ¨ç©ºç™½åŒºæ·»åŠ ä»£ç "><a href="#ï¼ˆ1ï¼‰åœ¨ç©ºç™½åŒºæ·»åŠ ä»£ç " class="headerlink" title="ï¼ˆ1ï¼‰åœ¨ç©ºç™½åŒºæ·»åŠ ä»£ç "></a>ï¼ˆ1ï¼‰åœ¨ç©ºç™½åŒºæ·»åŠ ä»£ç </h3><h3 id="ï¼ˆ2ï¼‰æ‰©å¤§èŠ‚"><a href="#ï¼ˆ2ï¼‰æ‰©å¤§èŠ‚" class="headerlink" title="ï¼ˆ2ï¼‰æ‰©å¤§èŠ‚"></a>ï¼ˆ2ï¼‰æ‰©å¤§èŠ‚</h3><h3 id="ï¼ˆ3ï¼‰åˆ é™¤èŠ‚"><a href="#ï¼ˆ3ï¼‰åˆ é™¤èŠ‚" class="headerlink" title="ï¼ˆ3ï¼‰åˆ é™¤èŠ‚"></a>ï¼ˆ3ï¼‰åˆ é™¤èŠ‚</h3><h3 id="ï¼ˆ4ï¼‰æ–°æ·»èŠ‚"><a href="#ï¼ˆ4ï¼‰æ–°æ·»èŠ‚" class="headerlink" title="ï¼ˆ4ï¼‰æ–°æ·»èŠ‚"></a>ï¼ˆ4ï¼‰æ–°æ·»èŠ‚</h3><h3 id="ï¼ˆ5ï¼‰åˆå¹¶èŠ‚"><a href="#ï¼ˆ5ï¼‰åˆå¹¶èŠ‚" class="headerlink" title="ï¼ˆ5ï¼‰åˆå¹¶èŠ‚"></a>ï¼ˆ5ï¼‰åˆå¹¶èŠ‚</h3><h2 id="6ã€å¯¼å‡ºè¡¨-amp-å¯¼å…¥è¡¨"><a href="#6ã€å¯¼å‡ºè¡¨-amp-å¯¼å…¥è¡¨" class="headerlink" title="6ã€å¯¼å‡ºè¡¨&amp;å¯¼å…¥è¡¨"></a>6ã€å¯¼å‡ºè¡¨&amp;å¯¼å…¥è¡¨</h2><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><p>é¦–å…ˆæ˜ç™½ï¼Œä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºæ˜¯æœ‰<strong>å¤šä¸ªpeæ–‡ä»¶ç»„æˆ</strong>çš„ã€‚</p><p><strong>å¯¼å…¥è¡¨ï¼ˆIMP)</strong>ï¼šPEæ–‡ä»¶å¼•ç”¨äº†å“ªäº›æ–‡ä»¶</p><ul><li><strong>å¯¼å…¥åœ°å€è¡¨IAT</strong>ï¼šå‚¨å­˜å¯¼å…¥å‡½æ•°åœ¨å†…å­˜é‡Œçš„å®é™…åº”ç”¨ã€‚</li><li><strong>å¯¼å…¥åç§°è¡¨INT</strong>ï¼šæ¯ä¸ªdllå¯¼å…¥æè¿°ç¬¦ï¼Œå‚¨å­˜å‡½æ•°åæˆ–è€…åºå·ï¼Œç”¨äºåŠ è½½è§£æå‡½æ•°åœ°å€ã€‚</li></ul><div class="table-container"><table><thead><tr><th style="text-align:left"><strong>ç»„ä»¶</strong></th><th style="text-align:left"><strong>å†…å®¹ï¼ˆç£ç›˜ï¼‰</strong></th><th style="text-align:left"><strong>å†…å®¹ï¼ˆå†…å­˜ï¼‰</strong></th><th style="text-align:left"><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong>å¯¼å…¥è¡¨ï¼ˆIMPï¼‰</strong></td><td style="text-align:left">æ‰€æœ‰å¯¼å…¥DLLçš„æè¿°ä¿¡æ¯</td><td style="text-align:left">ä¸å˜</td><td style="text-align:left">ç®¡ç†æ‰€æœ‰å¯¼å…¥çš„DLLå’Œå‡½æ•°å¼•ç”¨</td></tr><tr><td style="text-align:left"><strong>å¯¼å…¥åç§°è¡¨ï¼ˆINTï¼‰</strong></td><td style="text-align:left">å‡½æ•°åç§°/åºå·çš„RVA</td><td style="text-align:left">ä¸å˜ï¼ˆæˆ–ä¸å­˜åœ¨äºå†…å­˜ï¼‰</td><td style="text-align:left">æä¾›åŠ è½½æ—¶è§£æå‡½æ•°åœ°å€çš„çº¿ç´¢</td></tr><tr><td style="text-align:left"><strong>å¯¼å…¥åœ°å€è¡¨ï¼ˆIATï¼‰</strong></td><td style="text-align:left">åˆå§‹ä¸ºå‡½æ•°åç§°/åºå·çš„RVA</td><td style="text-align:left">å®é™…å‡½æ•°åœ°å€</td><td style="text-align:left">è¿è¡Œæ—¶è·³è½¬åˆ°ç›®æ ‡å‡½æ•°çš„åœ°å€è¡¨</td></tr></tbody></table></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Import Table (IMP)</span><br><span class="line">â”œâ”€ IMAGE_IMPORT_DESCRIPTOR 1 (DLL1)</span><br><span class="line">â”‚  â”œâ”€ OriginalFirstThunk â†’ INT (å‡½æ•°åç§°/åºå·)</span><br><span class="line">â”‚  â””â”€ FirstThunk â†’ IAT (åˆå§‹åŒINTï¼ŒåŠ è½½åä¸ºåœ°å€)</span><br><span class="line">â”œâ”€ IMAGE_IMPORT_DESCRIPTOR 2 (DLL2)</span><br><span class="line">â”‚  â”œâ”€ OriginalFirstThunk â†’ INT</span><br><span class="line">â”‚  â””â”€ FirstThunk â†’ IAT</span><br><span class="line">â””â”€ ...</span><br></pre></td></tr></table></figure><p><strong>å¯¼å‡ºè¡¨(EAT)</strong>ï¼šå½“å‰çš„PEæ–‡ä»¶å‚¨å­˜äº†å“ªäº›å‡½æ•°ç»™å…¶ä»–æ–‡ä»¶ç”¨ã€‚</p><p><strong>Q</strong>ï¼šå¯¼å‡ºè¡¨åœ¨å“ªï¼Ÿ</p><p><strong>A</strong>ï¼šå†æ‰©å±•PEå¤´æœ€åä¸€ä¸ªæˆå‘˜</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052108437.png" alt="image"></p><h4 id="Dll"><a href="#Dll" class="headerlink" title="Dll"></a>Dll</h4><p>åŠ¨æ€é“¾æ¥åº“</p><p>åŠ è½½DLLçš„ä¸¤ç§æ–¹å¼</p><ul><li><strong>æ˜¾å¼é“¾æ¥</strong>ï¼šç¨‹åºä½¿ç”¨DLLæ—¶å€™åŠ è½½ï¼Œä½¿ç”¨å®Œé‡Šæ”¾å†…å­˜ã€‚</li><li><strong>éšå¼é“¾æ¥</strong>ï¼šç¨‹åºå¼€å§‹æ—¶ä¸€åŒåŠ è½½DLLï¼Œç¨‹åºç»ˆæ­¢æ—¶é‡Šæ”¾å†…å­˜ã€‚</li></ul><h3 id="å¯¼å‡ºè¡¨"><a href="#å¯¼å‡ºè¡¨" class="headerlink" title="å¯¼å‡ºè¡¨"></a>å¯¼å‡ºè¡¨</h3><h4 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052109509.png" alt="image"></h4><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052110010.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052111005.png" alt="image"></p><p>å…ˆæ‰¾åˆ°å¯¼å‡ºè¡¨ä½ç½®</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052111830.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052111561.png" alt="image"></p><h3 id="å¯¼å…¥è¡¨"><a href="#å¯¼å…¥è¡¨" class="headerlink" title="å¯¼å…¥è¡¨"></a>å¯¼å…¥è¡¨</h3><p>ç¡®å®šä¾èµ–çš„å‡½æ•°</p><p><strong>å¯¼å…¥è¡¨ä½ç½®</strong></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052112545.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052112232.png" alt="image"></p><p><strong>å¯¼å…¥è¡¨ç»“æ„</strong></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052112548.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052113698.png" alt="image"></p><h4 id="Name-1"><a href="#Name-1" class="headerlink" title="Name"></a>Name</h4><p>å­—ç¬¦ä¸²æŒ‡é’ˆï¼ŒæŒ‡å‘å¯¼å…¥å‡½æ•°æ‰€å±çš„åº“æ–‡ä»¶åå­—ã€‚</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052113795.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052113568.png" alt="image"></p><p>RVAè¦è½¬æˆFOAï¼Œå‚è€ƒä¸‹é¢çš„å®é™…è®¡ç®—</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052114790.png" alt="image"></p><p>å› ä¸ºæŒ‡å‘çš„æ˜¯assicç çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥åˆ°ç¬¬ä¸€ä¸ª00ç»“æŸ</p><h4 id="OringinalFirstThunk-INT"><a href="#OringinalFirstThunk-INT" class="headerlink" title="OringinalFirstThunk-INT"></a>OringinalFirstThunk-INT</h4><p>å¯¼å…¥åç§°è¡¨<img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052114717.png" alt="image"></p><h4 id="FirstThunk-IAT"><a href="#FirstThunk-IAT" class="headerlink" title="FirstThunk-IAT"></a>FirstThunk-IAT</h4><p>å¯¼å…¥åœ°å€è¡¨</p><h3 id="å®é™…è®¡ç®—"><a href="#å®é™…è®¡ç®—" class="headerlink" title="å®é™…è®¡ç®—"></a>å®é™…è®¡ç®—</h3><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052115276.png" alt="image"></p><p>Export Directory RVAï¼š93 5D 82 09-&gt;0x09825D93(imagebase:0x00000010)æŸ¥äº†ä¸€ä¸‹å†rdataæ®µ-&gt;FOAï¼š0x09825D83</p><p>Export Directory Sizeï¼š00033669</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052116225.png" alt="image"></p><p>çœ‹äº†010åŠå¤©ä¸å¯¹ï¼Œdumpbin /headersçœ‹äº†ä¸€ä¸‹ï¼Œç„¶ååˆå¼€äº†ä¸ªexeï¼Œå‘ç°è¿™ä¸ªçˆ†çº¢çš„æ„æ€æ˜¯typora.exeæ²¡æœ‰å¯¼å…¥è¡¨å¯¼å‡ºè¡¨ã€‚ã€‚ã€‚(ä¹Ÿæœ‰å¯èƒ½æœ‰åŠ å£³ï¼Ÿdieçœ‹äº†ä¸€ä¸‹æ²¡æœ‰ï¼Œä½†æ˜¯è¿™ä¸ªåœ°å€å¤ªå¤§äº†ä¸æ­£å¸¸)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dumpbin /headers &quot;D:\Typora\Typora\Typora.exe&quot;</span><br></pre></td></tr></table></figure><p>æ¢ä¸ªæ–‡ä»¶æ¥</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052116588.png" alt="image"></p><p>Import Directory RVAï¼š0x00003824ï¼Œåœ¨.rdataæ®µï¼Œrdataæ®µçš„RVAæ˜¯0x00003000ï¼Œæ‰€ä»¥ç›¸å¯¹åœ°å€å°±æ˜¯0x00000824ï¼Œrdataæ®µçš„raw addressæ˜¯0x00001A00ï¼Œæ‰€ä»¥FOAæ˜¯0x00002224ï¼Œå¤§å°æ˜¯C8å­—èŠ‚</p><p><strong>Import Directory RVA</strong>ï¼š0x00003824</p><p><strong>.rdataæ®µçš„ RVA</strong>ï¼š0x00003000</p><p><strong>.rdataæ®µçš„ Raw Address</strong>ï¼š0x00001A00</p><p><strong>.rdataæ®µçš„ Raw Size</strong>ï¼šC8 å­—èŠ‚ï¼ˆå³ 200 å­—èŠ‚ï¼‰</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç›¸å¯¹åœ°å€ <span class="operator">=</span> <span class="built_in">Import</span> <span class="built_in">Directory</span> <span class="variable">RVA</span> <span class="operator">-</span> <span class="operator">.</span><span class="variable">rdata</span>æ®µçš„ <span class="variable">RVA</span> <span class="operator">=</span> <span class="number">0</span><span class="variable">x00003824</span> <span class="operator">-</span> <span class="number">0</span><span class="variable">x00003000</span> <span class="operator">=</span> <span class="number">0</span><span class="variable">x00000824</span></span><br><span class="line"></span><br><span class="line"><span class="variable">FOA</span> <span class="operator">=</span> <span class="operator">.</span><span class="variable">rdata</span>æ®µçš„ <span class="variable">Raw</span> <span class="variable">Address</span> <span class="operator">+</span> ç›¸å¯¹åœ°å€ <span class="operator">=</span><span class="number">0</span><span class="variable">x00001A00</span> <span class="operator">+</span> <span class="number">0</span><span class="variable">x00000824</span> <span class="operator">=</span> <span class="number">0</span><span class="variable">x00002224</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052116426.png" alt="image"></p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PEæ–‡ä»¶ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NSSCTF</title>
      <link href="/2025/01/05/NSSCTF/"/>
      <url>/2025/01/05/NSSCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="NSSCTF"><a href="#NSSCTF" class="headerlink" title="NSSCTF"></a>NSSCTF</h1><h2 id="easyREï¼ˆè™šå‡½æ•°è¡¨-åè°ƒè¯•-å†…è”å‡½æ•°ï¼‰"><a href="#easyREï¼ˆè™šå‡½æ•°è¡¨-åè°ƒè¯•-å†…è”å‡½æ•°ï¼‰" class="headerlink" title="easyREï¼ˆè™šå‡½æ•°è¡¨+åè°ƒè¯•+å†…è”å‡½æ•°ï¼‰"></a>easyREï¼ˆè™šå‡½æ•°è¡¨+åè°ƒè¯•+å†…è”å‡½æ•°ï¼‰</h2><p><a href="https://www.nssctf.cn/problem/43">[SWPU 2019]easyRE | NSSCTF</a></p><p>æ²¡åšå‡ºæ¥ï¼Œçœ‹äº†ä½¬çš„wpæ‰ç†æ¸…æ€è·¯<a href="https://bbs.kanxue.com/thread-271798.htm#msg_header_h3_2">[åŸåˆ›] SWPUCTF 2019 easyRE-CTFå¯¹æŠ—-çœ‹é›ª-å®‰å…¨ç¤¾åŒº|å®‰å…¨æ‹›è˜|kanxue.com</a></p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="main"><a href="#main" class="headerlink" title="main"></a>main</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD v4[<span class="number">30</span>]; <span class="comment">// [esp-6Ch] [ebp-F8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+Ch] [ebp-80h]</span></span><br><span class="line">  _DWORD v6[<span class="number">27</span>]; <span class="comment">// [esp+10h] [ebp-7Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+88h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">sub_40EF90</span>() )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;                                   <span class="comment">// åè°ƒè¯•</span></span><br><span class="line">  <span class="built_in">sub_4026C0</span>(<span class="number">0x6Cu</span>);</span><br><span class="line">  <span class="built_in">sub_401FE0</span>(v6);                               <span class="comment">// vftableè™šå‡½æ•°è¡¨</span></span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v4[<span class="number">29</span>] = v4;</span><br><span class="line">  <span class="built_in">sub_40F360</span>(v4, v6);</span><br><span class="line">  <span class="built_in">sub_40F080</span>(v4[<span class="number">0</span>], v4[<span class="number">1</span>]);</span><br><span class="line">  v4[<span class="number">28</span>] = v4;</span><br><span class="line">  <span class="built_in">sub_40F360</span>(v4, v6);</span><br><span class="line">  <span class="built_in">sub_40F150</span>(argc, (<span class="type">int</span>)argv);</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">-1</span>;</span><br><span class="line">  <span class="built_in">sub_4021C0</span>(v6);</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åè°ƒè¯•patchæ‰å°±è¡Œ</p><h4 id="sub-401FE0"><a href="#sub-401FE0" class="headerlink" title="sub_401FE0"></a>sub_401FE0</h4><p>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼Œä¸‹é¢çš„åç§»æ˜¯å¯¹æ¯”ç”¨çš„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_DWORD *__thiscall <span class="title">sub_401FE0</span><span class="params">(_DWORD *<span class="keyword">this</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line"></span><br><span class="line">  *<span class="keyword">this</span> = &amp;EASYRE::`vftable<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">  this[1] = 0;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 52) = 8;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 53) = 0xEA;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 54) = 0x58;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 55) = 0xDE;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 56) = 0x94;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 57) = 0xD0;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 58) = 0x3B;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 59) = 0xBE;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 60) = 0x88;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 61) = 0xD4;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 62) = 0x32;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 63) = 0xB6;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 64) = 0x14;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 65) = 0x82;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 66) = 0xB7;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 67) = 0xAF;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 68) = 0x14;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 69) = 0x54;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 70) = 0x7F;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 71) = 0xCF;</span></span><br><span class="line"><span class="string">  qmemcpy(this + 0x12, &quot;  03\&quot;3   0 203\&quot;   $ &quot;, 20);</span></span><br><span class="line"><span class="string">  sub_4030A0(this + 0x17);</span></span><br><span class="line"><span class="string">  sub_402DE0(this + 0x1A);</span></span><br><span class="line"><span class="string">  for ( i = 0; i &lt; 40; ++i )</span></span><br><span class="line"><span class="string">    *((_BYTE *)this + i + 12) = 0;</span></span><br><span class="line"><span class="string">  return this;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.rdata:004124E4 90 21 40 00                   ??_7EASYRE@@6B@ dd offset sub_402190    ; DATA XREF: sub_401FE0+2Bâ†‘o</span><br><span class="line">.rdata:004124E4                                                                       ; sub_4021C0+Aâ†‘o</span><br><span class="line">.rdata:004124E4                                                                       ; sub_40F360+Câ†‘o</span><br><span class="line">.rdata:004124E8 F0 21 40 00                   dd offset sub_4021F0</span><br><span class="line">.rdata:004124EC B0 24 40 00                   dd offset sub_4024B0</span><br><span class="line">.rdata:004124F0 00 25 40 00                   dd offset sub_402500</span><br><span class="line">.rdata:004124F4 F0 22 40 00                   dd offset sub_4022F0</span><br><span class="line">.rdata:004124F8 A0 23 40 00                   dd offset sub_4023A0</span><br><span class="line">.rdata:004124FC E0 26 40 00                   dd offset sub_4026E0</span><br><span class="line">.rdata:00412500 30 27 40 00                   dd offset sub_402730</span><br><span class="line">.rdata:00412504 E0 23 40 00                   dd offset sub_4023E0</span><br><span class="line">.rdata:00412508 A0 28 40 00                   dd offset sub_4028A0</span><br><span class="line">.rdata:0041250C 00 2A 40 00                   dd offset sub_402A00</span><br><span class="line">.rdata:00412510 40 24 40 00                   dd offset sub_402440</span><br><span class="line">.rdata:00412514 00 00 00 00                   align 8</span><br></pre></td></tr></table></figure><p>â€‹    </p><h4 id="sub-40F150"><a href="#sub-40F150" class="headerlink" title="sub_40F150"></a>sub_40F150</h4><p>æ‰¾åˆ°å¯¹æ¯”å‡½æ•°</p><p> if ( sub_A124B0(va, input) )è¾“å‡ºcongratulationsè¯´æ˜sub_A124B0æ˜¯æˆ‘ä»¬ä¸»è¦å…³æ³¨çš„å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_40F150</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6[<span class="number">10</span>]; <span class="comment">// [esp+Ch] [ebp-38h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+40h] [ebp-4h]</span></span><br><span class="line">  va_list va; <span class="comment">// [esp+54h] [ebp+10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">va_start</span>(va, a2);</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v6, <span class="number">0</span>, <span class="built_in">sizeof</span>(v6));</span><br><span class="line">  v2 = <span class="built_in">printf</span>(std::cout, <span class="string">&quot;Please input your flag : &quot;</span>);</span><br><span class="line">  std::ostream::<span class="keyword">operator</span>&lt;&lt;(v2, sub_40F8F0);</span><br><span class="line">  <span class="built_in">sub_40F930</span>(std::cin, v6);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">sub_4024B0</span>(v6) )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="built_in">printf</span>(std::cout, &amp;unk_4122F0);        <span class="comment">// congratulations</span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">    std::ostream::<span class="keyword">operator</span>&lt;&lt;(v3, sub_40F8F0);</span><br><span class="line">    v7 = <span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">sub_4021C0</span>(va);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="built_in">printf</span>(std::cout, &amp;unk_41231C);        <span class="comment">// sorryï¼Œtry again</span></span><br><span class="line">    std::ostream::<span class="keyword">operator</span>&lt;&lt;(v5, sub_40F8F0);</span><br><span class="line">    v7 = <span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">sub_4021C0</span>(va);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="sub-4024B0"><a href="#sub-4024B0" class="headerlink" title="sub_4024B0"></a>sub_4024B0</h4><p>å¯¹ç…§è™šå‡½æ•°è¡¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL __thiscall <span class="title">sub_D724B0</span><span class="params">(_DWORD *<span class="keyword">this</span>, <span class="type">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  BOOL result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>[<span class="number">2</span>] = a2;</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (*(<span class="built_in">int</span> (__thiscall **)(_DWORD *))(*<span class="keyword">this</span> + <span class="number">0xC</span>))(<span class="keyword">this</span>) )<span class="comment">// sub_402500 00D72500</span></span><br><span class="line">  &#123;</span><br><span class="line">    (*(<span class="built_in">void</span> (__thiscall **)(_DWORD *))(*<span class="keyword">this</span> + <span class="number">0x18</span>))(<span class="keyword">this</span>);<span class="comment">// sub_4026E0 00D824FC</span></span><br><span class="line">    <span class="keyword">if</span> ( (*(<span class="built_in">int</span> (__thiscall **)(_DWORD *))(*<span class="keyword">this</span> + <span class="number">0x28</span>))(<span class="keyword">this</span>) )<span class="comment">// sub_402A00 00D72A00</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€åŒ–ä¸€ä¸‹å°±æ˜¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> sub_402500ï¼ˆï¼‰</span><br><span class="line">    sub_<span class="number">4026E0</span>ï¼ˆï¼‰</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">sub_402A00</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="keyword">return</span> 1</span></span><br><span class="line"><span class="function"><span class="keyword">return</span> 0</span></span><br></pre></td></tr></table></figure><h4 id="sub-D72500"><a href="#sub-D72500" class="headerlink" title="sub_D72500"></a>sub_D72500</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __thiscall <span class="title">sub_D72500</span><span class="params">(<span class="type">const</span> <span class="type">char</span> **<span class="keyword">this</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [esp+Ch] [ebp-B0h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v3; <span class="comment">// [esp+14h] [ebp-A8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+24h] [ebp-98h]</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">56</span>]; <span class="comment">// [esp+30h] [ebp-8Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">20</span>]; <span class="comment">// [esp+68h] [ebp-54h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">48</span>]; <span class="comment">// [esp+7Ch] [ebp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+B8h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;<span class="keyword">this</span>[<span class="number">2</span>][<span class="built_in">strlen</span>(<span class="keyword">this</span>[<span class="number">2</span>])];</span><br><span class="line">  <span class="built_in">strcpy</span>(v8, <span class="string">&quot;Ncg`esdvLkLgk$mL=Lgk$mL=Lgk$mL=Lgk$mL=Lgk$mLm&quot;</span>);</span><br><span class="line">  <span class="built_in">sub_D726C0</span>(v6, <span class="number">0x38u</span>);                        <span class="comment">// åˆå§‹åŒ–v6</span></span><br><span class="line">  <span class="built_in">sub_D72B00</span>(v6);</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">45</span>; ++i )</span><br><span class="line">    v8[i] ^= <span class="number">0x10u</span>;                             <span class="comment">// ^swpuctf\&#123;\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\&#125;</span></span><br><span class="line">  <span class="built_in">sub_D726C0</span>(v7, <span class="number">0x14u</span>);</span><br><span class="line">  <span class="built_in">sub_D72A70</span>(v8, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">LOBYTE</span>(v9) = <span class="number">1</span>;</span><br><span class="line">  v2 = (<span class="type">unsigned</span> __int8)<span class="built_in">sub_D74260</span>(<span class="keyword">this</span>[<span class="number">2</span>], v3, v6, v7, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">LOBYTE</span>(v9) = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">sub_D72A50</span>(v7);</span><br><span class="line">  v9 = <span class="number">-1</span>;</span><br><span class="line">  <span class="built_in">sub_D726A0</span>();</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501031630537.png" alt="1735892999415.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^swpuctf\&#123;\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ç‚¹åƒæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¼°è®¡æ˜¯flagæ ¼å¼</p><h4 id="sub-A12730"><a href="#sub-A12730" class="headerlink" title="sub_A12730"></a>sub_A12730</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __thiscall <span class="title">sub_A12730</span><span class="params">(_DWORD *<span class="keyword">this</span>, <span class="type">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// cf</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// bl</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// t2</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+Ch] [ebp-30h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+14h] [ebp-28h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+1Ch] [ebp-20h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [esp+20h] [ebp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [esp+24h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [esp+28h] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [esp+2Ch] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [esp+30h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// [esp+34h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v15 = <span class="number">0</span>;</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  v18 = <span class="number">0</span>;</span><br><span class="line">  v10 = <span class="keyword">this</span>[<span class="number">2</span>] + <span class="number">5</span> * a2 + <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i )</span><br><span class="line">    *(&amp;v13 + i) = *(i + v10);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  v3 = <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = *(&amp;v13 + v2);                          <span class="comment">// å–å•ä¸ªå­—ç¬¦</span></span><br><span class="line">    _DL = v4;</span><br><span class="line">    __asm &#123; rcl     dl, <span class="number">1</span> &#125;                     <span class="comment">// å¾ªç¯å·¦ç§»ç›´åˆ°CFä¸º1</span></span><br><span class="line">    *(&amp;v15 + v2) = <span class="number">1</span>;                           <span class="comment">// å°†1å†™å…¥v15 v2ä¸ªå­—èŠ‚çš„ä½ç½®</span></span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span>                                          <span class="comment">// v8=v6å·¦ç§»7ä½</span></span><br><span class="line">                                                <span class="comment">// v6=v4æœ€ä½ä½</span></span><br><span class="line">                                                <span class="comment">// v4å»æ‰æœ€ä½æœ‰æ•ˆä½</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8 = v6 &lt;&lt; <span class="number">7</span>;</span><br><span class="line">      v6 = v4 &amp; <span class="number">1</span>;</span><br><span class="line">      v4 = (v4 &gt;&gt; <span class="number">1</span>) | v8;</span><br><span class="line">      ++v7;                                     <span class="comment">// v7è®¡ç®—v4ä¸­1çš„ä¸ªæ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v6 );                               <span class="comment">// å¦‚æœv6ä¸º1 å³v4çš„å½“å‰æœ€ä½æœ‰æ•ˆä½æ˜¯ 1ï¼Œç»§ç»­å¾ªç¯ï¼Œ</span></span><br><span class="line">                                                <span class="comment">// v6ä¸º0åˆ™ç»“æŸå¾ªç¯</span></span><br><span class="line">    *(&amp;v16 + v2++) = v7 - <span class="number">1</span>;                    <span class="comment">// ä½å®½åº¦v16=v7-1</span></span><br><span class="line">    --v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v3 );</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    *(&amp;v14 + j) = *(&amp;v16 + j) + *(&amp;v15 + j);    <span class="comment">// å³è¾¹0çš„ä¸ªæ•°+å·¦ç§»è‡³è¿›ä½ä¸ªæ•°</span></span><br><span class="line">    *(&amp;v17 + j) = *(&amp;v13 + j) &lt;&lt; *(&amp;v15 + j);   <span class="comment">// flag&lt;&lt;å·¦ç§»è‡³è¿›ä½ä¸ªæ•°</span></span><br><span class="line">    *(&amp;v18 + j) = (*(&amp;v13 + j) &lt;&lt; (<span class="number">8</span> - *(&amp;v16 + j))) | ((*(&amp;v13 + j) &gt;&gt; (<span class="number">8</span> - *(&amp;v15 + j))) &lt;&lt; *(&amp;v15 + j));</span><br><span class="line">  &#125;                                             <span class="comment">// [flag&lt;&lt;ï¼ˆ8-å³è¾¹0çš„ä¸ªæ•°ï¼‰]|&#123;[flag&gt;&gt;(8-å·¦ç§»è‡³è¿›ä½ä¸ªæ•°ï¼‰]&lt;&lt;å·¦ç§»è‡³è¿›ä½ä¸ªæ•°&#125;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_A12F80</span>(&amp;v13);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤–é¢çš„dowhileå…¶å®æ˜¯åœ¨è®¡ç®—å·¦ç§»å‡ ä½CFä¸º1ï¼Œé‡Œé¢çš„dowhileæ˜¯åœ¨è®¡ç®—å³è¾¹0çš„ä¸ªæ•°</p><h4 id="sub-A128A0"><a href="#sub-A128A0" class="headerlink" title="sub_A128A0"></a>sub_A128A0</h4><p>ä¸æƒ³çœ‹äº†ï¼Œå¤§æ¦‚çœ‹çœ‹æ„Ÿè§‰èƒ½çˆ†ç ´ï¼Œä¸è¡Œå†å›æ¥çœ‹</p><p>å¥½å§è¿˜æ˜¯å¾—çœ‹</p><p>forå¾ªç¯åµŒå¥—if elseï¼Œå¤§æ¦‚æŠŠä¸Šé¢åŠ å¯†å®Œçš„flagåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†å¤„ç†ã€‚</p><p>å‰å››æ¬¡å¾ªç¯èµ°elseï¼Œå¯¹ <code>v15 + i + 20</code> èµ‹å€¼</p><p>åå››æ¬¡èµ°ifï¼Œå¯¹ <code>v17 + 0x1A</code> è¿›è¡Œæ“ä½œï¼Œæ›´æ–° <code>v14</code> å¹¶å¯¹ <code>v15</code> æ‰§è¡Œä½æ“ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">v17 = this;</span><br><span class="line">v15 = this + 3;</span><br><span class="line">*v15 |= *(v10 + i + 0x10) &lt;&lt; v14;</span><br><span class="line">*v15 |= *(v5 + i + 0x10) &lt;&lt; v14;</span><br><span class="line">*(v15 + i + 20) = *(v8 + i + 0xC) | v7;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬å‰é¢å¾—åˆ°äº†flagæ ¼å¼ï¼Œå¯ä»¥åˆ¤æ–­å‡ºæ¥whileèµ°5æ¬¡ã€‚</p><p>ä¸€ä¸ªå‚ä¸äº†åŠ å¯†ä¸€ä¸ªæ²¡å‚ä¸</p><p>è¿™é‡Œç”¨äº†ä½¬ç®€åŒ–å®Œçš„åŠ å¯†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> &#123;</span><br><span class="line">    v9 = sub_402DC0(v17 + <span class="number">26</span>);</span><br><span class="line">    v14 -= *(<span class="type">unsigned</span> __int8 *)(v9 + i); <span class="comment">// v14çš„åˆå§‹å€¼ä¸º0x20</span></span><br><span class="line">    *v15 |= res3 &lt;&lt; v14;</span><br><span class="line">&#125;   </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    v14 -= <span class="number">8</span> - res1;</span><br><span class="line">    *v15 |= res2 &lt;&lt; v14;</span><br><span class="line">    *((_BYTE *)v15 + i + <span class="number">20</span>) = <span class="number">0</span>çš„ä¸ªæ•° | (<span class="number">16</span> * å·¦ç§»è¿›ä½ä½æ•°);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç†ä¸€ä¸‹é€»è¾‘</p><ul><li>æ ¡éªŒflagæ ¼å¼</li><li>åŠ å¯†</li><li>5æ¬¡å¾ªç¯å¤„ç†åŠ å¯†ï¼Œä¸¤ç§ç»“æœï¼Œä¸€ä¸ªå—å­—ç¬¦å½±å“ä¸€ä¸ªç‹¬ç«‹å­˜åœ¨ã€‚</li><li>å¯¹æ¯”</li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#exp</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å·¦ç§»è¿›ä½ä½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_1</span>(<span class="params">c</span>): </span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        c = c &lt;&lt; <span class="number">1</span></span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> c &amp; <span class="number">0x100</span>:</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å³è¾¹0çš„ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_0</span>(<span class="params">c</span>): </span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> c &amp; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        c = c &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆæ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_0</span>(<span class="params">c</span>):</span><br><span class="line">    res1 = check_0(c) + check_1(c)</span><br><span class="line">    res2 = ((c &lt;&lt; check_1(c)) &amp; <span class="number">0xff</span>) &gt;&gt; res1</span><br><span class="line">    res3 = ((c &gt;&gt; (<span class="number">8</span> - check_1(c))) &lt;&lt; check_1(c)) | ((c &lt;&lt; (<span class="number">8</span> - check_0(c)) &amp; <span class="number">0xff</span>) &gt;&gt; res1)</span><br><span class="line">    <span class="keyword">return</span> [res1, res2, res3]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_part</span>(<span class="params">c,s2</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ£€æŸ¥å­—ç¬¦çš„åˆ†ç±»ï¼Œå¹¶è¿”å›ç¬¦åˆæ¡ä»¶çš„å­—ç¬¦&quot;&quot;&quot;</span></span><br><span class="line">    tmp = <span class="built_in">list</span>(<span class="built_in">set</span>(<span class="string">&#x27;  03\&quot;3   0 203\&quot;   $ &#x27;</span>))</span><br><span class="line">    tmp2=check_0(c) | (<span class="number">16</span>*check_1(c))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">set</span>(s2):</span><br><span class="line">        <span class="keyword">if</span> tmp2 ==<span class="built_in">ord</span>(i):</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">classify</span>():</span><br><span class="line">    for_each=string.ascii_lowercase+string.ascii_uppercase+string.digits</span><br><span class="line">    second_part_res = <span class="string">&#x27;  03\&quot;3   0 203\&quot;   $ &#x27;</span></span><br><span class="line">    d=<span class="built_in">dict</span>.fromkeys(<span class="built_in">list</span>(<span class="built_in">set</span>(second_part_res)))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">set</span>(second_part_res)):</span><br><span class="line">        d[i]=[]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> for_each:</span><br><span class="line">        tmp=check_part(<span class="built_in">ord</span>(i))</span><br><span class="line">        <span class="keyword">if</span> tmp:</span><br><span class="line">            d[tmp].append(i)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_1</span>(<span class="params">c,v14</span>):</span><br><span class="line">    exam=&#123;c:generate_0(<span class="built_in">ord</span>(c))&#125;</span><br><span class="line">    v14=v14-(<span class="number">8</span>-exam[c][<span class="number">0</span>])</span><br><span class="line">    tmp=exam[c][<span class="number">1</span>]&lt;&lt;v14</span><br><span class="line">    <span class="keyword">return</span> tmp,v14</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_2</span>(<span class="params">c,v14</span>):</span><br><span class="line">    exam=&#123;c:generate_0(<span class="built_in">ord</span>(c))&#125;</span><br><span class="line">    v14=v14-exam[c][<span class="number">0</span>]</span><br><span class="line">    tmp=exam[c][<span class="number">2</span>]&lt;&lt;v14</span><br><span class="line">    <span class="keyword">return</span> tmp,v14</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å·¦ç§»è¿›ä½ä½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_1</span>(<span class="params">c</span>): </span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        c = c &lt;&lt; <span class="number">1</span></span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> c &amp; <span class="number">0x100</span>:</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å³è¾¹0çš„ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_0</span>(<span class="params">c</span>): </span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> c &amp; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        c = c &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆæ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_0</span>(<span class="params">c</span>):</span><br><span class="line">    res1 = check_0(c) + check_1(c)</span><br><span class="line">    res2 = ((c &lt;&lt; check_1(c)) &amp; <span class="number">0xff</span>) &gt;&gt; res1</span><br><span class="line">    res3 = ((c &gt;&gt; (<span class="number">8</span> - check_1(c))) &lt;&lt; check_1(c)) | ((c &lt;&lt; (<span class="number">8</span> - check_0(c)) &amp; <span class="number">0xff</span>) &gt;&gt; res1)</span><br><span class="line">    <span class="keyword">return</span> [res1, res2, res3]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ç±»æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_part</span>(<span class="params">c</span>):</span><br><span class="line">    tmp = <span class="built_in">list</span>(<span class="built_in">set</span>(<span class="string">&#x27;  03\&quot;3   0 203\&quot;   $ &#x27;</span>))</span><br><span class="line">    tmp2 = check_0(c) | (<span class="number">16</span> * check_1(c))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tmp:</span><br><span class="line">        <span class="keyword">if</span> tmp2 == <span class="built_in">ord</span>(i):</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ç±»å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">classify</span>():</span><br><span class="line">    for_each = string.ascii_lowercase + string.ascii_uppercase + string.digits</span><br><span class="line">    second_part_res = <span class="string">&#x27;  03\&quot;3   0 203\&quot;   $ &#x27;</span></span><br><span class="line">    d = <span class="built_in">dict</span>.fromkeys(<span class="built_in">list</span>(<span class="built_in">set</span>(second_part_res)))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">set</span>(second_part_res)):</span><br><span class="line">        d[i] = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> for_each:</span><br><span class="line">        tmp = check_part(<span class="built_in">ord</span>(i))</span><br><span class="line">        <span class="keyword">if</span> tmp:</span><br><span class="line">            d[tmp].append(i)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•å‡½æ•°1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_1</span>(<span class="params">c, v14</span>):</span><br><span class="line">    exam = &#123;c: generate_0(<span class="built_in">ord</span>(c))&#125;</span><br><span class="line">    v14 = v14 - (<span class="number">8</span> - exam[c][<span class="number">0</span>])</span><br><span class="line">    tmp = exam[c][<span class="number">1</span>] &lt;&lt; v14</span><br><span class="line">    <span class="keyword">return</span> tmp, v14</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•å‡½æ•°2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_2</span>(<span class="params">c, v14</span>):</span><br><span class="line">    exam = &#123;c: generate_0(<span class="built_in">ord</span>(c))&#125;</span><br><span class="line">    v14 = v14 - exam[c][<span class="number">0</span>]</span><br><span class="line">    tmp = exam[c][<span class="number">2</span>] &lt;&lt; v14</span><br><span class="line">    <span class="keyword">return</span> tmp, v14</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—ç¬¬ä¸€ä¸ªéƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc_first_part</span>(<span class="params">s</span>):</span><br><span class="line">    v14 = <span class="number">0x20</span></span><br><span class="line">    tmp, v14 = test_1(s[<span class="number">0</span>], v14)</span><br><span class="line">    tmp2, v14 = test_1(s[<span class="number">1</span>], v14)</span><br><span class="line">    tmp3, v14 = test_1(s[<span class="number">2</span>], v14)</span><br><span class="line">    tmp4, v14 = test_1(s[<span class="number">3</span>], v14)</span><br><span class="line">    tmp5, v14 = test_2(s[<span class="number">0</span>], v14)</span><br><span class="line">    tmp6, v14 = test_2(s[<span class="number">1</span>], v14)</span><br><span class="line">    tmp7, v14 = test_2(s[<span class="number">2</span>], v14)</span><br><span class="line">    tmp8, v14 = test_2(s[<span class="number">3</span>], v14)</span><br><span class="line">    <span class="keyword">return</span> tmp | tmp2 | tmp3 | tmp4 | tmp5 | tmp6 | tmp7 | tmp8</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç¬¬ä¸€ä¸ªéƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_first_part</span>(<span class="params">second_part, first_part, d</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> d[second_part[<span class="number">0</span>]]:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> d[second_part[<span class="number">1</span>]]:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> d[second_part[<span class="number">2</span>]]:</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> d[second_part[<span class="number">3</span>]]:</span><br><span class="line">                    tmp = i + j + k + m</span><br><span class="line">                    <span class="keyword">if</span> calc_first_part(tmp) == first_part:</span><br><span class="line">                        <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»ç¨‹åº</span></span><br><span class="line">d = classify()</span><br><span class="line">s2 = <span class="string">&#x27;  03\&quot;3   0 203\&quot;   $ &#x27;</span></span><br><span class="line">s = [<span class="string">&#x27;08&#x27;</span>, <span class="string">&#x27;EA&#x27;</span>, <span class="string">&#x27;58&#x27;</span>, <span class="string">&#x27;DE&#x27;</span>, <span class="string">&#x27;94&#x27;</span>, <span class="string">&#x27;D0&#x27;</span>, <span class="string">&#x27;3B&#x27;</span>, <span class="string">&#x27;BE&#x27;</span>, <span class="string">&#x27;88&#x27;</span>, <span class="string">&#x27;D4&#x27;</span>, <span class="string">&#x27;32&#x27;</span>, <span class="string">&#x27;B6&#x27;</span>, <span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;82&#x27;</span>, <span class="string">&#x27;B7&#x27;</span>, <span class="string">&#x27;AF&#x27;</span>, <span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;54&#x27;</span>, <span class="string">&#x27;7F&#x27;</span>, <span class="string">&#x27;CF&#x27;</span>]</span><br><span class="line">flag = <span class="string">&#x27;swpuctf&#123;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">5</span>):</span><br><span class="line">    first_part = <span class="built_in">int</span>(s[<span class="number">3</span> + <span class="number">4</span> * i] + s[<span class="number">2</span> + <span class="number">4</span> * i] + s[<span class="number">1</span> + <span class="number">4</span> * i] + s[<span class="number">4</span> * i], <span class="number">16</span>)</span><br><span class="line">    second_part = s2[i * <span class="number">4</span>:i * <span class="number">4</span> + <span class="number">4</span>]</span><br><span class="line">    res = check_first_part(second_part, first_part, d)</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">4</span>:</span><br><span class="line">        flag += res</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag += res + <span class="string">&#x27;-&#x27;</span></span><br><span class="line">flag += <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#swpuctf&#123;we18-l8co-m1e4-58to-swpu&#125;</span></span><br></pre></td></tr></table></figure><h2 id="EasiestReï¼ˆåŒè¿›ç¨‹-è‡ªä¿®æ”¹-èƒŒåŒ…åŠ å¯†ï¼‰"><a href="#EasiestReï¼ˆåŒè¿›ç¨‹-è‡ªä¿®æ”¹-èƒŒåŒ…åŠ å¯†ï¼‰" class="headerlink" title="EasiestReï¼ˆåŒè¿›ç¨‹+è‡ªä¿®æ”¹+èƒŒåŒ…åŠ å¯†ï¼‰"></a>EasiestReï¼ˆåŒè¿›ç¨‹+è‡ªä¿®æ”¹+èƒŒåŒ…åŠ å¯†ï¼‰</h2><p><a href="https://www.nssctf.cn/problem/40">[SWPU 2019]EasiestRe | NSSCTF</a></p><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="main-1"><a href="#main-1" class="headerlink" title="main"></a>main</h4><p>è¿›æ¥å…ˆçœ‹åˆ°IsDebuggerPresentï¼Œè¿è¡Œä¸€ä¸‹å‘ç°å’Œç›´æ¥æ‰“å¼€çš„ç»“æœä¸ä¸€æ ·ï¼ŒåŒè¿›ç¨‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( IsDebuggerPresent() )  <span class="comment">//è°ƒè¯•å™¨è¿›ç¨‹</span></span><br><span class="line">.....</span><br><span class="line"><span class="keyword">if</span> ( CreateProcessA(Filename, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3u</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;StartupInfo, &amp;ProcessInformation) )  <span class="comment">//æ­£å¸¸è¿›ç¨‹</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  PVOID lpBaseAddress; <span class="comment">// [esp+18h] [ebp-558h]</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [esp+1Fh] [ebp-551h]</span></span><br><span class="line">  DWORD dwContinueStatus; <span class="comment">// [esp+20h] [ebp-550h]</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">DEBUG_EVENT</span> <span class="title">DebugEvent</span>;</span> <span class="comment">// [esp+28h] [ebp-548h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [esp+8Fh] [ebp-4E1h]</span></span><br><span class="line">  CONTEXT Context; <span class="comment">// [esp+94h] [ebp-4DCh] BYREF</span></span><br><span class="line">  HANDLE hThread; <span class="comment">// [esp+364h] [ebp-20Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+368h] [ebp-208h]</span></span><br><span class="line">  SIZE_T NumberOfBytesRead[<span class="number">3</span>]; <span class="comment">// [esp+370h] [ebp-200h] BYREF</span></span><br><span class="line">  SIZE_T NumberOfBytesWritten[<span class="number">3</span>]; <span class="comment">// [esp+37Ch] [ebp-1F4h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Buffer[<span class="number">60</span>]; <span class="comment">// [esp+388h] [ebp-1E8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v15[<span class="number">40</span>]; <span class="comment">// [esp+3C4h] [ebp-1ACh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v16[<span class="number">16</span>]; <span class="comment">// [esp+3ECh] [ebp-184h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">STARTUPINFOA</span> <span class="title">StartupInfo</span>;</span> <span class="comment">// [esp+3FCh] [ebp-174h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">PROCESS_INFORMATION</span> <span class="title">ProcessInformation</span>;</span> <span class="comment">// [esp+448h] [ebp-128h] BYREF</span></span><br><span class="line">  CHAR Filename[<span class="number">267</span>]; <span class="comment">// [esp+460h] [ebp-110h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(&amp;ProcessInformation, <span class="number">0</span>, <span class="keyword">sizeof</span>(ProcessInformation));</span><br><span class="line">  j__memset(&amp;StartupInfo, <span class="number">0</span>, <span class="keyword">sizeof</span>(StartupInfo));</span><br><span class="line">  v16[<span class="number">0</span>] = <span class="number">0x90</span>;</span><br><span class="line">  v16[<span class="number">1</span>] = <span class="number">0x83</span>;</span><br><span class="line">  v16[<span class="number">2</span>] = <span class="number">0x7D</span>;</span><br><span class="line">  v16[<span class="number">3</span>] = <span class="number">0xF8</span>;</span><br><span class="line">  v16[<span class="number">4</span>] = <span class="number">0x18</span>;</span><br><span class="line">  v16[<span class="number">5</span>] = <span class="number">0x7D</span>;</span><br><span class="line">  v16[<span class="number">6</span>] = <span class="number">0x11</span>;</span><br><span class="line">  v15[<span class="number">0</span>] = <span class="number">0x90</span>;</span><br><span class="line">  v15[<span class="number">1</span>] = <span class="number">0xF</span>;</span><br><span class="line">  v15[<span class="number">2</span>] = <span class="number">0xB6</span>;</span><br><span class="line">  v15[<span class="number">3</span>] = <span class="number">0x55</span>;</span><br><span class="line">  v15[<span class="number">4</span>] = <span class="number">0xF7</span>;</span><br><span class="line">  v15[<span class="number">5</span>] = <span class="number">0x8B</span>;</span><br><span class="line">  v15[<span class="number">6</span>] = <span class="number">0x45</span>;</span><br><span class="line">  v15[<span class="number">7</span>] = <span class="number">8</span>;</span><br><span class="line">  v15[<span class="number">8</span>] = <span class="number">0x8B</span>;</span><br><span class="line">  v15[<span class="number">9</span>] = <span class="number">4</span>;</span><br><span class="line">  v15[<span class="number">10</span>] = <span class="number">0x90</span>;</span><br><span class="line">  v15[<span class="number">11</span>] = <span class="number">0xF</span>;</span><br><span class="line">  v15[<span class="number">12</span>] = <span class="number">0xAF</span>;</span><br><span class="line">  v15[<span class="number">13</span>] = <span class="number">0x45</span>;</span><br><span class="line">  v15[<span class="number">14</span>] = <span class="number">0xFC</span>;</span><br><span class="line">  v15[<span class="number">15</span>] = <span class="number">0x33</span>;</span><br><span class="line">  v15[<span class="number">16</span>] = <span class="number">0xD2</span>;</span><br><span class="line">  v15[<span class="number">17</span>] = <span class="number">0xF7</span>;</span><br><span class="line">  v15[<span class="number">18</span>] = <span class="number">0x75</span>;</span><br><span class="line">  v15[<span class="number">19</span>] = <span class="number">0xF8</span>;</span><br><span class="line">  v15[<span class="number">20</span>] = <span class="number">0xF</span>;</span><br><span class="line">  v15[<span class="number">21</span>] = <span class="number">0xB6</span>;</span><br><span class="line">  v15[<span class="number">22</span>] = <span class="number">0x4D</span>;</span><br><span class="line">  v15[<span class="number">23</span>] = <span class="number">0xF7</span>;</span><br><span class="line">  v15[<span class="number">24</span>] = <span class="number">0x8B</span>;</span><br><span class="line">  v15[<span class="number">25</span>] = <span class="number">0x45</span>;</span><br><span class="line">  v15[<span class="number">26</span>] = <span class="number">0xC</span>;</span><br><span class="line">  v15[<span class="number">27</span>] = <span class="number">0x89</span>;</span><br><span class="line">  v15[<span class="number">28</span>] = <span class="number">0x14</span>;</span><br><span class="line">  v15[<span class="number">29</span>] = <span class="number">0x88</span>;</span><br><span class="line">  j__memset(Buffer, <span class="number">0</span>, <span class="number">0x32u</span>);</span><br><span class="line">  NumberOfBytesWritten[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( IsDebuggerPresent() )                    <span class="comment">// è°ƒè¯•å™¨è¿›ç¨‹</span></span><br><span class="line">  &#123;</span><br><span class="line">    GetStartupInfoA(&amp;StartupInfo);</span><br><span class="line">    GetModuleFileNameA(<span class="number">0</span>, Filename, <span class="number">0x104u</span>);</span><br><span class="line">    <span class="keyword">if</span> ( CreateProcessA(Filename, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3u</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;StartupInfo, &amp;ProcessInformation) )<span class="comment">// åˆ›å»ºæ–°è¿›ç¨‹</span></span><br><span class="line">    &#123;</span><br><span class="line">      v5 = <span class="number">1</span>;</span><br><span class="line">LABEL_6:</span><br><span class="line">      <span class="keyword">while</span> ( v5 )</span><br><span class="line">      &#123;</span><br><span class="line">        dwContinueStatus = <span class="number">0x10002</span>;</span><br><span class="line">        WaitForDebugEvent(&amp;DebugEvent, <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">        <span class="keyword">switch</span> ( DebugEvent.dwDebugEventCode )  <span class="comment">// å¤„ç†è°ƒè¯•äº‹ä»¶</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">            <span class="keyword">if</span> ( DebugEvent.u.Exception.ExceptionRecord.ExceptionCode == <span class="number">0x80000003</span> )<span class="comment">// é‡åˆ°è°ƒè¯•æ–­ç‚¹</span></span><br><span class="line">            &#123;</span><br><span class="line">              v8 = <span class="number">1</span>;                           <span class="comment">// ç»§ç»­æ‰§è¡Œç¨‹åºï¼Œè·³è¿‡å½“å‰å¼‚å¸¸</span></span><br><span class="line">              dwContinueStatus = <span class="number">0x10002</span>;</span><br><span class="line">              lpBaseAddress = DebugEvent.u.Exception.ExceptionRecord.ExceptionAddress;<span class="comment">// ä¿å­˜å¼‚å¸¸çš„åœ°å€ï¼ˆå³æ–­ç‚¹åœ°å€ï¼‰</span></span><br><span class="line">              ReadProcessMemory(                <span class="comment">// è¯»å– 35 å­—èŠ‚çš„å†…å­˜æ•°æ®åˆ°bufferé‡Œ</span></span><br><span class="line">                ProcessInformation.hProcess,</span><br><span class="line">                DebugEvent.u.Exception.ExceptionRecord.ExceptionAddress,</span><br><span class="line">                Buffer,</span><br><span class="line">                <span class="number">0x23u</span>,</span><br><span class="line">                NumberOfBytesRead);</span><br><span class="line">              <span class="keyword">if</span> ( NumberOfBytesRead[<span class="number">0</span>] )</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt; <span class="number">35</span> &amp;&amp; Buffer[i] == <span class="number">0x90</span>; ++i )<span class="comment">// æ£€æŸ¥nop</span></span><br><span class="line">                  ;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> ( i == <span class="number">1</span> )</span><br><span class="line">                v8 = <span class="number">0</span>;</span><br><span class="line">              <span class="keyword">if</span> ( v8 )                         <span class="comment">// v8é0åˆ™ç»§ç»­æ‰§è¡Œï¼Œv8ä¸º0åˆ™è·³è½¬åˆ°dwContinueStatus = 0x80010001;</span></span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">switch</span> ( i )</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    Context.ContextFlags = <span class="number">65543</span>;</span><br><span class="line">                    hThread = OpenThread(<span class="number">0x1FFFFFu</span>, <span class="number">0</span>, DebugEvent.dwThreadId);</span><br><span class="line">                    <span class="keyword">if</span> ( !GetThreadContext(hThread, &amp;Context) )</span><br><span class="line">                      <span class="keyword">goto</span> LABEL_31;</span><br><span class="line">                    ++Context.Eip;</span><br><span class="line">                    <span class="keyword">if</span> ( SetThreadContext(hThread, &amp;Context) )</span><br><span class="line">                    &#123;</span><br><span class="line">                      dwContinueStatus = <span class="number">0x10002</span>;</span><br><span class="line">                      CloseHandle(hThread);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">goto</span> LABEL_33;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">LABEL_31:</span><br><span class="line">                    ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, <span class="number">0x80010001</span>);</span><br><span class="line">                    <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">7</span>:                       <span class="comment">// å°†v16çš„æ•°æ®å†™å…¥lpBaseAddress</span></span><br><span class="line">                                                <span class="comment">// ç„¶åè¯»å–lpBaseAddress å¤„çš„æ•°æ®å¹¶å­˜å‚¨åœ¨ Buffer ä¸­</span></span><br><span class="line">                                                <span class="comment">// æˆåŠŸå†™å…¥ 7 å­—èŠ‚æ•°æ®åˆ™ç»§ç»­æ‰§è¡Œç¨‹åº</span></span><br><span class="line">                    WriteProcessMemory(ProcessInformation.hProcess, lpBaseAddress, v16, <span class="number">7u</span>, NumberOfBytesWritten);</span><br><span class="line">                    <span class="keyword">if</span> ( NumberOfBytesWritten[<span class="number">0</span>] == <span class="number">7</span> )</span><br><span class="line">                    &#123;</span><br><span class="line">                      ReadProcessMemory(ProcessInformation.hProcess, lpBaseAddress, Buffer, <span class="number">7u</span>, NumberOfBytesRead);</span><br><span class="line">                      dwContinueStatus = <span class="number">65538</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">goto</span> LABEL_33;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">30</span>:                      <span class="comment">// v15 ä¸­çš„ 30 å­—èŠ‚æ•°æ®å†™å…¥lpBaseAddress</span></span><br><span class="line">                    WriteProcessMemory(ProcessInformation.hProcess, lpBaseAddress, v15, <span class="number">0x1Eu</span>, NumberOfBytesWritten);</span><br><span class="line">                    <span class="keyword">if</span> ( NumberOfBytesWritten[<span class="number">0</span>] == <span class="number">30</span> )</span><br><span class="line">                      dwContinueStatus = <span class="number">65538</span>;</span><br><span class="line">                    <span class="keyword">goto</span> LABEL_33;</span><br><span class="line">                  <span class="keyword">default</span>:                      <span class="comment">// iï¼=4ï¼Œ5ï¼Œ7ï¼Œ30</span></span><br><span class="line">                    <span class="keyword">goto</span> LABEL_33;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              dwContinueStatus = <span class="number">0x80010001</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_33;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">            ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, <span class="number">0x10002u</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">4u</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="number">5u</span>:</span><br><span class="line">            v5 = <span class="number">0</span>;</span><br><span class="line">            ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, <span class="number">0x10002u</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">6u</span>:</span><br><span class="line">            ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, <span class="number">0x10002u</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">LABEL_33:</span><br><span class="line">            ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, dwContinueStatus);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_F53922();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="sub-F58A40"><a href="#sub-F58A40" class="headerlink" title="sub_F58A40"></a>sub_F58A40</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">text:00F58AF8                 int     3               ; Trap to Debugger</span><br><span class="line">text:00F58AF9                 nop</span><br><span class="line">text:00F58AFA                 nop</span><br><span class="line">text:00F58AFB                 nop</span><br><span class="line">text:00F58AFC                 nop</span><br><span class="line">text:00F58AFD                 nop</span><br><span class="line">text:00F58AFE                 nop</span><br><span class="line">text:00F58AFF                 push    offset aYouAreTooShort ; &quot;you are too short!&quot;</span><br><span class="line">text:00F58B04                 call    printf</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œé‡åˆ°int 3ä¼šå†™å…¥v16 7å­—èŠ‚çš„æ•°æ®</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">7</span>:                      </span><br><span class="line">                   WriteProcessMemory(ProcessInformation.hProcess, lpBaseAddress, v16, <span class="number">7u</span>, NumberOfBytesWritten);</span><br><span class="line">                   <span class="keyword">if</span> ( NumberOfBytesWritten[<span class="number">0</span>] == <span class="number">7</span> )</span><br><span class="line">                   &#123;</span><br><span class="line">                     ReadProcessMemory(ProcessInformation.hProcess, lpBaseAddress, Buffer, <span class="number">7u</span>, NumberOfBytesRead);</span><br><span class="line">                     dwContinueStatus = <span class="number">65538</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="keyword">goto</span> LABEL_33;</span><br></pre></td></tr></table></figure><p>paste dataå°±è¡Œ</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501051651130.png" alt="image"></p><h4 id="sub-F587E0"><a href="#sub-F587E0" class="headerlink" title="sub_F587E0"></a>sub_F587E0</h4><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501080247609.png" alt="1736275603403.png"></p><p>30å­—èŠ‚çš„æœ‰ç‚¹é•¿ï¼Œidapythonå§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–çš„å­—èŠ‚ä½ç½®èŒƒå›´ï¼šä» 0xF58C45 åˆ° 0xF58D10</span></span><br><span class="line">start_addr = <span class="number">0x00F58C45</span>  <span class="comment"># èµ·å§‹åœ°å€</span></span><br><span class="line">end_addr = <span class="number">0x00F58D10</span>    <span class="comment"># ç»“æŸåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­˜å‚¨å­—èŠ‚çš„åˆ—è¡¨</span></span><br><span class="line">data = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æŒ‡å®šåœ°å€èŒƒå›´</span></span><br><span class="line"><span class="keyword">for</span> addr <span class="keyword">in</span> <span class="built_in">range</span>(start_addr, end_addr + <span class="number">1</span>):  <span class="comment"># æŒ‰å­—èŠ‚é€ä¸ªè¯»å–</span></span><br><span class="line">    byte = idaapi.get_byte(addr)  <span class="comment"># è·å–å½“å‰åœ°å€çš„å­—èŠ‚</span></span><br><span class="line">    <span class="keyword">if</span> byte != -<span class="number">1</span>:  <span class="comment"># ç¡®ä¿å­—èŠ‚æœ‰æ•ˆ</span></span><br><span class="line">        data.append(byte)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªæå–å­˜å‚¨åˆ°å†…å­˜ä¸­çš„å­—èŠ‚ï¼ˆæ¯æ¡ mov æŒ‡ä»¤çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼‰</span></span><br><span class="line">stored_values = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data) - <span class="number">6</span>, <span class="number">7</span>):  <span class="comment"># æ¯æ¡æŒ‡ä»¤ä¸º 7 å­—èŠ‚ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿå­—èŠ‚</span></span><br><span class="line">    stored_values.append(data[i + <span class="number">6</span>])  <span class="comment"># å­˜å‚¨æ¯æ¡ mov æŒ‡ä»¤çš„æœ€åä¸€ä¸ªå­—èŠ‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°æå–çš„å­˜å‚¨å­—èŠ‚å€¼ä½œä¸ºæ•°ç»„</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Stored values in array:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[&quot;</span> + <span class="string">&quot;, &quot;</span>.join(<span class="string">&quot;0x&#123;:02X&#125;&quot;</span>.<span class="built_in">format</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> stored_values) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#[0x90, 0x0F, 0xB6, 0x55, 0xF7, 0x8B, 0x45, 0x08, 0x8B, 0x04, 0x90, 0x0F, 0xAF, 0x45, 0xFC, 0x33, 0xD2, 0xF7, 0x75, 0xF8, 0x0F, 0xB6, 0x4D, 0xF7, 0x8B, 0x45, 0x0C, 0x89, 0x14ï¼Œ0x88]</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idaapi <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> idc <span class="keyword">import</span>*</span><br><span class="line">data=[<span class="number">0x90</span>, <span class="number">0x0F</span>, <span class="number">0xB6</span>, <span class="number">0x55</span>, <span class="number">0xF7</span>, <span class="number">0x8B</span>, <span class="number">0x45</span>, <span class="number">0x08</span>, <span class="number">0x8B</span>, <span class="number">0x04</span>, <span class="number">0x90</span>, <span class="number">0x0F</span>, <span class="number">0xAF</span>, <span class="number">0x45</span>, <span class="number">0xFC</span>, <span class="number">0x33</span>, <span class="number">0xD2</span>, <span class="number">0xF7</span>, <span class="number">0x75</span>, <span class="number">0xF8</span>, <span class="number">0x0F</span>, <span class="number">0xB6</span>, <span class="number">0x4D</span>, <span class="number">0xF7</span>, <span class="number">0x8B</span>, <span class="number">0x45</span>, <span class="number">0x0C</span>, <span class="number">0x89</span>, <span class="number">0x14</span>,<span class="number">0x88</span>]</span><br><span class="line">b=<span class="number">0x0F58824</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    ida_bytes.patch_byte(b+i,data[i])</span><br></pre></td></tr></table></figure><p>ä¿®å®Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> __cdecl <span class="title function_">sub_F587E0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 i; <span class="comment">// [esp+3h] [ebp-9h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8u</span>; ++i )</span><br><span class="line">    *(a2 + <span class="number">4</span> * i) = <span class="number">41</span> * *(a1 + <span class="number">4</span> * i) % <span class="number">0x1EBu</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜è¦ä¸ªin3+3ä¸ªnopï¼Œæ ¹æ®ä¸»å‡½æ•°åˆ†æä¸ç®¡å®ƒ</p><h4 id="sub-F583C0"><a href="#sub-F583C0" class="headerlink" title="sub_F583C0"></a>sub_F583C0</h4><p>in3+4ä¸ªnopï¼Œå¯¹åº”case4ï¼Œmainé‡Œçš„å¤„ç†æ˜¯eip+1è·³è¿‡å¼‚å¸¸</p><p><del>åœ¨int3é‚£é‡Œä¸‹ä¸ªæ–­ç‚¹ï¼ŒåŠ¨è°ƒä¸€ä¸‹çœ‹çœ‹ç¨‹åºå’‹å¤„ç†è¿™é‡Œçš„</del></p><p>å¿˜äº†åŒçº¿ç¨‹äº†ï¼Œapply patch to programmï¼Œç„¶åè¿è¡Œä¸€ä¸‹exe</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.text:0069842B                               ;   __try &#123; // __except at loc_69845A</span><br><span class="line">.text:0069842B C7 45 FC 00 00 00 00          mov     [ebp+ms_exc.registration.TryLevel], 0</span><br><span class="line">.text:00698432 CC                            int     3                               ; Trap to Debugger</span><br><span class="line">.text:00698433 90                            nop</span><br><span class="line">.text:00698434 90                            nop</span><br><span class="line">.text:00698435 90                            nop</span><br><span class="line">.text:00698436 90                            nop</span><br><span class="line">....</span><br><span class="line">.text:0069845A                               loc_69845A:                             ; DATA XREF: .rdata:stru_7783E8â†“o</span><br><span class="line">.text:0069845A                               ;   __except(loc_698454) // owned by 69842B</span><br><span class="line">.text:0069845A 8B 65 E8                      mov     esp, [ebp+ms_exc.old_esp]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥è·³åˆ°äº†loc_69845Aï¼Œæœ‰ç‚¹åƒå¯†æ–‡å¯†é’¥ä¹‹ç±»çš„ï¼ŒåŒæ ·çš„æˆ‘ä»¬keypatch in3 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int 3 -&gt; jmp loc_69845A</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯è§£å¯†äº†ï¼ŒèƒŒåŒ…åŠ å¯†ç½‘ä¸Šéšä¾¿æ‰¾ä¸ªè„šæœ¬æ”¹æ”¹</p><p>swpuctf{y0u_@re_s0_coo1}</p><h2 id="zer0pts-2020-vmlogï¼ˆvmï¼‰"><a href="#zer0pts-2020-vmlogï¼ˆvmï¼‰" class="headerlink" title="[zer0pts 2020]vmlogï¼ˆvmï¼‰"></a>[zer0pts 2020]vmlogï¼ˆvmï¼‰</h2><p><a href="https://www.nssctf.cn/problem/61">[zer0pts 2020]vmlog | NSSCTF</a></p><p>æ‹¿åˆ°vm.pyå’Œlog.txtï¼Œvm.pyå®ç°äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„æŒ‡ä»¤é›†ï¼Œè¡Œä¸ºå–å†³äºprogramå˜é‡å’Œè¾“å…¥ã€‚åšvmé¢˜çš„å¸¸è§„æ€è·¯å°±æ˜¯æŠŠæ±‡ç¼–æ‰“å°å‡ºæ¥çœ‹çœ‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> program <span class="keyword">import</span> program</span><br><span class="line"></span><br><span class="line">reg = <span class="number">0</span></span><br><span class="line">mem = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">p = <span class="number">0</span></span><br><span class="line">pc = <span class="number">0</span></span><br><span class="line">buf = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(program)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> pc &lt; <span class="built_in">len</span>(program):</span><br><span class="line">    op = program[pc]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> op == <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        reg += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> add reg 1 #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;-&quot;</span>:</span><br><span class="line">        reg -= <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> sub reg 1 #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;*&quot;</span>:</span><br><span class="line">        reg *= mem[p]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mul reg mem[<span class="subst">&#123;p&#125;</span>] #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;%&quot;</span>:</span><br><span class="line">        reg = mem[p] % reg</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mod reg mem[<span class="subst">&#123;p&#125;</span>] #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;l&quot;</span>:</span><br><span class="line">        reg = mem[p]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mov reg mem[<span class="subst">&#123;p&#125;</span>] #reg=<span class="subst">&#123;reg&#125;</span>,p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;s&quot;</span>:</span><br><span class="line">        mem[p] = reg</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mov mem[<span class="subst">&#123;p&#125;</span>] reg #mem=<span class="subst">&#123;mem&#125;</span>,p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;&gt;&quot;</span>:</span><br><span class="line">        p = (p + <span class="number">1</span>) % <span class="number">10</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> inc p 1 #p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;&lt;&quot;</span>:</span><br><span class="line">        p = (p - <span class="number">1</span>) % <span class="number">10</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> dec p 1 #p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;,&quot;</span>:</span><br><span class="line">        a = sys.stdin.buffer.read(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> getchar&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> a:</span><br><span class="line">            reg = <span class="number">0</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mov, reg 0 #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            reg += <span class="built_in">ord</span>(a)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mov, reg <span class="subst">&#123;<span class="built_in">ord</span>(a)&#125;</span> #input #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;p&quot;</span>:</span><br><span class="line">        buf += <span class="built_in">str</span>(reg)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> buf+=str(reg)&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;[&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> cmp reg 0&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> reg == <span class="number">0</span>:</span><br><span class="line">            cnt = <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> cnt != <span class="number">0</span>:</span><br><span class="line">                pc += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> program[pc] == <span class="string">&quot;[&quot;</span>:</span><br><span class="line">                    cnt += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> program[pc] == <span class="string">&quot;]&quot;</span>:</span><br><span class="line">                    cnt -= <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> jz &quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;]&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> cmp reg 0&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> reg != <span class="number">0</span>:</span><br><span class="line">            cnt = <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> cnt != <span class="number">0</span>:</span><br><span class="line">                pc -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> program[pc] == <span class="string">&quot;[&quot;</span>:</span><br><span class="line">                    cnt -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> program[pc] == <span class="string">&quot;]&quot;</span>:</span><br><span class="line">                    cnt += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> jnz &quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;M&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(mem)</span><br><span class="line"></span><br><span class="line">    pc += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(buf)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------------------------------&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------------------------------&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------------------------------&quot;</span>)</span><br><span class="line"><span class="comment">#print(f&quot;PC: &#123;pc&#125;, OP: &#123;op&#125;, REG: &#123;reg&#125;, MEM: &#123;mem&#125;, P: &#123;p&#125;, BUF: &#x27;&#123;buf&#125;&#x27;&quot;)</span></span><br></pre></td></tr></table></figure><p>ç»™çš„log.txtæ˜¯program+è¿è¡Œæ—¥å¿—</p><p>è‡ªå·±å†å®šä¹‰ä¸€ä¸ªprogram.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">program = <span class="string">&quot;M+s+&gt;s&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[s&lt;&lt;l&gt;*&lt;s&gt;&gt;l-]&lt;&lt;l-s&gt;l*-s*-s*-s*-s*-s*-s&gt;l*+++++s*-----s****s&gt;&gt;l+s[Ml-s&lt;&lt;l&gt;,[&lt;&lt;*&gt;&gt;s&lt;&lt;&lt;l&gt;&gt;&gt;%&lt;s&gt;&gt;l&lt;s&gt;l+s&lt;l]&gt;l]&lt;&lt;lp&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">M+s+&gt;s&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[s&lt;&lt;l&gt;*&lt;s&gt;&gt;l-]&lt;&lt;l-s</span><br><span class="line">&gt;l*-s*-s*-s*-s*-s*-s</span><br></pre></td></tr></table></figure><ul><li><p><strong><code>M</code></strong>ï¼šæ‰“å°åˆå§‹å†…å­˜çŠ¶æ€ï¼Œä¾¿äºè°ƒè¯•ã€‚</p></li><li><p><code>s</code> å’Œ <code>l</code></p><p>ï¼šå°†å€¼å­˜å‚¨åˆ°å†…å­˜æˆ–åŠ è½½åˆ°å¯„å­˜å™¨ã€‚</p><ul><li><code>mem[0]</code> è¢«è®¾ç½®ä¸ºä¸€ä¸ªå¤§å€¼ï¼ˆ262âˆ’12^{62} - 1262âˆ’1ï¼‰ï¼Œé€šå¸¸ç”¨äºæ¨¡è¿ç®—ã€‚</li><li><code>mem[1]</code> è¢«è®¾ç½®ä¸º 2ï¼ˆåŸºæ•° <code>r</code>ï¼‰ã€‚</li><li><code>mem[2]</code> è¢«è®¾ç½®ä¸º 1ï¼ˆåˆå§‹å“ˆå¸Œå€¼ <code>h</code>ï¼‰ã€‚</li></ul></li><li><p>æ¨æ–­</p><ul><li>è¿™ç§åˆå§‹åŒ–æ–¹å¼éå¸¸å…¸å‹ï¼Œå¸¸è§äºæ»šåŠ¨å“ˆå¸Œç®—æ³•çš„å®ç°ã€‚</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">,[&lt;&lt;*&gt;&gt;s&lt;&lt;&lt;l&gt;&gt;&gt;%&lt;s</span><br></pre></td></tr></table></figure><ul><li><strong><code>[ ,</code></strong>ï¼šå¼€å§‹è¯»å–è¾“å…¥å­—ç¬¦ã€‚</li><li><strong><code>&lt;&lt;\*</code></strong>ï¼šå½“å‰å“ˆå¸Œå€¼ <code>h</code> åŠ ä¸Šè¾“å…¥å­—ç¬¦åï¼Œä¹˜ä»¥åŸºæ•° <code>r</code>ã€‚</li><li><strong><code>%</code></strong>ï¼šå¯¹æ¨¡æ•° <code>m</code> å–æ¨¡ï¼Œé˜²æ­¢å“ˆå¸Œå€¼æº¢å‡ºã€‚</li><li>æ¨æ–­<ul><li>è¿™æ˜¯æ»šåŠ¨å“ˆå¸Œç®—æ³•çš„æ ¸å¿ƒå…¬å¼ï¼š h=(h+input)â‹…rmodâ€‰â€‰mh = (h + \text{input}) \cdot r \mod mh=(h+input)â‹…rmodm</li></ul></li></ul><h4 id=""><a href="#" class="headerlink" title=" "></a> </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Ml-s&lt;&lt;l&gt;,[&lt;&lt;*&gt;&gt;s&lt;&lt;&lt;l&gt;&gt;&gt;%&lt;s&gt;&gt;l&lt;s&gt;l+s&lt;l]&gt;l]&lt;&lt;lp</span><br></pre></td></tr></table></figure><ul><li>å¾ªç¯æ ¸å¿ƒ<ul><li><code>[Ml-s&lt;&lt;l&gt;</code>ï¼šå¼€å§‹æ–°ä¸€è½®çš„å“ˆå¸Œå€¼æ›´æ–°ï¼Œæ ‡å¿—ä½æ§åˆ¶ã€‚</li><li><code>,[&lt;&lt;*&gt;&gt;s&lt;&lt;&lt;l&gt;&gt;&gt;%&lt;s</code>ï¼šå¯¹æ¯ä¸ªè¾“å…¥å­—ç¬¦è¿›è¡Œæ»šåŠ¨å“ˆå¸Œæ›´æ–°ã€‚</li><li><code>&gt;l+s&lt;l]</code>ï¼šè®¾ç½®æ ‡å¿—ä½ï¼Œç»§ç»­ä¸‹ä¸€è½®è¾“å…¥å¤„ç†ã€‚</li></ul></li><li>æ¨æ–­<ul><li>æ»šåŠ¨å“ˆå¸Œçš„æœ¬è´¨æ˜¯å¯¹è¾“å…¥å­—ç¬¦çš„é€ä¸ªå¤„ç†ï¼Œç»“åˆä¹˜æ³•ã€åŠ æ³•å’Œæ¨¡è¿ç®—ã€‚</li></ul></li></ul><h4 id="-1"><a href="#-1" class="headerlink" title=" "></a> </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;lp</span><br></pre></td></tr></table></figure><ul><li>ä½œç”¨<ul><li>è¾“å‡ºæœ€ç»ˆçš„å“ˆå¸Œå€¼ <code>h</code>ï¼ˆå­˜å‚¨åœ¨ <code>mem[2]</code>ï¼‰ã€‚</li></ul></li></ul><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;D:\LeStoreDownload\webpage\CTF\nssctf\[zer0pts 2020]vmlog\tmp\log.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    prev_h = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> f:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            arr = <span class="built_in">eval</span>(l.strip())</span><br><span class="line">            <span class="keyword">if</span> arr[<span class="number">4</span>] == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> prev_h:</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                        <span class="keyword">if</span> (prev_h + i) * arr[<span class="number">1</span>] % arr[<span class="number">0</span>] == arr[<span class="number">2</span>]:</span><br><span class="line">                            flag += <span class="built_in">chr</span>(i)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                prev_h = arr[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#zer0pts&#123;3asy_t0_f0110w_th3_l0g?&#125;</span></span><br></pre></td></tr></table></figure><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç»ƒä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¶åœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDApythonå­¦ä¹ </title>
      <link href="/2024/12/30/%E5%88%9D%E8%AF%86IDApython/"/>
      <url>/2024/12/30/%E5%88%9D%E8%AF%86IDApython/</url>
      
        <content type="html"><![CDATA[<h1 id="IDApython-amp-IDC"><a href="#IDApython-amp-IDC" class="headerlink" title="IDApython&amp;IDC"></a><strong>IDApython&amp;IDC</strong></h1><p>IDApython å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.hex-rays.com/developer-guide/idapython">IDAPython | Hex-Rays Docs</a></p><p>IDC å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.hex-rays.com/developer-guide/idc">IDC | Hex-Rays Docs</a></p><h1 id="å¸¸ç”¨æ¨¡å—"><a href="#å¸¸ç”¨æ¨¡å—" class="headerlink" title="å¸¸ç”¨æ¨¡å—"></a><strong>å¸¸ç”¨æ¨¡å—</strong></h1><h2 id="1-IDC"><a href="#1-IDC" class="headerlink" title="1.IDC"></a><strong>1.IDC</strong></h2><p>ä¸ IDA å‘½ä»¤è¡Œè¿›è¡Œäº¤äº’çš„æ¨¡å—ï¼Œæä¾›äº†å¾ˆå¤š IDA ä¸­æŒ‡ä»¤ç›¸å…³çš„å‡½æ•°ã€‚</p><ul><li><strong><code>idc.get_name(ea)</code></strong>ï¼šè·å–åœ°å€ <code>ea</code> å¤„çš„åç§°ã€‚</li><li><strong><code>idc.get_func_name(ea)</code></strong>ï¼šè·å–å‡½æ•°åœ°å€å¤„çš„å‡½æ•°åç§°ã€‚</li><li><strong><code>idc.set_name(ea, name)</code></strong>ï¼šä¸ºåœ°å€ <code>ea</code> è®¾ç½®ä¸€ä¸ªæ–°çš„åç§°ã€‚</li><li><strong><code>idc.add_entry(ea, name, start, end)</code></strong>ï¼šåœ¨ <code>ea</code> å¤„æ·»åŠ ä¸€ä¸ªå…¥å£ç‚¹ã€‚</li><li><strong><code>idc.get_func(ea)</code></strong>ï¼šè·å– <code>ea</code> å¤„çš„å‡½æ•°ç»“æ„ã€‚</li></ul><h2 id="2-IDAAPI"><a href="#2-IDAAPI" class="headerlink" title="2.IDAAPI"></a><strong>2.IDAAPI</strong></h2><p>ä¸ IDA çš„æ ¸å¿ƒ API äº¤äº’çš„ä¸»è¦æ¨¡å—ã€‚åŒ…æ‹¬äº†å¯¹ IDA æ ¸å¿ƒå¯¹è±¡çš„è®¿é—®ï¼Œæ¶µç›–äº†åœ°å€ã€å‡½æ•°ã€èŠ‚ç­‰è®¸å¤šåº•å±‚æ“ä½œã€‚</p><ul><li><strong><code>idaapi.get_func(ea)</code></strong>ï¼šè¿”å›åœ°å€ <code>ea</code> å¤„çš„å‡½æ•°å¯¹è±¡ã€‚</li><li><strong><code>idaapi.get_flags(ea)</code></strong>ï¼šè¿”å›åœ°å€ <code>ea</code> çš„æ ‡å¿—ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä»£ç ã€æ•°æ®è¿˜æ˜¯å…¶ä»–ç±»å‹ã€‚</li><li><strong><code>idaapi.create_data(ea, size, type)</code></strong>ï¼šåœ¨åœ°å€ <code>ea</code> å¤„åˆ›å»ºæ•°æ®ã€‚</li><li><strong><code>idaapi.get_strlit_contents(ea)</code></strong>ï¼šè·å– <code>ea</code> å¤„çš„å­—ç¬¦ä¸²å†…å®¹ã€‚</li><li><strong><code>idaapi.add_func(ea)</code></strong>ï¼šå°†åœ°å€ <code>ea</code> æ·»åŠ ä¸ºä¸€ä¸ªå‡½æ•°ã€‚</li></ul><h2 id="3-IDAUTILS"><a href="#3-IDAUTILS" class="headerlink" title="3.IDAUTILS"></a><strong>3.IDAUTILS</strong></h2><p>å·¥å…·å‡½æ•°ï¼Œå¸®åŠ©åœ¨åæ±‡ç¼–ä¸­è‡ªåŠ¨åŒ–å’Œç®€åŒ–åˆ†æè¿‡ç¨‹ã€‚</p><ul><li><strong><code>idautils.Functions(start, end)</code></strong>ï¼šéå†åœ¨ <code>start</code> åˆ° <code>end</code> åœ°å€èŒƒå›´å†…çš„æ‰€æœ‰å‡½æ•°ã€‚</li><li><strong><code>idautils.DecodeInstruction(ea)</code></strong>ï¼šè§£ç åœ°å€ <code>ea</code> å¤„çš„æŒ‡ä»¤ã€‚</li><li><strong><code>idautils.FindBinary(start, end, pattern, flags)</code></strong>ï¼šåœ¨æŒ‡å®šèŒƒå›´å†…æŸ¥æ‰¾ä¸æ¨¡å¼åŒ¹é…çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</li><li><strong><code>idautils.Heads(start, end)</code></strong>ï¼šéå†åœ°å€èŒƒå›´å†…çš„æ‰€æœ‰æŒ‡ä»¤åœ°å€ã€‚</li></ul><h2 id="4-ida-bytes"><a href="#4-ida-bytes" class="headerlink" title="4.ida_bytes"></a><strong>4.ida_bytes</strong></h2><p><code>ida_bytes</code> æä¾›äº†å¯¹å†…å­˜åŒºåŸŸå­—èŠ‚çº§åˆ«æ“ä½œçš„å‡½æ•°ã€‚</p><ul><li><strong><code>ida_bytes.get_byte(ea)</code></strong>ï¼šè·å– <code>ea</code> å¤„çš„ä¸€ä¸ªå­—èŠ‚</li><li><strong><code>ida_bytes.get_word(ea)</code></strong>ï¼šè·å– <code>ea</code> å¤„çš„ä¸€ä¸ªå­—.</li><li><strong><code>ida_bytes.get_dword(ea)</code></strong>ï¼šè·å– <code>ea</code> å¤„çš„ä¸€ä¸ªåŒå­—ã€‚</li></ul><h2 id="5-ida-struct"><a href="#5-ida-struct" class="headerlink" title="5.ida_struct"></a><strong>5.ida_struct</strong></h2><p><code>ida_struct</code> å¤„ç† IDA ä¸­çš„ç»“æ„ä½“ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å–ã€åˆ›å»ºã€ä¿®æ”¹å’Œè®¾ç½®ç»“æ„ä½“ã€‚</p><ul><li><strong><code>ida_struct.get_struc_name(struc)</code></strong>ï¼šè·å–ç»“æ„ä½“çš„åç§°ã€‚</li><li><strong><code>ida_struct.add_struc()</code></strong>ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„ç»“æ„ä½“ã€‚</li><li><strong><code>ida_struct.set_struc_member()</code></strong>ï¼šè®¾ç½®ç»“æ„ä½“æˆå‘˜çš„å±æ€§ã€‚</li></ul><h2 id="6-ida-diskio"><a href="#6-ida-diskio" class="headerlink" title="6.ida_diskio"></a><strong>6.ida_diskio</strong></h2><p><code>ida_diskio</code> æä¾›äº†ä¸ç£ç›˜ IO æ“ä½œç›¸å…³çš„å‡½æ•°ï¼Œä¾‹å¦‚è¯»å–æˆ–å†™å…¥æ–‡ä»¶ã€‚</p><ul><li><strong><code>ida_diskio.get_input_file_path()</code></strong>ï¼šè·å–å½“å‰è¾“å…¥æ–‡ä»¶çš„è·¯å¾„ã€‚</li><li><strong><code>ida_diskio.save_input_file()</code></strong>ï¼šä¿å­˜å½“å‰è¾“å…¥æ–‡ä»¶ã€‚</li></ul><h1 id="å¸¸ç”¨æŠ€å·§"><a href="#å¸¸ç”¨æŠ€å·§" class="headerlink" title="å¸¸ç”¨æŠ€å·§"></a><strong>å¸¸ç”¨æŠ€å·§</strong></h1><h2 id="è·å–åŸºæœ¬å—-ida-get-bb"><a href="#è·å–åŸºæœ¬å—-ida-get-bb" class="headerlink" title="è·å–åŸºæœ¬å— ida_get_bb"></a><strong>è·å–åŸºæœ¬å— ida_get_bb</strong></h2><p><code>ida_get_bb</code> å‡½æ•°çš„åŠŸèƒ½æ˜¯è·å–æŒ‡å®šåœ°å€ <code>ea</code> æ‰€åœ¨çš„åŸºæœ¬å—ï¼ˆBasic Blockï¼‰ã€‚åŸºæœ¬å—æ˜¯æŒ‡åœ¨ç¨‹åºä¸­è¿ç»­çš„ä¸€ç»„æŒ‡ä»¤åºåˆ—ï¼Œè¿™äº›æŒ‡ä»¤åœ¨ç¨‹åºçš„æ§åˆ¶æµå›¾ä¸Šä¸ä¼šè¢«ä¸­æ–­ï¼Œåªæœ‰ä»å¤´åˆ°å°¾çš„é¡ºåºæ‰§è¡Œï¼Œå¹¶ä¸”åªæœ‰åœ¨å—çš„ç»“æŸå¤„æ‰èƒ½è·³å‡ºè¿™ä¸ªå—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ida_get_bb</span>(<span class="params">ea</span>):</span><br><span class="line">    f_blocks = idaapi.FlowChart(idaapi.get_func(ea), flags=idaapi.FC_PREDS)</span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> f_blocks:</span><br><span class="line">        <span class="keyword">if</span> block.start_ea &lt;= ea <span class="keyword">and</span> ea &lt; block.end_ea:</span><br><span class="line">            <span class="keyword">return</span> block</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°åŠŸèƒ½æ¦‚è¿°"><a href="#å‡½æ•°åŠŸèƒ½æ¦‚è¿°" class="headerlink" title="å‡½æ•°åŠŸèƒ½æ¦‚è¿°"></a><strong>å‡½æ•°åŠŸèƒ½æ¦‚è¿°</strong></h3><ul><li><strong>è¾“å…¥</strong>ï¼šè™šæ‹Ÿåœ°å€ (<code>ea</code>)ï¼Œå³ç›®æ ‡æŒ‡ä»¤çš„åœ°å€ã€‚</li><li><strong>è¾“å‡º</strong>ï¼šåŒ…å«è¯¥åœ°å€çš„åŸºæœ¬å— (<code>block</code>) æˆ–è€… <code>None</code>ï¼ˆå¦‚æœæœªæ‰¾åˆ°ï¼‰ã€‚</li></ul><h3 id="å‡½æ•°é€»è¾‘"><a href="#å‡½æ•°é€»è¾‘" class="headerlink" title="å‡½æ•°é€»è¾‘"></a><strong>å‡½æ•°é€»è¾‘</strong></h3><ol><li>åˆ©ç”¨ IDA Pro çš„ <code>idaapi.FlowChart</code> ç±»ç”Ÿæˆå½“å‰å‡½æ•°çš„æ§åˆ¶æµå›¾ï¼ˆFlow Chartï¼‰ï¼Œå³å‡½æ•°å†…çš„æ‰€æœ‰åŸºæœ¬å—ã€‚</li><li>éå†æ¯ä¸ªåŸºæœ¬å—ï¼Œæ£€æŸ¥è¯¥åŸºæœ¬å—çš„èµ·å§‹åœ°å€ (<code>start_ea</code>) å’Œç»“æŸåœ°å€ (<code>end_ea</code>)ï¼Œåˆ¤æ–­ç›®æ ‡åœ°å€ (<code>ea</code>) æ˜¯å¦åœ¨è¯¥åŸºæœ¬å—èŒƒå›´å†…ã€‚</li><li>å¦‚æœæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„åŸºæœ¬å—ï¼Œåˆ™è¿”å›è¯¥åŸºæœ¬å—å¯¹è±¡ã€‚</li><li>å¦‚æœéå†å®Œæ‰€æœ‰åŸºæœ¬å—éƒ½æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ï¼Œè¿”å› <code>None</code>ã€‚</li></ol><h2 id="åˆ›å»º-åˆ é™¤å‡½æ•°"><a href="#åˆ›å»º-åˆ é™¤å‡½æ•°" class="headerlink" title="åˆ›å»º / åˆ é™¤å‡½æ•°"></a><strong>åˆ›å»º / åˆ é™¤å‡½æ•°</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">idc.add_func(<span class="number">0x401000</span>, <span class="number">0x401050</span>)  <span class="comment"># Create a function starting at 0x401000 and ending at 0x401050</span></span><br><span class="line">idc.del_func(<span class="number">0x401000</span>)  <span class="comment"># Delete the function at 0x401000</span></span><br></pre></td></tr></table></figure><h2 id="è·å–å‡½æ•°çš„åç§°"><a href="#è·å–å‡½æ•°çš„åç§°" class="headerlink" title="è·å–å‡½æ•°çš„åç§°"></a><strong>è·å–å‡½æ•°çš„åç§°</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_func_name(ea)</span><br></pre></td></tr></table></figure><h2 id="éå†æ‰€æœ‰å‡½æ•°å¹¶æ‰“å°å…¶æœ‰æ•ˆåœ°å€å’Œåç§°"><a href="#éå†æ‰€æœ‰å‡½æ•°å¹¶æ‰“å°å…¶æœ‰æ•ˆåœ°å€å’Œåç§°" class="headerlink" title="éå†æ‰€æœ‰å‡½æ•°å¹¶æ‰“å°å…¶æœ‰æ•ˆåœ°å€å’Œåç§°"></a><strong>éå†æ‰€æœ‰å‡½æ•°å¹¶æ‰“å°å…¶æœ‰æ•ˆåœ°å€å’Œåç§°</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> func_ea <span class="keyword">in</span> idautils.Functions(): </span><br><span class="line">func_name = idc.get_func_name(func_ea)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(func_ea), func_name)</span><br></pre></td></tr></table></figure><h2 id="åˆ—å‡ºåœ°å€çš„äº¤å‰å¼•ç”¨ï¼š"><a href="#åˆ—å‡ºåœ°å€çš„äº¤å‰å¼•ç”¨ï¼š" class="headerlink" title="åˆ—å‡ºåœ°å€çš„äº¤å‰å¼•ç”¨ï¼š"></a><strong>åˆ—å‡ºåœ°å€çš„äº¤å‰å¼•ç”¨ï¼š</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> xref <span class="keyword">in</span> idautils.XrefsFrom(<span class="number">0x401000</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Xref from 0x401000 to <span class="subst">&#123;<span class="built_in">hex</span>(xref.to)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="éå†æ‰€æœ‰äº¤å‰å¼•ç”¨å¹¶æ‰“å°"><a href="#éå†æ‰€æœ‰äº¤å‰å¼•ç”¨å¹¶æ‰“å°" class="headerlink" title="éå†æ‰€æœ‰äº¤å‰å¼•ç”¨å¹¶æ‰“å°"></a><strong>éå†æ‰€æœ‰äº¤å‰å¼•ç”¨å¹¶æ‰“å°</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for ref in idautils.XrefsTo(ea):</span><br><span class="line">  print(hex(ref.frm))</span><br></pre></td></tr></table></figure><h2 id="è·å–æ®µåœ°å€"><a href="#è·å–æ®µåœ°å€" class="headerlink" title="è·å–æ®µåœ°å€"></a>è·å–æ®µåœ°å€</h2><p><code>idautils.Segments()</code> è¿”å› <strong>æ‰€æœ‰æ®µçš„èµ·å§‹åœ°å€</strong>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> seg <span class="keyword">in</span> idautils.Segments():</span><br><span class="line">    seg_name = idc.get_segm_name(seg)</span><br><span class="line">    <span class="keyword">if</span> seg_name != <span class="string">&quot;.text&quot;</span> <span class="keyword">and</span> seg_name != <span class="string">&quot;UPX0&quot;</span>:</span><br><span class="line">        <span class="comment"># print(f&quot;è·³è¿‡æ®µ: &#123;seg_name&#125; (0x&#123;seg:X&#125;)&quot;)</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨å¤„ç†æ®µ: <span class="subst">&#123;seg_name&#125;</span> (0x<span class="subst">&#123;seg:X&#125;</span>)&quot;</span>)</span><br><span class="line">    start_ea = seg</span><br><span class="line">    end_ea = idc.get_segm_end(seg) <span class="comment">#è¿”å›æ®µçš„ç»“æŸåœ°å€ã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ–‡æœ¬-æŒ‡ä»¤æœç´¢"><a href="#æ–‡æœ¬-æŒ‡ä»¤æœç´¢" class="headerlink" title="æ–‡æœ¬ / æŒ‡ä»¤æœç´¢"></a><strong>æ–‡æœ¬ / æŒ‡ä»¤æœç´¢</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢æ•´ä¸ªå†…å­˜åŒºåŸŸçš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_string</span>(<span class="params">pattern</span>):</span><br><span class="line">    <span class="keyword">for</span> ea <span class="keyword">in</span> idautils.Strings():</span><br><span class="line">        <span class="keyword">if</span> pattern <span class="keyword">in</span> ea:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Found string at <span class="subst">&#123;<span class="built_in">hex</span>(ea)&#125;</span>: <span class="subst">&#123;ea&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢ &quot;Hello&quot; å­—ç¬¦ä¸²</span></span><br><span class="line">search_string(<span class="string">&quot;Hello&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æœç´¢æ±‡ç¼–æŒ‡ä»¤</span></span><br><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_asm_instruction</span>(<span class="params">pattern</span>):</span><br><span class="line">    <span class="comment"># éå†æ•´ä¸ªç¨‹åºçš„æ‰€æœ‰æŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">for</span> ea <span class="keyword">in</span> idautils.Heads(idc.get_segm_by_name(<span class="string">&quot;.text&quot;</span>), idc.get_segm_end(idc.get_segm_by_name(<span class="string">&quot;.text&quot;</span>))):</span><br><span class="line">        disasm = idc.GetDisasm(ea)  <span class="comment"># è·å–åœ°å€å¤„çš„åæ±‡ç¼–æŒ‡ä»¤</span></span><br><span class="line">        <span class="keyword">if</span> pattern <span class="keyword">in</span> disasm:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Found instruction at <span class="subst">&#123;<span class="built_in">hex</span>(ea)&#125;</span>: <span class="subst">&#123;disasm&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢ &quot;mov eax, ebx&quot; æŒ‡ä»¤</span></span><br><span class="line">search_asm_instruction(<span class="string">&quot;mov eax, ebx&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="å¾ªç¯å·¦ç§»-å³ç§»"><a href="#å¾ªç¯å·¦ç§»-å³ç§»" class="headerlink" title="å¾ªç¯å·¦ç§» / å³ç§»"></a><strong>å¾ªç¯å·¦ç§» / å³ç§»</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ROR</span>(<span class="params">i,index</span>):<span class="comment">#å¾ªç¯åˆç§»</span></span><br><span class="line">    tmp = <span class="built_in">bin</span>(i)[<span class="number">2</span>:].rjust(<span class="number">8</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(index):</span><br><span class="line">        tmp = tmp[-<span class="number">1</span>] + tmp[:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(tmp, <span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ROL</span>(<span class="params">i,index</span>):<span class="comment">#å¾ªç¯å·¦ç§»</span></span><br><span class="line">    tmp = <span class="built_in">bin</span>(i)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(index):</span><br><span class="line">        tmp = tmp[<span class="number">1</span>:] + tmp[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(tmp, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å®ä¾‹</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">def ROR(i,index):</span><br><span class="line">    tmp = bin(i)[2:].rjust(8,&quot;0&quot;)</span><br><span class="line">    for _ in range(index):</span><br><span class="line">        tmp = tmp[-1] + tmp[:-1]</span><br><span class="line">    return int(tmp, 2)</span><br><span class="line">    </span><br><span class="line">addr1=0x140001085</span><br><span class="line">addr2=0x140001d00</span><br><span class="line">for i in range(addr2-addr1):</span><br><span class="line">    PatchByte(addr1+i,ROR(Byte(addr1+i),3)^90)</span><br><span class="line">print(&#x27;successful&#x27;)</span><br></pre></td></tr></table></figure><h2 id="åˆ—å‡º-segment-å‡½æ•°ï¼ˆä»¥åŠå®ƒä»¬çš„äº¤å‰å¼•ç”¨ï¼‰"><a href="#åˆ—å‡º-segment-å‡½æ•°ï¼ˆä»¥åŠå®ƒä»¬çš„äº¤å‰å¼•ç”¨ï¼‰" class="headerlink" title="åˆ—å‡º segment å‡½æ•°ï¼ˆä»¥åŠå®ƒä»¬çš„äº¤å‰å¼•ç”¨ï¼‰"></a><strong>åˆ—å‡º segment å‡½æ•°ï¼ˆä»¥åŠå®ƒä»¬çš„äº¤å‰å¼•ç”¨ï¼‰</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_kernwin</span><br><span class="line"><span class="keyword">import</span> ida_segment</span><br><span class="line"><span class="keyword">import</span> ida_funcs</span><br><span class="line"><span class="keyword">import</span> ida_xref</span><br><span class="line"><span class="keyword">import</span> ida_auto</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    ida_auto.auto_wait()  <span class="comment"># ç¡®ä¿ IDA å®Œæˆè‡ªåŠ¨åˆ†æ</span></span><br><span class="line">    ea = ida_kernwin.get_screen_ea()</span><br><span class="line">    seg = ida_segment.getseg(ea)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> seg:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;No segment found at 0x%x&quot;</span> % ea)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    func = ida_funcs.get_func(seg.start_ea)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> func:</span><br><span class="line">        func = ida_funcs.get_next_func(seg.start_ea)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> func <span class="keyword">and</span> func.start_ea &lt; seg.end_ea:</span><br><span class="line">        funcea = func.start_ea</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Function %s at 0x%x&quot;</span> % (ida_funcs.get_func_name(funcea), funcea))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥æ‰¾å¯¹ funcea çš„äº¤å‰å¼•ç”¨</span></span><br><span class="line">        xb = ida_xref.xrefblk_t()</span><br><span class="line">        <span class="keyword">if</span> xb.first_to(funcea, ida_xref.XREF_ALL):</span><br><span class="line">            <span class="keyword">while</span> xb.iscode:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;  called from %s(0x%x)&quot;</span> % (ida_funcs.get_func_name(xb.frm), xb.frm))</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> xb.next_to():</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        func = ida_funcs.get_next_func(funcea)</span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åˆ—å‡º-segment-ä¸­çš„æ‰€æœ‰å‡½æ•°-ï¼ˆå’Œäº¤å‰å¼•ç”¨ï¼‰"><a href="#åˆ—å‡º-segment-ä¸­çš„æ‰€æœ‰å‡½æ•°-ï¼ˆå’Œäº¤å‰å¼•ç”¨ï¼‰" class="headerlink" title="åˆ—å‡º segment ä¸­çš„æ‰€æœ‰å‡½æ•° ï¼ˆå’Œäº¤å‰å¼•ç”¨ï¼‰"></a><strong>åˆ—å‡º segment ä¸­çš„æ‰€æœ‰å‡½æ•° ï¼ˆå’Œäº¤å‰å¼•ç”¨ï¼‰</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_kernwin</span><br><span class="line"><span class="keyword">import</span> ida_idaapi</span><br><span class="line"><span class="keyword">import</span> ida_segment</span><br><span class="line"><span class="keyword">import</span> ida_funcs</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># Get current ea</span></span><br><span class="line">    ea = ida_kernwin.get_screen_ea()</span><br><span class="line">    <span class="keyword">if</span> ea == ida_idaapi.BADADDR:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Could not get get_screen_ea()&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    seg = ida_segment.getseg(ea)</span><br><span class="line">    <span class="keyword">if</span> seg:</span><br><span class="line">        <span class="comment"># Loop from start to end in the current segment</span></span><br><span class="line">        <span class="keyword">for</span> funcea <span class="keyword">in</span> idautils.Functions(seg.start_ea, seg.end_ea):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Function %s at 0x%x&quot;</span> % (ida_funcs.get_func_name(funcea), funcea))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Find all code references to funcea</span></span><br><span class="line">            <span class="keyword">for</span> ref <span class="keyword">in</span> idautils.CodeRefsTo(funcea, <span class="number">1</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;  called from %s(0x%x)&quot;</span> % (ida_funcs.get_func_name(ref), ref))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Please position the cursor within a segment&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="è·å–å¹¶æ‰“å°å½“å‰å…‰æ ‡æ‰€åœ¨å‡½æ•°ï¼ˆæˆ–ä»£ç å—ï¼‰çš„è¯¦ç»†ä¿¡æ¯"><a href="#è·å–å¹¶æ‰“å°å½“å‰å…‰æ ‡æ‰€åœ¨å‡½æ•°ï¼ˆæˆ–ä»£ç å—ï¼‰çš„è¯¦ç»†ä¿¡æ¯" class="headerlink" title="è·å–å¹¶æ‰“å°å½“å‰å…‰æ ‡æ‰€åœ¨å‡½æ•°ï¼ˆæˆ–ä»£ç å—ï¼‰çš„è¯¦ç»†ä¿¡æ¯"></a>è·å–å¹¶æ‰“å°å½“å‰å…‰æ ‡æ‰€åœ¨å‡½æ•°ï¼ˆæˆ–ä»£ç å—ï¼‰çš„è¯¦ç»†ä¿¡æ¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> ida_kernwin</span><br><span class="line"><span class="keyword">import</span> ida_funcs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_flags</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°çš„æ ‡å¿—ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å‡½æ•°æ ‡å¿—: %08X&quot;</span> % fn.flags)</span><br><span class="line">    <span class="keyword">if</span> fn.is_far():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¿œå‡½æ•°&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> fn.does_return():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¯¥å‡½æ•°ä¸ä¼šè¿”å›&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> fn.flags &amp; ida_funcs.FUNC_FRAME:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¯¥å‡½æ•°ä½¿ç”¨å¸§æŒ‡é’ˆ&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> fn.flags &amp; ida_funcs.FUNC_THUNK:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¯¥å‡½æ•°æ˜¯ Thunk å‡½æ•°&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> fn.flags &amp; ida_funcs.FUNC_LUMINA:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¯¥å‡½æ•°ä¿¡æ¯ç”± Lumina æä¾›&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> fn.flags &amp; ida_funcs.FUNC_OUTLINE:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¯¥å‡½æ•°æ˜¯ä¼ªä»£ç å‡½æ•°ï¼ˆéçœŸå®å‡½æ•°ï¼‰&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_regvars</span>(<span class="params">pfn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°ä¸­çš„é‡å‘½åå¯„å­˜å™¨ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> ida_funcs.is_func_entry(pfn)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥å‡½æ•°æœ‰ %d ä¸ªé‡å‘½åå¯„å­˜å™¨&quot;</span> % pfn.regvarqty)</span><br><span class="line">    <span class="keyword">for</span> rv <span class="keyword">in</span> pfn.regvars:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%08X..%08X &#x27;%s&#x27;-&gt;&#x27;%s&#x27;&quot;</span> % (rv.start_ea, rv.end_ea, rv.canon, rv.user))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_regargs</span>(<span class="params">pfn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å¯„å­˜å™¨ä¼ é€’çš„å‚æ•°ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> ida_funcs.is_func_entry(pfn)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥å‡½æ•°æœ‰ %d ä¸ªå¯„å­˜å™¨å‚æ•°&quot;</span> % pfn.regargqty)</span><br><span class="line">    <span class="keyword">for</span> ra <span class="keyword">in</span> pfn.regargs:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  å¯„å­˜å™¨ç¼–å·=%d, å‚æ•°åç§°=\&quot;%s\&quot;, (åºåˆ—åŒ–ç±»å‹)=\&quot;%s\&quot;&quot;</span> % (</span><br><span class="line">            ra.reg,</span><br><span class="line">            ra.name,</span><br><span class="line">            binascii.hexlify(ra.<span class="built_in">type</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_tails</span>(<span class="params">pfn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°çš„å°¾å—ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> ida_funcs.is_func_entry(pfn)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥å‡½æ•°æœ‰ %d ä¸ªå°¾å—&quot;</span> % pfn.tailqty)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pfn.tailqty):</span><br><span class="line">        ft = pfn.tails[i]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  å°¾å— %i: %08X..%08X&quot;</span> % (i, ft.start_ea, ft.end_ea))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_stkpnts</span>(<span class="params">pfn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°çš„æ ˆè°ƒæ•´ç‚¹ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥å‡½æ•°æœ‰ %d ä¸ªæ ˆè°ƒæ•´ç‚¹&quot;</span> % pfn.pntqty)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pfn.pntqty):</span><br><span class="line">        pnt = pfn.points[i]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  æ ˆè°ƒæ•´ç‚¹ %i @%08X: %d&quot;</span> % (i, pnt.ea, pnt.spd))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_frame</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°çš„æ ˆå¸§ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> ida_funcs.is_func_entry(fn)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¸§ç»“æ„ ID: %08X&quot;</span> % fn.frame)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å±€éƒ¨å˜é‡åŒºå¤§å°: %8X&quot;</span> % fn.frsize)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ä¿å­˜å¯„å­˜å™¨åŒºå¤§å°: %8X&quot;</span> % fn.frregs)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¿”å›æ—¶æ¸…ç†çš„å­—èŠ‚æ•°: %8X&quot;</span> % fn.argsize)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¸§æŒ‡é’ˆåç§»é‡: %8X&quot;</span> % fn.fpd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_parents</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°å°¾å—çš„æ‰€æœ‰è€…å’Œå¼•ç”¨ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> ida_funcs.is_func_tail(fn)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ‰€å±å‡½æ•°: %08X&quot;</span> % fn.owner)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥å°¾å—è¢« %d ä¸ªå‡½æ•°å¼•ç”¨&quot;</span> % fn.refqty)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(fn.refqty):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  å¼•ç”¨è€… %i: %08X&quot;</span> % (i, fn.referers[i]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_func_info</span>(<span class="params">ea</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°æŒ‡å®šåœ°å€æ‰€åœ¨çš„å‡½æ•°ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    pfn = ida_funcs.get_fchunk(ea)</span><br><span class="line">    <span class="keyword">if</span> pfn <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¯¥åœ°å€ %08X å¤„æ²¡æœ‰å‡½æ•°ï¼&quot;</span> % ea)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å½“å‰ä»£ç å—èŒƒå›´: %08X..%08X&quot;</span> % (pfn.start_ea, pfn.end_ea))</span><br><span class="line">    dump_flags(pfn)</span><br><span class="line">    <span class="keyword">if</span> ida_funcs.is_func_entry(pfn):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªå…¥å£ä»£ç å—&quot;</span>)</span><br><span class="line">        dump_tails(pfn)</span><br><span class="line">        dump_frame(pfn)</span><br><span class="line">        dump_regvars(pfn)</span><br><span class="line">        dump_regargs(pfn)</span><br><span class="line">        dump_stkpnts(pfn)</span><br><span class="line">    <span class="keyword">elif</span> ida_funcs.is_func_tail(pfn):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªå°¾ä»£ç å—&quot;</span>)</span><br><span class="line">        dump_parents(pfn)</span><br><span class="line"></span><br><span class="line">ea = ida_kernwin.get_screen_ea()</span><br><span class="line">dump_func_info(ea)</span><br></pre></td></tr></table></figure><h2 id="å‘ç°æœ‰å‡½æ•°å¸§æ·»åŠ æ–°æˆå‘˜"><a href="#å‘ç°æœ‰å‡½æ•°å¸§æ·»åŠ æ–°æˆå‘˜" class="headerlink" title="å‘ç°æœ‰å‡½æ•°å¸§æ·»åŠ æ–°æˆå‘˜"></a><strong>å‘ç°æœ‰å‡½æ•°å¸§æ·»åŠ æ–°æˆå‘˜</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_funcs</span><br><span class="line"><span class="keyword">import</span> ida_frame</span><br><span class="line"><span class="keyword">import</span> ida_typeinf</span><br><span class="line"><span class="keyword">import</span> ida_range</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_frame_member</span>(<span class="params">func_ea</span>):</span><br><span class="line">    name = <span class="string">&quot;my_stkvar&quot;</span></span><br><span class="line"></span><br><span class="line">    tif = ida_typeinf.tinfo_t(ida_typeinf.BTF_UINT64) </span><br><span class="line">    <span class="comment">#åˆ›å»ºäº†ä¸€ä¸ª 64 ä½æ•´æ•° (uint64_t) çš„ tinfo_t ç±»å‹å¯¹è±¡ã€‚</span></span><br><span class="line">    tif.create_ptr(tif)</span><br><span class="line">    <span class="comment"># å°†å…¶è½¬æ¢ä¸ºæŒ‡é’ˆç±»å‹ï¼Œå³ uint64_t*ã€‚</span></span><br><span class="line">    </span><br><span class="line">    func = ida_funcs.get_func(func_ea)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> func:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Failed to get function!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Function @ <span class="subst">&#123;func.start_ea:x&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    frame_tif = ida_typeinf.tinfo_t()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ida_frame.get_func_frame(frame_tif, func):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Failed to get frame!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;frame_tif._<span class="built_in">print</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    rs = ida_range.rangeset_t()</span><br><span class="line">    sp_offset = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> frame_tif.calc_gaps(rs):</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">range</span> <span class="keyword">in</span> rs:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">range</span>.start_ea &lt;= <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> (<span class="built_in">range</span>.end_ea - <span class="built_in">range</span>.start_ea) &gt;= tif.get_size():</span><br><span class="line">                sp_offset = <span class="built_in">range</span>.start_ea</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Range [<span class="subst">&#123;<span class="built_in">range</span>.start_ea:x&#125;</span>, <span class="subst">&#123;<span class="built_in">range</span>.end_ea:x&#125;</span>[ selected.&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> sp_offset &gt; <span class="number">0</span>:</span><br><span class="line">        sval = ida_frame.calc_frame_offset(func, sp_offset, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># è®¡ç®—åœ¨IDA æ ˆå¸§ç»“æ„ä¸­çš„åç§»é‡</span></span><br><span class="line">        <span class="keyword">if</span> ida_frame.add_frame_member(func, name, sval, tif):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Frame member added at frame offset <span class="subst">&#123;sval&#125;</span>!&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Failed adding frame member&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Could not find gaps in current frame...&quot;</span>)</span><br><span class="line"></span><br><span class="line">add_frame_member(idc.here())</span><br></pre></td></tr></table></figure><h1 id="å¸¸ç”¨API"><a href="#å¸¸ç”¨API" class="headerlink" title="å¸¸ç”¨API"></a>å¸¸ç”¨API</h1><p><code>idaapi.MinEA()</code>ï¼šè·å–è½½å…¥ç¨‹åºçš„æœ€å°çš„æœ‰æ•ˆåœ°å€ã€‚</p><p><code>idaapi.MaxEA()</code>ï¼šè·å–è½½å…¥çš„ç¨‹åºæœ€å¤§çš„æœ‰æ•ˆåœ°å€ã€‚</p><p><code>idaapi.Assemble(head, line)</code>ï¼šä»headåœ°å€å¼€å§‹åæ±‡ç¼–ï¼Œå¯»æ‰¾ç›´åˆ°é‡åˆ°lineè¿™æ¡æŒ‡ä»¤æ—¶åœæ­¢ï¼Œè¿”å›ä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªè¡¨ç¤ºæ˜¯å¦æˆåŠŸï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æœ€åè¿™æ¡lineæŒ‡ä»¤çš„å­—èŠ‚è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼š<code>ret</code>å°±ä¼šæ˜¯<code>&#39;\xc3&#39;</code>è¿™ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œæœ‰äº›æŒ‡ä»¤å¯èƒ½ç”±å¤šä¸ªå­—èŠ‚è¡¨ç¤ºã€‚</p><p><code>idaapi.GetMnem(addr)</code>ï¼šè·å–addråœ°å€å¤„çš„æŒ‡ä»¤ã€‚</p><p><code>idaapi.MakeCode(addr)</code>ï¼šä»addråœ°å€å¼€å§‹å°è¯•å°†æ•°æ®è½¬æ¢ä¸ºæ±‡ç¼–ä»£ç ã€‚</p><p><code>idaapi.next_not_tail(addr)</code>ï¼šå¾€ä¸‹èµ°ä¸€ä¸ªæŒ‡ä»¤ï¼Œå¦‚æœä¸æ˜¯å°¾éƒ¨ï¼Œåˆ™è¿”å›ä¸‹ä¸€æ¡æŒ‡ä»¤çš„èµ·å§‹åœ°å€ã€‚</p><p><code>idaapi.GetDisasm(addr)</code>ï¼šè·å–addråœ°å€å¼€å§‹çš„ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤ã€‚</p><p><code>idaapi.GetFlags(addr)</code>ï¼šè·å–addråœ°å€å¤„çš„ä¸€ç³»åˆ—æ ‡å¿—ä½ï¼Œå¯ç”¨æ¥<em>åˆ¤æ–­å±äºcodeè¿˜æ˜¯data</em>ã€‚</p><p><code>idaapi.isCode(Flags)</code>ï¼šé€šè¿‡Flagsåˆ¤æ–­æ˜¯å¦æ˜¯æ±‡ç¼–ä»£ç ã€‚</p><p><code>idaapi.MakeUnkn(addr, size)</code>ï¼šå–æ¶ˆå¯¹addråœ°å€å¤„çš„sizeå¤§å°çš„å®šä¹‰ï¼Œæš‚ä¸æ¸…æ¥šè¯¥åœ°å€æ˜¯ä»£ç è¿˜æ˜¯æ•°æ®æ—¶å¯ä»¥ä½¿ç”¨ã€‚</p><p><code>idaapi.GetOpnd(addr, index)</code>ï¼šå–addråœ°å€å¤„çš„æŒ‡ä»¤çš„ç¬¬indexä¸ªæ“ä½œæ•°ï¼Œä»é›¶å¼€å§‹ï¼Œä»å·¦å¼€å§‹ï¼Œä¾æ¬¡ä¸ºintelæ±‡ç¼–è¯­æ³•ä¸­çš„ç›®çš„æ“ä½œæ•°ã€æºæ“ä½œæ•°ã€‚</p><p><code>idaapi.get_name_ea(min_ea, name)</code>ï¼šä»min_eaåœ°å€å¼€å§‹ï¼Œå¯»æ‰¾åä¸ºnameçš„æœ‰æ•ˆåœ°å€ï¼Œè¯¥nameå¯ä»¥ä¸ºå‡½æ•°åã€labelåã€‚</p><p><code>idaapi.get_dword(addr)</code>ï¼šä»addråœ°å€å¤„è·å–ä¸€ä¸ªdwordæ•°æ®ã€‚</p><p><code>idaapi.MakeDword(addr)</code>ï¼šå°†addrå¼€å§‹çš„ä¸€ä¸ªDWORDå¤§å°çš„æ•°æ®å®šä¹‰ä¸ºåŒå­—å½¢å¼ï¼Œä¸¾ä¸€åä¸‰ï¼ŒQä»£è¡¨å››å­—èŠ‚æ•°æ®ï¼ŒAPIå½¢å¼ä¸€è‡´ã€‚</p><p><code>idaapi.Segname(addr)</code>ï¼šå¾—åˆ°addråœ°å€æ‰€å¤„çš„åŒºæ®µåã€‚</p><p><code>idaapi.MakeFunction(addr)</code>ï¼šå°†addråœ°å€å¤„å®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œç›¸å½“äºå¿«æ·é”®Pã€‚</p><p>BADADDR: å¸¸é‡ï¼Œä»£è¡¨é”™è¯¯çš„åœ°å€ã€‚</p><p><code>idaapi.GetSpd(addr)</code>ï¼šè·å–addråœ°å€å¤„çš„æ ˆæŒ‡é’ˆSPçš„å€¼ï¼Œè€Œåœ¨IDAä¸­æ˜¾ç¤ºçš„å€¼åˆ™æ˜¯SPåˆ°BPåŸºå€é’ˆçš„å·®å€¼ï¼Œä¾‹å¦‚è·å–åˆ°çš„å€¼ä¸º-4ï¼Œåœ¨IDAä¸­æ˜¾ç¤ºæ ˆæŒ‡é’ˆçš„æƒ…å†µæ—¶åˆ™ä¸º4ã€‚</p><p><code>idaapi.SetSpDiff(addr, diff)</code>ï¼šè®¾ç½®addråœ°å€å¤„çš„SpæŒ‡é’ˆä¸BpæŒ‡é’ˆçš„å·®å€¼ï¼Œåœ¨å¹³è¡¡å †æ ˆæ—¶éœ€è¦ç”¨åˆ°ã€‚</p><p><code>idaapi.next_head(head, BADADDR)</code>ï¼šéå†ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œé™¤éé‡åˆ°BADADDRï¼Œè¿”å›ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</p><p><code>idaapi.ua_mnem(addr)</code>ï¼šè¿”å›addråœ°å€å¤„çš„æŒ‡ä»¤ç±»å‹ã€‚</p><p><code>idaapi.MakeName(addr, &#39;&#39;)</code>ï¼šç»™addråœ°å€å¤„ä¸€ä¸ªæ ‡è®°labelã€‚</p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDA, Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆè¯†TCP</title>
      <link href="/2024/12/27/%E5%88%9D%E8%AF%86TCP/"/>
      <url>/2024/12/27/%E5%88%9D%E8%AF%86TCP/</url>
      
        <content type="html"><![CDATA[<h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><h3 id="ä¸€ã€TCPç‰¹ç‚¹"><a href="#ä¸€ã€TCPç‰¹ç‚¹" class="headerlink" title="ä¸€ã€TCPç‰¹ç‚¹"></a>ä¸€ã€TCPç‰¹ç‚¹</h3><ol><li><p>é¢å‘è¿æ¥çš„åè®®ï¼Œåœ¨ä¼ è¾“æ•°æ®å‰éœ€è¦å»ºç«‹ä¸€æ¡å¯é è¿æ¥</p></li><li><p>æµå¼åè®®ï¼ŒTCPå°†æ•°æ®çœ‹ä½œå­—èŠ‚æµã€‚ä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®æ˜¯å¯ä»¥è¢«åˆ†å‰²ä¸ºå¤šä¸ªæ•°æ®åŒ…åœ¨æ¥æ”¶ç«¯é‡æ–°ç»„è£…çš„ã€‚</p></li><li><p>TCPé€šè¿‡æ ¡éªŒå’Œ\åºåˆ—å·å’Œç¡®è®¤åº”ç­”æ¥ç¡®ä¿æ•°æ®çš„å¯é ä¼ è¾“ï¼Œå‡ºé”™å›é‡æ–°ä¼ è¾“ã€‚</p></li><li><p>æœåŠ¡å™¨è¢«åŠ¨è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨è¿æ¥ã€‚</p></li></ol><h3 id="äºŒã€TCPç¼–ç¨‹"><a href="#äºŒã€TCPç¼–ç¨‹" class="headerlink" title="äºŒã€TCPç¼–ç¨‹"></a>äºŒã€TCPç¼–ç¨‹</h3><h4 id="serverç«¯"><a href="#serverç«¯" class="headerlink" title="serverç«¯"></a>serverç«¯</h4><h5 id="1-åˆ›å»ºå¥—æ¥å­—socket"><a href="#1-åˆ›å»ºå¥—æ¥å­—socket" class="headerlink" title="1.åˆ›å»ºå¥—æ¥å­—socket()"></a>1.åˆ›å»ºå¥—æ¥å­—socket()</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">socket</span><span class="params">(<span class="type">int</span> domain, <span class="type">int</span> type, <span class="type">int</span> protocol)</span>;</span><br><span class="line"> </span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    domainï¼šé€šä¿¡åŸŸï¼Œåè®®æ—</span><br><span class="line">      AF_UNIX æœ¬åœ°é€šä¿¡</span><br><span class="line">      AF_INET ipv4ç½‘ç»œåè®®</span><br><span class="line">      AF_INET6 ipv6ç½‘ç»œåè®®</span><br><span class="line">      AF_PACKET åº•å±‚æ¥å£</span><br><span class="line">    typeï¼šå¥—æ¥å­—çš„ç±»å‹</span><br><span class="line">      SOCK_STREAM æµå¼å¥—æ¥å­—ï¼ˆtcpï¼‰</span><br><span class="line">      SOCK_DGRAM æ•°æ®æŠ¥å¥—æ¥å­—ï¼ˆudpï¼‰</span><br><span class="line">      SOCK_RAW åŸå§‹å¥—æ¥å­—ï¼ˆç”¨äºé“¾è·¯å±‚ï¼‰</span><br><span class="line">    protocolï¼šé™„åŠ åè®®ï¼Œå¦‚æœä¸éœ€è¦ï¼Œåˆ™è®¾ç½®ä¸º<span class="number">0</span></span><br><span class="line"> </span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼šæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">    å¤±è´¥ï¼šâ€<span class="number">1</span></span><br></pre></td></tr></table></figure><h5 id="2-ç»‘å®šå¥—æ¥å­—bind"><a href="#2-ç»‘å®šå¥—æ¥å­—bind" class="headerlink" title="2.ç»‘å®šå¥—æ¥å­—bind()"></a>2.ç»‘å®šå¥—æ¥å­—bind()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line"> </span><br><span class="line">#include &lt;sys/socket.h&gt;</span><br><span class="line">int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);</span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    å°†å¥—æ¥å­—ä¸ç½‘ç»œä¿¡æ¯ç»“æ„ä½“ç»‘å®š</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œsocketçš„è¿”å›å€¼</span><br><span class="line">    addrï¼šç½‘ç»œä¿¡æ¯ç»“æ„ä½“</span><br><span class="line">      é€šç”¨ç»“æ„ä½“ï¼ˆä¸€èˆ¬ä¸ç”¨ï¼‰</span><br><span class="line">      struct sockaddr</span><br><span class="line">      ç½‘ç»œä¿¡æ¯ç»“æ„ä½“ sockaddr_in</span><br><span class="line">#include &lt;netinet/in.h&gt;</span><br><span class="line">struct sockaddr_in</span><br><span class="line">addrlenï¼š</span><br><span class="line">    addrçš„é•¿åº¦</span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼š0</span><br><span class="line">    å¤±è´¥ï¼š-1</span><br></pre></td></tr></table></figure><h5 id="3-ç›‘å¬å¥—æ¥å­—listen"><a href="#3-ç›‘å¬å¥—æ¥å­—listen" class="headerlink" title="3.ç›‘å¬å¥—æ¥å­—listen()"></a>3.ç›‘å¬å¥—æ¥å­—listen()</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span> <span class="comment">/* See NOTES */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">listen</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> backlog)</span>;</span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    å°†å¥—æ¥å­—è®¾ç½®ä¸ºè¢«åŠ¨ç›‘å¬çŠ¶æ€ï¼Œè¿™æ ·åšä¹‹åå°±å¯ä»¥æ¥æ”¶åˆ°è¿æ¥è¯·æ±‚</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œsocketå‡½æ•°è¿”å›å€¼</span><br><span class="line">    backlogï¼šå…è®¸é€šä¿¡è¿æ¥çš„ä¸»æœºä¸ªæ•°ï¼Œä¸€èˆ¬è®¾ç½®ä¸º<span class="number">5</span>ã€<span class="number">10</span></span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼š<span class="number">0</span></span><br><span class="line">    å¤±è´¥ï¼š<span class="number">-1</span></span><br></pre></td></tr></table></figure><h5 id="4-æ¥æ”¶è¿æ¥accept"><a href="#4-æ¥æ”¶è¿æ¥accept" class="headerlink" title="4.æ¥æ”¶è¿æ¥accept()"></a>4.æ¥æ”¶è¿æ¥accept()</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span> <span class="comment">/* See NOTES */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">accept</span><span class="params">(<span class="type">int</span> sockfd, <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> *addrlen)</span>;</span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œsocketå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">    addrï¼šæ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯çš„ä¿¡æ¯ç»“æ„ä½“ï¼ˆè‡ªåŠ¨å¡«å……ï¼Œå®šä¹‰å˜é‡å³å¯ï¼‰</span><br><span class="line">    addrlenï¼šaddrçš„é•¿åº¦</span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼šæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆåªè¦æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±ä¼šäº§ç”Ÿæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ä¸“é—¨ä¸æŒ‡å®šçš„å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡çš„ï¼‰</span><br><span class="line">    å¤±è´¥ï¼š<span class="number">-1</span></span><br></pre></td></tr></table></figure><h5 id="5-é€šä¿¡recv-send"><a href="#5-é€šä¿¡recv-send" class="headerlink" title="5.é€šä¿¡recv()/send()"></a>5.é€šä¿¡recv()/send()</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">recv</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags)</span>;</span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    æ¥æ”¶æ•°æ®</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">å®¢æˆ·ç«¯ï¼šsocketå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">æœåŠ¡å™¨ï¼šacceptå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">    bufï¼šä¿å­˜æ¥æ”¶åˆ°çš„æ•°æ®</span><br><span class="line">    lenï¼šbufçš„é•¿åº¦</span><br><span class="line">    flagsï¼šæ ‡å¿—ä½</span><br><span class="line">      <span class="number">0</span> é˜»å¡</span><br><span class="line">      MSG_DONTWAIT éé˜»å¡</span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼šæ¥æ”¶çš„å­—èŠ‚æ•°</span><br><span class="line">    å¤±è´¥ï¼š<span class="number">-1</span></span><br><span class="line">å¦‚æœå‘é€ç«¯å…³é—­æ–‡ä»¶æè¿°ç¬¦æˆ–è€…å…³é—­è¿›ç¨‹ï¼Œåˆ™recvå‡½æ•°ä¼šè¿”å›<span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">send</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags)</span>;</span><br><span class="line"> </span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    å‘é€æ•°æ®</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line"> </span><br><span class="line">å®¢æˆ·ç«¯ï¼š</span><br><span class="line">    socketå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">æœåŠ¡å™¨ï¼š</span><br><span class="line">    acceptå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line"> </span><br><span class="line">     bufï¼šå‘é€çš„æ•°æ®</span><br><span class="line">     lenï¼šbufçš„é•¿åº¦</span><br><span class="line">     flagsï¼šæ ‡å¿—ä½</span><br><span class="line">       <span class="number">0</span> é˜»å¡</span><br><span class="line">       MSG_DONTWAIT éé˜»å¡</span><br><span class="line"> </span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼šå‘é€çš„å­—èŠ‚æ•°</span><br><span class="line">    å¤±è´¥ï¼š<span class="number">-1</span></span><br></pre></td></tr></table></figure><h5 id="6-å…³é—­å¥—æ¥å­—"><a href="#6-å…³é—­å¥—æ¥å­—" class="headerlink" title="6.å…³é—­å¥—æ¥å­—()"></a>6.å…³é—­å¥—æ¥å­—()</h5><h4 id="clientç«¯"><a href="#clientç«¯" class="headerlink" title="clientç«¯"></a>clientç«¯</h4><h5 id="1-socket"><a href="#1-socket" class="headerlink" title="1.socket()"></a>1.socket()</h5><h5 id="2-connect"><a href="#2-connect" class="headerlink" title="2.connect()"></a>2.connect()</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span> <span class="comment">/* See NOTES */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">connect</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> addrlen)</span>;</span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    ç»™æœåŠ¡å™¨å‘é€å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œsocketå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">    addrï¼šè¦è¿æ¥çš„æœåŠ¡å™¨çš„ç½‘ç»œä¿¡æ¯ç»“æ„ä½“ï¼ˆéœ€è¦è‡ªå·±è®¾ç½®ï¼‰</span><br><span class="line">    addrlenï¼šaddçš„é•¿åº¦</span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼š<span class="number">0</span></span><br><span class="line">    å¤±è´¥ï¼š<span class="number">-1</span></span><br></pre></td></tr></table></figure><h5 id="3-send-recv"><a href="#3-send-recv" class="headerlink" title="3.send()/recv()"></a>3.send()/recv()</h5><h5 id="4-close"><a href="#4-close" class="headerlink" title="4.close()"></a>4.close()</h5><h3 id="ä¸‰ã€OSIæ¨¡å‹"><a href="#ä¸‰ã€OSIæ¨¡å‹" class="headerlink" title="ä¸‰ã€OSIæ¨¡å‹"></a>ä¸‰ã€OSIæ¨¡å‹</h3><div class="table-container"><table><thead><tr><th>åº”ç”¨å±‚</th><th>HTTPã€SMTPã€SNMPã€FTPã€Telnetã€SIPã€SSHã€NFSã€RTSPã€XMPPã€Whoisã€ENRPã€ç­‰ç­‰</th></tr></thead><tbody><tr><td>è¡¨ç¤ºå±‚</td><td>XDRã€ASN.1ã€SMBã€AFPã€NCPã€ç­‰ç­‰</td></tr><tr><td>ä¼šè¯å±‚</td><td>ASAPã€SSHã€RPCã€NetBIOSã€ASPã€Winsockã€BSD Socketsã€ç­‰ç­‰</td></tr><tr><td>ä¼ è¾“å±‚</td><td>TCPã€UDPã€TLSã€RTPã€SCTPã€SPXã€ATPã€ILã€ç­‰ç­‰</td></tr><tr><td>ç½‘ç»œå±‚</td><td>IPã€ICMPã€IGMPã€IPXã€BGPã€OSPFã€RIPã€IGRPã€EIGRPã€ARPã€RARPã€X.25ã€ç­‰ç­‰</td></tr><tr><td>æ•°æ®é“¾è·¯å±‚</td><td>ä»¥å¤ªç½‘ã€ä»¤ç‰Œç¯ã€HDLCã€å¸§ä¸­ç»§ã€ISDNã€ATMã€IEEE 802.11ã€FDDIã€PPPã€ç­‰ç­‰</td></tr><tr><td>ç‰©ç†å±‚</td><td>ä¾‹å¦‚é“œç¼†ã€ç½‘çº¿ã€å…‰ç¼†ã€æ— çº¿ç”µç­‰ç­‰</td></tr></tbody></table></div><p><img src="C:\Users\zmycm\AppData\Roaming\Typora\typora-user-images\image-20241124204619077.png" alt="image-20241124204619077"></p><h2 id="DTLS"><a href="#DTLS" class="headerlink" title="DTLS"></a>DTLS</h2><h3 id="1-1DTLSç‰¹ç‚¹ä½œç”¨"><a href="#1-1DTLSç‰¹ç‚¹ä½œç”¨" class="headerlink" title="1.1DTLSç‰¹ç‚¹ä½œç”¨"></a>1.1DTLSç‰¹ç‚¹ä½œç”¨</h3><p><strong>DTLS</strong>: æ˜¯ä¸€ç§é¢å‘<strong>æ— è¿æ¥</strong>çš„åè®®ï¼Œ<strong>åŸºäº UDP</strong>ï¼Œ<strong>ä½œç”¨</strong>ä¸ºç»™UDPæä¾›ç«¯åˆ°ç«¯çš„å®‰å…¨é€šé“ï¼Œå°±åƒSSL/TLSå¯¹TCPçš„ä½œç”¨ä¸€æ ·ã€‚</p><p>SSL/TLSåè®®æ˜¯åŸºäºTCP socketï¼Œåˆ©ç”¨åŠ å¯†ã€åŸºäºæ•°å­—è¯ä¹¦çš„èº«ä»½éªŒè¯ç­‰æœºåˆ¶åœ¨ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ä¹‹é—´æ„å»ºäº†ä¸€ä¸ªç«¯åˆ°ç«¯çš„å®‰å…¨é€šé“ï¼Œä¿è¯äº†ä¼ è¾“æ•°æ®çš„åŠ å¯†æ€§ã€‚</p><p>æ²¡ç”¨åˆ°ï¼Œç”¨åˆ°å†æ¥è¡¥å……</p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TCP </tag>
            
            <tag> ç½‘ç»œåè®® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>X86æ±‡ç¼–&amp;å†…è”æ±‡ç¼–</title>
      <link href="/2024/12/27/X86%E6%B1%87%E7%BC%96and%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96/"/>
      <url>/2024/12/27/X86%E6%B1%87%E7%BC%96and%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96/</url>
      
        <content type="html"><![CDATA[<h2 id="X86æ±‡ç¼–å­¦ä¹ "><a href="#X86æ±‡ç¼–å­¦ä¹ " class="headerlink" title="X86æ±‡ç¼–å­¦ä¹ "></a>X86æ±‡ç¼–å­¦ä¹ </h2><h3 id="ä¸€ã€åŸºç¡€çŸ¥è¯†"><a href="#ä¸€ã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="ä¸€ã€åŸºç¡€çŸ¥è¯†"></a>ä¸€ã€åŸºç¡€çŸ¥è¯†</h3><h4 id="1-CPU"><a href="#1-CPU" class="headerlink" title="1.CPU"></a>1.CPU</h4><p>CPUæ§åˆ¶æ•´ä¸ªè®¡ç®—æœºè¿ä½œå’Œè¿ç®—ã€‚è¦æƒ³è®©CPUå·¥ä½œï¼Œå°±éœ€è¦å‘å®ƒæä¾›<strong>æŒ‡ä»¤</strong>å’Œ<strong>æ•°æ®</strong>ã€‚</p><h4 id="2-æŒ‡ä»¤"><a href="#2-æŒ‡ä»¤" class="headerlink" title="2.æŒ‡ä»¤"></a>2.æŒ‡ä»¤</h4><h5 id="ï¼ˆ1ï¼‰-æ±‡ç¼–æŒ‡ä»¤"><a href="#ï¼ˆ1ï¼‰-æ±‡ç¼–æŒ‡ä»¤" class="headerlink" title="ï¼ˆ1ï¼‰.æ±‡ç¼–æŒ‡ä»¤"></a>ï¼ˆ1ï¼‰.æ±‡ç¼–æŒ‡ä»¤</h5><p>ç›´æ¥è¢«CPUæ‰§è¡Œçš„æŒ‡ä»¤</p><h5 id="ï¼ˆ2ï¼‰-ä¼ªæŒ‡ä»¤"><a href="#ï¼ˆ2ï¼‰-ä¼ªæŒ‡ä»¤" class="headerlink" title="ï¼ˆ2ï¼‰.ä¼ªæŒ‡ä»¤"></a>ï¼ˆ2ï¼‰.ä¼ªæŒ‡ä»¤</h5><p>æŒ‡å¯¼æ±‡ç¼–å™¨å·¥ä½œçš„æŒ‡ä»¤ï¼Œä¸ç”Ÿæˆæœºæ¢°ç ã€‚</p><ul><li>æ®µå®šä¹‰æŒ‡ä»¤ï¼šå¦‚SEGMENTã€ENDSï¼Œç”¨äºå®šä¹‰å’Œç»“æŸä¸€ä¸ªæ®µã€‚</li><li>æ•°æ®å®šä¹‰æŒ‡ä»¤ï¼šå¦‚DBã€DWï¼Œç”¨äºå®šä¹‰å­—èŠ‚æˆ–å­—æ•°æ®ã€‚</li><li>å¸¸é‡å®šä¹‰æŒ‡ä»¤ï¼šå¦‚EQUï¼Œç”¨äºå®šä¹‰å¸¸é‡ã€‚</li></ul><h5 id="3-ç¬¦å·æŒ‡ä»¤"><a href="#3-ç¬¦å·æŒ‡ä»¤" class="headerlink" title="(3).ç¬¦å·æŒ‡ä»¤"></a>(3).ç¬¦å·æŒ‡ä»¤</h5><p>ç”¨äºæ ‡è¯†å˜é‡ã€å¸¸é‡ã€ä»£ç æ®µç­‰ï¼Œåœ¨æ±‡ç¼–è¿‡ç¨‹ä¸­è¢«æ›¿æ¢ä¸ºå…·ä½“çš„åœ°å€æˆ–å€¼ã€‚å®ƒä»¬æ²¡æœ‰å¯¹åº”çš„æœºå™¨ç ã€‚</p><ul><li><p><strong>æ ‡ç­¾</strong>ï¼šç”¨äºæ ‡è¯†ä»£ç ä¸­çš„ä½ç½®ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">LABEL</span>: ; å®šä¹‰ä¸€ä¸ªæ ‡ç­¾<span class="selector-tag">LABEL</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å®å®šä¹‰</strong>ï¼šå¦‚<code>MACRO</code>ï¼Œç”¨äºå®šä¹‰å®ï¼Œç®€åŒ–ä»£ç ç¼–å†™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MYMACRO MACRO ; å®å®šä¹‰å†…å®¹ ENDM</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™"><a href="#3-CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™" class="headerlink" title="3.CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™"></a>3.CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™</h4><ol><li>å­˜å‚¨å•å…ƒçš„åœ°å€</li><li>æ§åˆ¶ä¿¡æ¯</li><li>è¯»æˆ–è€…å†™çš„æ•°æ®</li></ol><h4 id="4-åœ°å€æ€»çº¿"><a href="#4-åœ°å€æ€»çº¿" class="headerlink" title="4.åœ°å€æ€»çº¿"></a>4.åœ°å€æ€»çº¿</h4><p>CPUé€šè¿‡åœ°å€æ€»çº¿æ¥<strong>æŒ‡å®šå­˜å‚¨å™¨å•å…ƒ</strong>ã€‚</p><p>ä¸€ä¸ªCPUæœ‰Næ ¹åœ°å€çº¿ï¼Œåˆ™å®ƒçš„åœ°å€æ€»çº¿å®½åº¦ä¸ºNï¼Œæœ€å¤šå¯ä»¥å¯»æ‰¾2çš„Næ¬¡æ–¹ç»™å†…å­˜å•å…ƒã€‚</p><p>CPUé€šè¿‡åœ°å€æ€»çº¿ä¼ å…¥å­˜å‚¨å™¨çš„å¿…é¡»æ˜¯ä¸€ä¸ªå†…å­˜å•å…ƒçš„<strong>ç‰©ç†åœ°å€</strong>ã€‚</p><h4 id="5-æ•°æ®æ€»çº¿"><a href="#5-æ•°æ®æ€»çº¿" class="headerlink" title="5.æ•°æ®æ€»çº¿"></a>5.æ•°æ®æ€»çº¿</h4><p>CPUä¸å†…å­˜æˆ–å…¶ä»–å™¨ä»¶ä¹‹é—´<strong>æ•°æ®ä¼ é€</strong>æ˜¯é€šè¿‡æ•°æ®æ€»çº¿è¿›è¡Œçš„ã€‚</p><h4 id="6-æ§åˆ¶æ€»çº¿"><a href="#6-æ§åˆ¶æ€»çº¿" class="headerlink" title="6.æ§åˆ¶æ€»çº¿"></a>6.æ§åˆ¶æ€»çº¿</h4><p>CPU<strong>å¯¹å¤–éƒ¨å™¨ä»¶çš„æ§åˆ¶</strong>æ˜¯é€šè¿‡æ§åˆ¶æ€»çº¿è¿›è¡Œçš„ã€‚</p><h4 id="7-å†…å­˜åœ°å€ç©ºé—´"><a href="#7-å†…å­˜åœ°å€ç©ºé—´" class="headerlink" title="7.å†…å­˜åœ°å€ç©ºé—´"></a>7.å†…å­˜åœ°å€ç©ºé—´</h4><p>8086CPUåœ°å€æ€»çº¿å®½åº¦ä¸º20ï¼Œå¯ä»¥å®šä½2çš„20æ¬¡æ–¹ä¸ªå†…å­˜å•å…ƒï¼Œé‚£ä¹ˆå†…å­˜åœ°å€ç©ºé—´ä¸º1MBã€‚</p><h3 id="äºŒã€å¯„å­˜å™¨"><a href="#äºŒã€å¯„å­˜å™¨" class="headerlink" title="äºŒã€å¯„å­˜å™¨"></a>äºŒã€å¯„å­˜å™¨</h3><h4 id="ï¼ˆä¸€ï¼‰ã€é€šç”¨å¯„å­˜å™¨"><a href="#ï¼ˆä¸€ï¼‰ã€é€šç”¨å¯„å­˜å™¨" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€é€šç”¨å¯„å­˜å™¨"></a>ï¼ˆä¸€ï¼‰ã€é€šç”¨å¯„å­˜å™¨</h4><h5 id="1-æ•°æ®å¯„å­˜å™¨"><a href="#1-æ•°æ®å¯„å­˜å™¨" class="headerlink" title="1.æ•°æ®å¯„å­˜å™¨"></a>1.æ•°æ®å¯„å­˜å™¨</h5><h6 id="ï¼ˆ1ï¼‰ä½œä¸ºå®Œæ•´çš„32ä½æ•°æ®å¯„å­˜å™¨"><a href="#ï¼ˆ1ï¼‰ä½œä¸ºå®Œæ•´çš„32ä½æ•°æ®å¯„å­˜å™¨" class="headerlink" title="ï¼ˆ1ï¼‰ä½œä¸ºå®Œæ•´çš„32ä½æ•°æ®å¯„å­˜å™¨"></a>ï¼ˆ1ï¼‰ä½œä¸ºå®Œæ•´çš„32ä½æ•°æ®å¯„å­˜å™¨</h6><ul><li>EAXï¼ŒEBXï¼ŒECXï¼ŒEDX</li></ul><h6 id="ï¼ˆ2ï¼‰ä¸‹åŠéƒ¨åˆ†ä½œä¸º16ä½å¯„å­˜å™¨"><a href="#ï¼ˆ2ï¼‰ä¸‹åŠéƒ¨åˆ†ä½œä¸º16ä½å¯„å­˜å™¨" class="headerlink" title="ï¼ˆ2ï¼‰ä¸‹åŠéƒ¨åˆ†ä½œä¸º16ä½å¯„å­˜å™¨"></a>ï¼ˆ2ï¼‰ä¸‹åŠéƒ¨åˆ†ä½œä¸º16ä½å¯„å­˜å™¨</h6><ul><li>AXï¼šç´¯åŠ å™¨</li><li>BXï¼šåŸºå€å¯„å­˜å™¨</li><li>CXï¼šè®¡æ•°å¯„å­˜å™¨</li><li>DXï¼šæ•°æ®å¯„å­˜å™¨</li></ul><h6 id="ï¼ˆ3ï¼‰16ä½å¯„å­˜å™¨çš„ä¸‹åŠéƒ¨åˆ†å’Œä¸ŠåŠéƒ¨åˆ†å†ä½œä¸º8ä½å¯„å­˜å™¨"><a href="#ï¼ˆ3ï¼‰16ä½å¯„å­˜å™¨çš„ä¸‹åŠéƒ¨åˆ†å’Œä¸ŠåŠéƒ¨åˆ†å†ä½œä¸º8ä½å¯„å­˜å™¨" class="headerlink" title="ï¼ˆ3ï¼‰16ä½å¯„å­˜å™¨çš„ä¸‹åŠéƒ¨åˆ†å’Œä¸ŠåŠéƒ¨åˆ†å†ä½œä¸º8ä½å¯„å­˜å™¨"></a>ï¼ˆ3ï¼‰16ä½å¯„å­˜å™¨çš„ä¸‹åŠéƒ¨åˆ†å’Œä¸ŠåŠéƒ¨åˆ†å†ä½œä¸º8ä½å¯„å­˜å™¨</h6><ul><li>AH,AL,BLH,BL</li><li>CH,CL,DH,DL</li></ul><h5 id="2-æŒ‡é’ˆå¯„å­˜å™¨"><a href="#2-æŒ‡é’ˆå¯„å­˜å™¨" class="headerlink" title="2.æŒ‡é’ˆå¯„å­˜å™¨"></a>2.æŒ‡é’ˆå¯„å­˜å™¨</h5><ul><li>æŒ‡ä»¤æŒ‡é’ˆï¼ˆIPï¼‰</li><li>å †æ ˆæŒ‡é’ˆï¼ˆSPï¼‰</li><li>åŸºæœ¬æŒ‡é’ˆï¼ˆBPï¼‰</li></ul><h5 id="3-ç´¢å¼•å¯„å­˜å™¨"><a href="#3-ç´¢å¼•å¯„å­˜å™¨" class="headerlink" title="3.ç´¢å¼•å¯„å­˜å™¨"></a>3.ç´¢å¼•å¯„å­˜å™¨</h5><ul><li>æºç´¢å¼•ï¼ˆSIï¼‰</li><li>DI</li></ul><h5 id="4-æ•°æ®å¯„å­˜å™¨"><a href="#4-æ•°æ®å¯„å­˜å™¨" class="headerlink" title="4.æ•°æ®å¯„å­˜å™¨"></a>4.æ•°æ®å¯„å­˜å™¨</h5><h4 id="ï¼ˆäºŒï¼‰ã€æ§åˆ¶å¯„å­˜å™¨"><a href="#ï¼ˆäºŒï¼‰ã€æ§åˆ¶å¯„å­˜å™¨" class="headerlink" title="ï¼ˆäºŒï¼‰ã€æ§åˆ¶å¯„å­˜å™¨"></a>ï¼ˆäºŒï¼‰ã€æ§åˆ¶å¯„å­˜å™¨</h4><p>å°†32ä½æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨å’Œ32ä½æ ‡å¿—å¯„å­˜å™¨ç»„åˆã€‚</p><h5 id="é€šç”¨æ ‡å¿—ä½"><a href="#é€šç”¨æ ‡å¿—ä½" class="headerlink" title="é€šç”¨æ ‡å¿—ä½"></a>é€šç”¨æ ‡å¿—ä½</h5><ul><li><strong>æº¢å‡ºæ ‡å¿—ï¼ˆOFï¼‰</strong> -<u>æœ‰ç¬¦å·</u>ç®—æœ¯è¿ç®—åæ•°æ®çš„é«˜é˜¶ä½ï¼ˆæœ€å·¦ä½ï¼‰çš„æº¢å‡ºã€‚</li><li><strong>æ–¹å‘æ ‡è®°ï¼ˆDFï¼‰</strong> -DFå€¼ä¸º0æ—¶ï¼Œå­—ç¬¦ä¸²æ“ä½œä¸ºä»å·¦è‡³å³çš„æ–¹å‘ï¼›å½“DFå€¼ä¸º1æ—¶ï¼Œå­—ç¬¦ä¸²æ“ä½œä¸ºä»å³è‡³å·¦çš„æ–¹å‘ã€‚</li><li><strong>ä¸­æ–­æ ‡å¿—ï¼ˆIFï¼‰</strong> -å½“å€¼ä¸º0æ—¶ï¼Œå®ƒç¦ç”¨å¤–éƒ¨ä¸­æ–­ï¼Œè€Œå½“å€¼ä¸º1æ—¶ï¼Œå®ƒä½¿èƒ½ä¸­æ–­ã€‚</li><li><strong>é™·é˜±æ ‡å¿—ï¼ˆTFï¼‰</strong> -å…è®¸åœ¨å•æ­¥æ¨¡å¼ä¸‹è®¾ç½®å¤„ç†å™¨çš„æ“ä½œã€‚æˆ‘ä»¬ä½¿ç”¨çš„DEBUGç¨‹åºè®¾ç½®äº†é™·é˜±æ ‡å¿—ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡é€æ­¥æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ã€‚</li><li><strong>ç¬¦å·æ ‡å¿—ï¼ˆSFï¼‰</strong> -æ­£ç»“æœå°†SFçš„å€¼æ¸…é™¤ä¸º0ï¼Œè´Ÿç»“æœå°†å…¶è®¾ç½®ä¸º1ã€‚</li><li><strong>é›¶æ ‡å¿—ï¼ˆZFï¼‰</strong> -éé›¶ç»“æœå°†é›¶æ ‡å¿—æ¸…é›¶ï¼Œé›¶ç»“æœå°†å…¶æ¸…é›¶ã€‚</li><li><strong>è¾…åŠ©è¿›ä½æ ‡å¿—ï¼ˆAFï¼‰</strong> -åŒ…å«ç»è¿‡ç®—æœ¯è¿ç®—åä»ä½3åˆ°ä½4çš„è¿›ä½ï¼›ç”¨äºä¸“ä¸šç®—æœ¯ã€‚å½“1å­—èŠ‚ç®—æœ¯è¿ç®—å¼•èµ·ä»ç¬¬3ä½åˆ°ç¬¬4ä½çš„è¿›ä½æ—¶ï¼Œå°†è®¾ç½®AFã€‚</li><li><strong>å¥‡å¶æ ¡éªŒæ ‡å¿—ï¼ˆPFï¼‰</strong> -å¶æ•°ä¸ª1ä½å°†å¥‡å¶æ ¡éªŒæ ‡å¿—æ¸…ä¸º0ï¼Œå¥‡æ•°ä¸ª1ä½å°†å¥‡å¶æ ¡éªŒæ ‡å¿—æ¸…ä¸º1ã€‚</li><li><strong>è¿›ä½æ ‡å¿—ï¼ˆCFï¼‰</strong> -åœ¨ç®—æœ¯è¿ç®—åï¼Œå®ƒåŒ…å«ä¸€ä¸ªé«˜ä½ï¼ˆæœ€å·¦è¾¹ï¼‰çš„0æˆ–1è¿›ä½ã€‚</li></ul><h4 id="ï¼ˆä¸‰ï¼‰ã€æ®µå¯„å­˜å™¨"><a href="#ï¼ˆä¸‰ï¼‰ã€æ®µå¯„å­˜å™¨" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€æ®µå¯„å­˜å™¨"></a>ï¼ˆä¸‰ï¼‰ã€æ®µå¯„å­˜å™¨</h4><ul><li><strong>CS</strong>ï¼š<u><strong>ä»£ç æ®µå¯„å­˜å™¨</strong></u>ï¼ŒåŒ…å«å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»£ç çš„æ®µåŸºå€ã€‚</li><li><strong>DS</strong>ï¼š<strong><u>æ•°æ®æ®µå¯„å­˜å™¨</u></strong>ï¼Œé€šå¸¸åŒ…å«ç¨‹åºæ­£åœ¨æ“ä½œçš„æ•°æ®çš„æ®µåŸºå€ã€‚</li><li><strong>SS</strong>ï¼š<strong><u>å †æ ˆæ®µå¯„å­˜å™¨</u></strong>ï¼ŒåŒ…å«å½“å‰å †æ ˆçš„æ®µåŸºå€ã€‚</li><li><strong>ES</strong>ï¼š<strong><u>é™„åŠ æ®µå¯„å­˜å™¨</u></strong>ï¼Œç”¨äºå­˜å‚¨å…¶ä»–æ•°æ®æ®µçš„åŸºå€ã€‚</li><li><strong>FS</strong></li><li><strong>GS</strong></li></ul><h4 id="ï¼ˆå››ï¼‰8086CPUç»™å‡ºç‰©ç†åœ°å€çš„æ–¹æ³•"><a href="#ï¼ˆå››ï¼‰8086CPUç»™å‡ºç‰©ç†åœ°å€çš„æ–¹æ³•" class="headerlink" title="ï¼ˆå››ï¼‰8086CPUç»™å‡ºç‰©ç†åœ°å€çš„æ–¹æ³•"></a>ï¼ˆå››ï¼‰8086CPUç»™å‡ºç‰©ç†åœ°å€çš„æ–¹æ³•</h4><p><strong>ç‰©ç†åœ°å€=æ®µåœ°å€x16+åç§»åœ°å€</strong></p><p>ç”¨ä¸¤ä¸ª16ä½åœ°å€ï¼ˆæ®µåœ°å€ã€åç§»åœ°å€ï¼‰åˆæˆä¸€ä¸ª20ä½ç‰©ç†åœ°å€</p><p>æ®µåœ°å€ x 16 æ˜¯åå…­è¿›åˆ¶<strong>æ®µåœ°å€æ•°æ®å·¦ç§»ä¸€ä½</strong></p><h3 id="ï¼ˆä¸‰ï¼‰ã€å†…å­˜å’Œå¯»å€"><a href="#ï¼ˆä¸‰ï¼‰ã€å†…å­˜å’Œå¯»å€" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€å†…å­˜å’Œå¯»å€"></a>ï¼ˆä¸‰ï¼‰ã€å†…å­˜å’Œå¯»å€</h3><h4 id="æ®µåˆ†å¸ƒ"><a href="#æ®µåˆ†å¸ƒ" class="headerlink" title="æ®µåˆ†å¸ƒ"></a>æ®µåˆ†å¸ƒ</h4><ul><li><strong>text</strong>: å­˜æ”¾çš„æ˜¯äºŒè¿›åˆ¶æœºå™¨ç ï¼Œç”¨äºå­˜å‚¨ç¨‹åºä¸­å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œåªè¯»</li><li><strong>.data</strong>: ç”¨äºå­˜å‚¨ç¨‹åºä¸­å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚éé»˜è®¤å€¼</li><li><strong>.bss</strong>ï¼šå­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œæˆ–è€…é»˜è®¤åˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€‚è¿™ä¸€éƒ¨åˆ†åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ä¸å ç¡¬ç›˜ç©ºé—´ï¼Œå³ä¸ä¼šçœŸå®å­˜å‚¨è¿™äº›ä¸ºåˆå§‹åŒ–çš„å˜é‡ï¼Œè€Œæ˜¯åœ¨ç¨‹åºåŠ è½½åˆ°å†…å­˜æ—¶å†åˆ†é…ã€‚å½“ç„¶è‚¯å®šéœ€è¦æœ‰ä¸ªæ ‡è¯†ï¼Œå‘Šè¯‰è¯¥æ€ä¹ˆåˆ†é…å†…å­˜</li><li><strong>.rodata</strong>ï¼šå­˜æ”¾åªè¯»æ•°æ®ï¼Œå¦‚å¸¸é‡æ•°æ®</li></ul><h4 id="å£°æ˜é™æ€æ•°æ®åŒº"><a href="#å£°æ˜é™æ€æ•°æ®åŒº" class="headerlink" title="å£°æ˜é™æ€æ•°æ®åŒº"></a>å£°æ˜é™æ€æ•°æ®åŒº</h4><p>.DATAå£°æ˜é™æ€æ•°æ®åŒº</p><p><strong>åœ¨æ±‡ç¼–ä¸­åªæœ‰ä¸€ç»´æ•°ç»„</strong>ï¼Œåªæœ‰æ²¡æœ‰äºŒç»´å’Œå¤šç»´æ•°ç»„ã€‚</p><h4 id="å†…å­˜å¯»å€"><a href="#å†…å­˜å¯»å€" class="headerlink" title="å†…å­˜å¯»å€"></a>å†…å­˜å¯»å€</h4><ul><li><strong>ç«‹å³å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov rax, 123 ; rax = 123</span><br></pre></td></tr></table></figure><ul><li><strong>å¯„å­˜å™¨å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add rax, rbx ; rax = rax + rbx</span><br></pre></td></tr></table></figure><ul><li><strong>ç›´æ¥å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [someVariable] ; eax = contents of memory at address someVariable</span><br></pre></td></tr></table></figure><ul><li><strong>é—´æ¥å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [rbx] ; eax = contents of memory at address stored in rbx</span><br></pre></td></tr></table></figure><ul><li><strong>åŸºå€å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [rbx+4] ; eax = contents of memory at address (rbx + 4)</span><br></pre></td></tr></table></figure><ul><li><strong>ç´¢å¼•å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [rbx+rcx*4] ; eax = contents of memory at address (rbx + rcx*4)</span><br></pre></td></tr></table></figure><ul><li><strong>åŸºå€å˜å€å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [rbx+rcx+4] ; eax = contents of memory at address (rbx + rcx + 4)</span><br></pre></td></tr></table></figure><h4 id="Heap"><a href="#Heap" class="headerlink" title="Heap"></a>Heap</h4><p>å› ä¸ºç”¨æˆ·ä¸»åŠ¨è¯·æ±‚è€Œåˆ’åˆ†å‡ºæ¥çš„å†…å­˜åŒºåŸŸï¼Œå«åš Heapï¼ˆå †ï¼‰ã€‚</p><p>å®ƒç”±èµ·å§‹åœ°å€å¼€å§‹ï¼Œä»ä½ä½ï¼ˆåœ°å€ï¼‰å‘é«˜ä½ï¼ˆåœ°å€ï¼‰å¢é•¿ã€‚</p><p>Heap çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹å°±æ˜¯ä¸ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œå¿…é¡»æ‰‹åŠ¨é‡Šæ”¾ï¼Œæˆ–è€…ç”±åƒåœ¾å›æ”¶æœºåˆ¶æ¥å›æ”¶ã€‚</p><h4 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h4><p>é™¤äº† Heap ä»¥å¤–ï¼Œå…¶ä»–çš„å†…å­˜å ç”¨å«åš Stackï¼ˆæ ˆï¼‰ã€‚ç®€å•è¯´ï¼ŒStack æ˜¯ç”±äºå‡½æ•°è¿è¡Œè€Œä¸´æ—¶å ç”¨çš„å†…å­˜åŒºåŸŸã€‚</p><p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018012210.png" alt="img"></p><h3 id="ï¼ˆäº”ï¼‰ã€æŒ‡ä»¤"><a href="#ï¼ˆäº”ï¼‰ã€æŒ‡ä»¤" class="headerlink" title="ï¼ˆäº”ï¼‰ã€æŒ‡ä»¤"></a>ï¼ˆäº”ï¼‰ã€æŒ‡ä»¤</h3><h4 id="leaå’ŒmovæŒ‡ä»¤"><a href="#leaå’ŒmovæŒ‡ä»¤" class="headerlink" title="leaå’ŒmovæŒ‡ä»¤"></a>leaå’ŒmovæŒ‡ä»¤</h4><p>LEAæŒ‡ä»¤å°†å…¶ç¬¬äºŒä¸ªæ“ä½œå¯¹è±¡æŒ‡å®šçš„åœ°å€æ”¾å…¥å…¶ç¬¬ä¸€ä¸ªæ“ä½œå¯¹è±¡æŒ‡å®šçš„å¯„å­˜å™¨ä¸­ã€‚</p><p>MOVæŒ‡ä»¤å°†å…¶ç¬¬äºŒæ“ä½œå¯¹è±¡ï¼ˆå³å¯„å­˜å™¨å†…å®¹ã€å†…å­˜å†…å®¹æˆ–å¸¸é‡å€¼ï¼‰æ‰€å¼•ç”¨çš„æ•°æ®é¡¹å¤åˆ¶åˆ°å…¶ç¬¬ä¸€æ“ä½œå¯¹è±¡ï¼ˆå³å¯„å­˜å™¨æˆ–å†…å­˜ï¼‰æ‰€å¼•ç”¨çš„ä½ç½®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [ebx]     ; å°†EBXä¸­çš„åœ°å€æ‰€æŒ‡å‘çš„å†…å­˜ä¸­çš„4ä¸ªå­—èŠ‚ç§»åŠ¨åˆ°EAXä¸­</span><br><span class="line">mov [var], ebx     ; å°†EBXçš„å†…å®¹ç§»åˆ°å†…å­˜åœ°å€varçš„4ä¸ªå­—èŠ‚ä¸­(æ³¨æ„ï¼Œä¸åŠ ä¸­æ‹¬å·çš„varæ˜¯ä¸€ä¸ª32ä½åœ°å€å¸¸é‡ï¼ŒåŠ ä¸­æ‹¬å·æ‰æ˜¯å–åœ°å€æŒ‡å‘çš„å†…å®¹)</span><br><span class="line">mov eax, [esi-4] ; å°†å†…å­˜åœ°å€ESI+(-4)ä¸Šçš„4ä¸ªå­—èŠ‚ç§»å…¥EAX</span><br><span class="line">mov [esi+eax], cl ; å°†CLçš„å†…å®¹ç§»åˆ°åœ°å€ä¸ºESI+EAXçš„å•å­—èŠ‚ä¸­</span><br><span class="line">mov edx, [esi+4*ebx] ; å°†åœ°å€ä¸ºESI+4*EBXçš„4å­—èŠ‚æ•°æ®ç§»åŠ¨åˆ°EDXä¸­</span><br></pre></td></tr></table></figure><h4 id="ADDã€SUBæŒ‡ä»¤"><a href="#ADDã€SUBæŒ‡ä»¤" class="headerlink" title="ADDã€SUBæŒ‡ä»¤"></a>ADDã€SUBæŒ‡ä»¤</h4><p>ç”¨äºå¯¹å­—èŠ‚ï¼Œå­—å’ŒåŒå­—å¤§å°çš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œç®€å•çš„åŠ /å‡ï¼Œå³åˆ†åˆ«ç”¨äºæ·»åŠ æˆ–å‡å»8ä½ï¼Œ16ä½æˆ–32ä½æ“ä½œæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add &lt;reg&gt;,&lt;reg&gt;</span><br><span class="line">add &lt;reg&gt;,&lt;mem&gt;</span><br><span class="line">add &lt;mem&gt;,&lt;reg&gt;</span><br><span class="line">add &lt;reg&gt;,&lt;con&gt;</span><br><span class="line">add &lt;mem&gt;,&lt;con&gt;</span><br><span class="line">sub al, ah ; AL â† AL - AH</span><br><span class="line">sub eax, 216 ; ä»å­˜å‚¨åœ¨EAXä¸­çš„å€¼ä¸­å‡å»216</span><br></pre></td></tr></table></figure><h4 id="INCå’ŒDECæŒ‡ä»¤"><a href="#INCå’ŒDECæŒ‡ä»¤" class="headerlink" title="INCå’ŒDECæŒ‡ä»¤"></a>INCå’ŒDECæŒ‡ä»¤</h4><p>ç›®æ ‡æ“ä½œæ•°å¯ä»¥æ˜¯8ä½ï¼Œ16ä½æˆ–32ä½æ“ä½œæ•°ã€‚</p><p>INCæŒ‡ä»¤ç”¨äºå°†æ“ä½œæ•°åŠ 1ã€‚</p><p>DECæŒ‡ä»¤ç”¨äºå°†æ“ä½œæ•°å‡1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INC EBX      ;  32-bit å¯„å­˜å™¨ è‡ªå¢1</span><br><span class="line">INC DL       ;  8-bit å¯„å­˜å™¨ è‡ªå¢1</span><br><span class="line">INC [count]  ;  å˜é‡count  è‡ªå¢1</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="imulã€idiv"><a href="#imulã€idiv" class="headerlink" title="imulã€idiv"></a>imulã€idiv</h4><p>æ•´æ•°ä¹˜é™¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">imul &lt;reg32&gt;,&lt;reg32&gt;</span><br><span class="line">imul &lt;reg32&gt;,&lt;mem&gt;</span><br><span class="line">imul &lt;reg32&gt;,&lt;reg32&gt;,&lt;con&gt;</span><br><span class="line">imul &lt;reg32&gt;,&lt;mem&gt;,&lt;con&gt;</span><br><span class="line"></span><br><span class="line">imul eax, [var] ; å°†EAXçš„å†…å®¹ä¹˜ä»¥å†…å­˜ä½ç½®varçš„32ä½å†…å®¹å¹¶å°†ç»“æœå­˜å‚¨åœ¨EAXä¸­</span><br><span class="line">imul esi, edi, 25 ; ESI â†’ EDI * 25</span><br><span class="line"></span><br><span class="line">idiv &lt;reg32&gt;</span><br><span class="line">idiv &lt;mem&gt;</span><br><span class="line"></span><br><span class="line">idiv ebx ; å°†EDX:EAXçš„å†…å®¹é™¤ä»¥EBXçš„å†…å®¹ã€‚æŠŠå•†æ”¾åœ¨EAXä¸­ï¼Œä½™æ”¾åœ¨EDXä¸­</span><br><span class="line">idiv DWORD PTR [var] ; å°†EDX:EAXçš„å†…å®¹é™¤ä»¥å­˜å‚¨åœ¨å†…å­˜ä½ç½®varçš„32ä½å€¼ã€‚æŠŠå•†æ”¾åœ¨EAXä¸­ï¼Œä½™æ”¾åœ¨EDXä¸­</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="and-or-xoræŒ‡ä»¤"><a href="#and-or-xoræŒ‡ä»¤" class="headerlink" title="and, or, xoræŒ‡ä»¤"></a><strong>and, or, xor</strong>æŒ‡ä»¤</h4><p>æŒ‰ä½ä¸ã€æˆ–å’Œå¼‚æˆ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">and &lt;reg&gt;,&lt;reg&gt;</span><br><span class="line">and &lt;reg&gt;,&lt;mem&gt;</span><br><span class="line">and &lt;mem&gt;,&lt;reg&gt;</span><br><span class="line">and &lt;reg&gt;,&lt;con&gt;</span><br><span class="line">and &lt;mem&gt;,&lt;con&gt;</span><br><span class="line"></span><br><span class="line">and eax, 0fH ; æ¸…é™¤EAXçš„é™¤æœ€å4ä½ä»¥å¤–çš„æ‰€æœ‰ä½</span><br><span class="line">xor edx, edx ; å°†EDXçš„å†…å®¹è®¾ç½®ä¸ºé›¶</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="notã€negæŒ‡ä»¤"><a href="#notã€negæŒ‡ä»¤" class="headerlink" title="notã€negæŒ‡ä»¤"></a>notã€negæŒ‡ä»¤</h4><p>NOT æŒ‡ä»¤è§¦å‘ï¼ˆç¿»è½¬ï¼‰æ“ä½œå¯¹è±¡ä¸­çš„æ‰€æœ‰ä½ã€‚å…¶ç»“æœè¢«ç§°ä¸ºåç ã€‚</p><p>NEGæ˜¯æ±‡ç¼–æŒ‡ä»¤ä¸­çš„æ±‚è¡¥æŒ‡ä»¤ï¼Œå¯¹æ“ä½œå¯¹è±¡æ‰§è¡Œæ±‚è¡¥è¿ç®—ï¼šç”¨é›¶å‡å»æ“ä½œå¯¹è±¡ï¼Œç„¶åç»“æœè¿”å›æ“ä½œå¯¹è±¡ã€‚</p><p>ï¼ˆå°†æ“ä½œå¯¹è±¡æŒ‰ä½å–åååŠ 1ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">not &lt;reg&gt;</span><br><span class="line">not &lt;mem&gt;</span><br><span class="line"></span><br><span class="line">not BYTE PTR [var] ; å–åå†…å­˜ä½ç½®varçš„å­—èŠ‚ä¸­çš„æ‰€æœ‰ä½</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="shl-shræŒ‡ä»¤"><a href="#shl-shræŒ‡ä»¤" class="headerlink" title="shl, shræŒ‡ä»¤"></a><strong>shl, shr</strong>æŒ‡ä»¤</h4><p> å·¦ç§»ï¼Œå³ç§»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shl &lt;reg&gt;,&lt;con8&gt;</span><br><span class="line">shl &lt;mem&gt;,&lt;con8&gt;</span><br><span class="line">shl &lt;reg&gt;,&lt;cl&gt;</span><br><span class="line">shl &lt;mem&gt;,&lt;cl&gt;</span><br><span class="line"></span><br><span class="line">shl eax, 1 ; å°†EAXçš„å€¼ä¹˜ä»¥2ï¼ˆå¦‚æœæœ€é«˜æœ‰æ•ˆä½ä¸º0ï¼‰</span><br><span class="line">shr ebx, cl ; å°†EBXçš„å€¼é™¤ä»¥2^n^çš„ç»“æœçš„ä¸‹é™å­˜å‚¨åœ¨EBXä¸­ï¼Œå…¶ä¸­næ˜¯CLä¸­çš„å€¼</span><br></pre></td></tr></table></figure><h4 id="JMPåŠè¡ç”Ÿ"><a href="#JMPåŠè¡ç”Ÿ" class="headerlink" title="JMPåŠè¡ç”Ÿ"></a>JMPåŠè¡ç”Ÿ</h4><p>æ— æ¡ä»¶è·³è½¬</p><div class="table-container"><table><thead><tr><th>JMP</th><th>æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤</th></tr></thead><tbody><tr><td><strong>JC</strong></td><td>è¿›ä½æ—¶è·³è½¬</td></tr><tr><td><strong>JO</strong></td><td>æº¢å‡ºæ—¶è·³è½¬</td></tr><tr><td><strong>JE</strong>/<strong>JZ</strong></td><td>ç›¸ç­‰/é›¶æ—¶è·³è½¬</td></tr><tr><td><strong>JS</strong></td><td>è´Ÿæ•°æ—¶è·³è½¬</td></tr><tr><td><strong>JP</strong>/<strong>JPE</strong></td><td>å¥‡å¶æ ¡éªŒæ—¶è·³è½¬</td></tr><tr><td></td></tr></tbody></table></div><h4 id="CMPæŒ‡ä»¤"><a href="#CMPæŒ‡ä»¤" class="headerlink" title="CMPæŒ‡ä»¤"></a>CMPæŒ‡ä»¤</h4><p>æ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMP DX, 00  ; å°†DXå€¼ä¸0è¿›è¡Œæ¯”è¾ƒ</span><br><span class="line">JE  L7      ; å¦‚æœç­‰äºï¼Œåˆ™è·³è½¬åˆ°æ ‡ç­¾L7</span><br></pre></td></tr></table></figure><h4 id="LOOPæŒ‡ä»¤"><a href="#LOOPæŒ‡ä»¤" class="headerlink" title="LOOPæŒ‡ä»¤"></a>LOOPæŒ‡ä»¤</h4><p>å®ç°å¾ªç¯ï¼ˆè®¡æ•°å‹å¾ªç¯ï¼‰</p><p>CX = CX -1</p><p>åˆ¤æ–­CXä¸­çš„å€¼ï¼Œä¸ä¸º0åˆ™ç»§ç»­è·³è½¬ï¼›ä¸º0åˆ™å‘ä¸‹æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOOP    label</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å…­-ã€è°ƒç”¨çº¦å®š"><a href="#å…­-ã€è°ƒç”¨çº¦å®š" class="headerlink" title="(å…­)ã€è°ƒç”¨çº¦å®š"></a>(å…­)ã€è°ƒç”¨çº¦å®š</h3><h4 id="ç³»ç»Ÿè°ƒç”¨"><a href="#ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨"></a><strong>ç³»ç»Ÿè°ƒç”¨</strong></h4><p>æ“ä½œç³»ç»Ÿä¸ºç”¨æˆ·æ€è¿è¡Œçš„è¿›ç¨‹ä¸ç¡¬ä»¶è®¾å¤‡ä¹‹é—´è¿›è¡Œäº¤äº’æä¾›äº†ä¸€ç»„æ¥å£ã€‚</p><p>å®è´¨ä¸Šå°±æ˜¯<strong><em>\</em>å‡½æ•°è°ƒç”¨**</strong>ï¼Œåªä¸è¿‡è°ƒç”¨çš„æ˜¯<strong><em>\</em>ç³»ç»Ÿå‡½æ•°**</strong>ï¼Œå¤„äºå†…æ ¸æ€è€Œå·²</p><p>åœ¨Linuxä¸­ï¼ŒEAXå¯„å­˜å™¨æ˜¯è´Ÿè´£ä¼ é€’ç³»ç»Ÿè°ƒç”¨å·çš„ã€‚</p><h2 id="å†…è”æ±‡ç¼–"><a href="#å†…è”æ±‡ç¼–" class="headerlink" title="å†…è”æ±‡ç¼–"></a>å†…è”æ±‡ç¼–</h2><h3 id="ï¼ˆä¸€ï¼‰ã€å†…è”å‡½æ•°"><a href="#ï¼ˆä¸€ï¼‰ã€å†…è”å‡½æ•°" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€å†…è”å‡½æ•°"></a>ï¼ˆä¸€ï¼‰ã€å†…è”å‡½æ•°</h3><p>å†…è”æ±‡ç¼–æ˜¯æŒ‡åœ¨é«˜çº§è¯­è¨€ä¸­åµŒå…¥æ±‡ç¼–ä»£ç ï¼Œï¼Œå‡å°‘å‡½æ•°è°ƒç”¨ã€‚</p><h3 id="ï¼ˆäºŒï¼‰ã€å†…è”æ±‡ç¼–è¯­æ³•"><a href="#ï¼ˆäºŒï¼‰ã€å†…è”æ±‡ç¼–è¯­æ³•" class="headerlink" title="ï¼ˆäºŒï¼‰ã€å†…è”æ±‡ç¼–è¯­æ³•"></a>ï¼ˆäºŒï¼‰ã€å†…è”æ±‡ç¼–è¯­æ³•</h3><h4 id="1-åœ¨-GCC-ä¸­"><a href="#1-åœ¨-GCC-ä¸­" class="headerlink" title="1. åœ¨ GCC ä¸­"></a>1. åœ¨ GCC ä¸­</h4><p>ä½¿ç”¨ <code>asm</code> æˆ– <code>__asm__</code> å…³é”®å­—ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">asm</span>(<span class="string">&quot;assembly-code&quot;</span> : output : input : clobbered_registers);</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>, b = <span class="number">20</span>, result;</span><br><span class="line"><span class="keyword">asm</span>(<span class="string">&quot;addl %%ebx, %%eax&quot;</span></span><br><span class="line">    : <span class="string">&quot;=a&quot;</span>(result)           <span class="comment">// è¾“å‡ºçº¦æŸï¼Œ`a` è¡¨ç¤ºä½¿ç”¨ EAX å¯„å­˜å™¨</span></span><br><span class="line">    : <span class="string">&quot;a&quot;</span>(a), <span class="string">&quot;b&quot;</span>(b)         <span class="comment">// è¾“å…¥çº¦æŸï¼Œ`b` è¡¨ç¤ºä½¿ç”¨ EBX å¯„å­˜å™¨</span></span><br><span class="line">    : <span class="string">&quot;cc&quot;</span>);                 <span class="comment">// é€šçŸ¥ç¼–è¯‘å™¨æ¡ä»¶ç è¢«ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><h4 id="å…³é”®çº¦æŸï¼š"><a href="#å…³é”®çº¦æŸï¼š" class="headerlink" title="å…³é”®çº¦æŸï¼š"></a>å…³é”®çº¦æŸï¼š</h4><ul><li><strong>æ“ä½œæ•°çº¦æŸ</strong>ï¼š<ul><li><code>&quot;r&quot;</code>ï¼šä»»æ„å¯„å­˜å™¨</li><li><code>&quot;m&quot;</code>ï¼šå†…å­˜æ“ä½œæ•°</li><li><code>&quot;i&quot;</code>ï¼šç«‹å³æ•°</li><li><code>&quot;a&quot;</code>ï¼šEAX</li><li><code>&quot;b&quot;</code>ï¼šEBX ç­‰</li></ul></li><li><strong>ä¿®é¥°ç¬¦</strong>ï¼š<ul><li><code>=ï¼š</code>ï¼šè¡¨ç¤ºå†™å…¥è¾“å‡º</li><li><code>+ï¼š</code>ï¼šè¡¨ç¤ºè¯»å†™æ“ä½œ</li><li><code>&amp;ï¼š</code>ï¼šè¡¨ç¤ºæ—©æœŸé‡Šæ”¾å¯„å­˜å™¨</li></ul></li></ul><h4 id="2-åœ¨-MSVC-ä¸­"><a href="#2-åœ¨-MSVC-ä¸­" class="headerlink" title="2. åœ¨ MSVC ä¸­"></a>2. åœ¨ MSVC ä¸­</h4><p>ä½¿ç”¨ <code>__asm</code> å…³é”®å­—ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__asm &#123;</span><br><span class="line">    mov eax, <span class="number">1</span></span><br><span class="line">    add eax, <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">5</span>, b = <span class="number">3</span>, result;</span><br><span class="line">    __asm &#123;</span><br><span class="line">        mov eax, a</span><br><span class="line">        add eax, b</span><br><span class="line">        mov result, eax</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Result: %d\n&quot;</span>, result);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸‰-å¸¸ç”¨æŒ‡ä»¤ç¤ºä¾‹"><a href="#ä¸‰-å¸¸ç”¨æŒ‡ä»¤ç¤ºä¾‹" class="headerlink" title="(ä¸‰)å¸¸ç”¨æŒ‡ä»¤ç¤ºä¾‹"></a>(ä¸‰)å¸¸ç”¨æŒ‡ä»¤ç¤ºä¾‹</h3><h4 id="1-æ•°æ®ä¼ é€"><a href="#1-æ•°æ®ä¼ é€" class="headerlink" title="1. æ•°æ®ä¼ é€"></a>1. æ•°æ®ä¼ é€</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov eax, 10       ; å°† 10 é€å…¥ EAX å¯„å­˜å™¨</span><br><span class="line">mov ebx, eax      ; å°† EAX çš„å€¼ä¼ ç»™ EBX</span><br></pre></td></tr></table></figure><h4 id="2-ç®—æœ¯è¿ç®—"><a href="#2-ç®—æœ¯è¿ç®—" class="headerlink" title="2. ç®—æœ¯è¿ç®—"></a>2. ç®—æœ¯è¿ç®—</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add eax, ebx      ; EAX = EAX + EBX</span><br><span class="line">sub eax, 5        ; EAX = EAX - 5</span><br><span class="line">mul ebx           ; EAX = EAX * EBX</span><br><span class="line">div ecx           ; EAX = EAX / ECX</span><br></pre></td></tr></table></figure><h4 id="3-æ¡ä»¶è·³è½¬"><a href="#3-æ¡ä»¶è·³è½¬" class="headerlink" title="3. æ¡ä»¶è·³è½¬"></a>3. æ¡ä»¶è·³è½¬</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmp eax, ebx      ; æ¯”è¾ƒ EAX å’Œ EBX</span><br><span class="line">je equal_label    ; å¦‚æœç›¸ç­‰ï¼Œåˆ™è·³è½¬åˆ° equal_label</span><br><span class="line">jg greater_label  ; å¦‚æœå¤§äºï¼Œåˆ™è·³è½¬åˆ° greater_label</span><br></pre></td></tr></table></figure><h4 id="4-æ ˆæ“ä½œ"><a href="#4-æ ˆæ“ä½œ" class="headerlink" title="4. æ ˆæ“ä½œ"></a>4. æ ˆæ“ä½œ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push eax          ; å°† EAX å‹å…¥æ ˆ</span><br><span class="line">pop ebx           ; ä»æ ˆä¸­å¼¹å‡ºå€¼åˆ° EBX</span><br></pre></td></tr></table></figure><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ±‡ç¼– </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
